# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–æ—Ä–º–∞—Ç–µ –∞—É–¥–∏–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏

## üìã –û–±–∑–æ—Ä

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ gRPC.

---

## üîÑ –ü—Ä–æ—Ç–æ–∫–æ–ª –ø–µ—Ä–µ–¥–∞—á–∏

### gRPC Service
**–§–∞–π–ª:** `streaming.proto`  
**–°–µ—Ä–≤–∏—Å:** `StreamingService`  
**–ú–µ—Ç–æ–¥:** `StreamAudio` (streaming)

### Protobuf —Å–æ–æ–±—â–µ–Ω–∏—è

#### StreamResponse
```protobuf
message StreamResponse {
  oneof content {
    string text_chunk = 1;     // –¢–µ–∫—Å—Ç–æ–≤—ã–π —á–∞–Ω–∫
    AudioChunk audio_chunk = 2; // –ê—É–¥–∏–æ —á–∞–Ω–∫
    string end_message = 3;    // –°–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    string error_message = 4;  // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
  }
}
```

#### AudioChunk
```protobuf
message AudioChunk {
  bytes audio_data = 1;        // –ê—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  string dtype = 2;            // –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  repeated int32 shape = 3;    // –§–æ—Ä–º–∞ –º–∞—Å—Å–∏–≤–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}
```

---

## üìä –§–æ—Ä–º–∞—Ç –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö** | Raw PCM | –ù–µ—Å–∂–∞—Ç—ã–µ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ |
| **–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö (dtype)** | `'int16'` | 16-–±–∏—Ç–Ω—ã–µ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ —Å–æ –∑–Ω–∞–∫–æ–º |
| **Sample rate** | `24000` –∏–ª–∏ `48000` Hz | –ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏) |
| **Channels** | `1` (–º–æ–Ω–æ) | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤ |
| **Bits per sample** | `16` –±–∏—Ç | –†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å —Å—ç–º–ø–ª–∞ |
| **Byte order** | Little-endian | –ü–æ—Ä—è–¥–æ–∫ –±–∞–π—Ç–æ–≤ |
| **–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞** | `4096` –±–∞–π—Ç | –†–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| **Shape** | `[]` (–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤) | –§–æ—Ä–º–∞ –¥–∞–Ω–Ω—ã—Ö (1D –º–∞—Å—Å–∏–≤) |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
AudioChunk {
  audio_data: <bytes>     // Raw PCM –¥–∞–Ω–Ω—ã–µ
  dtype: "int16"          // –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö
  shape: []               // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ (1D)
}
```

---

## üî¢ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –§–æ—Ä–º–∞—Ç audio_data

**–¢–∏–ø:** `bytes` (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–π—Ç–æ–≤)  
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** Raw PCM –¥–∞–Ω–Ω—ã–µ

```
audio_data = [
  sample_1_low_byte,  sample_1_high_byte,  // –°—ç–º–ø–ª 1 (16 –±–∏—Ç, little-endian)
  sample_2_low_byte,  sample_2_high_byte,  // –°—ç–º–ø–ª 2 (16 –±–∏—Ç, little-endian)
  sample_3_low_byte,  sample_3_high_byte,  // –°—ç–º–ø–ª 3 (16 –±–∏—Ç, little-endian)
  ...
]
```

### –ü—Ä–∏–º–µ—Ä –±–∞–π—Ç–æ–≤

–î–ª—è —Ç–µ–∫—Å—Ç–∞ "Hello" (–ø—Ä–∏–º–µ—Ä–Ω–æ 1 —Å–µ–∫—É–Ω–¥–∞ –ø—Ä–∏ 24kHz):
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ç–º–ø–ª–æ–≤:** 24000 (–¥–ª—è 1 —Å–µ–∫—É–Ω–¥—ã)
- **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:** 24000 √ó 2 –±–∞–π—Ç–∞ = 48000 –±–∞–π—Ç
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤:** 48000 / 4096 ‚âà 12 —á–∞–Ω–∫–æ–≤

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –±–∞–π—Ç–æ–≤

–ö–∞–∂–¥—ã–π —Å—ç–º–ø–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ 16-–±–∏—Ç–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ —Å–æ –∑–Ω–∞–∫–æ–º:

```python
# Python –ø—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
import struct

# –ß–∏—Ç–∞–µ–º 2 –±–∞–π—Ç–∞ –∫–∞–∫ int16 (little-endian)
sample = struct.unpack('<h', audio_data[0:2])[0]
# sample –±—É–¥–µ—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç -32768 –¥–æ 32767
```

---

## üì° –ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–¥–∞—á–∏

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
EdgeTTSProvider
  ‚Üì
MP3 –æ—Ç Edge TTS API (~20 KB)
  ‚Üì
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è MP3 ‚Üí PCM —á–µ—Ä–µ–∑ pydub
  ‚Üì
Raw PCM –¥–∞–Ω–Ω—ã–µ (~180 KB)
  ‚Üì
–†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏ –ø–æ 4096 –±–∞–π—Ç
  ‚Üì
–ö–∞–∂–¥—ã–π —á–∞–Ω–∫ ‚Üí AudioChunk
```

### 2. –£–ø–∞–∫–æ–≤–∫–∞ –≤ Protobuf

```python
# –ö–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (grpc_server.py)
yield streaming_pb2.StreamResponse(
    audio_chunk=streaming_pb2.AudioChunk(
        audio_data=chunk,      # bytes, —Ä–∞–∑–º–µ—Ä ~4096 –±–∞–π—Ç
        dtype='int16',         # string
        shape=[]               # –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
    )
)
```

### 3. –ü–µ—Ä–µ–¥–∞—á–∞ —á–µ—Ä–µ–∑ gRPC

- **–ü—Ä–æ—Ç–æ–∫–æ–ª:** gRPC streaming
- **–§–æ—Ä–º–∞—Ç:** Protobuf binary
- **Rate limit:** 50ms –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 20 —á–∞–Ω–∫–æ–≤/—Å–µ–∫)

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å `StreamResponse` —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–∞–∂–¥–æ–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –õ–∏–±–æ `text_chunk` (—Ç–µ–∫—Å—Ç)
- –õ–∏–±–æ `audio_chunk` (–∞—É–¥–∏–æ)
- –õ–∏–±–æ `end_message` (–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)
- –õ–∏–±–æ `error_message` (–æ—à–∏–±–∫–∞)

---

## üíª –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

### Python –∫–ª–∏–µ–Ω—Ç

```python
import grpc
import streaming_pb2
import streaming_pb2_grpc
import struct

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
channel = grpc.insecure_channel('localhost:50051')
stub = streaming_pb2_grpc.StreamingServiceStub(channel)

# –ó–∞–ø—Ä–æ—Å
request = streaming_pb2.StreamRequest(
    prompt="Hello, how are you?",
    hardware_id="test_hardware",
    session_id="test_session"
)

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–∏–º–∞
responses = stub.StreamAudio(request)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
all_audio_data = bytearray()
for response in responses:
    if response.HasField('audio_chunk'):
        chunk = response.audio_chunk
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞
        assert chunk.dtype == 'int16', f"Unexpected dtype: {chunk.dtype}"
        assert chunk.shape == [], f"Unexpected shape: {chunk.shape}"
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö
        audio_data = chunk.audio_data
        all_audio_data.extend(audio_data)
        
        print(f"Received chunk: {len(audio_data)} bytes")
    
    elif response.HasField('text_chunk'):
        print(f"Text: {response.text_chunk}")

# –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ
# all_audio_data —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ PCM –¥–∞–Ω–Ω—ã–µ
# –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ WAV
```

### Swift –∫–ª–∏–µ–Ω—Ç (–ø—Ä–∏–º–µ—Ä)

```swift
// –ü–æ–ª—É—á–µ–Ω–∏–µ AudioChunk
let audioChunk = response.audioChunk

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞
guard audioChunk.dtype == "int16" else {
    print("Unexpected dtype: \(audioChunk.dtype)")
    return
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö
let audioData = audioChunk.audioData  // Data

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –º–∞—Å—Å–∏–≤ Int16
let samples = audioData.withUnsafeBytes { bytes in
    Array(UnsafeBufferPointer<Int16>(
        start: bytes.baseAddress?.assumingMemoryBound(to: Int16.self),
        count: bytes.count / 2
    ))
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
// samples —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤ Int16 –∑–Ω–∞—á–µ–Ω–∏–π
```

---

## üìê –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã

### –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

**–î–ª—è 1 —Å–µ–∫—É–Ω–¥—ã –∞—É–¥–∏–æ –ø—Ä–∏ 24kHz:**
- –°—ç–º–ø–ª–æ–≤: 24000
- –ë–∞–π—Ç –Ω–∞ —Å—ç–º–ø–ª: 2 (16 –±–∏—Ç)
- **–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: 48000 –±–∞–π—Ç (46.875 KB)**

**–î–ª—è 1 —Å–µ–∫—É–Ω–¥—ã –∞—É–¥–∏–æ –ø—Ä–∏ 48kHz:**
- –°—ç–º–ø–ª–æ–≤: 48000
- –ë–∞–π—Ç –Ω–∞ —Å—ç–º–ø–ª: 2 (16 –±–∏—Ç)
- **–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: 96000 –±–∞–π—Ç (93.75 KB)**

### –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞

**–ß–∞–Ω–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 4096 –±–∞–π—Ç**
- –°—ç–º–ø–ª–æ–≤ –≤ —á–∞–Ω–∫–µ: 4096 / 2 = 2048 —Å—ç–º–ø–ª–æ–≤
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ 24kHz: 2048 / 24000 ‚âà 0.085 —Å–µ–∫—É–Ω–¥—ã
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ 48kHz: 2048 / 48000 ‚âà 0.043 —Å–µ–∫—É–Ω–¥—ã

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤

**–î–ª—è —Ç–µ–∫—Å—Ç–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é ~3 —Å–µ–∫—É–Ω–¥—ã (–ø—Ä–∏ 24kHz):**
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: 3 √ó 48000 = 144000 –±–∞–π—Ç
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤: 144000 / 4096 ‚âà 36 —á–∞–Ω–∫–æ–≤

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```python
def validate_audio_chunk(chunk):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è AudioChunk"""
    assert chunk.dtype == 'int16', f"Expected int16, got {chunk.dtype}"
    assert len(chunk.shape) == 0, f"Expected empty shape, got {chunk.shape}"
    assert len(chunk.audio_data) > 0, "Audio data is empty"
    assert len(chunk.audio_data) % 2 == 0, "Audio data size must be even (16-bit samples)"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ int16
    sample_count = len(chunk.audio_data) // 2
    print(f"‚úÖ Valid chunk: {sample_count} samples, {len(chunk.audio_data)} bytes")
    return True
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WAV (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```python
import wave
import struct

def save_pcm_to_wav(pcm_data, filename, sample_rate=24000, channels=1):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PCM –¥–∞–Ω–Ω—ã—Ö –≤ WAV —Ñ–∞–π–ª"""
    with wave.open(filename, 'wb') as wav_file:
        wav_file.setnchannels(channels)
        wav_file.setsampwidth(2)  # 16 –±–∏—Ç = 2 –±–∞–π—Ç–∞
        wav_file.setframerate(sample_rate)
        wav_file.writeframes(pcm_data)
    
    print(f"‚úÖ WAV —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {filename}")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
all_audio_data = b''.join([chunk.audio_data for chunk in audio_chunks])
save_pcm_to_wav(all_audio_data, 'output.wav', sample_rate=24000)
```

---

## üìã –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è AudioChunk

### –ü–æ–ª—è

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------------|----------|----------|
| `audio_data` | `bytes` | ‚úÖ required | Raw PCM –±–∞–π—Ç—ã | –ê—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ |
| `dtype` | `string` | ‚úÖ required | `"int16"` | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö (–≤—Å–µ–≥–¥–∞ int16) |
| `shape` | `repeated int32` | ‚ö™ optional | `[]` | –§–æ—Ä–º–∞ –º–∞—Å—Å–∏–≤–∞ (–ø—É—Å—Ç–æ–π –¥–ª—è 1D) |

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **audio_data:** –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–µ–Ω 2 –±–∞–π—Ç–∞–º (16-–±–∏—Ç–Ω—ã–µ —Å—ç–º–ø–ª—ã)
- **dtype:** –í—Å–µ–≥–¥–∞ `"int16"` (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä—É–≥–∏–º)
- **shape:** –í—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]` (1D –¥–∞–Ω–Ω—ã–µ)

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä 1: –ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç

**–¢–µ–∫—Å—Ç:** "Hello!"  
**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~0.5 —Å–µ–∫—É–Ω–¥—ã  
**Sample rate:** 24000 Hz

```
–ß–∞–Ω–∫ 1: 4096 –±–∞–π—Ç (2048 —Å—ç–º–ø–ª–æ–≤, ~0.085 —Å–µ–∫)
–ß–∞–Ω–∫ 2: 4096 –±–∞–π—Ç (2048 —Å—ç–º–ø–ª–æ–≤, ~0.085 —Å–µ–∫)
–ß–∞–Ω–∫ 3: 4096 –±–∞–π—Ç (2048 —Å—ç–º–ø–ª–æ–≤, ~0.085 —Å–µ–∫)
–ß–∞–Ω–∫ 4: 4096 –±–∞–π—Ç (2048 —Å—ç–º–ø–ª–æ–≤, ~0.085 —Å–µ–∫)
–ß–∞–Ω–∫ 5: 4096 –±–∞–π—Ç (2048 —Å—ç–º–ø–ª–æ–≤, ~0.085 —Å–µ–∫)
–ß–∞–Ω–∫ 6: 4096 –±–∞–π—Ç (2048 —Å—ç–º–ø–ª–æ–≤, ~0.085 —Å–µ–∫)
–ò—Ç–æ–≥–æ: ~24000 –±–∞–π—Ç (12000 —Å—ç–º–ø–ª–æ–≤, ~0.5 —Å–µ–∫)
```

### –ü—Ä–∏–º–µ—Ä 2: –î–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

**–¢–µ–∫—Å—Ç:** "Hello! This is a longer test response from the assistant."  
**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~3 —Å–µ–∫—É–Ω–¥—ã  
**Sample rate:** 24000 Hz

```
–ß–∞–Ω–∫–æ–≤: ~36 (–ø–æ 4096 –±–∞–π—Ç)
–í—Å–µ–≥–æ: ~147456 –±–∞–π—Ç (73728 —Å—ç–º–ø–ª–æ–≤, ~3 —Å–µ–∫)
```

---

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Azure TTS

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Azure TTS (—Å—Ç–∞—Ä—ã–π) | Edge TTS (–Ω–æ–≤—ã–π) | –ò–¥–µ–Ω—Ç–∏—á–Ω–æ? |
|----------|-------------------|------------------|------------|
| **–§–æ—Ä–º–∞—Ç** | Raw PCM | Raw PCM | ‚úÖ –î–∞ |
| **dtype** | `'int16'` | `'int16'` | ‚úÖ –î–∞ |
| **Sample rate** | 24000 Hz | 24000/48000 Hz | ‚ö†Ô∏è –ú–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è |
| **Channels** | 1 (–º–æ–Ω–æ) | 1 (–º–æ–Ω–æ) | ‚úÖ –î–∞ |
| **Bits per sample** | 16 –±–∏—Ç | 16 –±–∏—Ç | ‚úÖ –î–∞ |
| **–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞** | 4096 –±–∞–π—Ç | 4096 –±–∞–π—Ç | ‚úÖ –î–∞ |
| **Shape** | `[]` | `[]` | ‚úÖ –î–∞ |
| **Byte order** | Little-endian | Little-endian | ‚úÖ –î–∞ |

**–í—ã–≤–æ–¥:** –§–æ—Ä–º–∞—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–Ω—Ç–∏—á–µ–Ω, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ —Ä–∞–∑–ª–∏—á–∏—è –≤ sample rate (24kHz vs 48kHz).

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. Sample Rate
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** 24000 Hz
- **–ú–æ–∂–µ—Ç –±—ã—Ç—å:** 48000 Hz (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- **–ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å sample rate –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 2. –ü–æ—Ä—è–¥–æ–∫ –±–∞–π—Ç–æ–≤
- **Little-endian:** –ú–ª–∞–¥—à–∏–π –±–∞–π—Ç –ø–µ—Ä–≤—ã–º
- **–ü—Ä–∏–º–µ—Ä:** –°—ç–º–ø–ª `0x1234` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ `[0x34, 0x12]`

### 3. –ó–Ω–∞—á–µ–Ω–∏—è —Å—ç–º–ø–ª–æ–≤
- **–î–∏–∞–ø–∞–∑–æ–Ω:** -32768 –¥–æ 32767 (16-–±–∏—Ç–Ω–æ–µ —Ü–µ–ª–æ–µ —Å–æ –∑–Ω–∞–∫–æ–º)
- **–¢–∏—à–∏–Ω–∞:** –û–±—ã—á–Ω–æ –æ–∫–æ–ª–æ 0
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∞–º–ø–ª–∏—Ç—É–¥–∞:** ¬±32767

### 4. –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–æ–≤
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** 4096 –±–∞–π—Ç
- **–ú–æ–∂–µ—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è:** –ü–æ—Å–ª–µ–¥–Ω–∏–π —á–∞–Ω–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ
- **–ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —á–∞–Ω–∫–∏ —Ä–∞–∑–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

---

## üìù –†–µ–∑—é–º–µ

### –§–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–¥–∞—á–∏

```
gRPC StreamResponse {
  audio_chunk: {
    audio_data: <bytes>,        // Raw PCM, 16-bit, little-endian
    dtype: "int16",             // –í—Å–µ–≥–¥–∞ int16
    shape: []                   // –í—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
  }
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—É–¥–∏–æ

- **–§–æ—Ä–º–∞—Ç:** Raw PCM (–±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
- **–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:** int16 (16-–±–∏—Ç–Ω—ã–µ —Ü–µ–ª—ã–µ —Å–æ –∑–Ω–∞–∫–æ–º)
- **Sample rate:** 24000 Hz (–∏–ª–∏ 48000 Hz)
- **Channels:** 1 (–º–æ–Ω–æ)
- **Byte order:** Little-endian
- **–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞:** 4096 –±–∞–π—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

1. –ü–æ–ª—É—á–∏—Ç—å `AudioChunk` –∏–∑ `StreamResponse`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `dtype == "int16"`
3. –ò–∑–≤–ª–µ—á—å `audio_data` (bytes)
4. –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –º–∞—Å—Å–∏–≤ 16-–±–∏—Ç–Ω—ã—Ö —Ü–µ–ª—ã—Ö (little-endian)
5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: 2025-12-26*  
*–í–µ—Ä—Å–∏—è: 1.0*  
*–°—Ç–∞—Ç—É—Å: ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ*

