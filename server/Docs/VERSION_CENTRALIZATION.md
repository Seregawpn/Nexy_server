# üéØ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 27 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è  
**–í–µ—Ä—Å–∏—è:** 1.0.1

---

## üìã –û–±–∑–æ—Ä

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π —Å–µ—Ä–≤–µ—Ä–∞. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (`config.env`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –º–æ–¥—É–ª–∏.

---

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

**`config.env`** ‚Üí –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
SERVER_VERSION=1.0.1
SERVER_BUILD=1.0.1
```

### –¶–µ–ø–æ—á–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π

```
config.env
  ‚Üì
unified_config.py (ServerMetadataConfig, UpdateServiceConfig)
  ‚Üì
main.py (health/status endpoints)
  ‚Üì
update_server_provider.py (appcast/health endpoints)
```

---

## üìç –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–µ—Ä—Å–∏–∏

### 1. –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä (`main.py`)
- `/health` endpoint ‚Üí `latest_version`, `latest_build`
- `/status` endpoint ‚Üí `latest_version`, `latest_build`
- –ò—Å—Ç–æ—á–Ω–∏–∫: `unified_config.get_server_metadata()`

### 2. Update Server (`update_server_provider.py`)
- `/updates/health` endpoint ‚Üí `latest_version`, `latest_build`
- `/appcast.xml` ‚Üí `sparkle:version`, `sparkle:shortVersionString`
- –ò—Å—Ç–æ—á–Ω–∏–∫: `config.default_version`, `config.default_build` (–∏–∑ `unified_config`)

### 3. –ú–∞–Ω–∏—Ñ–µ—Å—Ç—ã (`updates/manifests/manifest.json`)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- –í–µ—Ä—Å–∏—è –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –≤–µ—Ä—Å–∏–µ–π –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- –ü—Ä–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –≤–µ—Ä—Å–∏–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

---

## üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏

### –õ–æ–∫–∞–ª—å–Ω–æ

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.env`:
```bash
SERVER_VERSION=1.0.2
SERVER_BUILD=1.0.2
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ)

### –ù–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (Azure)

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
./scripts/update_server_version.sh 1.0.2 1.0.2
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û–±–Ω–æ–≤–∏—Ç `config.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –û–±–Ω–æ–≤–∏—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

**–í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Azure CLI**
```bash
az vm run-command invoke \
  --resource-group Nexy \
  --name nexy-regular \
  --command-id RunShellScript \
  --scripts "
    CONFIG_FILE=\"/home/azureuser/voice-assistant/server/config.env\"
    sed -i 's/^SERVER_VERSION=.*/SERVER_VERSION=1.0.2/' \$CONFIG_FILE
    sed -i 's/^SERVER_BUILD=.*/SERVER_BUILD=1.0.2/' \$CONFIG_FILE
    sudo systemctl restart voice-assistant.service
  "
```

---

## üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞

–ï—Å–ª–∏ –≤—ã –æ–±–Ω–æ–≤–∏–ª–∏ –∫–æ–¥ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ –µ–≥–æ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä:

```bash
./scripts/sync_version_centralization.sh
```

–°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–∏—Ç:
- `config/unified_config.py`
- `modules/update/providers/update_server_provider.py`
- `modules/update/config.py`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –õ–æ–∫–∞–ª—å–Ω–æ
```bash
python3 -c "
from config.unified_config import get_config
c = get_config()
print(f'Version: {c.get_server_metadata().version}')
print(f'Build: {c.get_server_metadata().build}')
"
```

### –£–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ /health
curl -sk https://20.151.51.172/health | jq '.latest_version, .latest_build'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ /updates/health
curl -sk https://20.151.51.172/updates/health | jq '.latest_version, .latest_build'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ /appcast.xml
curl -sk https://20.151.51.172/appcast.xml | grep -o 'sparkle:version="[^"]*"'
```

–í—Å–µ –≤–µ—Ä—Å–∏–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å!

---

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –í–µ—Ä—Å–∏–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç –º–µ–∂–¥—É —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `config.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
az vm run-command invoke \
  --resource-group Nexy \
  --name nexy-regular \
  --command-id RunShellScript \
  --scripts "cat /home/azureuser/voice-assistant/server/config.env | grep SERVER_VERSION"
```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sync_version_centralization.sh`)

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:
```bash
az vm run-command invoke \
  --resource-group Nexy \
  --name nexy-regular \
  --command-id RunShellScript \
  --scripts "sudo systemctl restart voice-assistant.service"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í–µ—Ä—Å–∏—è –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–Ω—Ñ–∏–≥–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –≤–µ—Ä—Å–∏–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞. –ú–∞–Ω–∏—Ñ–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤. –í–µ—Ä—Å–∏—è –≤ AppCast XML –≤—Å–µ–≥–¥–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞.

---

## üìù –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏** (`"1.0.1"`, –Ω–µ `1.0.1` –∏–ª–∏ `1001`)
2. **–í–µ—Ä—Å–∏—è –∏ build –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å** (—Å–æ–≥–ª–∞—Å–Ω–æ Section 11.1 –ø—Ä–∞–≤–∏–ª)
3. **–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç** (—Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞, SHA256)
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `Docs/VERSION_FORMAT_CRITICAL_FIX.md` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤–µ—Ä—Å–∏–π
- `Docs/SERVER_DEVELOPMENT_RULES.md` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
- `scripts/update_server_version.sh` ‚Äî —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏
- `scripts/sync_version_centralization.sh` ‚Äî —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 27 –Ω–æ—è–±—Ä—è 2025

