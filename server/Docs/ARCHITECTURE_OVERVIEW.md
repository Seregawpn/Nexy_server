# üß≠ Nexy ‚Äî –û–±–∑–æ—Ä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã Nexy. –ó–¥–µ—Å—å –æ–ø–∏—Å–∞–Ω—ã —Ä–æ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã, —Å–æ–±—ã—Ç–∏—è, –ø—Ä–∞–≤–∏–ª–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∂–∏–º–æ–≤ –∏ –æ–∂–∏–¥–∞–µ–º—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –º–µ–∂–¥—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ –∏ –º–æ–¥—É–ª—è–º–∏.

- –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –∏ –º–æ–¥—É–ª–µ–π Nexy
- –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏: –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π (–∫–∞–∫ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —É—Å—Ç—Ä–æ–µ–Ω–æ –≤ –∫–æ–¥–µ)

---

## 1) –ö–∞—Ä—Ç–∏–Ω–∞ –≤ —Ü–µ–ª–æ–º

Nexy ‚Äî –º–æ–¥—É–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Å–æ–±—ã—Ç–∏–π–Ω–æ–π —à–∏–Ω–æ–π (EventBus), —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è (ApplicationStateManager) –∏ –µ–¥–∏–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º —Ä–µ–∂–∏–º–æ–≤ (ModeController) –≤ –æ–±–µ—Ä—Ç–∫–µ ModeManagementIntegration. –í—Å—è –º–µ–∂–º–æ–¥—É–ª—å–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è ‚Äî —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è, –∞ —Å–º–µ–Ω–∞ —Ä–µ–∂–∏–º–æ–≤ ‚Äî —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏.

–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Ä–µ–∂–∏–º–æ–≤: SLEEPING ‚Üí LISTENING ‚Üí PROCESSING ‚Üí SLEEPING.

### üîß **–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–û–∫—Ç—è–±—Ä—å 2025):**
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞** - –≤—Å–µ 19 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ **Workflows —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã** - ListeningWorkflow –∏ ProcessingWorkflow
- ‚úÖ **EventBus —Å–∏—Å—Ç–µ–º–∞** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞** - unified_config.yaml
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - gRPC —Å–µ—Ä–≤–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - gRPC —Ñ–∞–π–ª—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **Azure VM –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞** - —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (20.151.51.172)
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π** - GitHub Actions + —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥–æ—Ç–æ–≤
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ø–ª–æ—è** - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ (2 –æ–∫—Ç—è–±—Ä—è 2025)
- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–ü—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã** - –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π grpcio, protobuf, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- üöÄ **–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø: –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π** - GitHub –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è + AppCast XML + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞** - —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã, –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã

### ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–´:**
- **–ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï:** gRPC —Å–µ—Ä–≤–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ú–û–î–£–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê:** gRPC —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª–µ–π
- **–ú–û–ù–ò–¢–û–†–ò–ù–ì:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:** –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨:** –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π

### üöÄ **–¢–ï–ö–£–©–ò–ô –≠–¢–ê–ü: –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–ê–Ø –£–ü–ê–ö–û–í–ö–ê + –î–ï–ü–õ–û–ô + –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï**
- **–ü–û–¢–û–ö 1:** –£–ø–∞–∫–æ–≤–∫–∞ PKG/DMG (2-3 —á–∞—Å–∞) - –ø–æ–¥–ø–∏—Å—å + –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏—è ‚è≥ **–ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£**
- **–ü–û–¢–û–ö 2:** –î–µ–ø–ª–æ–π —Å–µ—Ä–≤–µ—Ä–∞ (1-2 —á–∞—Å–∞) - Azure VM + gRPC + AppCast ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**
- **–ü–û–¢–û–ö 3:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (30 –º–∏–Ω) - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ üß™ **–ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£**
- **–≠–ö–û–ù–û–ú–ò–Ø –í–†–ï–ú–ï–ù–ò:** 1-2 —á–∞—Å–∞ (–≤–º–µ—Å—Ç–æ 4-5 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)

### **üß™ –°–ò–°–¢–ï–ú–ê –¶–ò–ö–õ–ò–ß–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:**
–ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –≤–∫–ª—é—á–∞–µ—Ç **–¢–ï–°–¢ ‚Üí –í–ê–õ–ò–î–ê–¶–ò–Ø ‚Üí –ü–ï–†–ï–•–û–î**:
- **–¢–ï–°–¢:** –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ —Ç–µ—Å—Ç–æ–≤
- **–í–ê–õ–ò–î–ê–¶–ò–Ø:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ —É—Å–ø–µ—Ö–∞
- **–ü–ï–†–ï–•–û–î:** –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
- **–¶–ò–ö–õ:** –í–æ–∑–≤—Ä–∞—Ç –∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ

**üìã –ü–†–ê–í–ò–õ–û:** –ù–ï –ü–ï–†–ï–•–û–î–ò–ú –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É –±–µ–∑ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞

```
client/                         # üñ•Ô∏è –ö–õ–ò–ï–ù–¢–°–ö–ê–Ø –ß–ê–°–¢–¨ (macOS)
‚îú‚îÄ main.py                      # üéØ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ requirements.txt             # üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (23 –ø–∞–∫–µ—Ç–∞, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã)
‚îú‚îÄ run.sh                       # üöÄ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ config/                      # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ  ‚îú‚îÄ unified_config.yaml       # üéØ –ï–î–ò–ù–´–ô –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ  ‚îú‚îÄ unified_config_loader.py  # üîß –ó–∞–≥—Ä—É–∑—á–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ  ‚îú‚îÄ logging_config.yaml       # üìù –£—Å—Ç–∞—Ä–µ–ª - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ unified_config.yaml
‚îÇ  ‚îú‚îÄ network_config.yaml       # üåê –£—Å—Ç–∞—Ä–µ–ª - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ unified_config.yaml
‚îÇ  ‚îú‚îÄ tray_config.yaml          # üéØ –£—Å—Ç–∞—Ä–µ–ª - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ unified_config.yaml
‚îÇ  ‚îî‚îÄ README.md                 # üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ integration/                 # üèóÔ∏è –°–ª–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (–ó–ê–í–ï–†–®–ï–ù)
‚îÇ  ‚îú‚îÄ core/                     # –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚îÇ  ‚îÇ  ‚îú‚îÄ event_bus.py           # üì° –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π
‚îÇ  ‚îÇ  ‚îú‚îÄ state_manager.py       # üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
‚îÇ  ‚îÇ  ‚îú‚îÄ simple_module_coordinator.py # üéØ –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
‚îÇ  ‚îÇ  ‚îî‚îÄ error_handler.py       # ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ  ‚îú‚îÄ integrations/             # üîó 19 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (–í–°–ï –ó–ê–í–ï–†–®–ï–ù–´)
‚îÇ  ‚îÇ  ‚îú‚îÄ tray_controller_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ permissions_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ input_processing_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ voice_recognition_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ screenshot_capture_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ hardware_id_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ grpc_client_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ speech_playback_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ mode_management_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ signal_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ audio_device_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ network_manager_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ updater_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ interrupt_management_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ voiceover_ducking_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ welcome_message_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ instance_manager_integration.py
‚îÇ  ‚îÇ  ‚îî‚îÄ autostart_manager_integration.py
‚îÇ  ‚îú‚îÄ workflows/                # ‚ö° WORKFLOWS (–ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê)
‚îÇ  ‚îÇ  ‚îú‚îÄ base_workflow.py       # üèóÔ∏è –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îÇ  ‚îÇ  ‚îú‚îÄ listening_workflow.py  # üé§ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä LISTENING
‚îÇ  ‚îÇ  ‚îú‚îÄ processing_workflow.py # ‚öôÔ∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä PROCESSING
‚îÇ  ‚îÇ  ‚îú‚îÄ workflow_config.py     # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è workflows
‚îÇ  ‚îÇ  ‚îî‚îÄ README.md              # üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è workflows
‚îÇ  ‚îî‚îÄ tests/                    # üß™ –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ modules/                     # üß© 18 –º–æ–¥—É–ª–µ–π (–±–µ–∑ –∑–Ω–∞–Ω–∏—è EventBus)
‚îÇ  ‚îú‚îÄ audio_device_manager/     # üîä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
‚îÇ  ‚îú‚îÄ grpc_client/              # üì° gRPC –∫–ª–∏–µ–Ω—Ç
‚îÇ  ‚îú‚îÄ hardware_id/              # üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
‚îÇ  ‚îú‚îÄ input_processing/         # ‚å®Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞
‚îÇ  ‚îú‚îÄ interrupt_management/     # ‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏
‚îÇ  ‚îú‚îÄ mode_management/          # üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏
‚îÇ  ‚îú‚îÄ network_manager/          # üåê –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏
‚îÇ  ‚îú‚îÄ permissions/              # üîê –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
‚îÇ  ‚îú‚îÄ screenshot_capture/       # üì∏ –ó–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞
‚îÇ  ‚îú‚îÄ signals/                  # üéµ –ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏–≥–Ω–∞–ª—ã
‚îÇ  ‚îú‚îÄ speech_playback/          # üîä –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ä–µ—á–∏
‚îÇ  ‚îú‚îÄ tray_controller/          # üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ tray –∏–∫–æ–Ω–∫–æ–π
‚îÇ  ‚îú‚îÄ updater/                  # üîÑ –ù–û–í–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (HTTP + DMG)
‚îÇ  ‚îú‚îÄ voice_recognition/        # üé§ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏
‚îÇ  ‚îú‚îÄ voiceover_control/        # ‚ôø –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VoiceOver (macOS)
‚îÇ  ‚îú‚îÄ welcome_message/          # üîä –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
‚îÇ  ‚îú‚îÄ instance_manager/         # üîí –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
‚îÇ  ‚îî‚îÄ autostart_manager/        # ‚ö° –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ assets/                      # üé® –†–µ—Å—É—Ä—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ  ‚îî‚îÄ icons/                    # üéØ –ò–∫–æ–Ω–∫–∏ –¥–ª—è tray
‚îî‚îÄ Docs/                        # üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   ‚îú‚îÄ ARCHITECTURE_OVERVIEW.md  # üèóÔ∏è –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   ‚îú‚îÄ CURRENT_STATUS_REPORT.md  # üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
   ‚îú‚îÄ GLOBAL_DELIVERY_PLAN.md   # üöÄ –ü–ª–∞–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
   ‚îú‚îÄ PACKAGING_FINAL_GUIDE.md  # üì¶ –ü–ª–∞–Ω —É–ø–∞–∫–æ–≤–∫–∏ PKG
   ‚îî‚îÄ PRODUCT_CONCEPT.md        # üí° –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞

server/                         # üñ•Ô∏è –°–ï–†–í–ï–†–ù–ê–Ø –ß–ê–°–¢–¨ (Python)
‚îú‚îÄ main.py                      # üéØ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ requirements.txt             # üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ config.env                   # ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ config/                      # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ  ‚îú‚îÄ unified_config.py         # üéØ –ï–î–ò–ù–´–ô –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ  ‚îî‚îÄ unified_config_example.yaml # üìù –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ modules/                     # üß© –ú–æ–¥—É–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ  ‚îú‚îÄ grpc_service/             # üì° gRPC —Å–µ—Ä–≤–∏—Å (–ü–†–ê–í–ò–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê)
‚îÇ  ‚îÇ  ‚îú‚îÄ core/                  # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ grpc_server.py      # üöÄ gRPC —Å–µ—Ä–≤–µ—Ä (100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ grpc_service_manager.py # üîß –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Ä–≤–∏—Å–∞
‚îÇ  ‚îÇ  ‚îú‚îÄ streaming.proto        # üì° Protobuf –ø—Ä–æ—Ç–æ–∫–æ–ª
‚îÇ  ‚îÇ  ‚îú‚îÄ streaming_pb2.py       # üì° –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
‚îÇ  ‚îÇ  ‚îú‚îÄ streaming_pb2_grpc.py  # üì° –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞–±—ã
‚îÇ  ‚îÇ  ‚îî‚îÄ config.py              # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è gRPC
‚îÇ  ‚îú‚îÄ text_processing/          # üìù –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
‚îÇ  ‚îú‚îÄ audio_generation/         # üîä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ
‚îÇ  ‚îú‚îÄ database/                 # üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ  ‚îú‚îÄ session_management/       # üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îÇ  ‚îú‚îÄ memory_management/        # üß† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
‚îÇ  ‚îú‚îÄ interrupt_handling/       # ‚ö° –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
‚îÇ  ‚îú‚îÄ text_filtering/           # üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
‚îÇ  ‚îî‚îÄ update/                   # üîÑ –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
‚îú‚îÄ monitoring/                  # üìä –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ  ‚îú‚îÄ grpc_monitor.py           # üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ gRPC
‚îÇ  ‚îî‚îÄ __init__.py               # üì¶ –ü–∞–∫–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îú‚îÄ scripts/                     # üß™ –£—Ç–∏–ª–∏—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ  ‚îú‚îÄ grpc_smoke.py             # üöÄ –ë—ã—Å—Ç—Ä—ã–π smoke-—Ç–µ—Å—Ç gRPC
‚îÇ  ‚îú‚îÄ test_backpressure.py      # üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
‚îÇ  ‚îú‚îÄ check_ramp_guardrails.sh  # üìà –ö–∞–Ω–∞—Ä–µ–µ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ  ‚îî‚îÄ ...                       # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ integrations/                # üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ  ‚îú‚îÄ core/                     # –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚îÇ  ‚îú‚îÄ service_integrations/     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ  ‚îî‚îÄ workflow_integrations/    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ workflows
‚îî‚îÄ Docs/                        # üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
   ‚îú‚îÄ SCALING_100_USERS_GUIDE.md # üìà –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
   ‚îî‚îÄ SERVER_MODULARIZATION_PLAN.md # üèóÔ∏è –ü–ª–∞–Ω –º–æ–¥—É–ª—è—Ä–∏–∑–∞—Ü–∏–∏
```

---

## 2) –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–æ–ª–∏ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

### üñ•Ô∏è **–ö–õ–ò–ï–ù–¢–°–ö–ê–Ø –ß–ê–°–¢–¨ (macOS)**

- EventBus (integration/core/event_bus.py)
  - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–æ–±—ã—Ç–∏–π–Ω–∞—è —à–∏–Ω–∞ (publish/subscribe, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)
  - –ò–∑–æ–ª–∏—Ä—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–ª–æ—Ç–Ω—ã–µ —Å–≤—è–∑–∫–∏

- ApplicationStateManager (integration/core/state_manager.py)
  - –ò—Å—Ç–∏–Ω–Ω–æ–µ —Ç–µ–∫—É—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ä–µ–∂–∏–º—ã/–∏—Å—Ç–æ—Ä–∏—è/–¥–∞–Ω–Ω—ã–µ)
  - –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞: `app.mode_changed`, `app.state_changed`
  - –ù–µ —Ä–µ—à–∞–µ—Ç –ö–ê–ö –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Ä–µ–∂–∏–º—ã ‚Äî —Ç–æ–ª—å–∫–æ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- ModeController (modules/mode_management/core/mode_controller.py)
  - –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ (–∫–∞—Ä—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –º–µ—Ç—Ä–∏–∫–∏)
  - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥–æ–Ω–∫–∏

- ModeManagementIntegration (integration/integrations/mode_management_integration.py)
  - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π ¬´—Ä—É–±–∏–ª—å–Ω–∏–∫¬ª —Ä–µ–∂–∏–º–æ–≤
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞—è–≤–∫–∏ `mode.request` –∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç ModeController
  - –ü–æ –∫–æ–ª–±—ç–∫—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `state_manager.set_mode(...)` –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
  - –ñ–µ—Å—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã PROCESSING –æ—Ç–∫–ª—é—á–µ–Ω—ã (–∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ Workflows)

- Workflows (integration/workflows/)
  - **ListeningWorkflow** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä LISTENING —Ä–µ–∂–∏–º–∞ (–¥–µ–±–∞—É–Ω—Å, —É–º–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã)
  - **ProcessingWorkflow** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä PROCESSING (capture‚Üígrpc‚Üíplayback‚ÜíSLEEPING)
  - **BaseWorkflow** - –æ–±—â–∞—è –±–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö workflows
  - Event-driven –ø–µ—Ä–µ—Ö–æ–¥—ã –≤–º–µ—Å—Ç–æ –∂–µ—Å—Ç–∫–∏—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (integration/integrations/*)
  - –ê–¥–∞–ø—Ç–∏—Ä—É—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏ –ø–æ–¥ —Å–æ–±—ã—Ç–∏–π–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç
  - –ù–ï –∏–∑–º–µ–Ω—è—é—Ç —Ä–µ–∂–∏–º –Ω–∞–ø—Ä—è–º—É—é; —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏–∫—É—é—Ç `mode.request`

- –ú–æ–¥—É–ª–∏ (client/modules/*)
  - –°–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–∑–∞—Ö–≤–∞—Ç, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ, –∞—É–¥–∏–æ –∏ —Ç.–ø.)
  - –ù–µ –∑–Ω–∞—é—Ç –ø—Ä–æ EventBus/—Ä–µ–∂–∏–º—ã; –∏—Ö ¬´–ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–∞—Ö¬ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### üñ•Ô∏è **–°–ï–†–í–ï–†–ù–ê–Ø –ß–ê–°–¢–¨ (Python)**

- gRPC Server (modules/grpc_service/core/grpc_server.py)
  - **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - —É–≤–µ–ª–∏—á–µ–Ω—ã –ª–∏–º–∏—Ç—ã –≤–æ—Ä–∫–µ—Ä–æ–≤
  - **ThreadPoolExecutor** —Å 100 –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
  - **Connection pooling** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è 100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  - **gRPC options** - keepalive, buffer sizes, timeout –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - **Backward compatibility** - —Å—Ç—Ä–æ–≥–æ–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (PR-3)

- GrpcServiceManager (modules/grpc_service/core/grpc_service_manager.py)
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º gRPC —Å–µ—Ä–≤–∏—Å–∞
  - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏ —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ ModuleCoordinator (PR-2.1)
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ feature-flags –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (v1/v2)

- gRPC Protocol (`modules/grpc_service/streaming.proto`)
  - **–°–∏–Ω—Ç–∞–∫—Å–∏—Å:** proto3
  - **–°–µ—Ä–≤–∏—Å:** StreamingService
  - **RPC –º–µ—Ç–æ–¥—ã:**
    - `StreamAudio` (unary_stream) - —Å—Ç—Ä–∏–º–∏–Ω–≥ –∞—É–¥–∏–æ –∏ —Ç–µ–∫—Å—Ç–∞
    - `InterruptSession` (unary_unary) - –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏
  - **–ü—Ä–∞–≤–∏–ª–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:**
    - ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è optional –ø–æ–ª–µ–π
    - ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω—ã –Ω–æ–≤—ã–µ RPC –º–µ—Ç–æ–¥—ã —Å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π
    - ‚ùå Breaking changes ‚Üí v2 —Å–µ—Ä–≤–∏—Å + feature-flag
    - ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π/–º–µ—Ç–æ–¥–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–æ
  - **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `Docs/GRPC_PROTOCOL_AUDIT.md` (PR-3)

- Monitoring System (monitoring/grpc_monitor.py)
  - **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, RPS, –æ—à–∏–±–∫–∏
  - **–ê–ª–µ—Ä—Ç—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
  - **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU, –ø–∞–º—è—Ç–∏, –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
  - **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ gRPC —Å–µ—Ä–≤–µ—Ä

- Smoke/Backpressure (scripts/grpc_smoke.py, scripts/test_backpressure.py)
  - **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–æ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - **–ú–µ—Ç—Ä–∏–∫–∏** - –∏–∑–º–µ—Ä–µ–Ω–∏–µ RPS, –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞, —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
  - **–ê–Ω–∞–ª–∏–∑** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
  - **–û—Ç—á–µ—Ç—ã** - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- –ú–æ–¥—É–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ (server/modules/*)
  - **text_processing** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ —Å Gemini API
  - **audio_generation** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ –æ—Ç–≤–µ—Ç–æ–≤
  - **session_management** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å–µ—Å—Å–∏—è–º–∏
  - **memory_management** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
  - **interrupt_handling** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
  - **text_filtering** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
  - **update** - —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å–µ—Ä–≤–µ—Ä–∞

- Feature Flags –∏ Kill-Switches (server/config/unified_config.py)
  - **use_module_coordinator** (bool, default=True) - –≤–∫–ª—é—á–µ–Ω–∏–µ ModuleCoordinator –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –º–æ–¥—É–ª–µ–π
  - **disable_module_coordinator** (bool, default=False) - —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞ (kill-switch)
  - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π rollout –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞
  - **–ü—Ä–∞–≤–∏–ª–∞:**
    - –ü—Ä–∏ `disable_module_coordinator=True` ‚Üí –æ—Ç–∫–∞—Ç –∫ legacy –ø—Ä—è–º—ã–º –∏–º–ø–æ—Ä—Ç–∞–º
    - –ü—Ä–∏ `use_module_coordinator=False` ‚Üí –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –º–æ–¥—É–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
    - Feature flags –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è: `USE_MODULE_COORDINATOR`, `NEXY_KS_DISABLE_MODULE_COORDINATOR`
  - **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –í—Å–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è feature flags –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å `scope=feature_flags decision=toggle`

---

## 3) –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### ‚úÖ **–ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï –î–û 100 –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô**

#### **gRPC –°–µ—Ä–≤–µ—Ä:**
- **ThreadPoolExecutor:** –£–≤–µ–ª–∏—á–µ–Ω —Å 10 –¥–æ 100 –≤–æ—Ä–∫–µ—Ä–æ–≤
- **Connection pooling:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è 100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **gRPC options:** –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã keepalive, buffer sizes, timeout –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **Memory limits:** –£–≤–µ–ª–∏—á–µ–Ω—ã –ª–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏ –≤ 5-10 —Ä–∞–∑
- **API limits:** –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ –ø–ª–∞—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã

#### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
grpc:
  max_workers: 100
  port: 50051

session:
  max_sessions: 200

interrupt:
  max_active_sessions: 100

text_processing:
  max_concurrent_requests: 50

memory:
  max_short_term_memory_size: 51200
  max_long_term_memory_size: 102400
```

### ‚úÖ **gRPC INTERCEPTORS –ò –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö (PR-7)**

#### **–ö–∞—Ä—Ç–∞ –∏–Ω—Ç–µ—Ä—Å–µ–ø—Ç–æ—Ä–æ–≤ (–∏—Å–∫–ª—é—á–µ–Ω–∏—è ‚Üí –∫–æ–¥—ã):**

| **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ** | **gRPC –ö–æ–¥** | **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** | **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ** |
|---------------|--------------|-------------------|----------------|
| `ConnectionError` | `UNAVAILABLE` | transient | –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ |
| `TimeoutError` | `DEADLINE_EXCEEDED` | transient | –ü—Ä–µ–≤—ã—à–µ–Ω —Ç–∞–π–º–∞—É—Ç |
| `asyncio.TimeoutError` | `DEADLINE_EXCEEDED` | transient | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç |
| `ValueError` | `INVALID_ARGUMENT` | permanent | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| `TypeError` | `INVALID_ARGUMENT` | permanent | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö |
| `MemoryError` | `RESOURCE_EXHAUSTED` | transient | –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ |
| `RuntimeError` | `INTERNAL` | permanent | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ |
| `Exception` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | `INTERNAL` | permanent | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ |

**–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:**
```
ts=... level=ERROR scope=grpc method=StreamAudio decision=error ctx={"error_code": "UNAVAILABLE", "error_classified": "transient", "error_type": "ConnectionError"} dur_ms=123
```

**–¢–∞–±–ª–∏—Ü–∞: –∏—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Üí gRPC-–∫–æ–¥ ‚Üí client-action:**

| **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ** | **gRPC –ö–æ–¥** | **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** | **Client Action** | **Retry Strategy** |
|---------------|--------------|-------------------|-------------------|-------------------|
| `ConnectionError` | `UNAVAILABLE` | transient | –ü–æ–∫–∞–∑–∞—Ç—å "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ", retry —Å exponential backoff | Exponential backoff: 1s, 2s, 4s, 8s, max 30s |
| `TimeoutError` | `DEADLINE_EXCEEDED` | transient | –ü–æ–∫–∞–∑–∞—Ç—å "–¢–∞–π–º–∞—É—Ç", retry —Å jitter | Exponential backoff + jitter: 2s¬±1s, 4s¬±2s, max 60s |
| `asyncio.TimeoutError` | `DEADLINE_EXCEEDED` | transient | –ü–æ–∫–∞–∑–∞—Ç—å "–¢–∞–π–º–∞—É—Ç", retry —Å jitter | Exponential backoff + jitter: 2s¬±1s, 4s¬±2s, max 60s |
| `ValueError` | `INVALID_ARGUMENT` | permanent | –ü–æ–∫–∞–∑–∞—Ç—å "–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞", –Ω–µ retry | –ù–µ—Ç retry, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| `TypeError` | `INVALID_ARGUMENT` | permanent | –ü–æ–∫–∞–∑–∞—Ç—å "–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞", –Ω–µ retry | –ù–µ—Ç retry, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| `MemoryError` | `RESOURCE_EXHAUSTED` | transient | –ü–æ–∫–∞–∑–∞—Ç—å "–ù–µ—Ö–≤–∞—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤", retry —á–µ—Ä–µ–∑ 30s | Fixed delay: 30s, max 3 –ø–æ–ø—ã—Ç–∫–∏ |
| `RuntimeError` | `INTERNAL` | permanent | –ü–æ–∫–∞–∑–∞—Ç—å "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞", –Ω–µ retry | –ù–µ—Ç retry, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç |
| `Exception` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | `INTERNAL` | permanent | –ü–æ–∫–∞–∑–∞—Ç—å "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞", –Ω–µ retry | –ù–µ—Ç retry, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç |
| Stream limit exceeded | `RESOURCE_EXHAUSTED` | transient | –ü–æ–∫–∞–∑–∞—Ç—å "–°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω", retry —á–µ—Ä–µ–∑ 60s | Fixed delay: 60s, max 2 –ø–æ–ø—ã—Ç–∫–∏ |
| Rate limit exceeded | `RESOURCE_EXHAUSTED` | transient | –ü–æ–∫–∞–∑–∞—Ç—å "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤", retry —á–µ—Ä–µ–∑ 10s | Fixed delay: 10s, max 3 –ø–æ–ø—ã—Ç–∫–∏ |

**–§–∞–π–ª:** `modules/grpc_service/core/grpc_interceptor.py`

---

### ‚úÖ **BACKPRESSURE –î–õ–Ø –°–¢–†–ò–ú–û–í (PR-7)**

#### **–ü–æ–ª–∏—Ç–∏–∫–∏ backpressure (–ª–∏–º–∏—Ç—ã/—Ç–∞–π–º–∞—É—Ç—ã/–∫–æ–¥—ã –æ—Ç–∫–∞–∑–∞):**

| **–ü–∞—Ä–∞–º–µ—Ç—Ä** | **–ó–Ω–∞—á–µ–Ω–∏–µ** | **–û–ø–∏—Å–∞–Ω–∏–µ** |
|-------------|--------------|--------------|
| `max_concurrent_streams` | 50 | –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö StreamAudio |
| `idle_timeout_seconds` | 300 (5 –º–∏–Ω—É—Ç) | –¢–∞–π–º–∞—É—Ç –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤ |
| `max_message_rate_per_second` | 10 | –ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É –Ω–∞ —Å—Ç—Ä–∏–º |
| `grace_period_seconds` | 30 | –ü–µ—Ä–∏–æ–¥ –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –∑–∞–∫—Ä—ã—Ç–∏–µ–º |

**–ö–æ–¥—ã –æ—Ç–∫–∞–∑–∞:**
- `RESOURCE_EXHAUSTED` ‚Äî –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Å—Ç—Ä–∏–º–æ–≤ –∏–ª–∏ rate limit
- `DEADLINE_EXCEEDED` ‚Äî –ø—Ä–µ–≤—ã—à–µ–Ω idle timeout

**–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:**
```
ts=... level=INFO scope=grpc method=StreamAudio decision=stream_acquired ctx={"stream_id": "...", "active_streams": 5, "max_streams": 50}
ts=... level=WARNING scope=grpc method=StreamAudio decision=stream_idle_timeout ctx={"stream_id": "...", "idle_time_seconds": 300}
```

**–¢–∞–±–ª–∏—Ü–∞: –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã backpressure –ø–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º:**

| **–ü–∞—Ä–∞–º–µ—Ç—Ä** | **dev** | **stage** | **prod** |
|-------------|---------|-----------|----------|
| `max_concurrent_streams` | 10 | 25 | 50 |
| `idle_timeout_seconds` | 60 (1 –º–∏–Ω) | 180 (3 –º–∏–Ω) | 300 (5 –º–∏–Ω) |
| `max_message_rate_per_second` | 5 | 8 | 10 |
| `grace_period_seconds` | 10 | 20 | 30 |

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- –õ–∏–º–∏—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ `unified_config.yaml` ‚Üí —Å–µ–∫—Ü–∏—è `backpressure`
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `BACKPRESSURE_MAX_STREAMS`, `BACKPRESSURE_IDLE_TIMEOUT`, `BACKPRESSURE_MAX_RATE`, `BACKPRESSURE_GRACE_PERIOD`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø–æ `NEXY_ENV` (dev/stage/prod)

**–§–∞–π–ª:** `modules/grpc_service/core/backpressure.py`

---

### ‚úÖ **GRACEFUL SHUTDOWN (PR-7)**

#### **–°—Ö–µ–º–∞ graceful-shutdown (—ç—Ç–∞–ø—ã, —Ç–∞–π–º–∏–Ω–≥–∏, —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏):**

**–≠—Ç–∞–ø—ã:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞** (SIGTERM/SIGINT)
   - –í—Ä–µ–º—è: < 1 —Å–µ–∫—É–Ω–¥–∞
   - –î–µ–π—Å—Ç–≤–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `shutdown_event`
   - –õ–æ–≥: `scope=server decision=shutdown ctx={"signal": 15}`

2. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏—ë–º–∞ –Ω–æ–≤—ã—Ö RPC**
   - –í—Ä–µ–º—è: < 1 —Å–µ–∫—É–Ω–¥–∞
   - –î–µ–π—Å—Ç–≤–∏–µ: –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - –õ–æ–≥: `scope=server decision=shutdown ctx={"action": "stop_accepting"}`

3. **–û–∂–∏–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö RPC**
   - –í—Ä–µ–º—è: –¥–æ 5 —Å–µ–∫—É–Ω–¥ (grace period)
   - –î–µ–π—Å—Ç–≤–∏–µ: –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –õ–æ–≥: `scope=server decision=shutdown ctx={"active_requests": 3, "grace_period": 5}`

4. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ backpressure manager**
   - –í—Ä–µ–º—è: < 1 —Å–µ–∫—É–Ω–¥–∞
   - –î–µ–π—Å—Ç–≤–∏–µ: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ –æ—á–∏—Å—Ç–∫–∏
   - –õ–æ–≥: `scope=backpressure decision=stop ctx={}`

5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫**
   - –í—Ä–µ–º—è: < 1 —Å–µ–∫—É–Ω–¥–∞
   - –î–µ–π—Å—Ç–≤–∏–µ: –§–∏–Ω–∞–ª—å–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç –º–µ—Ç—Ä–∏–∫
   - –õ–æ–≥: `scope=metrics decision=snapshot ctx={"p95_latency": {...}, "error_rate": {...}, "decision_rate": {...}}`

6. **–û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤**
   - –í—Ä–µ–º—è: < 2 —Å–µ–∫—É–Ω–¥—ã
   - –î–µ–π—Å—Ç–≤–∏–µ: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ HTTP, gRPC, Update —Å–µ—Ä–≤–µ—Ä–æ–≤
   - –õ–æ–≥: `scope=server decision=stop ctx={"reason": "graceful_shutdown"}`

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** ‚â§ 10 —Å–µ–∫—É–Ω–¥

**–§–∞–π–ª:** `main.py` (—Ñ—É–Ω–∫—Ü–∏–∏ `setup_signal_handlers()`, `graceful_shutdown()`)

---

### ‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ú–û–î–£–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê**

#### **gRPC —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã:**
- **–ò–∑:** `server/grpc_server.py`, `server/streaming.proto`, `server/streaming_pb2*.py`
- **–í:** `server/modules/grpc_service/` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- **Protobuf:** –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ
- **–ò–º–ø–æ—Ä—Ç—ã:** –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏

### ‚úÖ **–°–ò–°–¢–ï–ú–ê –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê**

#### **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- **–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- **RPS (Requests Per Second)** - –∑–∞–ø—Ä–æ—Å—ã –≤ —Å–µ–∫—É–Ω–¥—É
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞** - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **CPU –∏ –ø–∞–º—è—Ç—å** - —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

#### **–ê–ª–µ—Ä—Ç—ã:**
- **–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** - >80 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** - >80%
- **–í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU** - >90%
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫** - >5%

### ‚úÖ **–ü–†–û–í–ï–†–ö–ò –ù–ê–ì–†–£–ó–ö–ò –ò BACKPRESSURE**

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
- `scripts/grpc_smoke.py` ‚Äî –±—ã—Å—Ç—Ä—ã–π smoke-—Ç–µ—Å—Ç RPC –∏ –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- `scripts/test_backpressure.py` ‚Äî –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤ `max_concurrent_streams`, rate-limit –∏ idle timeout
- `scripts/check_ramp_guardrails.sh` ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –ø–µ—Ä–µ–¥ –∫–∞–Ω–∞—Ä–µ–µ—á–Ω—ã–º —Ä–∞—Å–∫–∞—Ç–æ–º

#### **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:**
```bash
# Smoke-—Ç–µ—Å—Ç gRPC
cd server
python scripts/grpc_smoke.py localhost 50051

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ backpressure (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –ø—Ä–æ—Ç–∏–≤ staging)
python scripts/test_backpressure.py localhost 50051 --max-streams 10

# –ö–∞–Ω–∞—Ä–µ–µ—á–Ω—ã–µ guardrails (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏)
./scripts/check_ramp_guardrails.sh
```

---

## 4) –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤ (Single Source of Truth)

- AppMode: –µ–¥–∏–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∏–∑ `modules/mode_management` (–¥—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã)
- –ó–∞–ø—Ä–æ—Å —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞: —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–µ–º `mode.request`
- –†–µ–∞–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ —Ä–µ–∂–∏–º–∞: —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `ModeManagementIntegration ‚Üí ModeController`
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ —Å–º–µ–Ω—ã: —Ç–æ–ª—å–∫–æ `ApplicationStateManager.set_mode(...)`

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞–ø—Ä–æ—Å–∞:

```python
await event_bus.publish("mode.request", {
  "target": AppMode.LISTENING,   # –∏–ª–∏ SLEEPING / PROCESSING
  "source": "<integration|module>",
  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: session_id, priority, data
})
```

–ö–æ–Ω—Ç—Ä–∞–∫—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

```python
# –§–∞–∫—Ç —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞
await event_bus.publish("app.mode_changed", {"mode": AppMode.LISTENING})

# –ú–æ—Å—Ç (–≤—Ä–µ–º–µ–Ω–Ω—ã–π): —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
await event_bus.publish("app.state_changed", {"old_mode": ..., "new_mode": ...})
```

–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
- SLEEPING ‚Üí LISTENING
- LISTENING ‚Üí PROCESSING, SLEEPING
- PROCESSING ‚Üí SLEEPING

–¢–∞–π–º–∞—É—Ç—ã PROCESSING: –∂–µ—Å—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã, –ø–µ—Ä–µ—Ö–æ–¥—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è Workflows –ø–æ —Å–æ–±—ã—Ç–∏—è–º.

---

## 4) –ì–ª–∞–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö (PTT –æ—Ç –∫–ª–∞–≤–∏—à–∏ –¥–æ –æ—Ç–≤–µ—Ç–∞)

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–±–µ–ª (LONG_PRESS)
   - InputProcessingIntegration –ø—É–±–ª–∏–∫—É–µ—Ç `voice.recording_start(session_id)` –∏ `mode.request(LISTENING)`
   - ModeManagementIntegration –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ ‚Üí ModeController ‚Üí StateManager ‚Üí `app.mode_changed`
   - VoiceRecognitionIntegration –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å/—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–±–µ–ª (RELEASE)
   - InputProcessingIntegration –ø—É–±–ª–∏–∫—É–µ—Ç `voice.recording_stop(session_id)` –∏ `mode.request(PROCESSING)`
   - VoiceRecognitionIntegration –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ ‚Üí `voice.recognition_completed|failed|timeout`

3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   - GrpcClientIntegration –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç + –∫–æ–Ω—Ç–µ–∫—Å—Ç
   - –û—Ç–≤–µ—Ç—ã –∞—É–¥–∏–æ —á–∞–Ω–∫–∞–º–∏ ‚Üí SpeechPlaybackIntegration –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç

4. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ ProcessingWorkflow)
   - ProcessingWorkflow –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç: capture‚Üígrpc‚Üíplayback‚ÜíSLEEPING
   - –ü–µ—Ä–µ—Ö–æ–¥ –≤ SLEEPING –ø–æ `playback.completed` –∏–ª–∏ `grpc.request_completed`
   - –ò—Ç–æ–≥–æ–≤—ã–π —Ñ–∞–∫—Ç —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ –ø—É–±–ª–∏–∫—É–µ—Ç StateManager

–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (interrupts) - –£–ù–ò–§–ò–¶–ò–†–û–í–ê–ù–´
- `keyboard.short_press` / `interrupt.request` ‚Üí –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ `playback.cancelled`
- **`playback.cancelled`** - –ï–î–ò–ù–´–ô –∫–∞–Ω–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∞—É–¥–∏–æ
- ProcessingWorkflow/ListeningWorkflow –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—Ç –≤–æ–∑–≤—Ä–∞—Ç –≤ SLEEPING

---

## 5) –°–æ–±—ã—Ç–∏–π–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã)

- –†–µ–∂–∏–º—ã
  - `mode.request{target, source, ...}` ‚Äî –∑–∞–ø—Ä–æ—Å —Å–º–µ–Ω—ã
  - `app.mode_changed{mode}` ‚Äî —Ñ–∞–∫—Ç —Å–º–µ–Ω—ã (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
  - `app.state_changed{old_mode, new_mode}` ‚Äî –º–æ—Å—Ç –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

- –ì–æ–ª–æ—Å
  - `voice.recording_start{session_id}`
  - `voice.recording_stop{session_id}`
  - `voice.recognition_started|completed|failed|timeout{session_id, ...}`

- gRPC / –û—Ç–≤–µ—Ç—ã
  - `grpc.request_started|completed|failed{session_id, ...}`
  - `grpc.response.audio{bytes, shape, dtype, session_id}`
  - `grpc.response.end_message{session_id, message?}` (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä)
  - –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ PROCESSING –¥–æ–ª–∂–Ω–æ –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ `grpc.request_completed` (–∏–ª–∏ `grpc.response.end_message`) –ª–∏–±–æ –Ω–∞ `playback.completed`, –∞ –Ω–µ –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç

- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
  - `playback.started|completed|failed|cancelled{session_id}`
  - **`playback.cancelled`** - –ï–î–ò–ù–´–ô –∫–∞–Ω–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∞—É–¥–∏–æ (–≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)

- –°–∏–≥–Ω–∞–ª—ã (cues)
  - `signal.request{kind, pattern, volume?, device?, session_id?}`
  - `signal.completed|failed{pattern, ...}`
  - –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∞–≤—Ç–æ—Å–∏–≥–Ω–∞–ª—ã: LISTENING‚Üí`listen_start`, playback.completed‚Üí`done`, –æ—à–∏–±–∫–∏/–æ—Ç–º–µ–Ω—ã‚Üí`error|cancel`

- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è/–ê—É–¥–∏–æ/–°–µ—Ç—å/–ñ–µ–ª–µ–∑–æ
  - `permissions.app_blocked|app_unblocked{...}`
  - `audio.device_switched|audio.device_snapshot{...}`
  - `network.status_changed{...}`
  - `hardware.id_obtained{...}`

–í—Å–µ –∏–º–µ–Ω–∞ —Å–æ–±—ã—Ç–∏–π –∏ –ø–æ–ª–µ–∑–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ ‚Äî —ç—Ç–æ ¬´–¥–æ–≥–æ–≤–æ—Ä¬ª –º–µ–∂–¥—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏.

---

## 6) –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –≥–æ–Ω–æ–∫ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `ModeController` (–≤–Ω—É—Ç—Ä–∏ ‚Äî `asyncio.Lock`) ‚Üí –æ–¥–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–∞ —Ä–∞–∑
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞—è–≤–æ–∫ –º–∞—Ä–∫–∏—Ä—É—é—Ç—Å—è `source` (+ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `priority`) ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ—à–∞—é—Ç—Å—è –≤ ModeManagementIntegration
- –ù–∏–∫–∞–∫–∏—Ö –ø—Ä—è–º—ã—Ö `state_manager.set_mode(...)` –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ ModeManagementIntegration
- –ü—Ä–∏ –≤–Ω–µ—à–Ω–µ–π —Å–º–µ–Ω–µ (–Ω–∞ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏) ModeManagementIntegration —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ `app.mode_changed`

---

## 7) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### **–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å:**
- **UnifiedServerConfig** (`server/config/unified_config.py`) ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π —Å–µ—Ä–≤–µ—Ä–∞
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (`server/config.env`) ‚Äî –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** (`server/config.env.example`) ‚Äî —à–∞–±–ª–æ–Ω —Å –ø–æ–ª–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥—É–ª–µ–π:**
- ‚úÖ `text_processing/config.py` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `unified_config`
- ‚úÖ `audio_generation/config.py` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `unified_config`
- ‚úÖ `memory_management/config.py` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `unified_config`
- ‚ö†Ô∏è –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —á–∏—Ç–∞—é—Ç –Ω–∞–ø—Ä—è–º—É—é –∏–∑ env (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –≤ –±—É–¥—É—â–∏—Ö PR)

**–ü—Ä–∞–≤–∏–ª–∞:**
- –í—Å–µ –º–æ–¥—É–ª–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `config.unified_config.get_config()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ù–∏–∫–∞–∫–∏—Ö –ø—Ä—è–º—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ YAML/JSON —Ñ–∞–π–ª–æ–≤ –≤–Ω–µ `unified_config.py` (–∫—Ä–æ–º–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`config.env`)
- –°–µ–∫—Ä–µ—Ç—ã (API –∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏) –Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

### **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å:**
- UnifiedConfigLoader ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –∏ –º–æ–¥—É–ª–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è:
  1) –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å –≤ `client/modules/<name>` –±–µ–∑ –∑–Ω–∞–Ω–∏—è EventBus
  2) –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ `client/integration/integrations/<name>_integration.py`
  3) –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è/–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω—É–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –∑–∞–ø—Ä–æ—Å—ã —Ä–µ–∂–∏–º–æ–≤ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `mode.request`
  4) –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é/–∑–∞–ø—É—Å–∫ –≤ `ModuleCoordinatorIntegration`

- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:
  - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ `ModeTransition` –≤ ModeManagementIntegration (–∏–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
  - –î–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ ‚Äî —É–∫–∞–∑–∞—Ç—å `action`, `priority`, `timeout`

---

## 8) –ó–∞–ø—É—Å–∫ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

- ModuleCoordinatorIntegration —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π/—Å—Ç–∞—Ä—Ç–æ–º/–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π
  - –°–æ–∑–¥–∞—ë—Ç EventBus, StateManager, ErrorHandler
  - –ü–æ–¥–Ω–∏–º–∞–µ—Ç —Ñ–æ–Ω–æ–≤–æ–π asyncio loop –∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –∫ EventBus
  - –°–æ–∑–¥–∞—ë—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–≤ —Ç.—á. ModeManagementIntegration)
  - –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç EventBus –∫ StateManager –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–æ–≤

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—É–ø—Ä–æ—â–µ–Ω–Ω–æ):
1) –°–æ–∑–¥–∞–Ω–∏–µ core-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ‚Üí 2) –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–≥–æ loop ‚Üí 3) –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π ‚Üí 4) initialize() ‚Üí 5) start() ‚Üí 6) –ü–æ–¥–ø–∏—Å–∫–∏ EventBus –∞–∫—Ç–∏–≤–Ω—ã

---

## 9) –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—à–∏–±–∫–∏

- ErrorHandler –ø—É–±–ª–∏–∫—É–µ—Ç/–ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π –∏ –≤–∞–∂–Ω–æ—Å—Ç—å—é
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
  - –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–∂–∏–º: –≤—Ö–æ–¥—è—â–∏–µ `mode.request`
  - –°–º–µ–Ω–∞ —Ä–µ–∂–∏–º–æ–≤: `app.mode_changed` (+ –º–µ—Ç—Ä–∏–∫–∏ ModeController)
  - –¢–∞–π–º–∞—É—Ç PROCESSING: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
  - –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è: `interrupt.request`, –æ—Ç–º–µ–Ω—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –õ–æ–≥–∏—Ä—É–π—Ç–µ `source` –∏ `session_id` –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –ø—É—Ç–µ–π
- –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ ¬´–¥—É–±–ª–∏—Ä—É—é—â–∏–µ¬ª —Ñ–∞–∫—Ç—ã —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ ‚Äî —Ç–æ–ª—å–∫–æ StateManager

‚Äî –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ PROCESSING
- –°–∏–≥–Ω–∞–ª–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–ª—É–∂–∏—Ç `grpc.request_completed` (–ø–æ–ª—É—á–µ–Ω end‚Äëof‚Äëstream) –ª–∏–±–æ `playback.completed`
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: `ModeManagementIntegration`/workflow PROCESSING –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ SLEEPING –ø–æ –æ–¥–Ω–æ–º—É –∏–∑ —Å–∏–≥–Ω–∞–ª–æ–≤ (—á—Ç–æ –Ω–∞—Å—Ç—É–ø–∏—Ç —Ä–∞–Ω—å—à–µ), –∞ —Ç–∞–π–º–∞—É—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∑–∞—â–∏—Ç–∞

‚Äî –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è gRPC (–ø–ª–∞–Ω)
- –í—ã–∑–æ–≤—ã gRPC –¥–æ–ª–∂–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å `metadata.authorization: Bearer <token>`
- –¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ macOS Keychain (Auth/Chat ‚Äî –æ—Ç–ª–æ–∂–µ–Ω–æ)

---

## 10) –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ —á–µ–∫‚Äë–ª–∏—Å—Ç –¥–ª—è PR

- [ ] –í –∫–æ–¥–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –Ω–µ—Ç –ø—Ä—è–º—ã—Ö `set_mode(...)`
- [ ] –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–º–µ–Ω—É —Ä–µ–∂–∏–º–∞ –∏–¥—É—Ç —á–µ—Ä–µ–∑ `mode.request`
- [ ] –ò–º–ø–æ—Ä—Ç `AppMode` ‚Äî —Ç–æ–ª—å–∫–æ –∏–∑ `modules/mode_management`
- [ ] –ü–æ–¥–ø–∏—Å–∫–∏/–ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É —Å–æ–±—ã—Ç–∏–π
- [ ] –ù–æ–≤—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ ModeManagementIntegration

---

## 11) –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Å—Å—ã–ª–∫–∏

### üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- **–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** `Docs/CURRENT_STATUS_REPORT.md`
- **–ü–ª–∞–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:** `Docs/GLOBAL_DELIVERY_PLAN.md`
- **–ü–ª–∞–Ω —É–ø–∞–∫–æ–≤–∫–∏:** `Docs/PACKAGING_FINAL_GUIDE.md`
- **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞:** `Docs/PRODUCT_CONCEPT.md`
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:** `server/SCALING_100_USERS_GUIDE.md`
- **–ú–æ–¥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞:** `server/SERVER_MODULARIZATION_PLAN.md`

### üèóÔ∏è **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- **Workflows –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `client/integration/workflows/README.md`
  - **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä:** `client/integration/core/module_coordinator_integration.py`
- **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Ä–µ–∂–∏–º–æ–≤:** `client/modules/mode_management/core/mode_controller.py`
- **–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è:** `client/integration/core/state_manager.py`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `client/config/unified_config.yaml`

### üñ•Ô∏è **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- **gRPC —Å–µ—Ä–≤–µ—Ä:** `server/modules/grpc_service/core/grpc_server.py`
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** `server/monitoring/grpc_monitor.py`
- **–ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏:** `server/scripts/test_backpressure.py`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞:** `server/config/unified_config_example.yaml`
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** `server/config.env`

### üåê –í–ê–ñ–ù–û: –°–µ—Ç–µ–≤–∞—è —Å—Ö–µ–º–∞ –≤—Ö–æ–¥–∞ (Ingress) ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–æ–∫—Ç—è–±—Ä—å 2025)

- –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø —Ç–µ–ø–µ—Ä—å –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ HTTPS –ø–æ—Ä—Ç 443 —Å —Ä–µ–≤–µ—Ä—Å‚Äë–ø—Ä–æ–∫—Å–∏ Nginx (HTTP/2):
  - gRPC: –∫–æ—Ä–Ω–µ–≤–æ–π –ø—É—Ç—å `/` (–±–µ–∑ `/grpc`), –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ `127.0.0.1:50051` —á–µ—Ä–µ–∑ `grpc_pass`
  - Update Server: –ø—É—Ç—å `/updates/‚Ä¶` –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ `127.0.0.1:8081` (HTTP/REST)
- –ü—Ä–µ–∂–Ω–∏–µ –≤–Ω–µ—à–Ω–∏–µ –ø–æ—Ä—Ç—ã `50051` –∏ `8081` –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–µ—Ç—è–º–∏/–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –∏ –±–æ–ª—å—à–µ –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –Ω–∞—Ä—É–∂—É.
- TLS: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π self‚Äësigned —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç c SAN=IP (`20.151.51.172`) –¥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞/Let‚Äôs Encrypt.

**–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ—Ä—Ç–æ–≤ –∏ –ø—É—Ç–µ–π:**

| **–¢–∏–ø –¥–æ—Å—Ç—É–ø–∞** | **–ü–æ—Ä—Ç/–ü—Ä–æ—Ç–æ–∫–æ–ª** | **–ü—É—Ç—å** | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | **–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ** |
|----------------|-------------------|----------|---------------|-------------------|
| **–í–Ω–µ—à–Ω–∏–π** | `443/HTTPS` (HTTP/2) | `/` | gRPC API | `grpc_pass grpc://127.0.0.1:50051` |
| **–í–Ω–µ—à–Ω–∏–π** | `443/HTTPS` (HTTP/2) | `/updates/` | Update Server | `proxy_pass http://127.0.0.1:8081/` |
| **–í–Ω–µ—à–Ω–∏–π** | `443/HTTPS` (HTTP/2) | `/updates/health` | Update Server Health | `proxy_pass http://127.0.0.1:8081/health` |
| **–í–Ω–µ—à–Ω–∏–π** | `443/HTTPS` (HTTP/2) | `/health` | Health check | `proxy_pass http://127.0.0.1:8080/health` |
| **–í–Ω–µ—à–Ω–∏–π** | `443/HTTPS` (HTTP/2) | `/status` | Status API | `proxy_pass http://127.0.0.1:8080/status` |
| **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π** | `50051/gRPC` | - | gRPC Server | –¢–æ–ª—å–∫–æ localhost (—á–µ—Ä–µ–∑ Nginx) |
| **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π** | `8080/HTTP` | `/health`, `/status` | Health/Status API | –¢–æ–ª—å–∫–æ localhost (—á–µ—Ä–µ–∑ Nginx) |
| **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π** | `8081/HTTP` | `/`, `/health`, `/appcast.xml` | Update Server | –¢–æ–ª—å–∫–æ localhost (—á–µ—Ä–µ–∑ Nginx) |

**–í–∞–∂–Ω–æ:**
- –í–Ω–µ—à–Ω–∏–µ –ø–æ—Ä—Ç—ã `50051` –∏ `8081` **–Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –Ω–∞—Ä—É–∂—É** (–º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–µ—Ç—è–º–∏/–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏)
- –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ `443/HTTPS` (Nginx reverse proxy)
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Ä—Ç—ã —Å–ª—É—à–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ `127.0.0.1` (localhost)

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–ª–∏–µ–Ω—Ç—É:
- gRPC endpoint: `https://20.151.51.172` (HTTP/2, TLS)
- Update endpoints: `https://20.151.51.172/updates/...`
- –ù–∞ –≤—Ä–µ–º—è self‚Äësigned TLS: –ª–∏–±–æ –¥–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –ª–∏–±–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É.

### ‚òÅÔ∏è **PRODUCTION –°–ï–†–í–ï–† –ù–ê AZURE VM (–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2 –æ–∫—Ç—è–±—Ä—è 2025)**

#### **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- **VM:** `nexy-regular` (Standard_D2s_v3)
  - **vCPUs:** 2 —è–¥—Ä–∞
  - **RAM:** 8 GiB
  - **–î–∏—Å–∫:** 30 GB SSD
  - **–û–°:** Ubuntu 22.04 LTS
- **–†–µ–≥–∏–æ–Ω:** Canada Central
- **IP –∞–¥—Ä–µ—Å:** `20.151.51.172` (–ø—É–±–ª–∏—á–Ω—ã–π, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π)
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ Active (running) - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å 01:44:16 UTC
- **Uptime:** –°—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫
- **–†–µ—Å—É—Ä—Å—ã:** RAM: 96MB/8GB, CPU: —Å—Ç–∞–±–∏–ª—å–Ω–æ
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ì–æ—Ç–æ–≤ –∫ 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

#### **–°–µ—Ä–≤–∏—Å—ã –∏ –ø–æ—Ä—Ç—ã:**
| **–°–µ—Ä–≤–∏—Å** | **–ü–æ—Ä—Ç** | **–ü—Ä–æ—Ç–æ–∫–æ–ª** | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | **–°—Ç–∞—Ç—É—Å** |
|-----------|---------|-------------|---------------|-----------|
| gRPC Server | `50051` | gRPC/HTTP2 | –û—Å–Ω–æ–≤–Ω–æ–π API –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω |
| HTTP Server | `8080` | HTTP | Health checks & status API | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω |
| Nginx Proxy | `443` | HTTPS/HTTP2 | Reverse proxy ‚Üí gRPC (50051) + HTTP (8080) + Updates (8081) | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω |
| Update Server | `8081` | HTTP | Sparkle –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ | ‚úÖ –ì–æ—Ç–æ–≤ |

#### **Nginx HTTP/2 gRPC Passthrough (PR-7):**

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- **HTTP/2 –≤–∫–ª—é—á–µ–Ω** ‚Äî `listen 443 ssl http2`
- **gRPC passthrough** ‚Äî `grpc_pass grpc://grpc_backend` –Ω–∞ –∫–æ—Ä–Ω–µ `/`
- **–¢–∞–π–º–∞—É—Ç—ã:**
  - `grpc_read_timeout 300s` ‚Äî –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤
  - `grpc_send_timeout 300s` ‚Äî –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
  - `grpc_connect_timeout 10s` ‚Äî –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞** ‚Äî `proxy_request_buffering off` –¥–ª—è —Å—Ç—Ä–∏–º–æ–≤
- **Cache-Control:**
  - `appcast.xml`: `max-age=60` (1 –º–∏–Ω—É—Ç–∞)
  - `/updates/health`: `max-age=30` (30 —Å–µ–∫—É–Ω–¥)
  - `/health`, `/status`: `max-age=30` (30 —Å–µ–∫—É–Ω–¥)

**–§–∞–π–ª:** `nginx/grpc-passthrough.conf`

#### **gRPC Server –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- **–í–æ—Ä–∫–µ—Ä—ã:** 100 (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- **Keep-alive:** 30 —Å–µ–∫—É–Ω–¥
- **–ë—É—Ñ–µ—Ä—ã:** 4MB (max message size)
- **–¢–∞–π–º–∞—É—Ç –∫–ª–∏–µ–Ω—Ç–∞:** 5 –º–∏–Ω—É—Ç
- **–ê–∫—Ç–∏–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:** 8 (text_processing, audio_generation, session_management, memory_management, interrupt_handling, text_filtering, update, grpc_service)
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **TLS:** –ü–æ–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ –±—É–¥—É—â–µ–º)

#### **Systemd Service:**
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** `voice-assistant.service`
- **–ü—É—Ç—å:** `/etc/systemd/system/voice-assistant.service`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ `active (running)`
- **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:** –í–∫–ª—é—á–µ–Ω (`enabled`)
- **Working Directory:** `/home/azureuser/voice-assistant`
- **Python:** `/home/azureuser/voice-assistant/venv/bin/python`
- **Entry Point:** `main.py`
- **Restart Policy:** `Restart=always`
- **Logs:** `journalctl -u voice-assistant.service`

#### **Health Checks:**
- **Health Endpoint:** `http://20.151.51.172/health` ‚Üí `200 OK`
- **Status API:** `http://20.151.51.172/status` ‚Üí JSON —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
  - –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–¥–æ 100)
  - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
  - Requests per minute (–¥–æ 1000)
  - Error rate (–ª–∏–º–∏—Ç 5%)
  - Average response time (–ª–∏–º–∏—Ç 5 —Å–µ–∫)
  - CPU & Memory usage (–ª–∏–º–∏—Ç 80%)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

### üöÄ **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –î–ï–ü–õ–û–ô –ò CI/CD:**

#### **Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ VM:**
- **URL:** `https://github.com/Seregawpn/Nexy_server.git`
- **–ü—É—Ç—å:** `/home/azureuser/voice-assistant`
- **–í–µ—Ç–∫–∞:** `main`
- **–°—Ç–∞—Ç—É—Å:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å origin
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** –ö–æ—Ä–µ–Ω—å = —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã (–±–µ–∑ `server/` –ø–∞–ø–∫–∏)

#### **GitHub Actions Workflow:**
- **–§–∞–π–ª:** `.github/workflows/deploy-to-azure.yml`
- **–¢—Ä–∏–≥–≥–µ—Ä—ã:** 
  - Push –≤ –≤–µ—Ç–∫—É `main`
  - –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤: `main.py`, `modules/**`, `integrations/**`, `config/**`, `requirements.txt`
  - Manual dispatch (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)
- **–ú–µ—Ç–æ–¥ –¥–µ–ø–ª–æ—è:** Azure CLI ‚Üí `az vm run-command invoke`
- **–°–µ–∫—Ä–µ—Ç—ã:** `AZURE_CREDENTIALS` (JSON —Ñ–æ—Ä–º–∞—Ç)
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Azure –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–¢–∞–π–º–∞—É—Ç:** 15 –º–∏–Ω—É—Ç

#### **–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ GitHub:**
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ä–µ–ª–∏–∑–æ–≤:** `https://github.com/Seregawpn/Nexy_production.git`
- **–ü—Ä–æ—Ü–µ—Å—Å:** DMG —Ñ–∞–π–ª ‚Üí GitHub Release ‚Üí Azure —Å–µ—Ä–≤–µ—Ä ‚Üí AppCast XML
- **–°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è:** `scripts/deploy.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
- **–¢–µ–≥ —Ä–µ–ª–∏–∑–∞:** `Update` (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è)
- **CDN:** GitHub CDN –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏:** SHA256 —Ö–µ—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è

#### **–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
**–ü—É—Ç—å:** `/home/azureuser/update-server.sh`

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**
1. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ (–¥–ª—è –æ—Ç–∫–∞—Ç–∞)
2. ‚úÖ `git stash` (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)
3. ‚úÖ `git clean -fd --exclude=venv/` (–æ—á–∏—Å—Ç–∫–∞, –Ω–æ –Ω–µ venv)
4. ‚úÖ `git pull origin main` (–ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)
5. ‚úÖ `pip install -r requirements.txt` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
6. ‚úÖ **–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è protobuf —Ñ–∞–π–ª–æ–≤** (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
   ```bash
   python -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. \
     modules/grpc_service/streaming.proto
   ```
7. ‚úÖ `systemctl restart voice-assistant.service` (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
8. ‚úÖ Health check (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
9. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç** –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ:
   - `git reset --hard $CURRENT_COMMIT`
   - –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è protobuf –¥–ª—è —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ `git pull`
- ‚úÖ –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ –û—Ç–∫–∞—Ç –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ health check
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã:**
- ‚ö†Ô∏è **Protobuf regeneration** –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- ‚ö†Ô∏è **venv preservation** - –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ `git clean`
- ‚ö†Ô∏è **Health check timeout** - 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### üìÅ **–°–¢–†–£–ö–¢–£–†–ê –†–ï–ü–û–ó–ò–¢–û–†–ò–ï–í:**

**üîó –î–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π:**

**1. –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç (`nexy_new`):**
- **URL:** `https://github.com/Seregawpn/nexy_new.git`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π –ø—Ä–æ–µ–∫—Ç (–∫–ª–∏–µ–Ω—Ç + —Å–µ—Ä–≤–µ—Ä)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** `client/` + `server/` + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**2. –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (`Nexy_server`):**
- **URL:** `https://github.com/Seregawpn/Nexy_server.git`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –¥–ª—è Azure VM
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ Azure VM
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** –¢–æ–ª—å–∫–æ `server/` —Ñ–∞–π–ª—ã + GitHub Actions

**üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
1. **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞** ‚Üí –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (`nexy_new`)
2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** ‚Üí –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `server/` –≤ `Nexy_server`
3. **–î–µ–ø–ª–æ–π** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —á–µ—Ä–µ–∑ GitHub Actions

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** Azure VM –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ `Nexy_server` —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.

–ï—Å–ª–∏ —á–µ–≥–æ‚Äë—Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤ —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –ø—Ä–∞–≤–∫–∏, –º—ã –æ–±–Ω–æ–≤–∏–º ¬´–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã¬ª –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

***

–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2 –æ–∫—Ç—è–±—Ä—è 2025 - –æ–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å Azure VM, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è, —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–∏.

---

## 12) –ö–∞—Ç–∞–ª–æ–≥ –º–æ–¥—É–ª–µ–π

### üñ•Ô∏è **–ö–õ–ò–ï–ù–¢–°–ö–ò–ï –ú–û–î–£–õ–ò (client/modules)**

- `audio_device_manager` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞, –∞–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ, –∫–æ–ª–±—ç–∫–∏ —Å–º–µ–Ω—ã; –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ EventBus.
- `grpc_client` ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π gRPC –∫–ª–∏–µ–Ω—Ç, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º/—Ä–µ—Ç—Ä–∞—è–º–∏.
- `hardware_id` ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –∫—ç—à/TTL, —Ñ–æ–Ω–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
- `input_processing` ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (Quartz/pynput), –¥–µ—Ç–µ–∫—Ü–∏—è LONG/SHORT/RELEASE, –∫–æ–Ω—Ñ–∏–≥ –ø–æ—Ä–æ–≥–æ–≤.
- `interrupt_management` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π (—Ç–∏–ø—ã/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã/–∏—Å—Ç–æ—Ä–∏—è), API –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø–∏—Å–∏/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.
- `mode_management` ‚Äî `ModeController`, —Ç–∏–ø—ã, —Ä–µ–∂–∏–º—ã (S/L/P), –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.
- `network_manager` ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏ (ping/HTTP), —Å–æ–±—ã—Ç–∏—è —Å—Ç–∞—Ç—É—Å–∞, —Å–Ω–∞–ø—à–æ—Ç—ã.
- `permissions` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–ø—Ä–æ—Å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (–º–∏–∫—Ä–æ—Ñ–æ–Ω/–∑–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞/—Å–µ—Ç—å/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è).
- `screenshot_capture` ‚Äî –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∑–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞/—Ä–∞–∑–º–µ—Ä–∞; –Ω–∞ macOS ‚Äî bridge/CLI fallback.
- `speech_playback` ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ —á–∞–Ω–∫–æ–≤, –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º.
- `tray_controller` ‚Äî UI-–∏–∫–æ–Ω–∫–∞/–º–µ–Ω—é, —Å—Ç–∞—Ç—É—Å—ã –¥–ª—è —Ä–µ–∂–∏–º–æ–≤.
- `updater` ‚Äî –ù–û–í–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: HTTP –º–∞–Ω–∏—Ñ–µ—Å—Ç, DMG —Ñ–∞–π–ª—ã, –º–∏–≥—Ä–∞—Ü–∏—è –≤ ~/Applications, 3 —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SHA256 + Ed25519 + codesign).
- `voice_recognition` ‚Äî –∑–∞–ø–∏—Å—å/—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏, —Å–∏–º—É–ª—è—Ç–æ—Ä/—Ä–µ–∞–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫, —Ç–∞–π–º–∞—É—Ç—ã, –æ—Ç–º–µ–Ω–∞.
- `voiceover_control` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VoiceOver –Ω–∞ macOS: —É–º–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ/–≤–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Command+F5, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.
- `instance_manager` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤: —Ñ–∞–π–ª–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, PID –ø—Ä–æ–≤–µ—Ä–∫–∞, TOCTOU –∑–∞—â–∏—Ç–∞, –∞—É–¥–∏–æ-—Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –Ω–µ–∑—Ä—è—á–∏—Ö.
- `welcome_message` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, TTS fallback, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
- `autostart_manager` ‚Äî –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: LaunchAgent —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, Login Items, bundle_id –ø–æ–¥—Ö–æ–¥, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.

### üñ•Ô∏è **–°–ï–†–í–ï–†–ù–´–ï –ú–û–î–£–õ–ò (server/modules)**

–í—Å–µ –º–æ–¥—É–ª–∏ –¥–æ–ª–∂–Ω—ã —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å `UniversalModuleInterface` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ `ModuleCoordinator`.

| **–ú–æ–¥—É–ª—å** | **Capability** | **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è/–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** | **–°—Ç–∞—Ç—É—Å** |
|------------|---------------|---------------------------|------------|
| `grpc_service` | `grpc` | `GrpcServiceIntegration` + `ModuleCoordinator` | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä (PR-2.1) |
| `text_processing` | `text_processing` | `StreamingWorkflowIntegration` | ‚úÖ –ù–∞—Ç–∏–≤–Ω—ã–π –º–æ–¥—É–ª—å |
| `audio_generation` | `audio_generation` | `StreamingWorkflowIntegration` | ‚úÖ –ê–¥–∞–ø—Ç–µ—Ä (PR-2.1) |
| `database` | `database` | `ModuleCoordinator` | ‚úÖ –ê–¥–∞–ø—Ç–µ—Ä (PR-2.1) |
| `session_management` | `session` | `ModuleCoordinator` | ‚úÖ –ê–¥–∞–ø—Ç–µ—Ä (PR-2.1) |
| `memory_management` | `memory` | `MemoryWorkflowIntegration` | ‚úÖ –ê–¥–∞–ø—Ç–µ—Ä (PR-2.1) |
| `interrupt_handling` | `interrupt` | `InterruptWorkflowIntegration` | ‚úÖ –ê–¥–∞–ø—Ç–µ—Ä (PR-2.1) |
| `text_filtering` | `text_filtering` | `StreamingWorkflowIntegration` | ‚úÖ –ê–¥–∞–ø—Ç–µ—Ä (PR-2.1) |
| `update` | `update` | `ModuleCoordinator` | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ü—Ä–∞–≤–∏–ª–∞:**
- –í—Å–µ –º–æ–¥—É–ª–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç `UniversalModuleInterface` (–Ω–∞—Ç–∏–≤–Ω–æ –∏–ª–∏ —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `ModuleCoordinator.register(capability, module, config)`
- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π —á–µ—Ä–µ–∑ `coordinator.get(capability)`
- –ü—Ä—è–º—ã–µ –º–µ–∂–º–æ–¥—É–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã
- –í `grpc_service_manager.py` –Ω–µ—Ç –ø—Ä—è–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –º–æ–¥—É–ª–µ–π (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä—ã)

**–§–∏—á–∞-—Ñ–ª–∞–≥–∏ –∏ Kill-switches:**
- `features.use_module_coordinator` ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞
- `kill_switches.disable_module_coordinator` ‚Äî —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `unified_config.py` (FeaturesConfig, KillSwitchesConfig)

**–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–∞:**
```
gRPC ‚Üí GrpcServiceManager ‚Üí ModuleCoordinator ‚Üí Modules (adapters/native)
                                                      ‚Üì
                                            WorkflowIntegrations
```

### üìä **–°–ò–°–¢–ï–ú–´ –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê –ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø**

- `monitoring` ‚Äî —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –º–µ—Ç—Ä–∏–∫–∏, –∞–ª–µ—Ä—Ç—ã.
- `scripts` ‚Äî smoke-—Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä–∫–∏ backpressure, –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –º–æ–¥—É–ª–∏ –Ω–µ –∑–Ω–∞—é—Ç –ø—Ä–æ EventBus/—Ä–µ–∂–∏–º—ã –Ω–∞–ø—Ä—è–º—É—é ‚Äî —ç—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–ª–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π. –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –º–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ gRPC —Å–µ—Ä–≤–∏—Å.

---

## 13) –ö–∞—Ç–∞–ª–æ–≥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### üñ•Ô∏è **–ö–õ–ò–ï–ù–¢–°–ö–ò–ï –ò–ù–¢–ï–ì–†–ê–¶–ò–ò (client/integration/integrations)**

- `mode_management_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –µ–¥–∏–Ω—ã–π ¬´—Ä—É–±–∏–ª—å–Ω–∏–∫¬ª —Ä–µ–∂–∏–º–æ–≤; –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `mode.request`, –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç `ModeController`, –ø—É–±–ª–∏–∫—É–µ—Ç —Ñ–∞–∫—Ç —á–µ—Ä–µ–∑ `StateManager`.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `mode.request`, `app.mode_changed`, –º–æ—Å—Ç—ã `keyboard.*`, `grpc.request_*`, `playback.*`, `interrupt.request`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: –ø—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Äî `app.mode_changed` (—á–µ—Ä–µ–∑ StateManager), –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ—Å—Ç—ã.

- `input_processing_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: PTT-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `voice.recording_start/stop`, –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–∂–∏–º LISTENING/PROCESSING.
  - –ü–æ–¥–ø–∏—Å–∫–∏: –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–ª–±—ç–∫–∏ –æ—Ç KeyboardMonitor, `voice.recognition_*` (fail/timeout).
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `keyboard.press/short_press/long_press/release`, `voice.recording_start/stop`, `mode.request(LISTENING|PROCESSING|SLEEPING)`.

- `voice_recognition_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∑–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è, –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `mode.switch` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è), –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç–∞—Ä—Ç/—Å—Ç–æ–ø –∑–∞–ø–∏—Å–∏, —Ç–∞–π–º–µ—Ä—ã; —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–º–µ–Ω—É —Ä–µ–∂–∏–º–∞.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `voice.recognition_started|completed|failed|timeout`, `mode.request(SLEEPING)` –ø—Ä–∏ fail/timeout.

- `grpc_client_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç `text + screenshot + hardware_id`, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç StreamRequest, —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –≤ —Å–æ–±—ã—Ç–∏—è.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `voice.recognition_completed`, `screenshot.captured`, `hardware.id_*`, `keyboard.short_press` (cancel), `interrupt.request`, `network.status_changed`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `grpc.request_started|completed|failed`, `grpc.response.audio`.

- `speech_playback_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ —á–∞–Ω–∫–æ–≤ –æ—Ç–≤–µ—Ç–∞, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `grpc.response.audio`, `grpc.request_completed|failed`, `keyboard.short_press`, `interrupt.request`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `playback.started|completed|failed|cancelled`, `mode.request(SLEEPING)` –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é/–æ—à–∏–±–∫–µ/—Ç–∏—à–∏–Ω–µ.

- `screenshot_capture_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ–¥–∏–Ω —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ PROCESSING; CLI‚Äëfallback –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –º–æ–¥—É–ª—è.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.mode_changed`, `voice.recording_stop`, `permissions.*` —Å—Ç–∞—Ç—É—Å—ã.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `screenshot.captured` (jpeg/webp), `screenshot.error`.

- `audio_device_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∞–≤—Ç–æ—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏/–º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º –ø–æ —Ä–µ–∂–∏–º–∞–º.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `app.shutdown`, `app.state_changed`, `app.mode_changed`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `audio.device_snapshot`, `audio.device_switched`, –æ—à–∏–±–∫–∏ –∞—É–¥–∏–æ.

- `permissions_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `app.shutdown`, `app.mode_changed`, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–≤–µ—Ä–∫–∏.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `permissions.status_checked`, `permissions.critical_status`, `permissions.app_blocked|app_unblocked`, `mode.request(SLEEPING)` –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ.

- `network_manager_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏, —Å–Ω–∞–ø—à–æ—Ç—ã, —Å–æ–±—ã—Ç–∏—è —Å–º–µ–Ω—ã.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `network.status_snapshot`, `network.status_changed`.

- `hardware_id_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ hardware_id; –æ—Ç–≤–µ—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `hardware.id_request`, `hardware.id_refresh`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `hardware.id_obtained`, `hardware.id_response`, `hardware.id_error`.

- `tray_controller_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞/–º–µ–Ω—é –≤ —Ç—Ä–µ–µ.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.mode_changed`, `keyboard.*`, `voice.mic_opened|closed`, `audio.device_*`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `tray.status_updated`.

- `updater_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ù–û–í–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π - HTTP –º–∞–Ω–∏—Ñ–µ—Å—Ç, DMG —Ñ–∞–π–ª—ã, –º–∏–≥—Ä–∞—Ü–∏—è –≤ ~/Applications, –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `app.shutdown`, `updater.check_manual`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

- `instance_manager_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ - –±–ª–æ–∫–∏—Ä—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, —Ñ–∞–π–ª–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, PID –≤–∞–ª–∏–¥–∞—Ü–∏—è.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `app.shutdown`, `instance.check_request`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `instance.status_checked`, `signal.duplicate_instance` (–∞—É–¥–∏–æ-—Å–∏–≥–Ω–∞–ª –¥–ª—è –Ω–µ–∑—Ä—è—á–∏—Ö).
  - –ö–†–ò–¢–ò–ß–ù–û: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ü–ï–†–í–´–ú –∏ –ë–õ–û–ö–ò–†–£–Æ–©–ò–ú - –ø—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `sys.exit(1)`.

- `voiceover_ducking_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VoiceOver –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏ –∑—Ä–µ–Ω–∏—è - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ/–≤–∫–ª—é—á–µ–Ω–∏–µ VoiceOver –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.mode_changed`, `keyboard.press`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: —Å–æ–±—ã—Ç–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VoiceOver, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
  - –õ–æ–≥–∏–∫–∞: –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ VoiceOver, –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏ LISTENING/PROCESSING, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∏ SLEEPING.

- `welcome_message_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ - –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, TTS fallback.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `speech_playback.ready`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: —Å–æ–±—ã—Ç–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
  - –õ–æ–≥–∏–∫–∞: –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

- `autostart_manager_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º - LaunchAgent, Login Items, bundle_id –ø–æ–¥—Ö–æ–¥.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `autostart.request`, `autostart.status_check`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `autostart.status_checked`, —Å–æ–±—ã—Ç–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º.
  - –ö–†–ò–¢–ò–ß–ù–û: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ü–û–°–õ–ï–î–ù–ò–ú –∏ –ù–ï –ë–õ–û–ö–ò–†–£–Æ–©–ò–ú.

–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç: –≤—Å–µ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–æ–≤ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `mode.request`; —Ñ–∞–∫—Ç —Å–º–µ–Ω—ã ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç StateManager.

### üñ•Ô∏è **–°–ï–†–í–ï–†–ù–´–ï –ò–ù–¢–ï–ì–†–ê–¶–ò–ò (server/integrations)**

- `service_integrations/` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
  - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Ä–≤–∏—Å–æ–≤
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

- `workflow_integrations/` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ workflows —Å–µ—Ä–≤–µ—Ä–∞
  - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π workflows

- `core/` ‚Äî –±–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞
  - –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
  - –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
  - –£—Ç–∏–ª–∏—Ç—ã –∏ —Ö–µ–ª–ø–µ—Ä—ã

---

## 14) –î–∏–∞–≥—Ä–∞–º–º—ã (Mermaid)

–ë—ã—Å—Ç—Ä—ã–µ —Å—Ö–µ–º—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤ –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏. GitHub —Ä–µ–Ω–¥–µ—Ä–∏—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã Mermaid, –≤ IDE –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å Markdown Preview.

### üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã (–∫–ª–∏–µ–Ω—Ç + —Å–µ—Ä–≤–µ—Ä)**

```mermaid
graph TB
    subgraph "üñ•Ô∏è –ö–ª–∏–µ–Ω—Ç (macOS)"
        A[EventBus] --> B[ModeManagementIntegration]
        B --> C[ModeController]
        C --> D[ApplicationStateManager]
        D --> E[Workflows]
        E --> F[–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏]
        F --> G[–ú–æ–¥—É–ª–∏]
        G --> H[gRPC Client]
    end
    
    subgraph "üñ•Ô∏è –°–µ—Ä–≤–µ—Ä (Python)"
        I[gRPC Server] --> J[GrpcServiceManager]
        J --> K[–ú–æ–¥—É–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞]
        K --> L[Monitoring]
        L --> M[Load Testing]
    end
    
    H <--> I
    
    subgraph "üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
        N[–ú–µ—Ç—Ä–∏–∫–∏] --> O[–ê–ª–µ—Ä—Ç—ã]
        O --> P[–û—Ç—á–µ—Ç—ã]
    end
    
    L --> N
```

### üîÑ **PTT: SLEEPING ‚Üí LISTENING ‚Üí PROCESSING ‚Üí SLEEPING (happy path)**

```mermaid
sequenceDiagram
    participant User
    participant Input as InputProcessingIntegration
    participant Bus as EventBus
    participant ModeMgmt as ModeManagementIntegration
    participant Ctrl as ModeController
    participant State as ApplicationStateManager
    participant VRec as VoiceRecognitionIntegration
    participant Shot as ScreenshotCaptureIntegration
    participant Grpc as GrpcClientIntegration
    participant Speech as SpeechPlaybackIntegration

    User->>Input: Long press (SPACE)
    Input->>Bus: voice.recording_start(session_id)
    Input->>Bus: mode.request(LISTENING)
    Bus->>ModeMgmt: mode.request
    ModeMgmt->>Ctrl: switch_mode(LISTENING)
    Ctrl-->>ModeMgmt: on_mode_changed(LISTENING)
    ModeMgmt->>State: set_mode(LISTENING)
    State->>Bus: app.mode_changed(mode=LISTENING)
    Bus-->>VRec: start listening

    User->>Input: Release (SPACE)
    Input->>Bus: voice.recording_stop(session_id)
    Input->>Bus: mode.request(PROCESSING)
    Bus->>ModeMgmt: mode.request
    ModeMgmt->>Ctrl: switch_mode(PROCESSING)
    Ctrl-->>ModeMgmt: on_mode_changed(PROCESSING)
    ModeMgmt->>State: set_mode(PROCESSING)
    State->>Bus: app.mode_changed(mode=PROCESSING)
    Bus-->>Shot: capture once
    VRec-->>Bus: voice.recognition_completed(text, session_id)
    Bus-->>Grpc: send (text+screenshot+hardware_id)
    Grpc-->>Bus: grpc.response.audio (chunks)
    Bus-->>Speech: play chunks
    Grpc-->>Bus: grpc.request_completed
    Speech-->>Bus: playback.completed
    Speech-->>Bus: mode.request(SLEEPING)
    Bus->>ModeMgmt: mode.request
    ModeMgmt->>Ctrl: switch_mode(SLEEPING)
    Ctrl-->>ModeMgmt: on_mode_changed(SLEEPING)
    ModeMgmt->>State: set_mode(SLEEPING)
    State->>Bus: app.mode_changed(mode=SLEEPING)
```

–ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∂–∞—Ç–∏–µ (interrupt): –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –≤ SLEEPING

```mermaid
sequenceDiagram
    participant Input as InputProcessingIntegration
    participant Bus as EventBus
    participant ModeMgmt as ModeManagementIntegration
    participant Ctrl as ModeController
    participant State as ApplicationStateManager
    participant Speech as SpeechPlaybackIntegration

    Input->>Bus: keyboard.short_press
    Speech-->>Bus: playback.cancelled (stop)
    Bus->>Bus: publish mode.request(SLEEPING)
    Bus->>ModeMgmt: mode.request(SLEEPING)
    ModeMgmt->>Ctrl: switch_mode(SLEEPING)
    Ctrl-->>ModeMgmt: on_mode_changed
    ModeMgmt->>State: set_mode(SLEEPING)
    State->>Bus: app.mode_changed(SLEEPING)
```

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞

```mermaid
flowchart LR
    subgraph Integrations
      A[InputProcessing] -->|mode.request| MM
      B[VoiceRecognition] -->|mode.request| MM
      C[SpeechPlayback] -->|mode.request| MM
      D[Permissions] -->|mode.request| MM
      E[Interrupts] -->|mode.request| MM
    end
    MM[ModeManagementIntegration]\n(–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞—è–≤–∫–∏) --> MC[ModeController]\n(–ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤)
    MC -->|callback| SM[ApplicationStateManager]\nset_mode()
    SM --> EB[EventBus]\napp.mode_changed
    EB --> Consumers[–í—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏]
```

### üìà **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

```mermaid
graph LR
    subgraph "üöÄ gRPC Server (100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)"
        A[ThreadPoolExecutor<br/>100 –≤–æ—Ä–∫–µ—Ä–æ–≤] --> B[Connection Pool<br/>100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π]
        B --> C[gRPC Options<br/>keepalive, buffers]
        C --> D[Memory Limits<br/>5-10x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ]
    end
    
    subgraph "üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
        E[–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è] --> F[RPS]
        F --> G[–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞]
        G --> H[–ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫]
        H --> I[CPU/–ü–∞–º—è—Ç—å]
    end
    
    subgraph "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
        J[Load Test Script] --> K[100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π]
        K --> L[–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏]
        L --> M[–ê–Ω–∞–ª–∏–∑ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏]
    end
    
    A --> E
    J --> A
```
