# üåê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 11 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è —Å–µ—Ä–≤–µ—Ä–∞:** 1.6.0.40  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
2. [–°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#—Å–µ—Ç–µ–≤–∞—è-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
3. [–°–µ—Ä–≤–∏—Å—ã –∏ –ø–æ—Ä—Ç—ã](#—Å–µ—Ä–≤–∏—Å—ã-–∏-–ø–æ—Ä—Ç—ã)
4. [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
5. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è backpressure](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-backpressure)
6. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
7. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–≤–µ—Ä—Å–∏—è–º–∏)
8. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
9. [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫](#–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–∏-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–æ—à–∏–±–æ–∫)

---

## üèóÔ∏è –û–±–∑–æ—Ä –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### **Azure VM:**
- **OS:** Ubuntu 22.04 LTS
- **Size:** Standard_D2s_v3 (2 vCPU, 8 GB RAM)
- **Location:** canadacentral
- **Public IP:** `20.63.24.187` (–º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏)
- **Resource Group:** `NetworkWatcherRG`
- **VM Name:** `Nexy`

### **–°–µ—Ä–≤–∏—Å—ã:**
- **gRPC Server:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
- **HTTP Health/Status:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- **Update Server:** –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞–º
- **Nginx:** Reverse proxy –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

## üåê –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### **–í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø (—á–µ—Ä–µ–∑ Nginx):**

| Endpoint | URL | –ü—Ä–æ—Ç–æ–∫–æ–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|----------|
| gRPC | `https://20.63.24.187:443` | HTTPS/gRPC (HTTP/2) | –û—Å–Ω–æ–≤–Ω–æ–π gRPC —Å–µ—Ä–≤–∏—Å |
| Health | `https://20.63.24.187/health` | HTTPS | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è |
| Status | `https://20.63.24.187/status` | HTTPS | –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ |
| Updates | `https://20.63.24.187/updates/*` | HTTPS | –°–µ—Ä–≤–∏—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π |

### **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Ä—Ç—ã (—Ç–æ–ª—å–∫–æ localhost):**

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | Host | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|------|----------|
| gRPC | 50051 | `127.0.0.1` | gRPC —Å–µ—Ä–≤–µ—Ä (–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ) |
| HTTP Health | 8080 | `127.0.0.1` | Health/Status endpoints |
| Update Server | 8081 | `127.0.0.1` | –°–µ—Ä–≤–∏—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π |

**‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ:** –í—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ `127.0.0.1` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º 50051, 8080, 8081 –∏–∑–≤–Ω–µ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.

### **Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

- **gRPC:** –ö–æ—Ä–Ω–µ–≤–æ–π –ø—É—Ç—å `/` ‚Üí `grpc_pass grpc://127.0.0.1:50051;`
- **Health/Status:** `/health`, `/status` ‚Üí `proxy_pass http://127.0.0.1:8080;`
- **Updates:** `/updates/*` ‚Üí `proxy_pass http://127.0.0.1:8081;`

---

## üîß –°–µ—Ä–≤–∏—Å—ã –∏ –ø–æ—Ä—Ç—ã

### **1. gRPC Server (50051)**

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- **Host:** `127.0.0.1` (—Ç–æ–ª—å–∫–æ localhost)
- **Port:** `50051`
- **Max Workers:** `100` (prod)
- **Protocol:** gRPC over HTTP/2

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ThreadPoolExecutor —Å 100 –≤–æ—Ä–∫–µ—Ä–∞–º–∏
- Keep-alive –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –¥–æ–ª–≥–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ò–Ω—Ç–µ—Ä—Å–µ–ø—Ç–æ—Ä –¥–ª—è –µ–¥–∏–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ gRPC:**
```python
options = [
    ('grpc.keepalive_time_ms', 30000),
    ('grpc.keepalive_timeout_ms', 5000),
    ('grpc.keepalive_permit_without_calls', True),
    ('grpc.max_receive_message_length', 4 * 1024 * 1024),  # 4MB
    ('grpc.max_send_message_length', 4 * 1024 * 1024),     # 4MB
    ('grpc.client_idle_timeout_ms', 300000),  # 5 –º–∏–Ω—É—Ç
]
```

### **2. HTTP Health/Status Server (8080)**

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- **Host:** `127.0.0.1` (—Ç–æ–ª—å–∫–æ localhost)
- **Port:** `8080`
- **Framework:** aiohttp

**Endpoints:**
- `GET /health` - Health check (Container Apps compliance)
- `GET /status` - –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
- `GET /` - –ö–æ—Ä–Ω–µ–≤–æ–π endpoint

**–û—Ç–≤–µ—Ç Health:**
```json
{
  "status": "OK",
  "latest_version": "1.6.0.40",
  "latest_build": "1.6.0.40"
}
```

**–û—Ç–≤–µ—Ç Status:**
```json
{
  "status": "running",
  "service": "voice-assistant",
  "latest_version": "1.6.0.40",
  "latest_build": "1.6.0.40",
  "update_server": "enabled",
  "endpoints": {
    "health": "/health",
    "status": "/status",
    "grpc": "port 50051",
    "updates": "port 8081"
  }
}
```

### **3. Update Server (8081)**

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- **Host:** `127.0.0.1` (—Ç–æ–ª—å–∫–æ localhost)
- **Port:** `8081`
- **Enabled:** `true`
- **CORS:** `true`

**Endpoints:**
- `GET /updates/health` - Health check update server
- `GET /updates/appcast.xml` - Sparkle appcast
- `GET /updates/downloads/*` - –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

## ‚öôÔ∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### **1. Backpressure Manager**

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ —Å—Ç—Ä–∏–º—ã –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (prod):**
```python
max_concurrent_streams: 50        # –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤
idle_timeout_seconds: 900         # 15 –º–∏–Ω—É—Ç –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö TTS –æ—Ç–≤–µ—Ç–æ–≤
max_message_rate_per_second: 0    # –û—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è –∞—É–¥–∏–æ —Å—Ç—Ä–∏–º–æ–≤
grace_period_seconds: 30           # –ü–µ—Ä–∏–æ–¥ –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤
- –ó–∞—â–∏—Ç–∞ –æ—Ç "–º–æ–ª—á–∞–ª–∏–≤—ã—Ö" –∫–ª–∏–µ–Ω—Ç–æ–≤ (idle timeout)
- Rate limiting –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è –∞—É–¥–∏–æ —Å—Ç—Ä–∏–º–æ–≤ (0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
- Graceful –∑–∞–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∏–º–æ–≤ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

**–û—à–∏–±–∫–∏:**
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ `max_concurrent_streams` ‚Üí `RESOURCE_EXHAUSTED`
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ `idle_timeout_seconds` ‚Üí —Å—Ç—Ä–∏–º –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### **2. Graceful Shutdown**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ `SIGTERM` –∏ `SIGINT`
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ backpressure manager
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
- –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `shutdown_event`
3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ backpressure manager
4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
5. –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
6. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

### **3. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

**–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:**
```
ts=2026-01-11T12:00:00.000Z level=INFO scope=grpc method=StreamAudio decision=start ctx={...} dur_ms=123
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `ts` - Timestamp (ISO 8601)
- `level` - –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARNING, ERROR)
- `scope` - –û–±–ª–∞—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (grpc, server, database, etc.)
- `method` - RPC –º–µ—Ç–æ–¥ (StreamAudio, InterruptSession, etc.)
- `decision` - –†–µ—à–µ–Ω–∏–µ (start, complete, abort, retry, degrade, error)
- `ctx` - –ö–æ–Ω—Ç–µ–∫—Å—Ç (JSON –æ–±—ä–µ–∫—Ç —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π)
- `dur_ms` - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ (API –∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã)
- –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- –£–¥–æ–±—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∞ —á–µ—Ä–µ–∑ CI/CloudWatch/Log Analytics

### **4. –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

**–°–±–æ—Ä—â–∏–∫ –º–µ—Ç—Ä–∏–∫:**
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- P95 latency –ø–æ RPC –º–µ—Ç–æ–¥–∞–º
- Error rate –ø–æ –º–µ—Ç–æ–¥–∞–º
- Decision rate (start/abort/retry/degrade/complete)
- Total requests/errors

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫:**
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- –ò—Ç–æ–≥–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏ graceful shutdown
- –§–æ—Ä–º–∞—Ç: `METRICS: {...}`

---

## üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è backpressure

### **–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (prod):**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `max_concurrent_streams` | 50 | –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤ |
| `idle_timeout_seconds` | 900 | –¢–∞–π–º–∞—É—Ç –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤ (15 –º–∏–Ω—É—Ç) |
| `max_message_rate_per_second` | 0 | Rate limit (0 = –æ—Ç–∫–ª—é—á–µ–Ω–æ) |
| `grace_period_seconds` | 30 | –ü–µ—Ä–∏–æ–¥ –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º |

### **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:**

1. **idle_timeout_seconds: 900 (15 –º–∏–Ω—É—Ç)**
   - –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–ª–∏–Ω–Ω—ã—Ö TTS –æ—Ç–≤–µ—Ç–æ–≤
   - –ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è

2. **max_message_rate_per_second: 0 (–æ—Ç–∫–ª—é—á–µ–Ω–æ)**
   - –û—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è –∞—É–¥–∏–æ —Å—Ç—Ä–∏–º–æ–≤ —Å –≤—ã—Å–æ–∫–æ–π —á–∞—Å—Ç–æ—Ç–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 20 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫
   - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –∞—É–¥–∏–æ

3. **max_concurrent_streams: 50**
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω–µ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### **Health Checks:**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:**
```bash
curl -sk https://20.63.24.187/health
curl -sk https://20.63.24.187/status
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ update server:**
```bash
curl -sk https://20.63.24.187/updates/health
```

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

**–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏:**
- –í—Å–µ –ª–æ–≥–∏ –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- P95 latency, error rate, decision rate
- –ò—Ç–æ–≥–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏ shutdown

### **Systemd —Å–µ—Ä–≤–∏—Å:**

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```bash
sudo systemctl status voice-assistant.service
sudo systemctl restart voice-assistant.service
sudo journalctl -u voice-assistant.service -n 50 --no-pager
```

---

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏

### **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:**

**–§–∞–π–ª:** `/VERSION` (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
- –í–µ—Ä—Å–∏—è —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ `VERSION` —Ñ–∞–π–ª–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ health/status endpoints
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å update server
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** `1.6.0.40`

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏:**
```bash
# –ò–∑ health endpoint
curl -sk https://20.63.24.187/health | jq .latest_version

# –ò–∑ status endpoint
curl -sk https://20.63.24.187/status | jq .latest_version
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### **–°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

1. **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Ä—Ç—ã:**
   - –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ `127.0.0.1`
   - –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
   - –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Nginx –Ω–∞ –ø–æ—Ä—Ç—É 443

2. **Nginx:**
   - Reverse proxy –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - TLS/SSL —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
   - HTTP/2 –¥–ª—è gRPC

3. **NSG (Network Security Group):**
   - –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ—Ä—Ç—ã: 22 (SSH, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω), 80, 443
   - –ü–æ—Ä—Ç 22 –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–æ IP –∞–¥—Ä–µ—Å—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

1. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   - `config/unified_config.py` - –∫–æ–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - `config/unified_config.yaml` - –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   - `config.env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è)

2. **–°–µ–∫—Ä–µ—Ç—ã:**
   - –•—Ä–∞–Ω—è—Ç—Å—è –≤ `config.env` (–Ω–µ –≤ git)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –≤ –ª–æ–≥–∞—Ö
   - –ù–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
   - Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏–π

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-----------|----------|--------------|
| `NEXY_ENV` | –û–∫—Ä—É–∂–µ–Ω–∏–µ (dev/stage/prod) | `prod` |
| `GRPC_HOST` | Host –¥–ª—è gRPC (`auto` = –ø–æ `NEXY_ENV`) | `auto` |
| `GRPC_PORT` | –ü–æ—Ä—Ç –¥–ª—è gRPC | `50051` |
| `MAX_WORKERS` | –ú–∞–∫—Å–∏–º—É–º –≤–æ—Ä–∫–µ—Ä–æ–≤ gRPC | `100` |
| `HTTP_HOST` | Host –¥–ª—è HTTP (`auto` = –ø–æ `NEXY_ENV`) | `auto` |
| `HTTP_PORT` | –ü–æ—Ä—Ç –¥–ª—è HTTP | `8080` |
| `UPDATE_HOST` | Host –¥–ª—è Update (`auto` = –ø–æ `NEXY_ENV`) | `auto` |
| `UPDATE_PORT` | –ü–æ—Ä—Ç –¥–ª—è Update | `8081` |
| `BACKPRESSURE_MAX_STREAMS` | –ú–∞–∫—Å–∏–º—É–º —Å—Ç—Ä–∏–º–æ–≤ | `50` |
| `BACKPRESSURE_IDLE_TIMEOUT` | Idle timeout (—Å–µ–∫—É–Ω–¥—ã) | `900` |
| `BACKPRESSURE_MAX_RATE` | Rate limit (0 = –æ—Ç–∫–ª—é—á–µ–Ω–æ) | `0` |

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ host:**

- **prod/stage:** `127.0.0.1` (—Ç–æ–ª—å–∫–æ localhost)
- **dev:** `0.0.0.0` (–¥–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- **`auto`:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ `NEXY_ENV`

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **Client Connection Guide:** `Docs/CLIENT_CONNECTION_GUIDE.md`
- **Architecture Overview:** `server/Docs/ARCHITECTURE_OVERVIEW.md`
- **Performance Analysis:** `Docs/PERFORMANCE_BOTTLENECK_ANALYSIS.md`
- **gRPC Protocol Audit:** `Docs/GRPC_PROTOCOL_AUDIT.md`

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞

- [ ] Health endpoint –æ—Ç–≤–µ—á–∞–µ—Ç: `curl -sk https://20.63.24.187/health`
- [ ] Status endpoint –æ—Ç–≤–µ—á–∞–µ—Ç: `curl -sk https://20.63.24.187/status`
- [ ] Update server –¥–æ—Å—Ç—É–ø–µ–Ω: `curl -sk https://20.63.24.187/updates/health`
- [ ] gRPC –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: `python scripts/grpc_smoke.py 20.63.24.187 443`
- [ ] –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Ä—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ (50051, 8080, 8081)
- [ ] Systemd —Å–µ—Ä–≤–∏—Å –∞–∫—Ç–∏–≤–µ–Ω: `sudo systemctl status voice-assistant.service`
- [ ] –õ–æ–≥–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –º–µ—Ç—Ä–∏–∫–∏
- [ ] –í–µ—Ä—Å–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞: `curl -sk https://20.63.24.187/health | jq .latest_version`

---

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

### **–ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç SSH –¥–æ—Å—Ç—É–ø)
bash server/scripts/diagnose_remote_server.sh [SERVER_IP] [SSH_USER]

# –ü—Ä–∏–º–µ—Ä:
bash server/scripts/diagnose_remote_server.sh 20.63.24.187 azureuser
```

**–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–±–µ–∑ SSH):**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
curl -sk https://20.63.24.187/health
curl -sk https://20.63.24.187/status

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ gRPC –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
python scripts/grpc_smoke.py 20.63.24.187 443

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ update server
curl -sk https://20.63.24.187/updates/health
```

---

### **–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è**

#### **1. –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ health endpoint**

**–°–∏–º–ø—Ç–æ–º—ã:**
- `curl -sk https://20.63.24.187/health` ‚Üí —Ç–∞–π–º–∞—É—Ç –∏–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
ping 20.63.24.187

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 443
nc -zv 20.63.24.187 443

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx
curl -sk https://20.63.24.187/health
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ (—Ç—Ä–µ–±—É–µ—Ç SSH):**
   ```bash
   ssh azureuser@20.63.24.187
   sudo systemctl status voice-assistant.service
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞:**
   ```bash
   sudo journalctl -u voice-assistant.service -n 100 --no-pager
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Nginx:**
   ```bash
   sudo systemctl status nginx
   sudo nginx -t  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   ```

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å:**
   ```bash
   sudo systemctl restart voice-assistant.service
   sudo systemctl restart nginx
   ```

---

#### **2. gRPC –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –æ—à–∏–±–∫—É `UNAVAILABLE` –∏–ª–∏ `DEADLINE_EXCEEDED`
- `python scripts/grpc_smoke.py 20.63.24.187 443` ‚Üí –æ—à–∏–±–∫–∞

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ gRPC —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
python scripts/grpc_smoke.py 20.63.24.187 443

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint (–¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å)
curl -sk https://20.63.24.187/health
```

**–î–µ–π—Å—Ç–≤–∏—è (—Ç—Ä–µ–±—É–µ—Ç SSH):**
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ gRPC —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:**
   ```bash
   ssh azureuser@20.63.24.187
   sudo ss -tlnp | grep 50051
   ps aux | grep "python.*main.py" | grep -v grep
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ gRPC:**
   ```bash
   sudo journalctl -u voice-assistant.service -n 200 --no-pager | grep -iE "grpc|StreamAudio|ERROR"
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è gRPC:**
   ```bash
   sudo cat /etc/nginx/sites-enabled/* | grep -A 10 "location /"
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: grpc_pass grpc://127.0.0.1:50051;
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Nginx:**
   ```bash
   sudo tail -50 /var/log/nginx/error.log
   sudo tail -50 /var/log/nginx/grpc-error.log 2>/dev/null || echo "–õ–æ–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω"
   ```

5. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:**
   ```bash
   sudo systemctl restart voice-assistant.service
   sudo systemctl restart nginx
   ```

---

#### **3. –û—à–∏–±–∫–∏ backpressure (RESOURCE_EXHAUSTED)**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –æ—à–∏–±–∫—É `RESOURCE_EXHAUSTED`
- –í –ª–æ–≥–∞—Ö: `error_type=stream_limit_exceeded` –∏–ª–∏ `rate_limit_exceeded`

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç SSH)
ssh azureuser@20.63.24.187
sudo journalctl -u voice-assistant.service -n 500 --no-pager | grep -E "active_streams|stream_limit|backpressure" | tail -20
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ backpressure:**
   - `max_concurrent_streams`: 50 (prod)
   - `idle_timeout_seconds`: 900 (15 –º–∏–Ω—É—Ç)
   - `max_message_rate_per_second`: 0 (–æ—Ç–∫–ª—é—á–µ–Ω–æ)

2. **–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã):**
   ```bash
   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å config.env
   ssh azureuser@20.63.24.187
   cd /home/azureuser/voice-assistant/server
   nano config.env
   # –ò–∑–º–µ–Ω–∏—Ç—å: BACKPRESSURE_MAX_STREAMS=100 (–≤—Ä–µ–º–µ–Ω–Ω–æ)
   sudo systemctl restart voice-assistant.service
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ—Ç –ª–∏ "–º–æ–ª—á–∞–ª–∏–≤—ã—Ö" —Å—Ç—Ä–∏–º–æ–≤:**
   ```bash
   sudo journalctl -u voice-assistant.service -n 1000 --no-pager | grep -E "stream_idle_timeout|idle_time" | tail -20
   ```

---

#### **4. –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö (ERROR, Exception, Failed)**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–∏: `ERROR`, `Exception`, `Failed`, `Traceback`
- –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö (—Ç—Ä–µ–±—É–µ—Ç SSH)
ssh azureuser@20.63.24.187
sudo journalctl -u voice-assistant.service -n 500 --no-pager | grep -iE "ERROR|Exception|Failed|Traceback" | tail -30
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. **–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤:**
   ```bash
   # –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –ø–æ scope
   sudo journalctl -u voice-assistant.service -n 1000 --no-pager | grep "decision=error" | tail -20
   
   # –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –ø–æ –º–µ—Ç–æ–¥—É
   sudo journalctl -u voice-assistant.service -n 1000 --no-pager | grep "method=StreamAudio.*decision=error" | tail -20
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–æ–∫:**
   - –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç `ctx={...}` —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `error_type`, `error_code`, `error_classified`

3. **–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:**
   - **`GEMINI_API_KEY` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `config.env`
   - **–¢–∞–π–º–∞—É—Ç LLM:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `text_processing.request_timeout`
   - **–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
   - **–û—à–∏–±–∫–∞ TTS:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Edge TTS –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

---

#### **5. –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–ª–∏ –ø–∞–¥–∞–µ—Ç**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–µ—Ä–≤–∏—Å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –í –ª–æ–≥–∞—Ö: `Started voice-assistant.service` ‚Üí `Stopped voice-assistant.service`

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç SSH)
ssh azureuser@20.63.24.187
sudo journalctl -u voice-assistant.service --since "1 hour ago" --no-pager | grep -E "Started|Stopped|active|inactive"
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –ø–∞–¥–µ–Ω–∏—è:**
   ```bash
   sudo journalctl -u voice-assistant.service -n 200 --no-pager | grep -A 10 -B 10 "ERROR\|Exception\|Traceback\|Failed"
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:**
   ```bash
   # –ü–∞–º—è—Ç—å
   free -h
   
   # CPU
   top -bn1 | head -20
   
   # –î–∏—Å–∫
   df -h
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   cd /home/azureuser/voice-assistant/server
   python -c "from config.unified_config import get_config; get_config()" 2>&1
   ```

---

#### **6. –ü—Ä–æ–±–ª–µ–º—ã —Å –≤–µ—Ä—Å–∏–µ–π**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í–µ—Ä—Å–∏—è –≤ `/health` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–∂–∏–¥–∞–µ–º–æ–π
- –í–µ—Ä—Å–∏—è –≤ `/status` –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `/health`

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π
curl -sk https://20.63.24.187/health | jq .latest_version
curl -sk https://20.63.24.187/status | jq .latest_version
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å VERSION —Ñ–∞–π–ª (—Ç—Ä–µ–±—É–µ—Ç SSH):**
   ```bash
   ssh azureuser@20.63.24.187
   cat /home/azureuser/voice-assistant/VERSION
   ```

2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é:**
   ```bash
   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
   cd /home/azureuser/voice-assistant
   # –û–±–Ω–æ–≤–∏—Ç—å VERSION —Ñ–∞–π–ª
   sudo systemctl restart voice-assistant.service
   ```

---

### **–≠—Å–∫–∞–ª–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º**

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:**

1. **–°–æ–±—Ä–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:**
   ```bash
   # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
   bash server/scripts/diagnose_remote_server.sh 20.63.24.187 azureuser > diagnostics_$(date +%Y%m%d_%H%M%S).log
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
   - `Docs/PERFORMANCE_BOTTLENECK_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - `Docs/EMPTY_RESPONSE_DIAGNOSIS.md` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—É—Å—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
   - `Docs/CLIENT_GRPC_DIAGNOSTIC_CHECKLIST.md` - —á–µ–∫–ª–∏—Å—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ gRPC
   - `server/Docs/BACKPRESSURE_README.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ backpressure

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**
   - P95 latency –≤ –ª–æ–≥–∞—Ö
   - Error rate –≤ –ª–æ–≥–∞—Ö
   - Decision rate –≤ –ª–æ–≥–∞—Ö

4. **–°–≤—è–∑–∞—Ç—å—Å—è —Å –∫–æ–º–∞–Ω–¥–æ–π:**
   - –ü—Ä–∏–ª–æ–∂–∏—Ç—å –ª–æ–≥–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
   - –£–∫–∞–∑–∞—Ç—å –≤—Ä–µ–º—è –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã
   - –û–ø–∏—Å–∞—Ç—å —Å–∏–º–ø—Ç–æ–º—ã –∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

---

### **–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**

**–ë–µ–∑ SSH (–ª–æ–∫–∞–ª—å–Ω–æ):**
```bash
# Health checks
curl -sk https://20.63.24.187/health
curl -sk https://20.63.24.187/status
curl -sk https://20.63.24.187/updates/health

# gRPC —Ç–µ—Å—Ç—ã
python scripts/grpc_smoke.py 20.63.24.187 443
python scripts/check_grpc_health.py 20.63.24.187 443
```

**–° SSH (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ):**
```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl status voice-assistant.service

# –õ–æ–≥–∏
sudo journalctl -u voice-assistant.service -n 100 --no-pager
sudo journalctl -u voice-assistant.service --since "1 hour ago" --no-pager

# –ü—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep "python.*main.py" | grep -v grep

# –ü–æ—Ä—Ç—ã
sudo ss -tlnp | grep -E "50051|8080|8081"

# Nginx
sudo systemctl status nginx
sudo nginx -t
sudo tail -50 /var/log/nginx/error.log
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 11 —è–Ω–≤–∞—Ä—è 2026
