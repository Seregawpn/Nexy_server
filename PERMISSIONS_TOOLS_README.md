# ๐ Nexy Permissions Tools

ะะฐะฑะพั ะธะฝััััะผะตะฝัะพะฒ ะดะปั ะดะธะฐะณะฝะพััะธะบะธ ะธ ะธัะฟัะฐะฒะปะตะฝะธั ะฟัะพะฑะปะตะผ ั ัะฐะทัะตัะตะฝะธัะผะธ macOS.

---

## ๐ ะัััััะน ััะฐัั

### ะัะปะธ ะฟัะธะปะพะถะตะฝะธะต ะฝะต ัะฐะฑะพัะฐะตั:

```bash
./health_check.sh
```

ะะพะบะฐะถะตั ััะพ ะฝะต ัะฐะบ ะธ ััะพ ะดะตะปะฐัั.

### ะะฒัะพะผะฐัะธัะตัะบะพะต ะธัะฟัะฐะฒะปะตะฝะธะต:

```bash
./fix_tcc_cache.sh
```

ะะฝัะตัะฐะบัะธะฒะฝัะน ัะบัะธะฟั ะธัะฟัะฐะฒะธั ะฟัะพะฑะปะตะผั ะทะฐ 2 ะผะธะฝััั.

---

## ๐ฆ ะกะพััะฐะฒ

### ๐ ะะธะฐะณะฝะพััะธะบะฐ

| ะกะบัะธะฟั | ะะฟะธัะฐะฝะธะต | ะัะตะผั |
|--------|----------|-------|
| `health_check.sh` | ะะพะผะฟะปะตะบัะฝะฐั ะฟัะพะฒะตัะบะฐ ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ | 30 ัะตะบ |
| `check_permissions.sh` | ะััััะฐั ะฟัะพะฒะตัะบะฐ ัะฐะทัะตัะตะฝะธะน TCC | 10 ัะตะบ |
| `check_bundle_mismatch.sh` | ะะพะธัะบ ะฝะตัะพะพัะฒะตัััะฒะธะน Bundle ID | 1 ะผะธะฝ |
| `diagnose_permissions.sh` | ะะพะปะฝะฐั ะดะธะฐะณะฝะพััะธะบะฐ ั ัะตะบะพะผะตะฝะดะฐัะธัะผะธ | 1 ะผะธะฝ |

### ๐๏ธ ะัะฟัะฐะฒะปะตะฝะธะต

| ะกะบัะธะฟั | ะะฟะธัะฐะฝะธะต | ะัะตะผั |
|--------|----------|-------|
| `fix_tcc_cache.sh` | ะะฒัะพะผะฐัะธัะตัะบะพะต ะธัะฟัะฐะฒะปะตะฝะธะต (ะธะฝัะตัะฐะบัะธะฒะฝะพ) | 2 ะผะธะฝ |
| `test_installed_app.sh` | ะะพะปะฝัะน ัะตัั ั ะฟะตัะตะทะฐะณััะทะบะพะน ะฟัะธะปะพะถะตะฝะธั | 1 ะผะธะฝ |
| `watch_logs.sh` | ะะพะฝะธัะพัะธะฝะณ ะปะพะณะพะฒ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ | ะฟะพััะพัะฝะฝะพ |

### ๐ ะะพะบัะผะตะฝัะฐัะธั

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต | ะัะดะธัะพัะธั |
|------|----------|-----------|
| `QUICK_PERMISSIONS_CHECK.md` | ะัะฐัะบะฐั ัะฟัะฐะฒะบะฐ | ะะพะปัะทะพะฒะฐัะตะปะธ |
| `SUPPORT_PLAYBOOK.md` | ะัะบะพะฒะพะดััะฒะพ ั ัะธะฟะพะฒัะผะธ ััะตะฝะฐัะธัะผะธ | ะกะปัะถะฑะฐ ะฟะพะดะดะตัะถะบะธ |
| `postinstall_healthcheck.sh` | ะกะบัะธะฟั ะดะปั ะธะฝัะตะณัะฐัะธะธ ะฒ PKG | ะะฐะทัะฐะฑะพััะธะบะธ |

---

## ๐ ะขะธะฟะพะฒัะต ััะตะฝะฐัะธะธ

### ะกัะตะฝะฐัะธะน 1: ะะตัะฒะฐั ัััะฐะฝะพะฒะบะฐ

```bash
# ะะพัะปะต ัััะฐะฝะพะฒะบะธ PKG
./health_check.sh

# ะัะปะธ ัะฐะทัะตัะตะฝะธะน ะฝะตั
./fix_tcc_cache.sh
# ะกะปะตะดัะนัะต ะธะฝััััะบัะธัะผ
```

### ะกัะตะฝะฐัะธะน 2: ะะฐะปะพัะบะธ ะตััั, ะฝะพ ะฝะต ัะฐะฑะพัะฐะตั

```bash
# ะัะพะฒะตัััะต ะฝะตัะพะพัะฒะตัััะฒะธะต
./check_bundle_mismatch.sh

# ะัะฟัะฐะฒััะต ะฐะฒัะพะผะฐัะธัะตัะบะธ
./fix_tcc_cache.sh
```

### ะกัะตะฝะฐัะธะน 3: ะะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั

```bash
# ะะพะปะฝะฐั ะดะธะฐะณะฝะพััะธะบะฐ
./diagnose_permissions.sh

# ะัะปะธ ะฝัะถะฝะพ - ัะฑัะพั ะธ ะฟะพะฒัะพัะฝัะน ะทะฐะฟัะพั
pkill -9 Nexy
sudo killall -9 tccd
sudo tccutil reset All com.nexy.assistant
open /Applications/Nexy.app
```

### ะกัะตะฝะฐัะธะน 4: ะะพะฝะธัะพัะธะฝะณ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ

```bash
# ะขะตัะผะธะฝะฐะป 1: ะปะพะณะธ
./watch_logs.sh

# ะขะตัะผะธะฝะฐะป 2: ัะตััะธัะพะฒะฐะฝะธะต
open /Applications/Nexy.app
# ะะฐะถะผะธัะต ะะะะะะ ะธ ะณะพะฒะพัะธัะต
```

---

## ๐ฏ ะะฝัะตะณัะฐัะธั ะฒ ัะตะปะธะทั

### 1. ะะพัััััะฐะฝะพะฒะพัะฝัะน ัะบัะธะฟั

ะะพะฑะฐะฒััะต ะฒ `build_final.sh`:

```bash
# ะกะพะทะดะฐัั ะดะธัะตะบัะพัะธั ะดะปั ัะบัะธะฟัะพะฒ
mkdir -p packaging/scripts

# ะกะบะพะฟะธัะพะฒะฐัั postinstall
cp postinstall_healthcheck.sh packaging/scripts/postinstall
chmod +x packaging/scripts/postinstall

# ะะพะฑะฐะฒะธัั ะฒ pkgbuild
pkgbuild ... \
  --scripts packaging/scripts/ \
  ...
```

### 2. ะัััะพะตะฝะฝะฐั ะฟัะพะฒะตัะบะฐ ะฒ ะฟัะธะปะพะถะตะฝะธะต

ะ `permissions_integration.py` ะดะพะฑะฐะฒััะต self-check:

```python
def check_permissions_on_startup(self):
    """ะัะพะฒะตัะบะฐ ัะฐะทัะตัะตะฝะธะน ะฟัะธ ััะฐััะต"""
    missing = []
    
    if not self._check_microphone():
        missing.append("Microphone")
    
    if not self._check_accessibility():
        missing.append("Accessibility")
    
    if missing:
        self._show_permissions_dialog(missing)
```

### 3. ะขะตะปะตะผะตััะธั

ะกะพะฑะธัะฐะนัะต ะฐะฝะพะฝะธะผะฝัั ััะฐัะธััะธะบั:

```python
analytics.track("permissions_check", {
    "granted": ["microphone", "accessibility"],
    "missing": ["input_monitoring"],
    "auto_fixed": True,
    "macos_version": "14.0"
})
```

---

## ๐ง ะะปั ัะฐะทัะฐะฑะพััะธะบะพะฒ

### ะะพะบะฐะปัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต

```bash
# ะกะฑัะพั ัะฐะทัะตัะตะฝะธะน
sudo tccutil reset All com.nexy.assistant

# ะะตัะตัะฑะพัะบะฐ ะธ ะฟะตัะตัััะฐะฝะพะฒะบะฐ
./packaging/build_final.sh
sudo installer -pkg dist/Nexy.pkg -target /

# Health check
./health_check.sh

# ะะพะฝะธัะพัะธะฝะณ
./watch_logs.sh
```

### ะกะฑะพั ะดะธะฐะณะฝะพััะธัะตัะบะพะน ะธะฝัะพัะผะฐัะธะธ

```bash
# ะะปั ะพัะฟัะฐะฒะบะธ ะฒ ะฑะฐะณ-ัะตะฟะพัั
./diagnose_permissions.sh > diagnostic_report.txt
tar -czf nexy_logs.tar.gz ~/Library/Application\ Support/Nexy/logs/
log show --predicate 'processImagePath contains "Nexy"' --last 1h > system_logs.txt
```

---

## ๐ ะะพะฝะธะผะฐะฝะธะต ะฟัะพะฑะปะตะผั

### ะััะธัะตะบัััะฐ ัะฐะทัะตัะตะฝะธะน macOS

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  macOS TCC (Transparency, Consent, Control) โ
โ                                             โ
โ  ~/Library/Application Support/             โ
โ    com.apple.TCC/TCC.db (SQLite)           โ
โ                                             โ
โ  ะฅัะฐะฝะธั:                                    โ
โ  โข Bundle ID ะฟัะธะปะพะถะตะฝะธั                     โ
โ  โข ะขะธะฟ ัะฐะทัะตัะตะฝะธั (Microphone, etc.)        โ
โ  โข ะกัะฐััั (allowed: 0/1)                    โ
โ  โข Timestamp                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ                  โ
           โ                  โ
     ะะะะะะจะะะะะข          ะะะะะะะฏะะข
           โ                  โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ  Nexy.app                    โ
    โ  (com.nexy.assistant)        โ
    โ                              โ
    โ  permissions_integration.py  โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพัะตะผั ะฒะพะทะฝะธะบะฐะตั ะฟัะพะฑะปะตะผะฐ

1. **TCC ะบัั ะฝะต ะพะฑะฝะพะฒะธะปัั**
   - System Settings UI ะฟะพะบะฐะทัะฒะฐะตั ะพะดะฝะพ
   - TCC.db ัะพะดะตัะถะธั ะดััะณะพะต
   - ะะตัะตะฝะธะต: ะฟะตัะตะทะฐะฟััะบ `tccd`

2. **Bundle ID ะธะทะผะตะฝะธะปัั**
   - ะะตัะตะฟะพะดะฟะธัั ั ะดััะณะธะผ Team ID
   - ะะฐะทัะตัะตะฝะธั ะฟัะธะฒัะทะฐะฝั ะบ ััะฐัะพะผั ID
   - ะะตัะตะฝะธะต: ัะฑัะพั ะธ ะฟะพะฒัะพัะฝัะน ะทะฐะฟัะพั

3. **ะะฐะทัะตัะตะฝะธั ะดะปั ะดััะณะพะณะพ ะฟััะธ**
   - ะัะปะพ: `/Users/x/Downloads/Nexy.app`
   - ะกัะฐะปะพ: `/Applications/Nexy.app`
   - ะะตัะตะฝะธะต: ัะดะฐะปะธัั ััะฐัะพะต, ะทะฐะฟัะพัะธัั ะดะปั ะฝะพะฒะพะณะพ

### CoreAudio Error 35

```
ะะตั ัะฐะทัะตัะตะฝะธั Microphone
      โ
macOS ะฑะปะพะบะธััะตั ะดะพัััะฟ ะบ ะฐัะดะธะพ ััััะพะนััะฒั
      โ
CoreAudio API ะฒะพะทะฒัะฐัะฐะตั error 35
      โ
sounddevice.InputStream ะฝะต ััะฐัััะตั
      โ
ะะตั ะดะฐะฝะฝัั ะดะปั ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั
```

---

## ๐ก Best Practices

### ะะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

1. ะัะตะณะดะฐ ัััะฐะฝะฐะฒะปะธะฒะฐะนัะต ะธะท PKG (ะฝะต ะฟะตัะตัะฐัะบะธะฒะฐะนัะต ะธะท Downloads)
2. ะัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต ะฟะพะดัะฒะตัะดะธัะต ะะกะ ัะธััะตะผะฝัะต ะดะธะฐะปะพะณะธ
3. ะัะปะธ ะฟัะพะฑะปะตะผั - ะทะฐะฟัััะธัะต `./health_check.sh`

### ะะปั ะฟะพะดะดะตัะถะบะธ

1. ะะตัะฒัะน ะทะฐะฟัะพั - ะฟะพะฟัะพัะธัะต `./health_check.sh`
2. ะัะฟะพะปัะทัะนัะต `SUPPORT_PLAYBOOK.md` ะดะปั ัะธะฟะพะฒัั ััะตะฝะฐัะธะตะฒ
3. ะญัะบะฐะปะธััะนัะต ั ะฟะพะปะฝะพะน ะดะธะฐะณะฝะพััะธะบะพะน (`diagnose_permissions.sh`)

### ะะปั ัะฐะทัะฐะฑะพััะธะบะพะฒ

1. ะขะตััะธััะนัะต ะฝะฐ ัะธััะพะน ัะธััะตะผะต (ัะฑัะพัะตะฝะฝัะต ัะฐะทัะตัะตะฝะธั)
2. ะัะพะฒะตััะนัะต Bundle ID ะธ ะฟะพะดะฟะธัั ะฟะพัะปะต ะบะฐะถะดะพะน ัะฑะพัะบะธ
3. ะะพะฑะฐะฒะปัะนัะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒ ะบัะธัะธัะตัะบะธะต ะผะตััะฐ
4. ะกะพะฑะธัะฐะนัะต ัะตะปะตะผะตััะธั ะพ ะฟัะพะฑะปะตะผะฐั ั ัะฐะทัะตัะตะฝะธัะผะธ

---

## ๐ ะะพะปััะตะฝะธะต ะฟะพะผะพัะธ

### ะกะฐะผะพััะพััะตะปัะฝะพ

1. `./health_check.sh` - ััะพ ะฝะต ัะฐะบ
2. `./fix_tcc_cache.sh` - ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะธัะฟัะฐะฒะปะตะฝะธะต
3. `QUICK_PERMISSIONS_CHECK.md` - ะฟะพะดัะพะฑะฝัะต ะธะฝััััะบัะธะธ

### ะกะปัะถะฑะฐ ะฟะพะดะดะตัะถะบะธ

1. ะัะฟัะฐะฒััะต ะฒัะฒะพะด `./diagnose_permissions.sh`
2. ะัะธะปะพะถะธัะต ัะบัะธะฝัะพั System Settings โ Privacy
3. ะฃะบะฐะถะธัะต ะฒะตััะธั macOS ะธ Nexy

### ะะฐะทัะฐะฑะพัะบะฐ

1. ะกะพะทะดะฐะนัะต issue ะฝะฐ GitHub
2. ะัะธะปะพะถะธัะต:
   - `diagnostic_report.txt`
   - `nexy_logs.tar.gz`
   - `system_logs.txt`
   - ะจะฐะณะธ ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั

---

## ๐ FAQ

**Q: ะะพัะตะผั ัะฐะทัะตัะตะฝะธั ะฝะต ัะพััะฐะฝััััั ะฟะพัะปะต ะฟะตัะตะทะฐะณััะทะบะธ?**  
A: ะัะพะฒะตัััะต Bundle ID - ะฒะพะทะผะพะถะฝะพ, ะฟัะธะปะพะถะตะฝะธะต ะทะฐะฟััะบะฐะตััั ะธะท ะดััะณะพะณะพ ะผะตััะฐ.

**Q: ะะฐะปะพัะบะธ ััะพัั, ะฝะพ ะฟัะธะปะพะถะตะฝะธะต ะณะพะฒะพัะธั ััะพ ะฝะตั ัะฐะทัะตัะตะฝะธะน?**  
A: ะะฐะฟัััะธัะต `./fix_tcc_cache.sh` - ะฟัะพะฑะปะตะผะฐ ะฒ ะบััะต TCC daemon.

**Q: ะะพะถะฝะพ ะปะธ ะฒัะดะฐัั ัะฐะทัะตัะตะฝะธั ะฟัะพะณัะฐะผะผะฝะพ?**  
A: ะะตั, ัะพะปัะบะพ ะฟะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะฒัะดะฐัั ัะฐะทัะตัะตะฝะธั ัะตัะตะท System Settings ะธะปะธ ัะธััะตะผะฝัะต ะดะธะฐะปะพะณะธ.

**Q: ะะพัะตะผั ะฟะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั ะฝัะถะฝะพ ะฒัะดะฐะฒะฐัั ัะฐะทัะตัะตะฝะธั ะทะฐะฝะพะฒะพ?**  
A: ะัะปะธ ะธะทะผะตะฝะธะปัั Bundle ID ะธะปะธ Team ID ะฒ ะฟะพะดะฟะธัะธ, macOS ััะธัะฐะตั ััะพ ะดััะณะธะผ ะฟัะธะปะพะถะตะฝะธะตะผ.

---

## ๐ ะกััะปะบะธ

- [Apple TCC Documentation](https://developer.apple.com/documentation/bundleresources/entitlements)
- [macOS Security and Privacy Guide](https://support.apple.com/guide/mac-help/control-access-to-your-mac-mchl211c911f/mac)
- ะะฝัััะตะฝะฝะธะน Wiki: [ัััะปะบะฐ]

---

**ะะตััะธั:** 1.0  
**ะะฐัะฐ:** 2025-10-11  
**ะะฒัะพั:** Nexy Development Team

