# –û—Ç—á–µ—Ç –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–∏–Ω—Ü–∏–ø–∞–º

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-11-07  
**–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:** `Docs/CLIENT_PRINCIPLES.md` (client_principles.md)  
**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –°–º. `Docs/ARCHITECTURE_OVERVIEW.md`

---

## üìä –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

**–°—Ç–∞—Ç—É—Å:** ‚ùå **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï**

–î–æ–∫—É–º–µ–Ω—Ç `client_principles.md` –æ–ø–∏—Å—ã–≤–∞–µ—Ç **—É—Å—Ç–∞—Ä–µ–≤—à—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**, –∫–æ—Ç–æ—Ä–∞—è **–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç** —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞. –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –¥—Ä—É–≥—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É** –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã.

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

| –ê—Å–ø–µ–∫—Ç | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|---------------------|-------------------|--------|
| **–ö–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** | `client/app/` —Å –ø–æ–¥–ø–∞–ø–∫–∞–º–∏ | `client/integration/` + `client/modules/` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Core –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** | `app/core/` | `integration/core/` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** | `app/ui/` | `modules/tray_controller/` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **State management** | `app/state/` | `integration/core/state_manager.py` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Permissions** | `app/permissions/` | `modules/permissions/` + `integration/integrations/first_run_permissions_integration.py` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **gRPC –∫–ª–∏–µ–Ω—Ç** | `app/grpc_client/` | `modules/grpc_client/` + `integration/integrations/grpc_client_integration.py` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Audio** | `app/audio/` | `modules/voice_recognition/` + `modules/speech_playback/` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **System integrations** | `app/system/` | `modules/autostart_manager/` + `modules/updater/` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |

**–í—ã–≤–æ–¥:** –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ `client_principles.md` **–ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç–∞—Ä–µ–ª–∞** –∏ –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

---

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

| –ü—Ä–∏–Ω—Ü–∏–ø | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|---------|---------------------|-------------------|--------|
| **First Run** | `FirstRunController` | `FirstRunPermissionsIntegration` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **State Management** | `state/handlers/` | `ApplicationStateManager` + `ModeController` | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Event System** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `EventBus` (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–æ–±—ã—Ç–∏–π–Ω–∞—è —à–∏–Ω–∞) | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **Module Coordination** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `SimpleModuleCoordinator` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **Workflows** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `ListeningWorkflow`, `ProcessingWorkflow` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **Integration Layer** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `integration/integrations/*` (20 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π) | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **Module Layer** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `modules/*` (19 –º–æ–¥—É–ª–µ–π) | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **Gateways/Selectors** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `integration/core/gateways/`, `integration/core/selectors.py` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |

**–í—ã–≤–æ–¥:** –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ **–Ω–µ —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è** –≤ `client_principles.md`.

---

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ê—Å–ø–µ–∫—Ç | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|---------------------|-------------------|--------|
| **–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** | `client_config.yaml` | `config/unified_config.yaml` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **–ó–∞–≥—Ä—É–∑—á–∏–∫** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `UnifiedConfigLoader` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫** | `NSUserDefaults` | `unified_config.yaml` + —Ñ–ª–∞–≥–∏ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Interaction Matrix** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `config/interaction_matrix.yaml` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **State Catalog** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `Docs/STATE_CATALOG.md` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ `client_principles.md` **–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç** —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

---

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

| –ê—Å–ø–µ–∫—Ç | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|---------------------|-------------------|--------|
| **–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤** | `ts=<unix> level=<INFO\|WARN\|ERROR> scope=<ui\|audio\|grpc\|permissions>` | `YYYY-MM-DD HH:MM:SS - Nexy - LEVEL - [session_id] - Message` | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Decision logs** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `decision=<start\|abort\|retry\|degrade> ctx={...} source=<domain> duration_ms=<int>` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `module.start\|ok\|fail` —Å session_id, duration_ms | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** | `~/Library/Logs/NexyClient` | `tempfile.gettempdir()/nexy_debug.log` | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |

**–í—ã–≤–æ–¥:** –§–æ—Ä–º–∞—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `client_principles.md` **–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç** —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

---

### 5. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ –ø–æ—Ç–æ–∫–∏

| –ê—Å–ø–µ–∫—Ç | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|---------------------|-------------------|--------|
| **Async/await** | ‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –¥–ª—è gRPC | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | `MainActor` | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (macOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ) | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **–î–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** | `TaskQueue` —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º concurrency | EventBus + Workflows | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Sleep** | `Task.sleep` | `asyncio.sleep` | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |

**–í—ã–≤–æ–¥:** –ü–æ–¥—Ö–æ–¥ –∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ –¥–µ—Ç–∞–ª–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è.

---

### 6. –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

| –ê—Å–ø–µ–∫—Ç | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|---------------------|-------------------|--------|
| **–ú–∏–∫—Ä–æ—Ñ–æ–Ω** | `permissions/mic_handler.py` | `modules/permissions/macos/mic_permission.py` + `FirstRunPermissionsIntegration` | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **–≠–∫—Ä–∞–Ω** | `permissions/screen_handler.py` | `modules/permissions/macos/screen_permission.py` + `FirstRunPermissionsIntegration` | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Accessibility** | `permissions/accessibility_handler.py` | `modules/permissions/macos/accessibility_permission.py` + `FirstRunPermissionsIntegration` | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Permission Restart** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `PermissionRestartIntegration` + `modules/permission_restart/` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **First Run Flow** | `FirstRunController` —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏ | `FirstRunPermissionsIntegration` —Å —É–º–Ω—ã–º–∏ –ø–∞—É–∑–∞–º–∏ | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è.

---

### 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ Sparkle

| –ê—Å–ø–µ–∫—Ç | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|---------------------|-------------------|--------|
| **–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π** | Sparkle | `modules/updater/` (HTTP + DMG) | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **AppCast** | –ö–µ—à–∏—Ä—É–µ—Ç—Å—è 60 —Å | HTTP –º–∞–Ω–∏—Ñ–µ—Å—Ç | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Health check** | –ö–µ—à–∏—Ä—É–µ—Ç—Å—è 30 —Å | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Update Notifications** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `UpdateNotificationIntegration` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ `client_principles.md` **–ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç–∞—Ä–µ–ª–∞**.

---

### 8. gRPC –∫–ª–∏–µ–Ω—Ç

| –ê—Å–ø–µ–∫—Ç | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|---------------------|-------------------|--------|
| **Async/await** | ‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Reconnect** | ‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **Exponential backoff** | ‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** |
| **–ú–µ—Ç—Ä–∏–∫–∏** | –£–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Stream ID** | `stream_id`, `decision_id`, `context` | `session_id` | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |

**–í—ã–≤–æ–¥:** gRPC –∫–ª–∏–µ–Ω—Ç —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ –¥–µ—Ç–∞–ª–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è.

---

### 9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ CI

| –ê—Å–ø–µ–∫—Ç | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|---------------------|-------------------|--------|
| **Unit —Ç–µ—Å—Ç—ã** | pytest / Xcode tests | pytest (—Å–º. `integration/tests/`) | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Integration —Ç–µ—Å—Ç—ã** | –õ–æ–∫–∞–ª—å–Ω—ã–π mock-—Å–µ—Ä–≤–µ—Ä | –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (—Å–º. `integration/tests/`) | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **UI —Ç–µ—Å—Ç—ã** | XCTest / snapshot | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Smoke —Ç–µ—Å—Ç—ã** | `make smoke` | –°–∫—Ä–∏–ø—Ç—ã –≤ `scripts/` | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Performance —Ç–µ—Å—Ç—ã** | Instruments | –ú–µ—Ç—Ä–∏–∫–∏ –≤ –ª–æ–≥–∞—Ö | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Contract —Ç–µ—Å—Ç—ã** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | –¢–µ—Å—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ EventBus | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **Gateway —Ç–µ—Å—Ç—ã** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | –¢–µ—Å—Ç—ã gateways (pairwise + –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ) | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |

**–í—ã–≤–æ–¥:** –ü–æ–¥—Ö–æ–¥ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ –¥–µ—Ç–∞–ª–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è.

---

### 10. –ú–µ—Ç—Ä–∏–∫–∏ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

| –ê—Å–ø–µ–∫—Ç | client_principles.md | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|--------|---------------------|-------------------|--------|
| **UI latency (p95)** | ‚â§ 100 –º—Å | –ù–µ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Permission success rate** | ‚â• 99% | –ò–∑–º–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ decision logs | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Stream reconnect success** | ‚â• 95% | –ò–∑–º–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **App start time** | ‚â§ 1.5 —Å | –ù–µ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **CPU usage avg** | ‚â§ 20% | –ù–µ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** |
| **Decision logs** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |
| **State Catalog** | –ù–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è | `Docs/STATE_CATALOG.md` | ‚ùå **–ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø** |

**–í—ã–≤–æ–¥:** –ú–µ—Ç—Ä–∏–∫–∏ —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç, –Ω–æ –¥–µ—Ç–∞–ª–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è.

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–Ω–æ–≤–∏—Ç—å client_principles.md (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** –°—Ä–µ–¥–Ω–∏–π  
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 2-3 —á–∞—Å–∞  
**–†–∏—Å–∫–∏:** –ù–∏–∑–∫–∏–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ `Docs/ARCHITECTURE_OVERVIEW.md`
2. –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ EventBus, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π, –º–æ–¥—É–ª–µ–π, workflows
3. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
4. –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
5. –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ gateways/selectors
6. –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
7. –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ STATE_CATALOG –∏ interaction_matrix

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
- –ü–æ–º–æ—â—å –Ω–æ–≤—ã–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ä–µ–º—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- –ù—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–¥–∞–ª–∏—Ç—å client_principles.md

**–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** –ü—Ä–æ—Å—Ç–æ–π  
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 5 –º–∏–Ω—É—Ç  
**–†–∏—Å–∫–∏:** –°—Ä–µ–¥–Ω–∏–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –£–¥–∞–ª–∏—Ç—å `client_principles.md`
2. –û–±–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ `Docs/ARCHITECTURE_OVERVIEW.md`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- –ò–∑–±–µ–∂–∞–Ω–∏–µ –ø—É—Ç–∞–Ω–∏—Ü—ã

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ü–æ—Ç–µ—Ä—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –í–æ–∑–º–æ–∂–Ω–∞—è –ø—É—Ç–∞–Ω–∏—Ü–∞ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∏ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π

**–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** –ü—Ä–æ—Å—Ç–æ–π  
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 10 –º–∏–Ω—É—Ç  
**–†–∏—Å–∫–∏:** –ù–∏–∑–∫–∏–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `client_principles.md` ‚Üí `client_principles_LEGACY.md`
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
3. –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ `Docs/ARCHITECTURE_OVERVIEW.md`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ò–∑–±–µ–∂–∞–Ω–∏–µ –ø—É—Ç–∞–Ω–∏—Ü—ã
- –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –î–æ–∫—É–º–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ú–æ–∂–µ—Ç –≤–≤–æ–¥–∏—Ç—å –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è, —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏–∑ `client_principles.md` **—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç** —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. ‚úÖ **Single Flow of Authority** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `STATE_CATALOG.md` –∏ `ApplicationStateManager`
2. ‚úÖ **Reactive by Default** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ EventBus
3. ‚úÖ **Asynchronous UX** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ asyncio –∏ EventBus
4. ‚úÖ **Explicit Permission Control** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `modules/permissions/` –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
5. ‚úÖ **Error Transparency** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `ErrorHandler` –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
6. ‚úÖ **Graceful Degradation** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ gateways –∏ decision engine
7. ‚úÖ **UI Predictability** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `interaction_matrix.yaml`
8. ‚úÖ **Minimal Invasiveness** ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç (macOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
9. ‚úÖ **Instrumentation by Design** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ decision logs –∏ –º–µ—Ç—Ä–∏–∫–∏

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω **–í–∞—Ä–∏–∞–Ω—Ç 1** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞):

- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞" —Å–æ–≥–ª–∞—Å–Ω–æ `Docs/ARCHITECTURE_OVERVIEW.md`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ EventBus –∏ —Å–æ–±—ã—Ç–∏–π–Ω–æ–π –º–æ–¥–µ–ª–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –∏ –º–æ–¥—É–ª–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ workflows
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è" (unified_config.yaml)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ" (—Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ gateways/selectors
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–û–±–Ω–æ–≤–ª–µ–Ω–∏—è" (HTTP + DMG –≤–º–µ—Å—Ç–æ Sparkle)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ STATE_CATALOG –∏ interaction_matrix
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" (contract tests, gateway tests)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–ú–µ—Ç—Ä–∏–∫–∏" (decision logs)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å `Docs/ARCHITECTURE_OVERVIEW.md`

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** `Docs/ARCHITECTURE_OVERVIEW.md`
- **–ö–∞—Ç–∞–ª–æ–≥ —Å–æ—Å—Ç–æ—è–Ω–∏–π:** `Docs/STATE_CATALOG.md`
- **–ú–∞—Ç—Ä–∏—Ü–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π:** `config/interaction_matrix.yaml`
- **–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** `.cursorrules` (repo_specific_rule)

---

**–í—ã–≤–æ–¥:** –î–æ–∫—É–º–µ–Ω—Ç `client_principles.md` **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞—Ä–µ–ª** –∏ —Ç—Ä–µ–±—É–µ—Ç **–ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –∏–ª–∏ **—É–¥–∞–ª–µ–Ω–∏—è**. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è **–í–∞—Ä–∏–∞–Ω—Ç 1** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.


