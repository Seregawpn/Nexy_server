# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è pipeline —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

## –î–∞—Ç–∞: 2025-12-09

## –ü—Ä–æ–±–ª–µ–º—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ `_audio_buffer` –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –Ω–æ–≤—ã—Ö `voice.recording_stop` –±—É—Ñ–µ—Ä —Å–æ–¥–µ—Ä–∂–∞–ª —Ö–≤–æ—Å—Ç—ã –ø—Ä–æ—à–ª—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –í Google —É—Ö–æ–¥–∏–ª –¥–ª–∏–Ω–Ω—ã–π –∫—É—Å–æ–∫ (8.8s) —Å –±–æ–ª—å—à–∏–º –±–ª–æ–∫–æ–º —Ç–∏—à–∏–Ω—ã ‚Üí `UnknownValueError`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ batch-—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (—É—Å–ø–µ—à–Ω–æ–π –∏–ª–∏ –Ω–µ—Ç) - —Å—Ç—Ä–æ–∫–∞ 836
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ (—É—Å–ø–µ—à–Ω–æ–π –∏–ª–∏ –Ω–µ—Ç) - —Å—Ç—Ä–æ–∫–∞ 793
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ AVF –ø—É—Ç–∏ - —Å—Ç—Ä–æ–∫–∞ 861
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –ø—Ä–∏ `stop_input=None` - —Å—Ç—Ä–æ–∫–∞ 856
5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ legacy –ø—É—Ç–∏ - —Å—Ç—Ä–æ–∫–∞ 947
6. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –≤ –±–ª–æ–∫–µ `finally`** –º–µ—Ç–æ–¥–∞ `_on_recording_stop` - —Å—Ç—Ä–æ–∫–∞ 954

**–§–∞–π–ª—ã:**
- `integration/integrations/voice_recognition_integration.py` (—Å—Ç—Ä–æ–∫–∏ 793, 836, 856, 861, 947, 954)

---

### 2. ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `voice.recording_stop` –æ—Ç QuartzKeyboardMonitor

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `QuartzKeyboardMonitor` –ø—É–±–ª–∏–∫—É–µ—Ç `voice.recording_stop` –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥
- AVF –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ –ø–æ–ª—É—á–∞–µ—Ç `stop_input` –∏ –ª–æ–≥–∏—Ä—É–µ—Ç `[AVF] –ó–∞–ø–∏—Å—å –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞`
- –ë—É—Ñ–µ—Ä –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è "–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏" –¥–∞–Ω–Ω—ã–º–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_publish_recording_stop_with_debounce()` —Å debounce 50–º—Å
2. ‚úÖ –í—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ `voice.recording_stop` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –≤—ã–∑–æ–≤ —Å debounce:
   - SHORT_PRESS (—Å—Ç—Ä–æ–∫–∞ 1194)
   - RELEASE (—Å—Ç—Ä–æ–∫–∞ 1619)
   - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ (—Å—Ç—Ä–æ–∫–∞ 1068)

**–§–∞–π–ª—ã:**
- `integration/integrations/input_processing_integration.py` (—Å—Ç—Ä–æ–∫–∏ 104-107, 369-395, 1068, 1194, 1619)

---

### 3. ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∞—É–¥–∏–æ (np.max/np.min –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, —á—Ç–æ AVFAudioEngine –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –≥–æ–ª–æ—Å, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∑–≤—É–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞: `min`, `max`, `mean`, `std`
2. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å –≤ –∞—É–¥–∏–æ

**–§–∞–π–ª—ã:**
- `integration/integrations/voice_recognition_integration.py` (—Å—Ç—Ä–æ–∫–∏ 567-575)

---

### 4. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ SFSpeechRecognizer

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í –ª–æ–≥–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç SFSpeech ‚Üí —Å—Ç—Ä–∏–º–∏–Ω–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –ø–æ—á–µ–º—É —Å—Ç—Ä–∏–º–∏–Ω–≥ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è `SFSpeechRecognizerWrapper` (—Å—Ç—Ä–æ–∫–∞ 271)
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (—Å—Ç—Ä–æ–∫–∞ 273)
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ (—Å—Ç—Ä–æ–∫–∞ 523)

**–§–∞–π–ª—ã:**
- `integration/integrations/voice_recognition_integration.py` (—Å—Ç—Ä–æ–∫–∏ 271, 273, 523)

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. ‚úÖ **–ë—É—Ñ–µ—Ä –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏** ‚Äî –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ `üßπ [AVF] –ë—É—Ñ–µ—Ä –æ—á–∏—â–µ–Ω...`
2. ‚úÖ **–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è `voice.recording_stop`** ‚Äî –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ `üö´ [DEBOUNCE] –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–π...`
3. ‚úÖ **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è** ‚Äî –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ `üé§ [AVF] –ü–µ—Ä–≤—ã–π —á–∞–Ω–∫: size=..., min=..., max=...`
4. ‚úÖ **SFSpeechRecognizer –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä—É–µ—Ç—Å—è** ‚Äî –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ `‚úÖ [SFSpeech] –°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ...` –∏–ª–∏ `‚ö†Ô∏è [SFSpeech] –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ...`

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É `pyobjc-framework-Speech`**:
   ```bash
   pip3 install pyobjc-framework-Speech --break-system-packages
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**:
   - `config/unified_config.yaml` ‚Üí `speech_recognition.streaming.enabled: true`
   - `config/unified_config.yaml` ‚Üí `speech_recognition.streaming.on_device: true`

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è macOS**:
   - –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å ‚Üí –ú–∏–∫—Ä–æ—Ñ–æ–Ω ‚Üí Nexy –≤–∫–ª—é—á–µ–Ω
   - –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å ‚Üí –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ ‚Üí Nexy –≤–∫–ª—é—á–µ–Ω

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**:
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ `üßπ [AVF] –ë—É—Ñ–µ—Ä –æ—á–∏—â–µ–Ω...` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ `üö´ [DEBOUNCE] –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–π...` –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ `üé§ [AVF] –ü–µ—Ä–≤—ã–π —á–∞–Ω–∫: ...` –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –∑–∞–ø–∏—Å–∏
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ `‚úÖ [SFSpeech] –°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ...` –∏–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å**:
   - –ó–∞–∂–∞—Ç—å Ctrl+N
   - –ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Hello")
   - –û—Ç–ø—É—Å—Ç–∏—Ç—å Ctrl+N
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `voice.recognition_completed` –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å —Ç–µ–∫—Å—Ç–æ–º

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ï—Å–ª–∏ SFSpeechRecognizer –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É: `python3 -c "from Speech import SFSpeechRecognizer; print('OK')"`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è macOS (—Å–º. –≤—ã—à–µ)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞

2. **–ï—Å–ª–∏ –∞—É–¥–∏–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–∏—à–∏–Ω—É**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ macOS ‚Üí –ó–≤—É–∫ ‚Üí –í—Ö–æ–¥ ‚Üí –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Ñ–æ–Ω
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞: `min` –∏ `max` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–ª–∏–∑–∫–∏ –∫ 0, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ —Ç–∏—à–∏–Ω–∞
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞—É–¥–∏–æ –≤ —Ñ–∞–π–ª –∏ –ø—Ä–æ—Å–ª—É—à–∞—Ç—å (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `_recognize_avf_audio`)

3. **–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ `UnknownValueError`**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —è–∑—ã–∫ –≤ `unified_config.yaml` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —è–∑—ã–∫—É —Ä–µ—á–∏ (`en-US` –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞—É–¥–∏–æ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–∂–∞—Ç–∏—è)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±—É—Ñ–µ—Ä –æ—á–∏—â–∞–µ—Ç—Å—è (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ `üßπ [AVF] –ë—É—Ñ–µ—Ä –æ—á–∏—â–µ–Ω...`)

