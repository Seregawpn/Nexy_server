# –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ .app bundle

## –°–∏–º–ø—Ç–æ–º—ã

- ‚úÖ –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª (`python main.py`) - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ùå –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ `.app` bundle - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ~4 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "Entering exit handler" - —ç—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –Ω–µ –∫—Ä–∞—à
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "xpc_connection_cancel" - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∞–º–æ –æ—Ç–º–µ–Ω—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

1. **InstanceManager - –ª–æ–∂–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ `.app` –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ "–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ" –∏–∑-–∑–∞:
     - Lock-—Ñ–∞–π–ª –Ω–µ –±—ã–ª –æ—á–∏—â–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
     - PID –≤ lock-—Ñ–∞–π–ª–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º PID (–±—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
     - –ü—Ä–æ–≤–µ—Ä–∫–∞ PID –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è `.app` bundle

2. **–†–∞–∑–ª–∏—á–∏—è –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –º–µ–∂–¥—É —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º –∏ .app**
   - –†–∞–∑–Ω—ã–µ –ø—É—Ç–∏ –∫ lock-—Ñ–∞–π–ª—É
   - –†–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (–∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞, cmdline)
   - –†–∞–∑–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å NSApplication –∏–ª–∏ rumps**
   - `app.run()` –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è —Å—Ä–∞–∑—É –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏
   - NSApplication activation policy –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - Tray icon –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ PID –≤ InstanceManager

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ PID –≤ lock-—Ñ–∞–π–ª–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º PID, —ç—Ç–æ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞ —Ç–æ—Ç –∂–µ –ø—Ä–æ—Ü–µ—Å—Å.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ PID –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å–∞:

```python
# –ö–†–ò–¢–ò–ß–ù–û: –ï—Å–ª–∏ PID –≤ lock-—Ñ–∞–π–ª–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º PID - —ç—Ç–æ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
if pid == current_pid:
    return False  # –ù–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ - —ç—Ç–æ —Ç–æ—Ç –∂–µ –ø—Ä–æ—Ü–µ—Å—Å
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**InstanceManagerIntegration**:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏ –∫ lock-—Ñ–∞–π–ª—É
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ PID –∏ –∏–º–µ–Ω–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

**InstanceManager._is_lock_valid()**:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ PID
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ cmdline
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–æ–∫

**TrayController.run_app()**:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è NSApplication –ø–µ—Ä–µ–¥ `app.run()`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `app.run()`

**SimpleModuleCoordinator.run()**:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞ –≤ `finally` –±–ª–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ `coordinator.stop()`

### 3. –£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ `.app` –±—É–¥—É—Ç –≤–∏–¥–Ω—ã:
- –ü—É—Ç—å –∫ lock-—Ñ–∞–π–ª—É
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ lock-—Ñ–∞–π–ª–∞
- –¢–µ–∫—É—â–∏–π PID –∏ –∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞
- –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–æ—Å—Ç–æ—è–Ω–∏–µ NSApplication –ø–µ—Ä–µ–¥ `app.run()`
- –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `app.run()`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ .app** –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ –ª–æ–∂–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ `app.run()`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ—á–µ–º—É `app.run()` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

2. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ InstanceManager**:
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ lock-—Ñ–∞–π–ª –æ—á–∏—â–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ PID –¥–ª—è `.app` bundle
   - –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è `.app`

3. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ app.run()**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ rumps –∏–ª–∏ NSApplication
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ NSApplication activation policy —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ tray icon —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `integration/integrations/instance_manager_integration.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
2. `modules/instance_manager/core/instance_manager.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ PID
3. `modules/tray_controller/core/tray_controller.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `app.run()`
4. `integration/core/simple_module_coordinator.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `finally` –±–ª–æ–∫

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω—É–∂–Ω–æ:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `.app` bundle
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π `üîç DEBUG:`
3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≥–æ–≤

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `Docs/TRAY_TERMINATION_FIX.md` ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ `applicationShouldTerminate` / quit handler.
- `Docs/EXIT_HANDLER_ISSUE_ANALYSIS.md` ‚Äî –ø–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä TAL timeout –∏ Error‚ÄØ35.
- `Docs/TAL_TESTING_CHECKLIST.md` ‚Äî –µ–¥–∏–Ω—ã–π —Ç–µ—Å—Ç-–ø–ª–∞–Ω TAL/TCC –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–æ–≤.



