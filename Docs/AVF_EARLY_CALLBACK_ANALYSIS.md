# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã: Completion callback —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ

## üîç –ü—Ä–æ–±–ª–µ–º–∞ –∏–∑ –ª–æ–≥–æ–≤

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

1. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å** (—Å—Ç—Ä–æ–∫–∞ 147-154):
   - `‚úÖ [AVF] –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞—á–∞—Ç–æ: 506880 bytes, 48000Hz, 1ch, duration‚âà5.28s`
   - `‚úÖ [AVF] scheduleBuffer –≤—ã–∑–≤–∞–Ω —Å completion handler (Python —Ñ—É–Ω–∫—Ü–∏—è)`
   - `‚úÖ [AVF] Fallback —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ event loop (duration=5.78s)`

2. **Completion callback —Å—Ä–∞–±–æ—Ç–∞–ª –°–õ–ò–®–ö–û–ú –†–ê–ù–û** (—Å—Ç—Ä–æ–∫–∞ 245-246):
   - `‚úÖ [AVF] –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ (callback –æ—Ç AVAudioPlayerNode, samples_played=506880)`
   - **–í—Ä–µ–º—è**: —á–µ—Ä–µ–∑ **0.89 —Å–µ–∫—É–Ω–¥—ã** –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º—ã—Ö **5.28 —Å–µ–∫—É–Ω–¥**!
   - `samples_played=506880` (—Ä–∞–≤–Ω–æ `total_samples_in_buffer`)

3. **SpeechPlaybackIntegration –æ–±–Ω–∞—Ä—É–∂–∏–ª –ø—Ä–æ–±–ª–µ–º—É** (—Å—Ç—Ä–æ–∫–∞ 338):
   - `‚ö†Ô∏è [AVF] –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ —á–µ—Ä–µ–∑ 0.91s (–æ–∂–∏–¥–∞–ª–æ—Å—å 5.28s) - –≤–æ–∑–º–æ–∂–Ω–æ, –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è`

4. **Fallback —Ç–∞–π–º–µ—Ä —Ç–æ–∂–µ —Å—Ä–∞–±–æ—Ç–∞–ª** (—Å—Ç—Ä–æ–∫–∞ 380-402):
   - `‚úÖ [AVF] –°–æ–±—ã—Ç–∏–µ audio.playback.completed –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ fallback —Ç–∞–π–º–µ—Ä`
   - –ù–æ —ç—Ç–æ —É–∂–µ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ callback —Å—Ä–∞–±–æ—Ç–∞–ª

---

## üîß –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–∏—á–∏–Ω–∞: Callback –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ scheduleBuffer

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- Completion callback –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **0.89 —Å–µ–∫—É–Ω–¥—ã** –≤–º–µ—Å—Ç–æ **5.28 —Å–µ–∫—É–Ω–¥**
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ callback —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±—É—Ñ–µ—Ä–∞**, –∞ –Ω–µ –ø–æ—Å–ª–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- `samples_played=506880` —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ callback —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –≤—Å–µ —Å—ç–º–ø–ª—ã –ø—Ä–æ–∏–≥—Ä–∞–Ω—ã, –Ω–æ —ç—Ç–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:

1. **Python —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ Objective-C –±–ª–æ–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ**:
   - PyObjC –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `scheduleBuffer`, –∞ –Ω–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
   - –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ Python —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—ë—Ä–Ω—É—Ç–∞ –≤ Objective-C –±–ª–æ–∫

2. **–ë—É—Ñ–µ—Ä –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é**:
   - –í–æ–∑–º–æ–∂–Ω–æ, –±—É—Ñ–µ—Ä –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω, –Ω–æ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
   - –ò–ª–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Å–æ–±—ã—Ç–∏–µ–º

3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç samples_played**:
   - `_total_samples_in_buffer = buffer_frames * buffer_channels`
   - –ï—Å–ª–∏ `buffer_frames` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω, —Ç–æ –∏ `samples_played` –±—É–¥–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ fallback —Ç–∞–π–º–µ—Ä (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ)

**–ü–ª—é—Å—ã**:
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PyObjC –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

**–ú–∏–Ω—É—Å—ã**:
- –ù–µ—Ç–æ—á–Ω–æ—Å—Ç—å (—Ç–∞–π–º–µ—Ä –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π)
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π (callback + fallback)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Python —Ñ—É–Ω–∫—Ü–∏–∏ –≤ Objective-C –±–ª–æ–∫

**–¢—Ä–µ–±—É–µ—Ç—Å—è**:
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞ Python —Ñ—É–Ω–∫—Ü–∏–∏ –≤ Objective-C –±–ª–æ–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `objc.ObjCBlock` –∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä—ã

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NSNotification –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–¢—Ä–µ–±—É–µ—Ç—Å—è**:
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `AVAudioEngineConfigurationChangeNotification`
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è `AVAudioPlayerNode`

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ fallback —Ç–∞–π–º–µ—Ä –∏ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å callback
2. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Python —Ñ—É–Ω–∫—Ü–∏–∏ –≤ Objective-C –±–ª–æ–∫
3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NSNotification –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

---

## üîç –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ callback –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–∑–æ–≤–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ callback —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `scheduleBuffer`

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á—ë—Ç `_total_samples_in_buffer`**:
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `buffer_frames` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `buffer_channels` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç output format

3. **–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Å–æ–∑–¥–∞–Ω–∏—è Objective-C –±–ª–æ–∫–∞**:
   - –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `objc.ObjCBlock` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NSNotification –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
