# –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

## üîç –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

### –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è —Å–æ–±—ã—Ç–∏–π:

1. **18:22:33,937** - –ü–µ—Ä–≤—ã–π —á–∞–Ω–∫ –Ω–∞—á–∞–ª –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (248832 bytes, duration‚âà2.59s)
2. **18:22:36,529** - –ü–µ—Ä–≤—ã–π —á–∞–Ω–∫ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —á–µ—Ä–µ–∑ callback (duration=2.59s) ‚úÖ
3. **18:22:36,631** - –í—Ç–æ—Ä–æ–π —á–∞–Ω–∫ –Ω–∞—á–∞–ª –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (283392 bytes, duration‚âà2.95s)
4. **18:22:37,031** - Fallback —Ç–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª —á–µ—Ä–µ–∑ 3.09s (2.95s + 0.5s) ‚ö†Ô∏è
5. **18:22:38,660** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª Ctrl+N (–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ)

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

### Fallback —Ç–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª –î–û –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

**–°—Ç—Ä–æ–∫–∞ 384 –ª–æ–≥–æ–≤:**
```
2025-12-11 18:22:37,031 - modules.audio_avf.core.avf_audio_engine - WARNING - ‚ö†Ô∏è [AVF] –ö–†–ò–¢–ò–ß–ù–û: Playback completion callback –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª —á–µ—Ä–µ–∑ 3.09s, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º. –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö callback'–æ–≤: 0
```

**–ü—Ä–æ–±–ª–µ–º–∞**: Callback –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —á–∞–Ω–∫–∞, –ø–æ—ç—Ç–æ–º—É fallback —Ç–∞–π–º–µ—Ä –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3.09s.

**–í—Ä–µ–º—è**: Fallback —Ç–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª –≤ 18:22:37,031, –∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª Ctrl+N —Ç–æ–ª—å–∫–æ –≤ 18:22:38,660 (—á–µ—Ä–µ–∑ 1.6 —Å–µ–∫—É–Ω–¥—ã –ü–û–°–õ–ï –æ—Å—Ç–∞–Ω–æ–≤–∫–∏).

---

## üîç –ü—Ä–∏—á–∏–Ω—ã

### 1. Callback –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —á–∞–Ω–∫–∞

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- Callback –±—ã–ª –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –∏ –±—ã–ª –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω (–Ω–æ –≤ –ª–æ–≥–∞—Ö –Ω–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)
- Callback –≤–æ–æ–±—â–µ –Ω–µ –±—ã–ª –≤—ã–∑–≤–∞–Ω AVAudioPlayerNode
- –ü—Ä–æ–±–ª–µ–º–∞ —Å PyObjC –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —á–∞–Ω–∫–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –í –ª–æ–≥–∞—Ö –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è `‚ö†Ô∏è [AVF] Completion callback —Å—Ä–∞–±–æ—Ç–∞–ª –ü–†–ï–ñ–î–ï–í–†–ï–ú–ï–ù–ù–û` –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —á–∞–Ω–∫–∞, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ callback –≤–æ–æ–±—â–µ –Ω–µ –±—ã–ª –≤—ã–∑–≤–∞–Ω.

---

### 2. Fallback —Ç–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ

**–õ–æ–≥–∏–∫–∞ fallback —Ç–∞–π–º–µ—Ä–∞:**
```python
await asyncio.sleep(duration_sec + 0.5)  # 2.95s + 0.5s = 3.45s
```

**–ù–æ –≤ –ª–æ–≥–∞—Ö:**
```
‚úÖ [AVF] Fallback —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ event loop (duration=3.45s)
‚ö†Ô∏è [AVF] –ö–†–ò–¢–ò–ß–ù–û: Playback completion callback –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª —á–µ—Ä–µ–∑ 3.09s
```

**–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**: Fallback —Ç–∞–π–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ 3.45s, –Ω–æ —Å—Ä–∞–±–æ—Ç–∞–ª —á–µ—Ä–µ–∑ 3.09s.

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–≤—ã–π —á–∞–Ω–∫, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —á–µ—Ä–µ–∑ fallback —Ç–∞–π–º–µ—Ä, –∞ –Ω–µ –≤—Ç–æ—Ä–æ–π.

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### –ü–µ—Ä–≤—ã–π —á–∞–Ω–∫ (248832 bytes, 2.59s):
- **–ù–∞—á–∞–ª–æ**: 18:22:33,937
- **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: 18:22:36,529 (—á–µ—Ä–µ–∑ callback, duration=2.59s) ‚úÖ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω —á–µ—Ä–µ–∑ callback

### –í—Ç–æ—Ä–æ–π —á–∞–Ω–∫ (283392 bytes, 2.95s):
- **–ù–∞—á–∞–ª–æ**: 18:22:36,631
- **–û–∂–∏–¥–∞–µ–º–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: 18:22:39,581 (2.95s + 0.5s = 3.45s)
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: 18:22:37,031 (—á–µ—Ä–µ–∑ fallback —Ç–∞–π–º–µ—Ä, 3.09s) ‚ö†Ô∏è
- **–ü—Ä–æ–±–ª–µ–º–∞**: Fallback —Ç–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ (3.09s –≤–º–µ—Å—Ç–æ 3.45s)

---

## ‚ùå –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

### Fallback —Ç–∞–π–º–µ—Ä –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —á–∞–Ω–∫–∞

**–ì–∏–ø–æ—Ç–µ–∑–∞**: Fallback —Ç–∞–π–º–µ—Ä –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞ (3.09s) —Å—Ä–∞–±–æ—Ç–∞–ª –ü–û–°–õ–ï —Ç–æ–≥–æ, –∫–∞–∫ –ø–µ—Ä–≤—ã–π —á–∞–Ω–∫ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —á–µ—Ä–µ–∑ callback, –∏ —ç—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –≤—Ç–æ—Ä–æ–≥–æ —á–∞–Ω–∫–∞.

**–ü—Ä–æ–±–ª–µ–º–∞**: Fallback —Ç–∞–π–º–µ—Ä –Ω–µ –±—ã–ª –æ—Ç–º–µ–Ω—ë–Ω –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞ —á–µ—Ä–µ–∑ callback.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ fallback —Ç–∞–π–º–µ—Ä –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º callback

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞**: –í `playback_completion_handler_impl()` –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è `_cancel_fallback_timer()`.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥** (—Å—Ç—Ä–æ–∫–∞ 193):
```python
# ‚úÖ –ù–û–í–û–ï: –û—Ç–º–µ–Ω—è–µ–º fallback —Ç–∞–π–º–µ—Ä –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º completion
engine_instance._cancel_fallback_timer()
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –≠—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ, —á—Ç–æ fallback —Ç–∞–π–º–µ—Ä —É–∂–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —á–∞–Ω–∫–∞ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –ø–µ—Ä–≤—ã–π —á–∞–Ω–∫ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è.

---

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ fallback —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –¥–≤–∞ —á–∞–Ω–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, fallback —Ç–∞–π–º–µ—Ä –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞ –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ —á–∞–Ω–∫–∞.

**–†–µ—à–µ–Ω–∏–µ**: –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ fallback —Ç–∞–π–º–µ—Ä –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ callback, –Ω–æ –∏ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–û—Ç–º–µ–Ω—è—Ç—å fallback —Ç–∞–π–º–µ—Ä –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è**:
   - –í `play_audio()` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–æ–≤–æ–≥–æ fallback —Ç–∞–π–º–µ—Ä–∞ –æ—Ç–º–µ–Ω—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π

2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –≤ fallback —Ç–∞–π–º–µ—Ä–µ**:
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤—Å—ë –µ—â—ë –∞–∫—Ç–∏–≤–Ω–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—É—â–µ–º—É —á–∞–Ω–∫—É

3. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–æ–π —á–∞–Ω–∫ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (–ø–æ session_id –∏–ª–∏ chunk_id)
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –ª–∏ fallback —Ç–∞–π–º–µ—Ä –∏ –ø–æ—á–µ–º—É

---

## üìä –í—ã–≤–æ–¥

**–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –Ω–µ –∏–∑-–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Ctrl+N), –∞ –∏–∑-–∑–∞ fallback —Ç–∞–π–º–µ—Ä–∞ –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Å—Ä–∞–±–æ—Ç–∞–ª –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ —á–∞–Ω–∫–∞.**

**–†–µ—à–µ–Ω–∏–µ**: –ù—É–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ fallback —Ç–∞–π–º–µ—Ä –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ callback, –Ω–æ –∏ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.
