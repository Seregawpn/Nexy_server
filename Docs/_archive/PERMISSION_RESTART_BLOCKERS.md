# üö´ Permission Restart - –í—Å–µ —É—Å–ª–æ–≤–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**–í–µ—Ä—Å–∏—è**: 1.0
**–î–∞—Ç–∞**: 2025-10-30

---

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–í–°–ï —É—Å–ª–æ–≤–∏—è**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç **–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ—Ç–ª–æ–∂–∏—Ç—å** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.

---

## üõë –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É—Ä–æ–≤–Ω—è 1: –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑

–≠—Ç–∏ —É—Å–ª–æ–≤–∏—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä—É—é—Ç** –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ - –æ–Ω –ù–ï –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤–æ–æ–±—â–µ.

### 1. ‚ùå `enabled: false` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–§–∞–π–ª**: [unified_config.yaml:173](../config/unified_config.yaml#L173)
```yaml
permission_restart:
  enabled: false  # ‚Üê –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º
```

**–ö–æ–¥**: [restart_scheduler.py:69-71](../modules/permission_restart/core/restart_scheduler.py#L69-L71)
```python
if not self._config.enabled:
    logger.debug("[PERMISSION_RESTART] Scheduler disabled by configuration")
    return None  # ‚Üê –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –í–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏

---

### 2. üîÑ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–§–∞–π–ª**: [unified_config.yaml:182](../config/unified_config.yaml#L182)
```yaml
permission_restart:
  respect_updates: true  # ‚Üê –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
```

**–ö–æ–¥**: [restart_scheduler.py:75-80](../modules/permission_restart/core/restart_scheduler.py#L75-L80)
```python
if self._config.respect_updates and self._is_update_available():
    logger.info(
        "[PERMISSION_RESTART] Update available - skipping permission restart "
        "(permissions will be applied after update restart)"
    )
    return None  # ‚Üê –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
```

**–õ–æ–≥–∏–∫–∞**:
- UpdaterIntegration –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: `is_update_available()` ‚Üí True/False
- –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ ‚Üí –Ω–µ –¥–µ–ª–∞–µ–º permission restart
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∞–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ó–∞—á–µ–º**: –ò–∑–±–µ–∂–∞—Ç—å **–¥–≤–æ–π–Ω–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞**:
1. ‚ùå –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
2. ‚ùå –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
3. ‚úÖ –û–¥–∏–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º)

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å**:
```python
from integration.integrations.updater_integration import UpdaterIntegration
updater.is_update_available()  # True ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞
```

---

### 3. üî¢ –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

**–§–∞–π–ª**: [unified_config.yaml:180](../config/unified_config.yaml#L180)
```yaml
permission_restart:
  max_restart_attempts: 3  # ‚Üê –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏
```

**–ö–æ–¥**: [restart_scheduler.py:83-88](../modules/permission_restart/core/restart_scheduler.py#L83-L88)
```python
if self._attempts >= self._config.max_restart_attempts:
    logger.warning(
        "[PERMISSION_RESTART] Max restart attempts reached (%d), skipping",
        self._config.max_restart_attempts,
    )
    return None  # ‚Üê –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
```

**–õ–æ–≥–∏–∫–∞**:
- –°—á—ë—Ç—á–∏–∫ `_attempts` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3) ‚Üí –±–æ–ª—å—à–µ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤

**–ö–∞–∫ —Å–±—Ä–æ—Å–∏—Ç—å**:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é
- –°—á—ë—Ç—á–∏–∫ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ `shutdown()` (—Å—Ç—Ä–æ–∫–∞ 129)

---

## ‚è≥ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É—Ä–æ–≤–Ω—è 2: –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

–≠—Ç–∏ —É—Å–ª–æ–≤–∏—è **–Ω–µ –æ—Ç–º–µ–Ω—è—é—Ç** –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫, –Ω–æ **–æ—Ç–∫–ª–∞–¥—ã–≤–∞—é—Ç** –µ–≥–æ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π.

### 4. üì¶ –ò–¥—ë—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–§–∞–π–ª**: [unified_config.yaml:182](../config/unified_config.yaml#L182)
```yaml
permission_restart:
  respect_updates: true  # ‚Üê –ñ–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

**–ö–æ–¥**: [restart_scheduler.py:149-151](../modules/permission_restart/core/restart_scheduler.py#L149-L151)
```python
if self._config.respect_updates and self._is_update_in_progress():
    await asyncio.sleep(self._poll_interval)  # –ñ–¥—ë–º...
    continue  # ‚Üê –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—â—ë —Ä–∞–∑
```

**–õ–æ–≥–∏–∫–∞**:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –£–ñ–ï –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω (—Å—Ç—Ä–æ–∫–∞ 112)
- –ù–æ **–∂–¥—ë—Ç** –ø–æ–∫–∞ `is_update_in_progress()` —Å—Ç–∞–Ω–µ—Ç False
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ `_poll_interval` —Å–µ–∫—É–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2 —Å–µ–∫)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ: **10 –º–∏–Ω—É—Ç** (—Å—Ç—Ä–æ–∫–∞ 135)

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```python
updater.is_update_in_progress()  # True ‚Üí –æ–∂–∏–¥–∞–Ω–∏–µ, False ‚Üí –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å
```

---

### 5. üéôÔ∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ (–Ω–µ –≤ —Ä–µ–∂–∏–º–µ SLEEPING)

**–§–∞–π–ª**: [unified_config.yaml:181](../config/unified_config.yaml#L181)
```yaml
permission_restart:
  respect_active_sessions: true  # ‚Üê –ñ–¥–∞—Ç—å —Ä–µ–∂–∏–º–∞ SLEEPING
```

**–ö–æ–¥**: [restart_scheduler.py:153-155](../modules/permission_restart/core/restart_scheduler.py#L153-L155)
```python
if self._config.respect_active_sessions and not self._is_idle_mode():
    await asyncio.sleep(self._poll_interval)  # –ñ–¥—ë–º...
    continue  # ‚Üê –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—â—ë —Ä–∞–∑
```

**–ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏**: [restart_scheduler.py:233-238](../modules/permission_restart/core/restart_scheduler.py#L233-L238)
```python
def _is_idle_mode(self) -> bool:
    current_mode = self._state_manager.get_current_mode()
    return current_mode == AppMode.SLEEPING  # ‚Üê –¢–æ–ª—å–∫–æ SLEEPING = idle
```

**–õ–æ–≥–∏–∫–∞**:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω, –Ω–æ **–∂–¥—ë—Ç** –ø–æ–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–π–¥—ë—Ç –≤ —Ä–µ–∂–∏–º SLEEPING
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ `_poll_interval` —Å–µ–∫—É–Ω–¥
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ: **10 –º–∏–Ω—É—Ç**

**–†–µ–∂–∏–º—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:
- `AppMode.SLEEPING` ‚úÖ - –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å (idle)
- `AppMode.LISTENING` ‚ùå - –ñ–¥—ë–º (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å)
- `AppMode.PROCESSING` ‚ùå - –ñ–¥—ë–º (–∏–¥—ë—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞**:
```bash
# –í –ª–æ–≥–∞—Ö:
tail -f ~/Library/Logs/Nexy/nexy.log | grep "current_mode"
```

---

## ‚è±Ô∏è –¢–∞–π–º–∞—É—Ç—ã

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

**–ö–æ–¥**: [restart_scheduler.py:135-147](../modules/permission_restart/core/restart_scheduler.py#L135-L147)
```python
MAX_WAIT_SECONDS = 600.0  # 10 –º–∏–Ω—É—Ç

while True:
    elapsed = asyncio.get_event_loop().time() - start_ts
    if elapsed >= MAX_WAIT_SECONDS:
        logger.warning(
            "[PERMISSION_RESTART] Timeout waiting for safe restart conditions "
            "(waited %.1fs), continuing with restart",
            elapsed,
        )
        break  # ‚Üê –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ 10 –º–∏–Ω—É—Ç
```

**–õ–æ–≥–∏–∫–∞**:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ÔøΩÔøΩ–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω, –Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —É—Å–ª–æ–≤–∏—è–º–∏ (update in progress –ò–õ–ò active session)
- –ñ–¥—ë–º –¥–æ **10 –º–∏–Ω—É—Ç**
- –ü–æ—Å–ª–µ 10 –º–∏–Ω—É—Ç ‚Üí **–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —É—Å–ª–æ–≤–∏—è

---

## üîç –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

| # | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | –¢–∏–ø | –ö–æ–Ω—Ñ–∏–≥ | –ü–æ–≤–µ–¥–µ–Ω–∏–µ | –ü—Ä–æ–≤–µ—Ä–∫–∞ |
|---|-----------|-----|--------|-----------|----------|
| 1 | `enabled: false` | –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑ | `permission_restart.enabled` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ù–ï –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è | –õ–æ–≥–∏: "Scheduler disabled" |
| 2 | –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑ | `permission_restart.respect_updates` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ù–ï –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è | –õ–æ–≥–∏: "Update available - skipping" |
| 3 | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ | –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑ | `permission_restart.max_restart_attempts` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ù–ï –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è | –õ–æ–≥–∏: "Max restart attempts reached" |
| 4 | –ò–¥—ë—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | `permission_restart.respect_updates` | –ñ–¥—ë—Ç –¥–æ 10 –º–∏–Ω—É—Ç | `updater.is_update_in_progress()` |
| 5 | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ | –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | `permission_restart.respect_active_sessions` | –ñ–¥—ë—Ç –¥–æ 10 –º–∏–Ω—É—Ç | `current_mode != SLEEPING` |
| 6 | –¢–∞–π–º–∞—É—Ç 10 –º–∏–Ω—É—Ç | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | Hardcoded | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ | –õ–æ–≥–∏: "Timeout waiting" |

---

## üìä –î–∏–∞–≥—Ä–∞–º–º–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PermissionChangeDetector –æ–±–Ω–∞—Ä—É–∂–∏–ª      ‚îÇ
‚îÇ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RestartScheduler.maybe_schedule_restart()‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ enabled=false?  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ –î–∞ ‚Üí ‚ùå –û–¢–ö–ê–ó
                   ‚îÇ –ù–µ—Ç ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ respect_updates=true && ‚îÇ
         ‚îÇ is_update_available()?  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ –î–∞ ‚Üí ‚ùå –û–¢–ö–ê–ó (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ permission restart)
                   ‚îÇ –ù–µ—Ç ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ attempts >= max_attempts?‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ –î–∞ ‚Üí ‚ùå –û–¢–ö–ê–ó
                   ‚îÇ –ù–µ—Ç ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ ‚úÖ –ü–õ–ê–ù–ò–†–£–ï–ú –ü–ï–†–ï–ó–ê–ü–£–°–ö ‚îÇ
         ‚îÇ (delay=5 —Å–µ–∫)           ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ –ñ–¥—ë–º 5 —Å–µ–∫—É–Ω–¥ (delay)   ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ –¶–ò–ö–õ –û–ñ–ò–î–ê–ù–ò–Ø (–º–∞–∫—Å 10 –º–∏–Ω—É—Ç)  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ respect_updates=true &&          ‚îÇ
    ‚îÇ is_update_in_progress()?         ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ –î–∞ ‚Üí ‚è≥ –ñ–î–Å–ú (sleep 2—Å–µ–∫)
               ‚îÇ –ù–µ—Ç ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ respect_active_sessions=true &&  ‚îÇ
    ‚îÇ current_mode != SLEEPING?        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ –î–∞ ‚Üí ‚è≥ –ñ–î–Å–ú (sleep 2—Å–µ–∫)
               ‚îÇ –ù–µ—Ç ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ elapsed > 10 –º–∏–Ω—É—Ç?              ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ –î–∞ ‚Üí ‚ö†Ô∏è –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û
               ‚îÇ –ù–µ—Ç ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ ‚úÖ –í–´–ü–û–õ–ù–Ø–ï–ú –ü–ï–†–ï–ó–ê–ü–£–°–ö          ‚îÇ
    ‚îÇ (open -a Nexy.app && os._exit(0))‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
cat config/unified_config.yaml | grep -A 10 "permission_restart:"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```yaml
permission_restart:
  enabled: true                      # ‚úÖ
  respect_active_sessions: true      # –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∂–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  respect_updates: true              # –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  max_restart_attempts: 3
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```python
from integration.integrations.updater_integration import UpdaterIntegration

updater = ...  # –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Å—Ç–∞–Ω—Å
print(f"Update available: {updater.is_update_available()}")
print(f"Update in progress: {updater.is_update_in_progress()}")
```

–ï—Å–ª–∏ `is_update_available() == True` ‚Üí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ #2 –∞–∫—Ç–∏–≤–Ω–∞!

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∂–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
tail -f ~/Library/Logs/Nexy/nexy.log | grep "current_mode\|AppMode"
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `AppMode.LISTENING` –∏–ª–∏ `AppMode.PROCESSING` ‚Üí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ #5 –∞–∫—Ç–∏–≤–Ω–∞!

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫

–í –ª–æ–≥–∞—Ö –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:
```
[PERMISSION_RESTART] Restart attempt 1/3
[PERMISSION_RESTART] Restart attempt 2/3
[PERMISSION_RESTART] Restart attempt 3/3
[PERMISSION_RESTART] Max restart attempts reached (3), skipping  ‚Üê –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞!
```

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# –°–ª–µ–¥–∏—Ç—å –∑–∞ –≤—Å–µ–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
tail -f ~/Library/Logs/Nexy/nexy.log | grep -E "PERMISSION_RESTART|Update available|current_mode"
```

---

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

### –°–∏–º–ø—Ç–æ–º: "–Ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, –Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç"

**–ß–µ–∫-–ª–∏—Å—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**:

1. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç?**
   ```bash
   tail -f ~/Library/Logs/Nexy/nexy.log | grep "Permission monitoring"
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `Permission monitoring task started`

2. ‚úÖ **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ?**
   ```bash
   tail -f ~/Library/Logs/Nexy/nexy.log | grep "status changed"
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `Accessibility status changed: ... ‚Üí granted`

3. ‚úÖ **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω?**
   ```bash
   tail -f ~/Library/Logs/Nexy/nexy.log | grep "Scheduling application restart"
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `Scheduling application restart (delay=5.0s, ...)`

4. ‚ùå **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º?**
   ```bash
   tail -f ~/Library/Logs/Nexy/nexy.log | grep "Update available"
   ```
   –ï—Å–ª–∏ –µ—Å—Ç—å: `Update available - skipping permission restart` ‚Üí **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ #2!**

5. ‚ùå **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∂–∏–º–æ–º?**
   ```bash
   tail -f ~/Library/Logs/Nexy/nexy.log | grep "current_mode"
   ```
   –ï—Å–ª–∏ `AppMode.LISTENING/PROCESSING` ‚Üí **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ #5!**

6. ‚ùå **–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫?**
   ```bash
   tail -f ~/Library/Logs/Nexy/nexy.log | grep "Max restart attempts"
   ```
   –ï—Å–ª–∏ –µ—Å—Ç—å: `Max restart attempts reached` ‚Üí **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ #3!**

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```yaml
# config/unified_config.yaml (dev)
permission_restart:
  enabled: true
  restart_delay_sec: 1.0              # –ë—ã—Å—Ç—Ä–µ–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
  respect_active_sessions: false      # –ù–µ –∂–¥–∞—Ç—å SLEEPING
  respect_updates: true               # –í—Å—ë —Ä–∞–≤–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  max_restart_attempts: 999           # –ë–µ–∑ –ª–∏–º–∏—Ç–∞
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞:

```yaml
# config/unified_config.yaml (production)
permission_restart:
  enabled: true
  restart_delay_sec: 5.0              # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  respect_active_sessions: true       # –ù–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  respect_updates: true               # –ò–∑–±–µ–≥–∞—Ç—å –¥–≤–æ–π–Ω–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
  max_restart_attempts: 3             # –ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [PERMISSION_RESTART_LOGIC.md](./_archive/PERMISSION_RESTART_LOGIC.md) - –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
- [PERMISSION_MONITORING_FEATURE.md](./_archive/PERMISSION_MONITORING_FEATURE.md) - –ú–µ—Ö–∞–Ω–∏–∑–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [unified_config.yaml](../config/unified_config.yaml) - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
