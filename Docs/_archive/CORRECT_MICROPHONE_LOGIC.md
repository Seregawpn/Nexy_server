# ะัะฐะฒะธะปัะฝะฐั ะปะพะณะธะบะฐ ะฐะบัะธะฒะฐัะธะธ ะผะธะบัะพัะพะฝะฐ

## ๐ฏ ะัะฐะฒะธะปัะฝะฐั ััะตะผะฐ ัะฐะฑะพัั

### ะะฐะบ ะดะพะปะถะฝะพ ัะฐะฑะพัะฐัั:

1. **ะะบัะธะฒะฐัะธั ะผะธะบัะพัะพะฝะฐ (AVF ะฝะฐ ัะตะบัะฝะดั)**
   - AVF ะฐะบัะธะฒะธััะตั ะผะธะบัะพัะพะฝ ะฝะฐ ~1 ัะตะบัะฝะดั
   - ะะพะปััะฐะตั ะดะฐะฝะฝัะต (ัะพัะผะฐั, ััััะพะนััะฒะพ, ะดะธะฐะณะฝะพััะธะบะฐ)
   - ะะตะทะฐะบัะธะฒะธััะตั ะผะธะบัะพัะพะฝ โ

2. **ะะบัะธะฒะฐัะธั ะผะธะบัะพัะพะฝะฐ (Google ัะตัะตะท speech_recognition)**
   - ะะธะฑะปะธะพัะตะบะฐ speech_recognition ะฐะบัะธะฒะธััะตั ะผะธะบัะพัะพะฝ ัะตัะตะท `sr.Microphone()`
   - ะะฐะฟะธััะฒะฐะตั ัะตัั ะฟะพะปัะทะพะฒะฐัะตะปั
   - ะัะฟัะฐะฒะปัะตั ะฒ Google Speech API

---

## ๐ ะัะฐะฒะธะปัะฝะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั

### ะญัะฐะฟ 1: ะะฐัะฐะปะพ ะทะฐะฟะธัะธ (`voice.recording_start`)

```python
_on_recording_start(event)
    โ
1. ะัะพะฒะตัะบะฐ ะฑะปะพะบะธัะพะฒะพะบ
   โโ if _first_run_in_progress โ return
    โ
2. ะฃััะฐะฝะพะฒะบะฐ ัะตััะธะธ
   โโ _set_session_id(session_id)
   โโ _recording_active = True
    โ
3. โ ะะะขะะะะฆะะฏ AVF (ะฝะฐ ัะตะบัะฝะดั ะดะปั ะดะธะฐะณะฝะพััะธะบะธ)
   โโ AVFAudioEngine.start_input()
   โโ ะะฐะฟะธััะฒะฐะตั ~1 ัะตะบัะฝะดั
   โโ ะะพะปััะฐะตั: ัะพัะผะฐั, ััััะพะนััะฒะพ, ะดะธะฐะณะฝะพััะธะบั
   โโ AVFAudioEngine.stop_input() โ (ะดะตะทะฐะบัะธะฒะธััะตั)
    โ
4. โ ะะะขะะะะฆะะฏ GOOGLE (ัะตัะตะท speech_recognition)
   โโ ะกะพะทะดะฐัะผ sr.Microphone()
   โโ recognizer.adjust_for_ambient_noise() (ะพะฟัะธะพะฝะฐะปัะฝะพ)
   โโ recognizer.listen() โ ะทะฐะฟะธัั ัะตัะธ
```

---

### ะญัะฐะฟ 2: ะะฐะฟะธัั ัะตัะธ (Google)

```python
speech_recognition ะทะฐะฟะธััะฒะฐะตั ัะตัะตะท sr.Microphone()
    โ
ะะพะปัะทะพะฒะฐัะตะปั ะณะพะฒะพัะธั
    โ
ะัะดะธะพ ะทะฐะฟะธััะฒะฐะตััั ัะตัะตะท PyAudio (ะฒะฝัััะธ speech_recognition)
    โ
ะะฐะบะพะฟะปะตะฝะธะต ะดะฐะฝะฝัั
```

---

### ะญัะฐะฟ 3: ะััะฐะฝะพะฒะบะฐ ะทะฐะฟะธัะธ (`voice.recording_stop`)

```python
_on_recording_stop(event)
    โ
1. ะััะฐะฝะพะฒะบะฐ ะทะฐะฟะธัะธ Google
   โโ recognizer.stop() โ ะฟะพะปััะฐะตะผ ะฐัะดะธะพ ะดะฐะฝะฝัะต
    โ
2. ะะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต
   โโ ะกะพะทะดะฐัะผ sr.AudioData
   โโ recognizer.recognize_google(audio_data, language)
       โโ ะะธะฑะปะธะพัะตะบะฐ ะพัะฟัะฐะฒะปัะตั ะฒ Google Speech API
    โ
3. ะะตะทัะปััะฐั
   โโ ะัะฑะปะธะบัะตะผ voice.recognition_completed ะธะปะธ voice.recognition_failed
```

---

## ๐ ะัะฐะฒะธะปัะฝะฐั ััะตะผะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         ะะะะะะะฌะะะฏ ะะะะะะ ะะะขะะะะฆะะ ะะะะะะคะะะ            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. voice.recording_start
   โ
   โโโบ _on_recording_start()
       โโ ะัะพะฒะตัะบะฐ ะฑะปะพะบะธัะพะฒะพะบ
       โโ ะฃััะฐะฝะพะฒะบะฐ ัะตััะธะธ
       โ
       โโ โ ะะะขะะะะฆะะฏ AVF (ะฝะฐ ัะตะบัะฝะดั)
       โ   โโ AVFAudioEngine.start_input()
       โ   โโ ะะฐะฟะธััะฒะฐะตั ~1 ัะตะบัะฝะดั
       โ   โโ ะะพะปััะฐะตั: ัะพัะผะฐั, ััััะพะนััะฒะพ, ะดะธะฐะณะฝะพััะธะบั
       โ   โโ AVFAudioEngine.stop_input() โ (ะดะตะทะฐะบัะธะฒะธััะตั)
       โ
       โโ โ ะะะขะะะะฆะะฏ GOOGLE (ัะตัะตะท speech_recognition)
           โโ ะกะพะทะดะฐัะผ sr.Microphone()
           โโ recognizer.adjust_for_ambient_noise() (ะพะฟัะธะพะฝะฐะปัะฝะพ)
           โโ recognizer.listen() โ ะทะฐะฟะธัั ัะตัะธ

2. ะะฐะฟะธัั ัะตัะธ (Google)
   โ
   โโโบ speech_recognition ะทะฐะฟะธััะฒะฐะตั ัะตัะตะท sr.Microphone()
       โโ ะะพะปัะทะพะฒะฐัะตะปั ะณะพะฒะพัะธั โ ะฐัะดะธะพ ะทะฐะฟะธััะฒะฐะตััั

3. voice.recording_stop
   โ
   โโโบ _on_recording_stop()
       โโ recognizer.stop() โ ะฟะพะปััะฐะตะผ ะฐัะดะธะพ ะดะฐะฝะฝัะต
       โโ ะกะพะทะดะฐัะผ sr.AudioData
       โโ recognizer.recognize_google(audio_data, language)
       โ   โโ ะะธะฑะปะธะพัะตะบะฐ ะพัะฟัะฐะฒะปัะตั ะฒ Google Speech API
       โโ ะัะฑะปะธะบัะตะผ ัะตะทัะปััะฐั
```

---

## โ ะงัะพ ะฝัะถะฝะพ ะธัะฟัะฐะฒะธัั

### ะขะตะบััะฐั ะฝะตะฟัะฐะฒะธะปัะฝะฐั ะปะพะณะธะบะฐ:
- โ AVF ะทะฐะฟะธััะฒะฐะตั ะฒัั ะฒัะตะผั
- โ AVF ะฟะตัะตะดะฐัั ะดะฐะฝะฝัะต ัะตัะตะท ัะพะฑััะธะต
- โ SpeechRecognition ะฝะต ะฐะบัะธะฒะธััะตั ะผะธะบัะพัะพะฝ

### ะัะฐะฒะธะปัะฝะฐั ะปะพะณะธะบะฐ:
- โ AVF ะฐะบัะธะฒะธััะตั ะฝะฐ ัะตะบัะฝะดั (ะดะธะฐะณะฝะพััะธะบะฐ)
- โ AVF ะดะตะทะฐะบัะธะฒะธััะตั
- โ Google (speech_recognition) ะฐะบัะธะฒะธััะตั ะผะธะบัะพัะพะฝ
- โ Google ะทะฐะฟะธััะฒะฐะตั ัะตัั
- โ Google ะพัะฟัะฐะฒะปัะตั ะฒ API

---

## ๐ง ะงัะพ ะฝัะถะฝะพ ะธะทะผะตะฝะธัั ะฒ ะบะพะดะต

1. **ะ `_on_recording_start`:**
   - AVF ะฐะบัะธะฒะธััะตั ะฝะฐ ~1 ัะตะบัะฝะดั
   - ะะพะปััะฐะตั ะดะธะฐะณะฝะพััะธะบั
   - AVF ะดะตะทะฐะบัะธะฒะธััะตั
   - ะะฐัะตะผ ะฐะบัะธะฒะธััะตะผ Google ัะตัะตะท `sr.Microphone()`

2. **ะ `_on_recording_stop`:**
   - ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ Google ะทะฐะฟะธัั
   - ะะพะปััะฐะตะผ ะดะฐะฝะฝัะต ะพั Google
   - ะะฐัะฟะพะทะฝะฐัะผ ัะตัะตะท `recognize_google()`

3. **ะฃะฑัะฐัั:**
   - ะญััะฐัะตัั ัะตัะตะท `voice.mic_data_ready`
   - ะะฑัะฐะฑะพัะบั ะดะฐะฝะฝัั ะพั AVF ะดะปั ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั
   - ะะฐัะธัั ะพั ะดะฒะพะนะฝะพะน ะฐะบัะธะฒะฐัะธะธ (ัะตะฟะตัั ััะพ ะฝะพัะผะฐะปัะฝะพ)

---

## ๐ฏ ะัะพะณ

**ะัะฐะฒะธะปัะฝะฐั ะปะพะณะธะบะฐ:**
1. AVF ะฐะบัะธะฒะธััะตั ะฝะฐ ัะตะบัะฝะดั โ ะฟะพะปััะฐะตั ะดะธะฐะณะฝะพััะธะบั โ ะดะตะทะฐะบัะธะฒะธััะตั
2. Google ะฐะบัะธะฒะธััะตั โ ะทะฐะฟะธััะฒะฐะตั ัะตัั โ ัะฐัะฟะพะทะฝะฐัั

**ะะตะฟัะฐะฒะธะปัะฝะฐั ะปะพะณะธะบะฐ (ัะตะบััะฐั):**
1. AVF ะฐะบัะธะฒะธััะตั โ ะทะฐะฟะธััะฒะฐะตั ะฒัั โ ะฟะตัะตะดะฐัั ะดะฐะฝะฝัะต โ Google ัะฐัะฟะพะทะฝะฐัั

