# –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –æ—à–∏–±–∫–∏ –≤ –∞—É–¥–∏–æ —Å–∏—Å—Ç–µ–º–µ Nexy

**–î–∞—Ç–∞:** 2025-12-04  
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–ª–µ–º, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å—Ç–∞–ª–∫–∏–≤–∞–µ–º—Å—è

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–≤–ª–∏—è—é—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

### 1. –û—à–∏–±–∫–∏ PortAudio –Ω–∞ Bluetooth —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (-9986, -10851)

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–∫–∞–∂–¥–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)

**–û—à–∏–±–∫–∏:**
```
||PaMacCore (AUHAL)|| Error on line 1332: err='-10851', msg=Audio Unit: Invalid Property Value
Error opening OutputStream: Internal PortAudio error [PaErrorCode -9986]
‚ùå [OUTPUT] –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ—Ç–æ–∫ –ø–æ—Å–ª–µ 2 –ø–æ–ø—ã—Ç–æ–∫
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Ç–æ–∫–∞ –¥–ª—è BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (`blocksize=512`, `latency`)
- –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É PortAudio –∏ macOS (PortAudio –≤–∏–¥–∏—Ç –æ–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, macOS ‚Äî –¥—Ä—É–≥–æ–µ)
- BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º –Ω—É–∂–Ω–æ 2-3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é CoreAudio pipeline
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–Ω—è—Ç–æ —Å—Ç–∞—Ä—ã–º –ø–æ—Ç–æ–∫–æ–º

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (fallback –Ω–∞ `device=None`, –∫—ç—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π)
- ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê –û–°–¢–ê–ï–¢–°–Ø** ‚Äî –æ—à–∏–±–∫–∏ –≤—Å–µ –µ—â–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –Ω–∞ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ

**–í–ª–∏—è–Ω–∏–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AirPods/Bluetooth –Ω–∞—É—à–Ω–∏–∫–∏
- –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∏–Ω–∞–º–∏–∫–∏
- –ó–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

---

### 2. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–∞—É—à–Ω–∏–∫–∏/Bluetooth –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç (INPUT)

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ macOS)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ macOS (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ AirPods)
- Nexy –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Å–º–µ–Ω—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ polling (—Å–æ–±—ã—Ç–∏–µ `device.default_input_changed` –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è)
- –ù–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—á—å –Ω–∞ —Å—Ç–∞—Ä–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (MacBook Air Microphone)
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ: –ø–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω –Ω–∞ "MacBook Air Microphone" (device_id=3) –≤–º–µ—Å—Ç–æ AirPods

**–ü—Ä–∏—á–∏–Ω—ã:**
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û (2025-12-04)**: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ async (`asyncio.create_task()`)
- ‚ö†Ô∏è **–ù–û–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**: –°–æ–±—ã—Ç–∏–µ `device.default_input_changed` –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è, –Ω–æ `SpeechRecognizer` –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- –í–æ–∑–º–æ–∂–Ω–æ, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `VoiceRecognitionIntegration._on_input_device_changed()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í–æ–∑–º–æ–∂–Ω–æ, `SpeechRecognizer.on_device_changed()` –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å —É–∂–µ –∏–¥–µ—Ç

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (async)
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ (2025-12-04)
- ‚ö†Ô∏è **–ù–û–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê** ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ AirPods –¥–ª—è INPUT –¥–∞–∂–µ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –¥–æ—Ö–æ–¥–∏—Ç –ª–∏ —Å–æ–±—ã—Ç–∏–µ –¥–æ `VoiceRecognitionIntegration._on_input_device_changed()`
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `SpeechRecognizer.on_device_changed()` –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ª–∏ –æ–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

**–í–ª–∏—è–Ω–∏–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–¥–µ–≤–∞–µ—Ç AirPods, –Ω–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–ª—É—à–∞—Ç—å —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Ñ–æ–Ω
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AirPods –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ä–µ—á–∏
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

**–õ–æ–≥–∏:**
```
2025-12-04 21:49:58,171 - modules.audio_core.core_audio_device_manager - INFO - üì¢ [MANAGER] –ü—É–±–ª–∏–∫—É–µ–º —Å–æ–±—ã—Ç–∏–µ device.default_input_changed: "MacBook Air Microphone" ‚Üí "Sergiy's AirPods"
2025-12-04 21:50:31,444 - modules.voice_recognition.core.speech_recognizer - INFO - ‚úÖ –ü–æ—Ç–æ–∫ –∑–∞–ø—É—â–µ–Ω –∑–∞ 0.116s (–ø–æ–ø—ã—Ç–∫–∞ 1/7)
2025-12-04 21:50:31,520 - modules.voice_recognition.core.speech_recognizer - INFO - ‚úÖ –ê—É–¥–∏–æ –ø–æ—Ç–æ–∫ —Å—Ç–∞–±–∏–ª–µ–Ω: device=3 (MacBook Air Microphone), rate=48000.0Hz, channels=1
```
–í–∏–¥–Ω–æ, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ, –Ω–æ –ø–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω –Ω–∞ —Å—Ç–∞—Ä–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.

---

### 2.1 –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–∞—É—à–Ω–∏–∫–∏/Bluetooth –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç (OUTPUT)

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ macOS)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ macOS (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ AirPods)
- Nexy –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- –ò–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫–∏ -9986/-10851

**–ü—Ä–∏—á–∏–Ω—ã:**
- –û—à–∏–±–∫–∏ PortAudio –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Ç–æ–∫–∞ –Ω–∞ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∏–º–µ–Ω–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–∏–∑ SwitchAudioSource) –∏ PortAudio ID
- BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≥–æ—Ç–æ–≤–æ (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- –°—Ç–∞—Ä—ã–π –ø–æ—Ç–æ–∫ –Ω–µ –∑–∞–∫—Ä—ã—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- DeviceStateCache –ø—É—Å—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Ç–æ–∫–∞ (fallback –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç)

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç DeviceStateCache —Å retry –ª–æ–≥–∏–∫–æ–π, fallback –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç)
- ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê –û–°–¢–ê–ï–¢–°–Ø** ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ
- ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ

**–í–ª–∏—è–Ω–∏–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

### 3. RuntimeWarning: coroutine 'EventBus.publish' was never awaited

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏—è —Å–º–µ–Ω—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)

**–°–∏–º–ø—Ç–æ–º—ã:**
```
RuntimeWarning: coroutine 'EventBus.publish' was never awaited
  self._event_bus.publish(event_name, payload)
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- `CoreAudioDeviceManager.publish_device_change_event()` –≤—ã–∑—ã–≤–∞–ª `self._event_bus.publish()` –±–µ–∑ `await`
- `EventBus.publish()` - —ç—Ç–æ async –º–µ—Ç–æ–¥, –µ–≥–æ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ `asyncio.create_task()` –∏–ª–∏ `await`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û (2025-12-04)**: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ async (`asyncio.create_task()` –∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ)
- ‚úÖ –ú–µ—Ç–æ–¥ `publish_device_change_event()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—É–±–ª–∏–∫—É–µ—Ç async —Å–æ–±—ã—Ç–∏—è
- ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢ –ü–†–û–í–ï–†–ö–ò**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –¥–æ—Ö–æ–¥—è—Ç –¥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–í–ª–∏—è–Ω–∏–µ:**
- RuntimeWarning –≤ –ª–æ–≥–∞—Ö (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –∑–∞—Å–æ—Ä—è–µ—Ç –ª–æ–≥–∏)
- –í–æ–∑–º–æ–∂–Ω–æ, —Å–æ–±—ã—Ç–∏—è –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏)

---

### 4. Race condition –≤ InputProcessingIntegration

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –Ω–∞–∂–∞—Ç–∏–∏/–æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ –∫–ª–∞–≤–∏—à–∏)

**–°–∏–º–ø—Ç–æ–º—ã:**
```
‚ö†Ô∏è LONG_PRESS: –Ω–µ–ª—å–∑—è –Ω–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å - key_not_pressed
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- LONG_PRESS –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ RELEASE
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `key_pressed` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False` –∏–∑-–∑–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ù–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞–≤–∏—à–∏

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ö†Ô∏è **–ù–ï –ò–°–ü–†–ê–í–õ–ï–ù–û** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç "–∑–∞–≤–∏—Å–∞–Ω–∏–µ" –ø—Ä–∏ –∑–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏

**–í–ª–∏—è–Ω–∏–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
- –ù—É–∂–Ω–æ –æ—Ç–ø—É—Å—Ç–∏—Ç—å –∏ –Ω–∞–∂–∞—Ç—å –∫–ª–∞–≤–∏—à—É —Å–Ω–æ–≤–∞

---

## üü° –°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å)

### 5. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã SwitchAudioSource

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ `SwitchAudioSource` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ
- –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è (subprocess —Å timeout=1-5s)
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–ü—Ä–∏—á–∏–Ω—ã:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (CoreAudioDeviceManager –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫)
- ‚ö†Ô∏è SwitchAudioSource –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback
- ‚ö†Ô∏è –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤—Å–µ –µ—â–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç

**–í–ª–∏—è–Ω–∏–µ:**
- –ó–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ó–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

---

### 6. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ –ª–æ–≥–∏–∫–∏

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ)

**–î—É–±–ª–∏—Ä—É–µ—Ç—Å—è:**
- `_is_bluetooth_device()` ‚Äî –≤ 5 –º–µ—Å—Ç–∞—Ö:
  - `SequentialSpeechPlayer._is_bluetooth_device()`
  - `SpeechRecognizer._is_bluetooth_device()`
  - `CoreAudioDeviceManager._is_bluetooth_device()`
  - `DeviceParamsNormalizer.is_bluetooth_device()`
  - `DeviceChangePublisher._is_bluetooth_device()`

- `_is_builtin_device()` ‚Äî –≤ 3 –º–µ—Å—Ç–∞—Ö
- `_is_remote_device()` ‚Äî –≤ 2 –º–µ—Å—Ç–∞—Ö
- `_classify_*_device()` ‚Äî –≤ 2 –º–µ—Å—Ç–∞—Ö (INPUT –∏ OUTPUT)
- `_device_is_available()` ‚Äî –≤ 2 –º–µ—Å—Ç–∞—Ö (INPUT –∏ OUTPUT)
- `_select_default_*_device()` ‚Äî –≤ 2 –º–µ—Å—Ç–∞—Ö (INPUT –∏ OUTPUT)
- `_query_system_default_*()` ‚Äî –≤ 2 –º–µ—Å—Ç–∞—Ö (INPUT –∏ OUTPUT)

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ª–≥–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ª–æ–≥–∏–∫–∏
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∏ –±–µ–∑ –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ö†Ô∏è **–ù–ï –†–ï–®–ï–ù–û** ‚Äî –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–µ—Ç—Å—è
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –Ω–µ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö
- –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

**–í–ª–∏—è–Ω–∏–µ:**
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö)
- –†–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏
- –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (3284 —Å—Ç—Ä–æ–∫–∏ –≤ player.py)

---

### 7. –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤)

**–°–∏–º–ø—Ç–æ–º—ã:**
```
‚ö†Ô∏è [OUTPUT] –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ "Sergiy's AirPods" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ PortAudio –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫
‚úÖ [OUTPUT] Fallback –Ω–∞ SwitchAudioSource (device_id –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω)
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∏–º–µ–Ω–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–∏–∑ SwitchAudioSource) –∏ PortAudio ID
- BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –º–æ–≥—É—Ç –Ω–µ –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤ PortAudio —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (CoreAudioDeviceManager –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫)
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –≤—Å–µ –µ—â–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–í–ª–∏—è–Ω–∏–µ:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- Fallback –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –û—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Ç–æ–∫–æ–≤

---

### 8. –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ—Ç–æ–∫–æ–≤

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ß–ê–°–¢–û** (–ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤)

**–°–∏–º–ø—Ç–æ–º—ã:**
```
‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ç–æ–∫–∞ —á–µ—Ä–µ–∑ AudioStreamManager
‚ö†Ô∏è [OUTPUT] –û–±–Ω–∞—Ä—É–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ—Ç–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ, –∑–∞–∫—Ä—ã–≤–∞–µ–º...
‚ö†Ô∏è [OUTPUT] –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ—Ç–æ–∫: active=False, started=False
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü–æ—Ç–æ–∫ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
- Race conditions –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º)
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –≤—Å–µ –µ—â–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–í–ª–∏—è–Ω–∏–µ:**
- –û—à–∏–±–∫–∏ "—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∑–∞–Ω—è—Ç–æ"
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –ó–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

---

## üü¢ –ù–ò–ó–ö–û–ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã, –Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ UX)

### 9. –ó–∞–≤–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ò–ù–û–ì–î–ê** (–ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –Ω–∞–∂–∞—Ç–∏–∏/–æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∂–∏–º–∞–µ—Ç Ctrl+N, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- –í –ª–æ–≥–∞—Ö: "‚ö†Ô∏è LONG_PRESS: –Ω–µ–ª—å–∑—è –Ω–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å - key_not_pressed"

**–ü—Ä–∏—á–∏–Ω—ã:**
- Race condition –º–µ–∂–¥—É LONG_PRESS –∏ RELEASE
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –æ–∂–∏–¥–∞–Ω–∏—è

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –†–ï–®–ï–ù–û** ‚Äî —Ç–∞–π–º–∞—É—Ç—ã —É–º–µ–Ω—å—à–µ–Ω—ã, –Ω–æ race condition –æ—Å—Ç–∞–µ—Ç—Å—è

---

### 10. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ò–ù–û–ì–î–ê**

**–°–∏–º–ø—Ç–æ–º—ã:**
```
‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è: interrupt.request, –∏—Å–ø–æ–ª—å–∑—É–µ–º SESSION_CLEAR
‚ùå –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ session_clear –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ç–∏–ø—ã –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
- –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢ –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø**

---

### 11. Lazy start –ø–æ—Ç–æ–∫–∞ OUTPUT

**–ß–∞—Å—Ç–æ—Ç–∞:** ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–≤–ª–∏—è–µ—Ç –Ω–∞ –∑–∞–¥–µ—Ä–∂–∫—É –Ω–∞—á–∞–ª–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —á–∞–Ω–∫–µ (`add_audio_data()`)
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)
- –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞—á–∞–ª–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ö†Ô∏è **–ù–ï –†–ï–®–ï–ù–û** ‚Äî –ø–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —á–∞–Ω–∫–µ

**–í–ª–∏—è–Ω–∏–µ:**
- –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞—á–∞–ª–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)
- –ü–ª–æ—Ö–æ–π UX (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥–µ—Ç –Ω–∞—á–∞–ª–∞ –∑–≤—É–∫–∞)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü–æ —á–∞—Å—Ç–æ—Ç–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è:
1. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (INPUT)** ‚Äî ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ) ‚Äî **–ù–û–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**
2. **–û—à–∏–±–∫–∏ PortAudio (-9986, -10851)** ‚Äî ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–∫–∞–∂–¥–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT)
3. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (OUTPUT)** ‚Äî ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
4. **RuntimeWarning: coroutine 'EventBus.publish' was never awaited** ‚Äî ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏—è) ‚Äî **–ò–°–ü–†–ê–í–õ–ï–ù–û (2025-12-04)**
5. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** ‚Äî ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É)
6. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã SwitchAudioSource** ‚Äî ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ)
7. **Race condition** ‚Äî ‚ö†Ô∏è **–ß–ê–°–¢–û** (–ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –Ω–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏)
8. **–ü—Ä–æ–±–ª–µ–º—ã —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤** ‚Äî ‚ö†Ô∏è **–ß–ê–°–¢–û** (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è BT)
9. **–û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ—Ç–æ–∫–æ–≤** ‚Äî ‚ö†Ô∏è **–ß–ê–°–¢–û** (–ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
10. **Lazy start –ø–æ—Ç–æ–∫–∞** ‚Äî ‚ö†Ô∏è **–ü–û–°–¢–û–Ø–ù–ù–û** (–≤–ª–∏—è–µ—Ç –Ω–∞ –∑–∞–¥–µ—Ä–∂–∫—É)
11. **–ó–∞–≤–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏** ‚Äî ‚ö†Ô∏è **–ò–ù–û–ì–î–ê**
12. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏** ‚Äî ‚ö†Ô∏è **–ò–ù–û–ì–î–ê**

### –ü–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:
**üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É):**
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (INPUT) ‚Äî **–ù–û–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**
- –û—à–∏–±–∫–∏ PortAudio –Ω–∞ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–∞—É—à–Ω–∏–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (OUTPUT)
- Race condition –≤ InputProcessingIntegration

**üü° –°–†–ï–î–ù–ò–ï (–≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å):**
- RuntimeWarning: coroutine 'EventBus.publish' was never awaited ‚Äî **–ò–°–ü–†–ê–í–õ–ï–ù–û (2025-12-04)**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã SwitchAudioSource
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ—Ç–æ–∫–æ–≤

**üü¢ –ù–ò–ó–ö–ò–ï (–≤–ª–∏—è—é—Ç –Ω–∞ UX):**
- Lazy start –ø–æ—Ç–æ–∫–∞
- –ó–∞–≤–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–∫—Ä–∏—Ç–∏—á–Ω–æ ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É):
1. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (INPUT)** ‚Äî **–ù–û–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê** ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ AirPods –¥–∞–∂–µ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
2. **–û—à–∏–±–∫–∏ PortAudio –Ω–∞ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö** ‚Äî –Ω—É–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å BT
3. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–∞—É—à–Ω–∏–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (OUTPUT)** ‚Äî —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–æ–±–ª–µ–º–æ–π #2
4. **Race condition** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞–≤–∏—à–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–≤–∞–∂–Ω–æ ‚Äî –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å):
5. **RuntimeWarning: coroutine 'EventBus.publish' was never awaited** ‚Äî **–ò–°–ü–†–ê–í–õ–ï–ù–û (2025-12-04)**, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π
6. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** ‚Äî –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤ –µ–¥–∏–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
7. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã SwitchAudioSource** ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
8. **–ü—Ä–æ–±–ª–µ–º—ã —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤** ‚Äî —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–æ–±–ª–µ–º–æ–π #6

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ ‚Äî —É–ª—É—á—à–∞–µ—Ç UX):
9. **Lazy start –ø–æ—Ç–æ–∫–∞** ‚Äî –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞
10. **–û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ—Ç–æ–∫–æ–≤** ‚Äî —É–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
11. **–ó–∞–≤–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏** ‚Äî —É–ª—É—á—à–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤
12. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏** ‚Äî –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## üí° –í—ã–≤–æ–¥—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (INPUT)** ‚Äî **–ù–û–í–ê–Ø –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê** ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ AirPods –¥–∞–∂–µ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ polling
2. **Bluetooth —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ–±–ª–µ–º (-9986, -10851, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** ‚Äî —É—Å–ª–æ–∂–Ω—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Å–æ–∑–¥–∞–µ—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã** ‚Äî –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2025-12-04):**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ async (`asyncio.create_task()`)
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ (–Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç DeviceStateCache –¥–ª—è OUTPUT —Å retry –ª–æ–≥–∏–∫–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—É—Å—Ç–æ–º cache

**–ù–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (2025-12-04):**
- ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û**: –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ AirPods –¥–ª—è INPUT –¥–∞–∂–µ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –¥–æ—Ö–æ–¥–∏—Ç –ª–∏ —Å–æ–±—ã—Ç–∏–µ `device.default_input_changed` –¥–æ `VoiceRecognitionIntegration._on_input_device_changed()`
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `SpeechRecognizer.on_device_changed()` –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ª–∏ –æ–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
1. **–°–†–û–ß–ù–û**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É —Å–æ–±—ã—Ç–∏–π `device.default_input_changed` –¥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
2. **–°–†–û–ß–ù–û**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É `SpeechRecognizer.on_device_changed()` –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
3. –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –º–æ–¥—É–ª—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π —Ä–µ—à–∏—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º:
   - –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
   - –ß–µ—Ç–∫–∞—è —Å–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞




