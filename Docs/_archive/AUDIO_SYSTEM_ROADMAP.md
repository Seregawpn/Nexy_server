# –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ-—Å–∏—Å—Ç–µ–º—ã Nexy

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-03  
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–æ–∫  
**–¶–µ–ª—å:** –î–æ–≤–µ—Å—Ç–∏ OUTPUT –¥–æ —É—Ä–æ–≤–Ω—è INPUT, —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —Å–¥–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —É—Å—Ç–æ–π—á–∏–≤–æ–π –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ)

### INPUT –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**
  - –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ ‚Üí –ø—Ä–æ–±—É—é—Ç—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ ‚Üí USB ‚Üí BT ‚Üí Remote
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º**
  - `_device_is_available()` —á–µ—Ä–µ–∑ `sd.check_input_settings()`
  - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Ç–æ–∫–∞
- ‚úÖ **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É**
  - `_classify_input_device()` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
  - –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–º–µ—é—Ç –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ PortAudio**
  - –û—à–∏–±–∫–∏ -9986/-10851 –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–µ)
  - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

### OUTPUT –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ (—á–∞—Å—Ç–∏—á–Ω–æ)
- ‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Ç–æ–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º**
  - `_stop_audio_stream()` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
  - Guard –∑–∞—â–∏—Ç–∞ (`_switch_in_progress`) –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç concurrent –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ **–ö—ç—à —É—Å–ø–µ—à–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**
  - `_last_successful_config` —Ö—Ä–∞–Ω–∏—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ **Fallback –Ω–∞ `device=None` –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö -9986/-10851**
  - –î–ª—è BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã**
  - –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (10s –≤–º–µ—Å—Ç–æ 5s)
  - –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (5s –≤–º–µ—Å—Ç–æ 15s)

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ **Feature flag `device_switch_v2`**
  - –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —á–µ—Ä–µ–∑ `sd.default.device` (–±–µ–∑ SwitchAudioSource)
  - –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è INPUT –∏ OUTPUT
- ‚úÖ **DeviceChangePublisher —Å Core Audio –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏**
  - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —á–µ—Ä–µ–∑ Core Audio
  - Fallback –Ω–∞ polling –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Core Audio
- ‚úÖ **AudioStreamManager**
  - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏
  - Retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
  - –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ -9986/-10851

---

## üîß –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫)

**‚úÖ –í–°–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–î–ê–ß–ò –í–´–ü–û–õ–ù–ï–ù–´**

–í—Å–µ —Ñ–∞–∑—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (1-6) –∑–∞–≤–µ—Ä—à–µ–Ω—ã. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –¥–ª—è INPUT –∏ OUTPUT.

### 1. OUTPUT: –¥–æ–≤–µ—Å—Ç–∏ –¥–æ —É—Ä–æ–≤–Ω—è INPUT ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¶–µ–ª—å:** OUTPUT –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ —Å–µ–±—è —Ç–∞–∫ –∂–µ —É–º–Ω–æ, –∫–∞–∫ INPUT (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–±–æ—á–∏–π output)

#### 1.1 –Ø–≤–Ω—ã–π fallback –¥–ª—è OUTPUT –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ç–æ–∫–∞

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è OUTPUT –ø–æ—Ç–æ–∫–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É
- –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ OUTPUT —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ INPUT:
  - –ü—Ä–æ–±—É–µ–º –Ω–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π default
  - –ï—Å–ª–∏ PortAudio –¥–∞—ë—Ç –æ—à–∏–±–∫—É (–æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ BT):
    - –ü–æ–º–µ—á–∞–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ "–±–∏—Ç–æ–µ"
    - –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ ‚Üí USB ‚Üí BT)
    - –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–≤–æ–¥–∏—Ç—Å—è ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ–º `OUTPUT_UNAVAILABLE`, –Ω–µ –∑–∞–≤–∏—Å–∞–µ–º
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `_select_default_output_device()` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `_select_default_input_device()`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `_device_is_available()` –¥–ª—è OUTPUT
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `_classify_output_device()` –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `modules/speech_playback/core/player.py` - –≤—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ï—Å–ª–∏ AirPods –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç ‚Üí —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ MacBook Speakers
- ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: `‚ö†Ô∏è [OUTPUT] ID 1 ("Sergiy's AirPods"): —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–µ–µ`
- ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: `‚úÖ [OUTPUT] –í–´–ë–†–ê–ù: ID 2 - "MacBook Air Speakers"`

#### 1.2 –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å: "–≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ö–æ—Ç—å –æ–¥–∏–Ω —Ä–∞–±–æ—á–∏–π output"

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ï—Å–ª–∏ OUTPUT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –∏–ª–∏ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∑–≤—É–∫

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ "–ª—É—á—à–µ –∏–≥—Ä–∞–µ—Ç –Ω–µ —Ç—É–¥–∞, –∫—É–¥–∞ —Ö–æ—Ç–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –Ω–æ –∏–≥—Ä–∞–µ—Ç"
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç (`device=None`) –µ—Å–ª–∏ –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- ‚ö†Ô∏è –ì–æ–ª–æ—Å–æ–≤–æ–π —Ñ–∏–¥–±–µ–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `modules/speech_playback/core/player.py` - –ª–æ–≥–∏–∫–∞ fallback –≤ `_switch_output_device()` —É–ª—É—á—à–µ–Ω–∞
- ‚úÖ `modules/speech_playback/core/player.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ "–µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ä–∞–±–æ—á–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ä–∞–±–æ—á–µ–µ OUTPUT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ª—ã—à–∏—Ç –∑–≤—É–∫, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –Ω–∞ —Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—Ç–µ–ª

#### 1.3 –ß—ë—Ç–∫–æ –æ–ø–∏—Å–∞—Ç—å —ç—Ç–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –∫–∞–∫ –ø–æ–ª–∏—Ç–∏–∫—É OUTPUT

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–ü–æ–ª–∏—Ç–∏–∫–∞ OUTPUT: –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏" –≤ `AUDIO_SYSTEM_ARCHITECTURE_ANALYSIS.md`
- ‚úÖ –û–ø–∏—Å–∞–Ω –∞–ª–≥–æ—Ä–∏—Ç–º fallback –¥–ª—è OUTPUT
- ‚úÖ –û–ø–∏—Å–∞–Ω—ã –≥–∞—Ä–∞–Ω—Ç–∏–∏ (–≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–π output)

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `Docs/AUDIO_SYSTEM_ARCHITECTURE_ANALYSIS.md` - –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª 3.4 "–ü–æ–ª–∏—Ç–∏–∫–∞ OUTPUT –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏" –∏ —Ä–∞–∑–¥–µ–ª 8.5 "–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"

---

### 2. –°–ª–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤: CoreAudio –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¶–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —Å–¥–µ–ª–∞—Ç—å CoreAudio –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã

#### 2.1 –í–≤–µ—Å—Ç–∏ (–∏–ª–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å) CoreAudioDeviceManager ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω `modules/audio_core/core_audio_device_manager.py`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã:
  - `get_current_default_input() -> DeviceInfo` - —Ç–µ–∫—É—â–∏–π default INPUT
  - `get_current_default_output() -> DeviceInfo` - —Ç–µ–∫—É—â–∏–π default OUTPUT
  - `get_available_devices(device_type) -> List[DeviceInfo]` - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚úÖ DeviceInfo —Å–æ–¥–µ—Ä–∂–∏—Ç:
  - `core_audio_id` / `uid` (–ø–æ–∫–∞ —á—Ç–æ None, TODO –¥–ª—è –±—É–¥—É—â–µ–≥–æ)
  - `name` (–¥–ª—è –ª–æ–≥–æ–≤/–æ—Ç–ª–∞–¥–∫–∏)
  - `is_bluetooth` / `is_builtin` / `is_external` (—Ñ–ª–∞–≥–∏ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
  - `portaudio_index` (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

**–§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `modules/audio_core/core_audio_device_manager.py` - —Å–æ–∑–¥–∞–Ω
- ‚úÖ DeviceInfo –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ `core_audio_device_manager.py` (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ï–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- ‚úÖ –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç SwitchAudioSource –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è default —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚ö†Ô∏è –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç PortAudio device_id (core_audio_id/uid - TODO –¥–ª—è –±—É–¥—É—â–µ–≥–æ)

#### 2.2 –û–±–ª–µ–≥—á–∏—Ç—å DeviceChangePublisher ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ DeviceChangePublisher –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CoreAudioDeviceManager –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
- ‚úÖ –£–¥–∞–ª–µ–Ω –∫—ç—à `_device_name_cache` (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
- ‚úÖ SwitchAudioSource –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ fallback (legacy)
- ‚úÖ PortAudio-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ CoreAudioDeviceManager

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –£–±—Ä–∞–Ω–æ –∏–∑ DeviceChangePublisher:
  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º—ë–Ω (`_device_name_cache` –∏ `_cache_lock` —É–¥–∞–ª–µ–Ω—ã)
  - –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã SwitchAudioSource –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –ø—É—Ç–∏ (—Ç–æ–ª—å–∫–æ fallback)
- ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ DeviceChangePublisher:
  - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Core Audio –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ "–±—ã–ª–æ/—Å—Ç–∞–ª–æ" –ø–æ `device_id` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) –∏–ª–∏ `name` (fallback)
  - –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è `device.default_*_changed`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CoreAudioDeviceManager –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `modules/audio_core/device_change_publisher.py` - —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ `modules/audio_core/core_audio_device_manager.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ DeviceChangePublisher

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ DeviceChangePublisher –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SwitchAudioSource –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –ø—É—Ç–∏
- ‚ö†Ô∏è DeviceChangePublisher –≤—Å–µ –µ—â–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ PortAudio (—á–µ—Ä–µ–∑ CoreAudioDeviceManager)
- ‚úÖ DeviceChangePublisher —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ `device_id` –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è

#### 2.3 –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤—ã—Ç–∞—â–∏—Ç—å SwitchAudioSource –∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—É—Ç–∏ ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ SwitchAudioSource –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ fallback (legacy)
- ‚úÖ –í—Å–µ –º–µ—Å—Ç–∞ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É—é—Ç CoreAudioDeviceManager
- ‚úÖ SwitchAudioSource –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ CoreAudioDeviceManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ SwitchAudioSource –æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
- ‚úÖ –í—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç CoreAudioDeviceManager –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å
- ‚úÖ SwitchAudioSource –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º fallback (legacy)

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `modules/audio_core/device_change_publisher.py` - SwitchAudioSource —Ç–æ–ª—å–∫–æ –≤ fallback
- ‚úÖ `modules/speech_playback/core/player.py` - —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç feature flag (—á–∞—Å—Ç–∏—á–Ω–æ —Å–¥–µ–ª–∞–Ω–æ —Ä–∞–Ω–µ–µ)
- ‚úÖ `modules/voice_recognition/core/speech_recognizer.py` - —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç feature flag (—á–∞—Å—Ç–∏—á–Ω–æ —Å–¥–µ–ª–∞–Ω–æ —Ä–∞–Ω–µ–µ)

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ SwitchAudioSource –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –ø—É—Ç–∏ (—Ç–æ–ª—å–∫–æ fallback)
- ‚úÖ –í—Å–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ–ø–∏—Ä–∞—é—Ç—Å—è –Ω–∞ CoreAudioDeviceManager (PortAudio)
- ‚úÖ SwitchAudioSource –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ fallback (legacy)

---

### 3. –°–æ–±—ã—Ç–∏—è: —Å–¥–µ–ª–∞—Ç—å payload "—Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º" ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¶–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π, —É–±—Ä–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ —Å–ª—É—à–∞—Ç–µ–ª–µ–π

#### 3.1 –°–¥–µ–ª–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ `device.default_*_changed` —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –°–æ–±—ã—Ç–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π payload —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- ‚úÖ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–±—ã—Ç–∏—è –Ω–∞–ø—Ä—è–º—É—é

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω payload —Å–æ–±—ã—Ç–∏—è `device.default_*_changed`:
  - `core_audio_id` / `uid` (–ø–æ–∫–∞ —á—Ç–æ None, TODO –¥–ª—è –±—É–¥—É—â–µ–≥–æ)
  - `device_name` (–¥–ª—è –ª–æ–≥–æ–≤/–æ—Ç–ª–∞–¥–∫–∏)
  - `is_bluetooth` / `is_builtin` / `is_external` (—Ñ–ª–∞–≥–∏ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
  - `portaudio_index` (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
  - `max_input_channels` / `max_output_channels` (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–Ω–∞–ª–∞—Ö)
  - `default_samplerate` (—á–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏)
  - `old_*` (–∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
- ‚úÖ –£–±—Ä–∞–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ –∏–º–µ–Ω–∏ –∏–∑ —Å–æ–±—ã—Ç–∏–π

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `modules/audio_core/device_change_publisher.py` - —Ä–∞—Å—à–∏—Ä–µ–Ω payload —Å–æ–±—ã—Ç–∏—è
- ‚úÖ `integration/integrations/voice_recognition_integration.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `integration/integrations/speech_playback_integration.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –Ω–µ –∏—â—É—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ –∏–º–µ–Ω–∏
- ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ payload —Å–æ–±—ã—Ç–∏—è
- ‚ö†Ô∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ `device_id` (uid - TODO –¥–ª—è –±—É–¥—É—â–µ–≥–æ)

#### 3.2 –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ `SpeechRecognizer` –∏ `SequentialSpeechPlayer` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–±—ã—Ç–∏—è –Ω–∞–ø—Ä—è–º—É—é
- ‚úÖ –ù–µ –¥–µ–ª–∞—é—Ç –ø–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ –∏–º–µ–Ω–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–±—ã—Ç–∏–π

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ `SpeechRecognizer.on_device_changed()`:
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–±—ã—Ç–∏—è –Ω–∞–ø—Ä—è–º—É—é
  - –ü–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –≤ AudioStreamManager
  - –ù–µ –¥–µ–ª–∞–µ—Ç –ø–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ –∏–º–µ–Ω–∏
- ‚úÖ `SequentialSpeechPlayer._switch_output_device()`:
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–±—ã—Ç–∏—è –Ω–∞–ø—Ä—è–º—É—é
  - –ü–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –≤ AudioStreamManager
  - –ù–µ –¥–µ–ª–∞–µ—Ç –ø–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ –∏–º–µ–Ω–∏ (—Ç–æ–ª—å–∫–æ fallback –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ BT –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ)

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `modules/voice_recognition/core/speech_recognizer.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `modules/speech_playback/core/player.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±–µ—Ä—ë—Ç—Å—è –∏–∑ payload —Å–æ–±—ã—Ç–∏—è
- ‚úÖ –ö–æ–¥ —Å—Ç–∞–ª –ø—Ä–æ—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ

---

### 4. AudioStreamManager: —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –ø–æ—Ç–æ–∫–æ–≤ ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¶–µ–ª—å:** –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –≤—Å–µ–π –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å PortAudio –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

#### 4.1 –õ—é–±–∞—è —Ä–∞–±–æ—Ç–∞ —Å PortAudio —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ AudioStreamManager ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ AudioStreamManager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ç–æ–∫–æ–≤
- ‚úÖ –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `sd.InputStream`/`sd.OutputStream` —É–±—Ä–∞–Ω—ã (–∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ AudioStreamManager)
- ‚úÖ –ü—Ä–∞–≤–∏–ª–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ `stream_manager.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PortAudio API
- ‚úÖ –£–±—Ä–∞–Ω –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `sd.InputStream` –∏–∑ `modules/permissions/first_run/activator.py` (—Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AudioStreamManager)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª–æ: "–≤—Å—è —Ä–∞–±–æ—Ç–∞ —Å PortAudio –ø–æ—Ç–æ–∫–∞–º–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ AudioStreamManager"
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª—É—á–∞–µ–≤ (—Å –ø–æ–º–µ—Ç–∫–æ–π –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö)

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `modules/permissions/first_run/activator.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AudioStreamManager
- ‚úÖ `modules/audio_core/stream_manager.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ù–µ—Ç –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ `sd.InputStream`/`sd.OutputStream` –≤–Ω–µ AudioStreamManager (–∫—Ä–æ–º–µ fallback)
- ‚úÖ –í—Å—è —Ä–∞–±–æ—Ç–∞ —Å PortAudio –ø–æ—Ç–æ–∫–∞–º–∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ AudioStreamManager
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `sd.query_devices()`, `sd.default.device`, `sd.check_*_settings()` –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º (—ç—Ç–æ –∑–∞–ø—Ä–æ—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –Ω–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤)

#### 4.2 INPUT –∏ OUTPUT –∂–∏–≤—É—Ç –ø–æ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- INPUT –∏ OUTPUT –∏—Å–ø–æ–ª—å–∑—É—é—Ç AudioStreamManager, –Ω–æ –ª–æ–≥–∏–∫–∞ –Ω–µ–º–Ω–æ–≥–æ —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è INPUT –∏ OUTPUT:
  - –ï–¥–∏–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ + –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã + –ø–æ–ª–∏—Ç–∏–∫–∞ BT)
  - AudioStreamManager —Ä–µ—à–∞–µ—Ç: –Ω–∞ —á—ë–º –æ—Ç–∫—Ä—ã—Ç—å, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è, –∫–∞–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ—à–∏–±–∫–∏
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ AudioStreamManager

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `modules/audio_core/stream_manager.py` - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É
- `modules/voice_recognition/core/speech_recognizer.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ª–æ–≥–∏–∫—É
- `modules/speech_playback/core/player.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ª–æ–≥–∏–∫—É

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- INPUT –∏ OUTPUT –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –º–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç—ã —Å AudioStreamManager
- –í—Å—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è/fallback —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ AudioStreamManager

---

### 5. –ü–æ–ª–∏—Ç–∏–∫–∏: –≤—ã–Ω–µ—Å—Ç–∏ "–º–∞–≥–∏—á–µ—Å–∫–∏–µ if-—ã" –≤ –æ–¥–Ω–æ –º–µ—Å—Ç–æ ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¶–µ–ª—å:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ "–º–∞–≥–∏—á–µ—Å–∫–∏–µ" –∑–Ω–∞—á–µ–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

#### 5.1 –í–≤–µ—Å—Ç–∏ DevicePolicy / AudioPolicy ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω `modules/audio_core/device_policy.py` —Å –∫–ª–∞—Å—Å–æ–º `DevicePolicy`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (BT, Normal, Built-in, Remote)
- ‚úÖ –í—Å–µ "–º–∞–≥–∏—á–µ—Å–∫–∏–µ if-—ã" –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –≤—ã–∑–æ–≤—ã `DevicePolicy.get_policy()`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω `modules/audio_core/device_policy.py` —Å –∫–ª–∞—Å—Å–æ–º `DevicePolicy`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–ª–∞—Å—Å `DevicePolicy`:
  - –ù–∞ –≤—Ö–æ–¥: `is_bluetooth`, `is_builtin`, `is_external`, `is_remote`, `device_name`
  - –ù–∞ –≤—ã—Ö–æ–¥: `DevicePolicyConfig` —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–µ—Ç—Ä–∞–µ–≤, –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –∏ —Ç.–¥.
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ –≤ `AudioStreamManager`:
  - `create_stream` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DevicePolicy` –¥–ª—è `max_retries` –∏ `retry_delay`
  - `_close_stream_safe` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DevicePolicy` –¥–ª—è `max_wait_active` –∏ `close_delay`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ –≤ `SequentialSpeechPlayer`:
  - –í—Å–µ —Ç–∞–π–º–∞—É—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–ª—É—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `_get_operation_timeout()` –∏–∑ –ø–æ–ª–∏—Ç–∏–∫–∏
  - –£–±—Ä–∞–Ω—ã –≤—Å–µ hardcoded –∑–Ω–∞—á–µ–Ω–∏—è `5.0 if is_bluetooth else 3.0`

**–§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `modules/audio_core/device_policy.py` - –Ω–æ–≤—ã–π —Ñ–∞–π–ª
- ‚úÖ `modules/audio_core/stream_manager.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É
- ‚úÖ `modules/speech_playback/core/player.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- –í—Å–µ "–º–∞–≥–∏—á–µ—Å–∫–∏–µ" –∑–Ω–∞—á–µ–Ω–∏—è –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ DevicePolicy
- –ù–µ—Ç —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω—ã—Ö "if is_bluetooth" –ø–æ –∫–æ–¥—É
- –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

---

### 6. –î–æ–∫—É–º–µ–Ω—Ç: —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å "—Ç–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å" ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–¶–µ–ª—å:** –ß—ë—Ç–∫–æ –æ–ø–∏—Å–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

#### 6.1 –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ä–µ–∂–∏–º Spotify/Zoom)" ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª 8.5 "–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ä–µ–∂–∏–º Spotify/Zoom)" –≤ `AUDIO_SYSTEM_ARCHITECTURE_ANALYSIS.md`
- ‚úÖ –û–ø–∏—Å–∞–Ω—ã –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Å–∏—Å—Ç–µ–º—ã:
  - INPUT: –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–π input, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
  - OUTPUT: –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–π output, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Ç–æ–∫–∞
- ‚úÖ –û–ø–∏—Å–∞–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ fallback –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (Built-in ‚Üí USB ‚Üí BT ‚Üí Remote)
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ DevicePolicy –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- ‚úÖ –û–ø–∏—Å–∞–Ω–æ, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç (—Ç–æ—á–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ)
- ‚úÖ –û–ø–∏—Å–∞–Ω —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã "—Å–ª–µ–¥—É–µ–º –∑–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–º default"

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `Docs/AUDIO_SYSTEM_ARCHITECTURE_ANALYSIS.md` - –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª 8.5

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —á—ë—Ç–∫–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç (–≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–π input/output)

#### 6.2 –í —Å—Ç–∞—Ç—É—Å–µ/–ø–ª–∞–Ω–µ —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å "—á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ" / "—á—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è" ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª 9.1 "–°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π" –≤ `AUDIO_SYSTEM_ARCHITECTURE_ANALYSIS.md`
- ‚úÖ –ß—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–æ:
  - ‚úÖ **–ß–¢–û –°–î–ï–õ–ê–ù–û** (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç):
    - INPUT –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ (fallback, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è)
    - OUTPUT –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ (fallback, –≥–∞—Ä–∞–Ω—Ç–∏—è —Ä–∞–±–æ—á–µ–≥–æ output, guard'—ã)
    - –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (AudioStreamManager, DevicePolicy, CoreAudioDeviceManager)
    - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã, retry –ª–æ–≥–∏–∫–∞)
  - üîß **–ß–¢–û –û–°–¢–ê–õ–û–°–¨** (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
    - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (‚úÖ –∑–∞–≤–µ—Ä—à–µ–Ω–∞)
    - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞, —Ä–µ–∂–∏–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
    - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ—à–∏–±–∫–∏ -10851, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `Docs/AUDIO_SYSTEM_ARCHITECTURE_ANALYSIS.md` - –æ–±–Ω–æ–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª 9.1 –∏ 9.2

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∑—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã)
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –µ—â—ë –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (—Ç–æ–ª—å–∫–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è)

---

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –§–∞–∑–∞ 1: OUTPUT fallback (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
1. ‚úÖ 1.1 –Ø–≤–Ω—ã–π fallback –¥–ª—è OUTPUT –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ç–æ–∫–∞
2. ‚úÖ 1.2 –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å: "–≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ö–æ—Ç—å –æ–¥–∏–Ω —Ä–∞–±–æ—á–∏–π output"
3. ‚úÖ 1.3 –û–ø–∏—Å–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É OUTPUT –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ

**–û—Ü–µ–Ω–∫–∞:** 2-3 –¥–Ω—è

### –§–∞–∑–∞ 2: –£–ø—Ä–æ—â–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (—É–ª—É—á—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã) ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
1. ‚úÖ 2.1 –í–≤–µ—Å—Ç–∏ CoreAudioDeviceManager
2. ‚úÖ 2.2 –û–±–ª–µ–≥—á–∏—Ç—å DeviceChangePublisher
3. ‚úÖ 2.3 –í—ã—Ç–∞—â–∏—Ç—å SwitchAudioSource –∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—É—Ç–∏

**–û—Ü–µ–Ω–∫–∞:** 3-5 –¥–Ω–µ–π  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:** –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –§–∞–∑–∞ 3: –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã) ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
1. ‚úÖ 3.1 –°–¥–µ–ª–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º
2. ‚úÖ 3.2 –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π

**–û—Ü–µ–Ω–∫–∞:** 1-2 –¥–Ω—è  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:** –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –§–∞–∑–∞ 4: –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è) ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
1. ‚úÖ 4.1 –õ—é–±–∞—è —Ä–∞–±–æ—Ç–∞ —Å PortAudio —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ AudioStreamManager
2. ‚ö†Ô∏è 4.2 INPUT –∏ OUTPUT –∂–∏–≤—É—Ç –ø–æ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ (—á–∞—Å—Ç–∏—á–Ω–æ - —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –º–æ–¥–µ–ª—å —á–µ—Ä–µ–∑ AudioStreamManager)

**–û—Ü–µ–Ω–∫–∞:** 2-3 –¥–Ω—è  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:** –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –§–∞–∑–∞ 5: –ü–æ–ª–∏—Ç–∏–∫–∏ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è) ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
1. ‚úÖ 5.1 –í–≤–µ—Å—Ç–∏ DevicePolicy - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ "–º–∞–≥–∏—á–µ—Å–∫–∏–µ if-—ã"

**–û—Ü–µ–Ω–∫–∞:** 1-2 –¥–Ω—è  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:** –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –§–∞–∑–∞ 6: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è) ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
1. ‚úÖ 6.1 –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ä–µ–∂–∏–º Spotify/Zoom)"
2. ‚úÖ 6.2 –í —Å—Ç–∞—Ç—É—Å–µ/–ø–ª–∞–Ω–µ —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å "—á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ" / "—á—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è"

**–û—Ü–µ–Ω–∫–∞:** 0.5 –¥–Ω—è  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:** –í—ã–ø–æ–ª–Ω–µ–Ω–æ

**–ò—Ç–æ–≥–æ:** 8-13 –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:** –í—Å–µ —Ñ–∞–∑—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã ‚úÖ

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞ –≤—Å–µ–≥–æ –ø–ª–∞–Ω–∞

–ö–æ–≥–¥–∞ –≤—Å—ë –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ, Nexy –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ Spotify / Apple Music / Zoom:

- ‚úÖ **–ñ–µ–ª–µ–∑–æ –º–æ–∂–µ—Ç —á—É–¥–∏—Ç—å, –Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å—ë "–ø—Ä–æ—Å—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç"**
- ‚úÖ **–í—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–π input/output, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**
- ‚úÖ **–ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏**
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑ "–º–∞–≥–∏—á–µ—Å–∫–∏—Ö" –∑–Ω–∞—á–µ–Ω–∏–π**

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∑–∞–¥–∞—á–∏ –ø–æ–º–µ—á–µ–Ω—ã —á–µ–∫–±–æ–∫—Å–∞–º–∏ `[ ]` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É–∫–∞–∑–∞–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
- –û—Ü–µ–Ω–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–∞–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã
- –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –æ–ø–∏—Å–∞–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏

