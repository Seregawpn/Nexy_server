# –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–î–∞–Ω–Ω—ã–µ, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ AVF, —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ Google Speech API –∏–∑-–∑–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞:
- AVF –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ 48kHz ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ 16kHz ‚Üí –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã ‚Üí UnknownValueError
- Google –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:

```
1. AVF –ø–æ–ª—É—á–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ë–ï–ó –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
   ‚îú‚îÄ get_current_input_device() ‚Üí –∏–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   ‚îú‚îÄ get_current_output_device() ‚Üí –∏–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   ‚îî‚îÄ –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω! ‚úÖ

2. Google –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é
   ‚îú‚îÄ sr.Microphone() ‚Üí –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω
   ‚îú‚îÄ –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ—á—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   ‚îî‚îÄ –ù–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ ‚Üí –Ω–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ ‚úÖ

3. Google —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
   ‚îú‚îÄ recognize_google() ‚Üí –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   ‚îî‚îÄ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
```

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å

### 1. –í `initialize()`:

```python
# ‚úÖ –°–æ–∑–¥–∞—ë–º SpeechRecognizer –¥–ª—è Google –∑–∞–ø–∏—Å–∏
if self._use_avf:
    # AVF –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (–ë–ï–ó –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞)
    # Google –±—É–¥–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é
    self._recognizer = SpeechRecognizer(DEFAULT_RECOGNITION_CONFIG)
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –æ—Ç AVF (–ë–ï–ó –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞)
    if self._avf_engine:
        device_info = self._avf_engine.get_current_input_device()
        logger.info(f"‚úÖ [AVF] –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ={device_info}")
```

### 2. –í `_on_recording_start()`:

```python
# ‚úÖ –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º AVF –¥–ª—è –∑–∞–ø–∏—Å–∏
# AVF –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (—É–∂–µ –ø–æ–ª—É—á–µ–Ω–∞ –≤ initialize)

# ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º Google –Ω–∞–ø—Ä—è–º—É—é
if self._recognizer:
    await self._recognizer.start_listening()
    # Google –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
```

### 3. –í `_on_recording_stop()`:

```python
# ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Google –∑–∞–ø–∏—Å—å
if self._recognizer:
    audio_data = await self._recognizer.stop_listening()
    
    # ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞—ë–º –Ω–∞–ø—Ä—è–º—É—é (–¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ)
    recognizer = sr.Recognizer()
    text = recognizer.recognize_google(audio_data, language=language)
    
    # –ü—É–±–ª–∏–∫—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    await self.event_bus.publish("voice.recognition_completed", {...})
```

### 4. –£–±—Ä–∞—Ç—å:

```python
# ‚ùå –£–±—Ä–∞—Ç—å:
# - _recognize_avf_audio() (–Ω–µ –Ω—É–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è)
# - _publish_mic_data_ready() (–Ω–µ –Ω—É–∂–Ω–∞ —ç—Å—Ç–∞—Ñ–µ—Ç–∞)
# - _on_mic_data_ready() (–Ω–µ –Ω—É–∂–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —ç—Å—Ç–∞—Ñ–µ—Ç—ã)
# - –†–µ—Å–µ–º–ø–ª–∏–Ω–≥ 48kHz ‚Üí 16kHz (Google —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç)
# - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é int16 ‚Üí float32 ‚Üí int16 (Google —Å–∞–º –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç)
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **–ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π**
   - Google –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   - –ù–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞

2. **–ù–µ—Ç –¥–≤–æ–π–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**
   - AVF –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω (—Ç–æ–ª—å–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
   - Google –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω –æ–¥–∏–Ω —Ä–∞–∑

3. **–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - –î–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   - –ù–µ—Ç UnknownValueError

4. **–ï—Å—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—Ç AVF**
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
   - –§–æ—Ä–º–∞—Ç—ã, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

- [ ] –ò–∑–º–µ–Ω–∏—Ç—å `initialize()`: —Å–æ–∑–¥–∞–≤–∞—Ç—å `SpeechRecognizer` –ø—Ä–∏ `_use_avf`
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å `_on_recording_start()`: –ù–ï –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å AVF, –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å Google
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å `_on_recording_stop()`: –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å Google, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é
- [ ] –£–±—Ä–∞—Ç—å `_recognize_avf_audio()` (–Ω–µ –Ω—É–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è)
- [ ] –£–±—Ä–∞—Ç—å `_publish_mic_data_ready()` (–Ω–µ –Ω—É–∂–Ω–∞ —ç—Å—Ç–∞—Ñ–µ—Ç–∞)
- [ ] –£–±—Ä–∞—Ç—å `_on_mic_data_ready()` (–Ω–µ –Ω—É–∂–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- [ ] –£–±—Ä–∞—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç –¥–≤–æ–π–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (—Ç–µ–ø–µ—Ä—å –Ω–µ –Ω—É–∂–Ω–∞)

---

## üéØ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è AVF ‚Üí Google —Å–æ–∑–¥–∞—ë—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã ‚Üí UnknownValueError

**–†–µ—à–µ–Ω–∏–µ:** 
- AVF —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (–ë–ï–ó –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞)
- Google –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π
- ‚úÖ –ù–µ—Ç –¥–≤–æ–π–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

