# –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –∏–∑–æ–ª—è—Ü–∏–∏

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-01-XX  
**–í–µ—Ä—Å–∏—è**: 1.0

---

## üéØ –¶–µ–ª—å

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∏–∑–æ–ª—è—Ü–∏–∏ –ø—Ä–æ–±–ª–µ–º, –ø–æ–∏—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –∏ —Ñ–ª–∞–≥–æ–≤.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ–±–ª–µ–º](#–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è-–∏–∑–æ–ª—è—Ü–∏—è-–ø—Ä–æ–±–ª–µ–º)
2. [–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
3. [–ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞](#–ø–æ–∏—Å–∫-—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ-–∫–æ–¥–∞)
4. [–ü–æ–∏—Å–∫ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤](#–ø–æ–∏—Å–∫-–∏-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-—Ñ–ª–∞–≥–æ–≤)
5. [–ß–µ–∫-–ª–∏—Å—Ç—ã –∏ —à–∞–±–ª–æ–Ω—ã](#—á–µ–∫-–ª–∏—Å—Ç—ã-–∏-—à–∞–±–ª–æ–Ω—ã)

---

## 1. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ–±–ª–µ–º

### 1.1 –ü—Ä–∏–Ω—Ü–∏–ø—ã –∏–∑–æ–ª—è—Ü–∏–∏

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –ò–∑–æ–ª—è—Ü–∏—è ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã.

**–ü—Ä–∞–≤–∏–ª–∞ –∏–∑–æ–ª—è—Ü–∏–∏**:
1. **–û–¥–Ω–∞ –≥–∏–ø–æ—Ç–µ–∑–∞ ‚Äî –æ–¥–∏–Ω —Ç–µ—Å—Ç**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≥–∏–ø–æ—Ç–µ–∑—É
2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–≤–∏—Å–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
3. **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
4. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**: –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –¥–∞–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ

### 1.2 –ê–ª–≥–æ—Ä–∏—Ç–º –∏–∑–æ–ª—è—Ü–∏–∏

**–®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –ø—Ä–æ–±–ª–µ–º—ã**
```python
# ‚ùå –ü–õ–û–•–û: –°–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
def test_microphone_initialization():
    """–¢–µ—Å—Ç –≤—Å–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞"""
    # –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ: —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, AVF, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, EventBus
    pass

# ‚úÖ –•–û–†–û–®–û: –£–∑–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è
def test_microphone_permission_check():
    """–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π"""
    # –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é: check_microphone_permission()
    pass
```

**–®–∞–≥ 2: –í—ã–¥–µ–ª–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è (MRE)**
```python
# MRE –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
# 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
# 2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# 3. –û–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

def test_permission_status_enum():
    """MRE: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ enum PermissionStatus"""
    from modules.permissions.core.types import PermissionStatus
    
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    status = PermissionStatus.GRANTED
    
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: —Ç–æ–ª—å–∫–æ enum
    assert status == PermissionStatus.GRANTED
    assert status != PermissionStatus.DENIED
```

**–®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```python
# ‚úÖ –•–û–†–û–®–û: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å –º–æ–∫–∞–º–∏
from unittest.mock import Mock, patch

def test_restart_scheduler_with_mocks():
    """–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å –º–æ–∫–∞–º–∏ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"""
    # Setup: –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
    mock_event_bus = Mock(spec=EventBus)
    mock_state_manager = Mock(spec=ApplicationStateManager)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∫–æ–≤ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
    mock_state_manager.get_mic_permission.return_value = PermissionStatus.GRANTED
    
    # Execution: —Ç–µ—Å—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫—É scheduler
    scheduler = RestartScheduler(mock_event_bus, mock_state_manager)
    result = scheduler.should_restart()
    
    # Assertion: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    assert result == True
```

### 1.3 –ß–µ–∫-–ª–∏—Å—Ç –∏–∑–æ–ª—è—Ü–∏–∏

**–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞**:
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –æ–¥–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –∏–∑–æ–ª—è—Ü–∏–∏ (—á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º, —á—Ç–æ –º–æ–∫–∞–µ–º)
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞**:
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] –¢–µ—Å—Ç –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –¢–µ—Å—Ç –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –≥–∏–ø–æ—Ç–µ–∑—É
- [ ] –¢–µ—Å—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º (–¥–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ)

**–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞**:
- [ ] –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- [ ] –¢–µ—Å—Ç –¥–∞–µ—Ç —á–µ—Ç–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø—Ä–æ—à–µ–ª/–Ω–µ –ø—Ä–æ—à–µ–ª)
- [ ] –¢–µ—Å—Ç –Ω–µ –∏–º–µ–µ—Ç –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- [ ] –¢–µ—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (docstring —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≥–∏–ø–æ—Ç–µ–∑—ã)

---

## 2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞ (AAA Pattern)

**Arrange (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞)** ‚Üí **Act (–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)** ‚Üí **Assert (–ü—Ä–æ–≤–µ—Ä–∫–∞)**

```python
def test_permission_restart_with_feature_flag():
    """–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç: –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ permission restart —Å feature flag"""
    
    # ===== ARRANGE (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞) =====
    mock_event_bus = Mock(spec=EventBus)
    mock_state_manager = Mock(spec=ApplicationStateManager)
    
    with patch('config.unified_config.get') as mock_config:
        mock_config.return_value = {
            'NEXY_FEATURE_PERMISSION_RESTART_V2': True,
            'NEXY_KS_PERMISSION_RESTART_V2': False
        }
        
        # ===== ACT (–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ) =====
        scheduler = RestartScheduler(mock_event_bus, mock_state_manager)
        result = scheduler.should_restart()
        
        # ===== ASSERT (–ü—Ä–æ–≤–µ—Ä–∫–∞) =====
        assert result == True
        mock_event_bus.publish.assert_called_once()
```

### 2.2 –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

**Unit —Ç–µ—Å—Ç—ã** (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –±—ã—Å—Ç—Ä—ã–µ, –±–µ–∑ IO):
```python
def test_permission_status_comparison():
    """Unit —Ç–µ—Å—Ç: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ PermissionStatus"""
    # –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    assert PermissionStatus.GRANTED == PermissionStatus.GRANTED
    assert PermissionStatus.GRANTED != PermissionStatus.DENIED
```

**Integration —Ç–µ—Å—Ç—ã** (—Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏, –Ω–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ):
```python
def test_gateway_decision_with_snapshot():
    """Integration —Ç–µ—Å—Ç: –ø—Ä–æ–≤–µ—Ä—è–µ–º gateway —Å —Ä–µ–∞–ª—å–Ω—ã–º Snapshot"""
    snapshot = Snapshot(
        perm_mic=PermissionStatus.GRANTED,
        perm_screen=PermissionStatus.GRANTED,
        # ... –¥—Ä—É–≥–∏–µ –æ—Å–∏
    )
    decision = decide_start_listening(snapshot)
    assert decision == Decision.START
```

**Contract —Ç–µ—Å—Ç—ã** (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ EventBus):
```python
def test_event_bus_contract():
    """Contract —Ç–µ—Å—Ç: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ–±—ã—Ç–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É"""
    event = {
        "session_id": "test-uuid",
        "text": "test text"
    }
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
    validate_event_contract("voice.recognition.result", event)
```

### 2.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ edge cases

**–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**:
```python
def test_permission_restart_with_all_flags_disabled():
    """Edge case: –≤—Å–µ —Ñ–ª–∞–≥–∏ –≤—ã–∫–ª—é—á–µ–Ω—ã"""
    with patch('config.unified_config.get') as mock_config:
        mock_config.return_value = {
            'NEXY_FEATURE_PERMISSION_RESTART_V2': False,
            'NEXY_KS_PERMISSION_RESTART_V2': True
        }
        scheduler = RestartScheduler(mock_event_bus, mock_state_manager)
        result = scheduler.should_restart()
        assert result == False  # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å False –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ

def test_permission_restart_with_kill_switch():
    """Edge case: kill-switch –≤–∫–ª—é—á–µ–Ω"""
    with patch('config.unified_config.get') as mock_config:
        mock_config.return_value = {
            'NEXY_FEATURE_PERMISSION_RESTART_V2': True,
            'NEXY_KS_PERMISSION_RESTART_V2': True  # Kill-switch –≤–∫–ª—é—á–µ–Ω
        }
        scheduler = RestartScheduler(mock_event_bus, mock_state_manager)
        result = scheduler.should_restart()
        assert result == False  # Kill-switch –¥–æ–ª–∂–µ–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
```

### 2.4 –ß–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü–µ—Ä–µ–¥ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ–º —Ç–µ—Å—Ç–∞**:
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ç–∏–ø —Ç–µ—Å—Ç–∞ (unit/integration/contract)
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞ (AAA: Arrange, Act, Assert)
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã edge cases –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–æ–∫–∏/—Å—Ç–∞–±—ã –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Ç–µ—Å—Ç–∞**:
- [ ] –°–æ–±–ª—é–¥–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ AAA (Arrange, Act, Assert)
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç edge cases (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –¢–µ—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (docstring —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è)

**–ü–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–∞**:
- [ ] –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- [ ] –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] –¢–µ—Å—Ç –Ω–µ –∏–º–µ–µ—Ç –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- [ ] –¢–µ—Å—Ç –ø–æ–∫—Ä—ã–≤–∞–µ—Ç edge cases

---

## 3. –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

### 3.1 –ú–µ—Ç–æ–¥—ã –ø–æ–∏—Å–∫–∞

**1. –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞**:
```bash
# Grep –ø–æ–∏—Å–∫
grep -r "is_bluetooth_device" modules/

# Codebase search (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫)
codebase_search "How to check if device is bluetooth?"
```

**2. –ü–æ–∏—Å–∫ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```bash
# –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
grep -r "def.*bluetooth" modules/
grep -r "def.*device.*check" modules/
```

**3. –ü–æ–∏—Å–∫ –≤ —É—Ç–∏–ª–∏—Ç–∞—Ö**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç
ls modules/*/utils/
grep -r "device_utils\|audio_utils" modules/
```

### 3.2 –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞

**–®–∞–≥ 1: –ü–æ–∏—Å–∫ –ø–æ —Ç–æ—á–Ω–æ–º—É –∏–º–µ–Ω–∏**
```python
# –ü–ï–†–ï–î —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏:
# def _is_bluetooth_device(self, name: str) -> bool:

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫:
grep -r "is_bluetooth_device" client/
# –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
```

**–®–∞–≥ 2: –ü–æ–∏—Å–∫ –ø–æ —Å–µ–º–∞–Ω—Ç–∏–∫–µ**
```python
# –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–µ –∏–º—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –∏—Å–∫–∞—Ç—å –ø–æ —Å–º—ã—Å–ª—É:
codebase_search "How to check if audio device is bluetooth?"
codebase_search "How to detect bluetooth devices?"
```

**–®–∞–≥ 3: –ü–æ–∏—Å–∫ –≤ —É—Ç–∏–ª–∏—Ç–∞—Ö**
```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã:
from modules.audio_system.utils import device_utils
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —Ç–∞–º –Ω—É–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
dir(device_utils)
```

**–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π**
```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω—É–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
# - modules/audio_system/utils/
# - modules/hardware_id/
# - modules/device_management/
```

### 3.3 –ß–µ–∫-–ª–∏—Å—Ç –ø–æ–∏—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

**–ü–ï–†–ï–î —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞/–º–µ—Ç–æ–¥–∞**:
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–∏—Å–∫ –ø–æ —Ç–æ—á–Ω–æ–º—É –∏–º–µ–Ω–∏ (grep)
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (codebase_search)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã (device_utils, audio_utils, –∏ —Ç.–¥.)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω—É–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è/–∫–ª–∞—Å—Å/–º–µ—Ç–æ–¥
- [ ] –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è/–∫–ª–∞—Å—Å/–º–µ—Ç–æ–¥ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞**:
```python
# ‚úÖ –•–û–†–û–®–û: –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
# 1. Grep –ø–æ–∏—Å–∫
grep -r "is_bluetooth_device" client/
# –†–µ–∑—É–ª—å—Ç–∞—Ç: modules/audio_system/utils/device_utils.py:is_bluetooth_device()

# 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
from modules.audio_system.utils.device_utils import is_bluetooth_device
is_bluetooth = is_bluetooth_device(device_name)
```

---

## 4. –ü–æ–∏—Å–∫ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤

### 4.1 –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–ª–∞–≥–∞—Ö

**1. –†–µ–µ—Å—Ç—Ä —Ñ–ª–∞–≥–æ–≤**:
- `Docs/FEATURE_FLAGS.md` ‚Äî –∫–∞—Ä—Ç–∞ –≤—Å–µ—Ö feature flags/kill-switches ‚Üí –∫–æ–¥

**2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
- `config/unified_config.yaml` ‚Äî —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–ª–∞–≥–æ–≤
- Environment variables ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
- –†–∞–∑–¥–µ–ª 6.1 –≤ `.cursorrules` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–ª–∞–≥–æ–≤
- –†–∞–∑–¥–µ–ª 19.1 –≤ `.cursorrules` ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞ —Ä–æ–ª–ª–∞—É—Ç–∞

### 4.2 –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ —Ñ–ª–∞–≥–æ–≤

**–®–∞–≥ 1: –ü–æ–∏—Å–∫ –≤ —Ä–µ–µ—Å—Ç—Ä–µ**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–µ—Å—Ç—Ä —Ñ–ª–∞–≥–æ–≤
cat Docs/FEATURE_FLAGS.md
# –ù–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π —Ñ–ª–∞–≥ –∏ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ
```

**–®–∞–≥ 2: –ü–æ–∏—Å–∫ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å unified_config.yaml
grep -r "NEXY_FEATURE" config/unified_config.yaml
grep -r "NEXY_KS" config/unified_config.yaml
```

**–®–∞–≥ 3: –ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ**
```bash
# –ù–∞–π—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–ª–∞–≥–∞ –≤ –∫–æ–¥–µ
grep -r "NEXY_FEATURE_PERMISSION_RESTART_V2" client/
grep -r "NEXY_KS_PERMISSION_RESTART_V2" client/
```

### 4.3 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö**:
```python
# ‚úÖ –•–û–†–û–®–û: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–ª–∞–≥–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∞
def test_with_feature_flag():
    """–¢–µ—Å—Ç —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º feature flag"""
    with patch('config.unified_config.get') as mock_config:
        mock_config.return_value = {
            'NEXY_FEATURE_PERMISSION_RESTART_V2': True,
            'NEXY_KS_PERMISSION_RESTART_V2': False
        }
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º —Ñ–ª–∞–≥–æ–º
        result = function_under_test()
        assert result == expected_with_flag

def test_without_feature_flag():
    """–¢–µ—Å—Ç —Å –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º feature flag"""
    with patch('config.unified_config.get') as mock_config:
        mock_config.return_value = {
            'NEXY_FEATURE_PERMISSION_RESTART_V2': False,
            'NEXY_KS_PERMISSION_RESTART_V2': False
        }
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º —Ñ–ª–∞–≥–æ–º
        result = function_under_test()
        assert result == expected_without_flag

def test_with_kill_switch():
    """–¢–µ—Å—Ç —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º kill-switch"""
    with patch('config.unified_config.get') as mock_config:
        mock_config.return_value = {
            'NEXY_FEATURE_PERMISSION_RESTART_V2': True,
            'NEXY_KS_PERMISSION_RESTART_V2': True  # Kill-switch –≤–∫–ª—é—á–µ–Ω
        }
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å kill-switch (–¥–æ–ª–∂–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å)
        result = function_under_test()
        assert result == expected_with_kill_switch
```

### 4.4 –ß–µ–∫-–ª–∏—Å—Ç –ø–æ–∏—Å–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–ª–∞–≥–æ–≤

**–ü–ï–†–ï–î –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–ª–∞–≥–∞**:
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ä–µ–µ—Å—Ç—Ä —Ñ–ª–∞–≥–æ–≤ (`Docs/FEATURE_FLAGS.md`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`config/unified_config.yaml`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–ª–∞–≥–∞ –≤ –∫–æ–¥–µ (grep)
- [ ] –ü–æ–Ω—è—Ç–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ñ–ª–∞–≥–∞ –∏ –µ–≥–æ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ–ª–∞–≥–∞ –≤ —Ç–µ—Å—Ç–µ**:
- [ ] –§–ª–∞–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ (patch)
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º —Ñ–ª–∞–≥–æ–º
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º —Ñ–ª–∞–≥–æ–º (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å kill-switch (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

**–ü–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–ª–∞–≥–∞**:
- [ ] –§–ª–∞–≥ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `Docs/FEATURE_FLAGS.md` (–µ—Å–ª–∏ –Ω–æ–≤—ã–π)
- [ ] –§–ª–∞–≥ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `config/unified_config.yaml` (–µ—Å–ª–∏ –Ω–æ–≤—ã–π)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–µ—Å–ª–∏ –Ω–æ–≤—ã–π)

---

## 5. –ß–µ–∫-–ª–∏—Å—Ç—ã –∏ —à–∞–±–ª–æ–Ω—ã

### 5.1 –ü–æ–ª–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–µ—Å—Ç–∞

**–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**:
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≥–∏–ø–æ—Ç–µ–∑–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –∏–∑–æ–ª—è—Ü–∏–∏
- [ ] –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –ù–∞–π–¥–µ–Ω—ã –∏ –ø–æ–Ω—è—Ç—ã —Ñ–ª–∞–≥–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –º–æ–∫–∏

**–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞**:
- [ ] –°–æ–±–ª—é–¥–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ AAA (Arrange, Act, Assert)
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ñ–ª–∞–≥–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç edge cases (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –¢–µ—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (docstring)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–∞**:
- [ ] –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- [ ] –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] –¢–µ—Å—Ç –Ω–µ –∏–º–µ–µ—Ç –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- [ ] –¢–µ—Å—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º

### 5.2 –®–∞–±–ª–æ–Ω –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```python
"""
–®–∞–±–ª–æ–Ω –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
"""
import pytest
from unittest.mock import Mock, patch

def test_[–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏]_[—Å—Ü–µ–Ω–∞—Ä–∏–π]():
    """
    –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç: [–æ–ø–∏—Å–∞–Ω–∏–µ –≥–∏–ø–æ—Ç–µ–∑—ã]
    
    –ì–∏–ø–æ—Ç–µ–∑–∞: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏]
    –ò–∑–æ–ª—è—Ü–∏—è: [—á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º, —á—Ç–æ –º–æ–∫–∞–µ–º]
    """
    # ===== ARRANGE (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞) =====
    # –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫–æ–≤
    mock_dependency1 = Mock(spec=Dependency1)
    mock_dependency2 = Mock(spec=Dependency2)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∫–æ–≤
    mock_dependency1.method.return_value = expected_value
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–ª–∞–≥–æ–≤ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
    with patch('config.unified_config.get') as mock_config:
        mock_config.return_value = {
            'NEXY_FEATURE_XXX': True,
            'NEXY_KS_XXX': False
        }
        
        # ===== ACT (–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ) =====
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
        test_object = TestedClass(mock_dependency1, mock_dependency2)
        
        # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
        result = test_object.method_under_test()
        
        # ===== ASSERT (–ü—Ä–æ–≤–µ—Ä–∫–∞) =====
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        assert result == expected_result
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
        mock_dependency1.method.assert_called_once()
        
    # ===== TEARDOWN (–û—á–∏—Å—Ç–∫–∞) =====
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ pytest fixtures
```

### 5.3 –®–∞–±–ª–æ–Ω –ø–æ–∏—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

```python
"""
–®–∞–±–ª–æ–Ω –ø–æ–∏—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
"""

# –®–∞–≥ 1: –ü–æ–∏—Å–∫ –ø–æ —Ç–æ—á–Ω–æ–º—É –∏–º–µ–Ω–∏
# grep -r "[–∏–º—è_—Ñ—É–Ω–∫—Ü–∏–∏]" client/

# –®–∞–≥ 2: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
# codebase_search "How to [–æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏]?"

# –®–∞–≥ 3: –ü–æ–∏—Å–∫ –≤ —É—Ç–∏–ª–∏—Ç–∞—Ö
# from modules.[module_name].utils import [utils_module]
# dir([utils_module])

# –®–∞–≥ 4: –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
# from modules.[module_name].utils.[utils_module] import [function_name]
# result = [function_name](args)

# –®–∞–≥ 5: –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ
# def [function_name](args):
#     """[–û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏]"""
#     pass
```

### 5.4 –®–∞–±–ª–æ–Ω –ø–æ–∏—Å–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–ª–∞–≥–æ–≤

```python
"""
–®–∞–±–ª–æ–Ω –ø–æ–∏—Å–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–ª–∞–≥–æ–≤
"""

# –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–µ—Å—Ç—Ä —Ñ–ª–∞–≥–æ–≤
# cat Docs/FEATURE_FLAGS.md

# –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# grep -r "[FLAG_NAME]" config/unified_config.yaml

# –®–∞–≥ 3: –ù–∞–π—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ
# grep -r "[FLAG_NAME]" client/

# –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–µ
# with patch('config.unified_config.get') as mock_config:
#     mock_config.return_value = {
#         '[FLAG_NAME]': True/False
#     }
#     # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `.cursorrules` (—Ä–∞–∑–¥–µ–ª 10.2) ‚Äî –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- `.cursorrules` (—Ä–∞–∑–¥–µ–ª 10.2.1) ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- `.cursorrules` (—Ä–∞–∑–¥–µ–ª 6.1) ‚Äî Feature Flags –∏ Kill-Switches
- `Docs/FEATURE_FLAGS.md` ‚Äî —Ä–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö feature flags/kill-switches
- `Docs/DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤—ã—è–≤–ª–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º
- `Docs/CODE_CHANGE_VALIDATION_RULES.md` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞

---

## ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–∏—Å–∫–∞

```bash
# –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏
grep -r "function_name" client/

# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
codebase_search "How to check if device is bluetooth?"

# –ü–æ–∏—Å–∫ —Ñ–ª–∞–≥–æ–≤
grep -r "NEXY_FEATURE" config/unified_config.yaml
grep -r "NEXY_KS" config/unified_config.yaml

# –ü–æ–∏—Å–∫ –≤ —É—Ç–∏–ª–∏—Ç–∞—Ö
ls modules/*/utils/
grep -r "device_utils\|audio_utils" modules/
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞ (AAA)

```python
def test_example():
    # ARRANGE: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–º–æ–∫–∏, —Ñ–ª–∞–≥–∏, –¥–∞–Ω–Ω—ã–µ)
    # ACT: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏)
    # ASSERT: –ü—Ä–æ–≤–µ—Ä–∫–∞ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã)
```

### –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º

1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≥–∏–ø–æ—Ç–µ–∑–∞
2. –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
3. –ù–∞–π–¥–µ–Ω—ã —Ñ–ª–∞–≥–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
4. –°–æ–∑–¥–∞–Ω –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç
5. –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

---

**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-01-XX
