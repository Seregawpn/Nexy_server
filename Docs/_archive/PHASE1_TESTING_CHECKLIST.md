# –ß–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –§–∞–∑—ã 1: –£–ø—Ä–æ—â–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-03  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
**Feature Flag:** `device_switch_v2.enabled: true` (–≤–∫–ª—é—á–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

---

## ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ feature flag

**–§–∞–π–ª:** `config/unified_config.yaml`

```yaml
features:
  device_switch_v2:
    enabled: true   # ‚úÖ –í–ö–õ–Æ–ß–ï–ù–û –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø
    rollout_percentage: 100
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] Feature flag —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `enabled: true`
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞

---

## üîç –¢–µ—Å—Ç—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ (–±–µ–∑ SwitchAudioSource)

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º feature flag –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —á–µ—Ä–µ–∑ `sd.default.device`.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `python client/main.py`
2. –î–æ–∂–¥–∞—Ç—å—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–∫ `[V2]`

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ):**
```
‚úÖ [OUTPUT][V2] –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç PortAudio: name="MacBook Air Speakers", id=0, BT=False
‚úÖ [INPUT][V2] –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç PortAudio: name="MacBook Air Microphone", id=0, BT=False
üîç [OUTPUT][V2] –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç PortAudio –Ω–∞–ø—Ä—è–º—É—é
üîç [INPUT][V2] –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç PortAudio –Ω–∞–ø—Ä—è–º—É—é
```

**–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- ‚ùå –õ–æ–≥–æ–≤ `[LEGACY] –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É —á–µ—Ä–µ–∑ SwitchAudioSource`
- ‚ùå –í—ã–∑–æ–≤–æ–≤ `SwitchAudioSource` (–∫—Ä–æ–º–µ fallback –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
- ‚ùå –õ–æ–≥–æ–≤ `‚úÖ [OUTPUT] macOS default (—á–µ—Ä–µ–∑ SwitchAudioSource)`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] –í –ª–æ–≥–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç–∫–∏ `[V2]`
- [ ] –ù–µ—Ç –ª–æ–≥–æ–≤ `[LEGACY]`
- [ ] –ù–µ—Ç –≤—ã–∑–æ–≤–æ–≤ `SwitchAudioSource` –∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—É—Ç–∏

---

### –¢–µ—Å—Ç 2: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–æ–±—ã—á–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –¥–µ—Ñ–æ–ª—Ç–∞.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞—É–¥–∏–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, welcome message)
3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤—ã–≤–æ–¥–∞ –≤ System Preferences ‚Üí Sound
4. –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
üîî [OUTPUT] –°–º–µ–Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: "MacBook Air Speakers" ‚Üí "USB Headphones" (source: polling)
üîÑ [OUTPUT][seq=1] –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ AudioStreamManager
‚úÖ [OUTPUT][seq=1] close_stream –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ
üîç [OUTPUT][seq=1] –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ —á–µ—Ä–µ–∑ AudioStreamManager.create_stream
‚úÖ [OUTPUT] –ê—É–¥–∏–æ –ø–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ PortAudio (-9986, -10851)
- [ ] –ê—É–¥–∏–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è –Ω–∞ –Ω–æ–≤–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- [ ] –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –≤—ã–∑–æ–≤–æ–≤ SwitchAudioSource

---

### –¢–µ—Å—Ç 3: –†–∞–±–æ—Ç–∞ —Å Bluetooth —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (AirPods)

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å AirPods (–∏–ª–∏ –¥—Ä—É–≥–æ–µ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω–æ–µ default output
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
4. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞—É–¥–∏–æ

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
‚úÖ [OUTPUT][V2] –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç PortAudio: name="Sergiy's AirPods", id=None, BT=True
üí° [OUTPUT] BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: –∏—Å–ø–æ–ª—å–∑—É–µ–º device=None (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º PortAudio ID)
‚úÖ [OUTPUT] –ê—É–¥–∏–æ –ø–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (`is_bluetooth=True`)
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `device_id=None` –¥–ª—è BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- [ ] –ê—É–¥–∏–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞ BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ PortAudio

---

### –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ device_name

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç `device_name="None"` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ï—Å–ª–∏ `device_name` —Ä–∞–≤–µ–Ω `None` –∏–ª–∏ —Å—Ç—Ä–æ–∫–µ `"None"`, —Å–æ–±—ã—Ç–∏–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
  ```
  ‚ö†Ô∏è [PLAYBACK] –°–æ–±—ã—Ç–∏–µ —Å–º–µ–Ω—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–µ device_name: None. –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ.
  ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] –°–æ–±—ã—Ç–∏—è —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º `device_name` –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
- [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –¢–µ—Å—Ç 5: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ polling loop

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ `device_id`.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ):**
```
üîç [OUTPUT][V2] –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç PortAudio –Ω–∞–ø—Ä—è–º—É—é
‚úÖ [OUTPUT][V2] –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç PortAudio: name="Device A", id=1, BT=False
# ... —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å ...
# (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–±—ã—Ç–∏—è —Å–º–µ–Ω—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –µ—Å–ª–∏ device_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç)
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ `device_id`, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ –∏–º–µ–Ω–∏
- [ ] –ù–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º `device_id`
- [ ] –°–æ–±—ã—Ç–∏—è —Å–º–µ–Ω—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏

---

## üìä –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ª–æ–≥–∞—Ö (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ):

- [ ] –ú–µ—Ç–∫–∏ `[V2]` –≤ –ª–æ–≥–∞—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- [ ] –õ–æ–≥–∏ `‚úÖ [OUTPUT][V2] –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç PortAudio: name="...", id=..., BT=...`
- [ ] –õ–æ–≥–∏ `‚úÖ [INPUT][V2] –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç PortAudio: name="...", id=..., BT=...`
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ `device_id` (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ)

### –ß–µ–≥–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ª–æ–≥–∞—Ö (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ):

- [ ] –õ–æ–≥–æ–≤ `[LEGACY] –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É —á–µ—Ä–µ–∑ SwitchAudioSource`
- [ ] –í—ã–∑–æ–≤–æ–≤ `SwitchAudioSource` –∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—É—Ç–∏
- [ ] –õ–æ–≥–æ–≤ `‚úÖ [OUTPUT] macOS default (—á–µ—Ä–µ–∑ SwitchAudioSource)` (–∫—Ä–æ–º–µ fallback –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
- [ ] –û—à–∏–±–æ–∫ `SwitchAudioSource –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ PATH` (–µ—Å–ª–∏ –æ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: `device_name` –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∫ `"None"` –≤ —Å–æ–±—ã—Ç–∏–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `üîÑ [PLAYBACK] –°–æ–±—ã—Ç–∏–µ —Å–º–µ–Ω—ã OUTPUT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: "..." ‚Üí "None" (ID: None, BT=False)`
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –≤ `speech_playback_integration.py` (—Å—Ç—Ä–æ–∫–∏ 824-831)
- –°–æ–±—ã—Ç–∏—è —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º `device_name` —Ç–µ–ø–µ—Ä—å –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –°–æ–±—ã—Ç–∏—è —Å `device_name="None"` –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
- [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∏ PortAudio (-9986, -10851) –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `Error opening OutputStream: Internal PortAudio error [PaErrorCode -9986]`
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ —É–¥–∞–µ—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Ç–æ–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `_switch_output_device`)
- ‚úÖ Fallback –ª–æ–≥–∏–∫–∞ –¥–ª—è PortAudio –æ—à–∏–±–æ–∫ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `AudioStreamManager`)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –°—Ç–∞—Ä—ã–π –ø–æ—Ç–æ–∫ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
- [ ] Fallback –ª–æ–≥–∏–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö PortAudio
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìù –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** _______________

**–¢–µ—Å—Ç 1 (–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞):**
- [ ] –ü–†–û–ô–î–ï–ù
- [ ] –ü–†–û–í–ê–õ–ï–ù
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:** _________________________________

**–¢–µ—Å—Ç 2 (–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤):**
- [ ] –ü–†–û–ô–î–ï–ù
- [ ] –ü–†–û–í–ê–õ–ï–ù
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:** _________________________________

**–¢–µ—Å—Ç 3 (BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞):**
- [ ] –ü–†–û–ô–î–ï–ù
- [ ] –ü–†–û–í–ê–õ–ï–ù
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:** _________________________________

**–¢–µ—Å—Ç 4 (–ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ device_name):**
- [ ] –ü–†–û–ô–î–ï–ù
- [ ] –ü–†–û–í–ê–õ–ï–ù
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:** _________________________________

**–¢–µ—Å—Ç 5 (–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤):**
- [ ] –ü–†–û–ô–î–ï–ù
- [ ] –ü–†–û–í–ê–õ–ï–ù
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:** _________________________________

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –§–∞–∑—ã 1

- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ SwitchAudioSource (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ)
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- [ ] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–æ–π
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
- [ ] –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ (fallback)

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã:**
   - –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü–µ—Ä–µ–π—Ç–∏ –∫ –§–∞–∑–µ 2 (CoreAudioDeviceManager)

2. **–ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:**
   - –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ –§–∞–∑–µ 2
   - –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å feature flag
python -c "from config.unified_config_loader import unified_config; config = unified_config._load_config(); print(config.get('features', {}).get('device_switch_v2', {}))"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
python client/main.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–∫ [V2]
grep -E "\[V2\]|\[LEGACY\]" log.md

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–∑–æ–≤—ã SwitchAudioSource
grep -E "SwitchAudioSource|macOS default.*—á–µ—Ä–µ–∑ SwitchAudioSource" log.md
```




