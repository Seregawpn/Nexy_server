# Ğ¡Ñ…ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ°ÑƒĞ´Ğ¸Ğ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Nexy

## Ğ”Ğ°Ñ‚Ğ°: 2025-12-09

## ĞĞ±Ñ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        VoiceRecognitionIntegration                        â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ (__init__)                        â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° feature flags (AVF, SFSpeech)                        â”‚  â”‚
â”‚  â”‚  2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ AVFAudioEngine                                       â”‚  â”‚
â”‚  â”‚  3. ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ SFSpeechRecognizerWrapper               â”‚  â”‚
â”‚  â”‚     â””â”€â–º _ensure_streaming_ready(context="initialize")            â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Ğ—ĞĞŸĞ˜Ğ¡Ğ¬ (_on_recording_start)                          â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  Event: voice.recording_start{session_id}                          â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° first_run (Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° ĞµÑĞ»Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½)                  â”‚  â”‚
â”‚  â”‚  2. _set_session_id(session_id)                                    â”‚  â”‚
â”‚  â”‚  3. _ensure_streaming_ready(context="recording_start")            â”‚  â”‚
â”‚  â”‚  4. _clear_audio_buffer()                                         â”‚  â”‚
â”‚  â”‚  5. _start_streaming_session(session_id) [ĞµÑĞ»Ğ¸ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½]  â”‚  â”‚
â”‚  â”‚     â”œâ”€â–º SFSpeechRecognizerWrapper.start_recognition()              â”‚  â”‚
â”‚  â”‚     â””â”€â–º Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ĞºĞ¾Ğ»Ğ»Ğ±ĞµĞºĞ¾Ğ² (on_result, on_error)                 â”‚  â”‚
â”‚  â”‚  6. AVFAudioEngine.start_input(callback=audio_callback)            â”‚  â”‚
â”‚  â”‚  7. ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: microphone.opened{session_id}                     â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         ĞŸĞĞ¢ĞĞš ĞĞ£Ğ”Ğ˜Ğ (audio_callback - Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ AVF)             â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ‡Ğ°Ğ½ĞºĞ° Ğ°ÑƒĞ´Ğ¸Ğ¾:                              â”‚  â”‚
â”‚  â”‚  audio_callback(data: bytes, sample_rate: int, channels: int)     â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: _is_streaming_session_live(session_id)            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                        â”‚                                            â”‚  â”‚
â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚  â”‚
â”‚  â”‚        â”‚                               â”‚                           â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                    â”‚  â”‚
â”‚  â”‚   â”‚ Ğ¡Ğ¢Ğ Ğ˜ĞœĞ˜ĞĞ“â”‚                    â”‚   BATCH   â”‚                    â”‚  â”‚
â”‚  â”‚   â”‚         â”‚                    â”‚           â”‚                    â”‚  â”‚
â”‚  â”‚   â”‚ sf_recognizer                â”‚ _audio_buffer                 â”‚  â”‚
â”‚  â”‚   â”‚ .append_audio(data)         â”‚ .append(data)                 â”‚  â”‚
â”‚  â”‚   â”‚                             â”‚ _audio_buffer_bytes += len   â”‚  â”‚
â”‚  â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                             â”‚  â”‚
â”‚  â”‚   â”‚ â”‚ SFSpeechRecognizer      â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚   â”‚ â”‚ (macOS native)          â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚   â”‚ â”‚                         â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚   â”‚ â”‚ on_result(text, final)  â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚   â”‚ â”‚ â””â”€â–º _streaming_partial_ â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚   â”‚ â”‚     result = text       â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                             â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            ĞĞ¡Ğ¢ĞĞĞĞ’ĞšĞ (_on_recording_stop)                          â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  Event: voice.recording_stop{session_id}                           â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° session_id (Ğ¸Ğ³Ğ½Ğ¾Ñ€ ĞµÑĞ»Ğ¸ Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚)                â”‚  â”‚
â”‚  â”‚  2. AVFAudioEngine.stop_input()                                    â”‚  â”‚
â”‚  â”‚  3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: _is_streaming_session_live(session_id)              â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Ğ’Ğ•Ğ¢ĞšĞ 1: Ğ¡Ğ¢Ğ Ğ˜ĞœĞ˜ĞĞ“ (ĞµÑĞ»Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½)                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  sf_recognizer.finish_recognition(timeout)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€â–º ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ° (~0-200ms)             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€â–º Ğ•ÑĞ»Ğ¸ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ _streaming_partial_result      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â–º ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: voice.recognition_completed{                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                  session_id, text, source="sf_speech_streaming"}â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑĞµÑÑĞ¸Ğ¸:                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - _streaming_session_active = False                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - _streaming_session_id = None                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - _streaming_partial_result = None                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Ğ’Ğ•Ğ¢ĞšĞ 2: BATCH (ĞµÑĞ»Ğ¸ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½)                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  _recognize_avf_audio(                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    total_audio, sample_rate, channels, session_id           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  )                                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  1. ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ bytes â†’ numpy int16                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  2. Ğ ĞµÑĞµĞ¼Ğ¿Ğ»Ğ¸Ğ½Ğ³ 48kHz â†’ 16kHz (Ğ´Ğ»Ñ Google Speech API)        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ WAV (ĞµÑĞ»Ğ¸ NEXY_DEBUG_SAVE_AUDIO=true)         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  4. SpeechRecognition.recognize_google()                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  5. ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: voice.recognition_completed/failed          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  finally:                                                          â”‚  â”‚
â”‚  â”‚  - _clear_audio_buffer()                                          â”‚  â”‚
â”‚  â”‚  - _recording_start_time = None                                  â”‚  â”‚
â”‚  â”‚  - state_manager.set_microphone_state("idle")                   â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 1. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _ensure_streaming_ready(context)                            â”‚
â”‚                                                               â”‚
â”‚  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹:                                         â”‚
â”‚     - _streaming_feature_enabled?                            â”‚
â”‚     - !_streaming_env_disabled?                             â”‚
â”‚     - _use_avf?                                              â”‚
â”‚     - _SF_SPEECH_AVAILABLE?                                  â”‚
â”‚                                                               â”‚
â”‚  2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ recognizer:                       â”‚
â”‚     - Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ¸ state == IDLE â†’ reuse                     â”‚
â”‚                                                               â”‚
â”‚  3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° retry-Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€Ğ°:                                  â”‚
â”‚     - Ğ•ÑĞ»Ğ¸ now < _streaming_retry_after â†’ skip              â”‚
â”‚                                                               â”‚
â”‚  4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ SFSpeechRecognizerWrapper:             â”‚
â”‚     - language = _streaming_language                         â”‚
â”‚     - on_device = _streaming_on_device                       â”‚
â”‚                                                               â”‚
â”‚  5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸:                                    â”‚
â”‚     - await recognizer.is_available()                        â”‚
â”‚     - Ğ•ÑĞ»Ğ¸ False â†’ _disable_streaming() + retry timer       â”‚
â”‚                                                               â”‚
â”‚  6. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ recognizer:                                   â”‚
â”‚     - self._sf_recognizer = recognizer                       â”‚
â”‚     - self._use_streaming = True                            â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Ğ—Ğ°Ğ¿ÑƒÑĞº ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ¾Ğ²Ğ¾Ğ¹ ÑĞµÑÑĞ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _start_streaming_session(session_id)                       â”‚
â”‚                                                               â”‚
â”‚  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: _is_streaming_active()?                       â”‚
â”‚                                                               â”‚
â”‚  2. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ»Ğ»Ğ±ĞµĞºĞ¾Ğ²:                                  â”‚
â”‚     on_streaming_result(text, is_final):                     â”‚
â”‚       - _streaming_partial_result = text                    â”‚
â”‚       - Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (final/intermediate)                     â”‚
â”‚                                                               â”‚
â”‚     on_streaming_error(error_msg):                          â”‚
â”‚       - _handle_streaming_failure()                         â”‚
â”‚       - ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ° (disable=True)                 â”‚
â”‚                                                               â”‚
â”‚  3. Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ:                                    â”‚
â”‚     await recognizer.start_recognition(                      â”‚
â”‚       on_result=on_streaming_result,                         â”‚
â”‚       on_error=on_streaming_error,                           â”‚
â”‚       sample_rate=_streaming_sample_rate                    â”‚
â”‚     )                                                        â”‚
â”‚                                                               â”‚
â”‚  4. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ„Ğ»Ğ°Ğ³Ğ¾Ğ² ÑĞµÑÑĞ¸Ğ¸:                                 â”‚
â”‚     - _streaming_session_id = session_id                    â”‚
â”‚     - _streaming_session_active = True                      â”‚
â”‚     - _streaming_partial_result = None                      â”‚
â”‚     - _streaming_error = None                               â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ°ÑƒĞ´Ğ¸Ğ¾ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² (real-time)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  audio_callback(data, sample_rate, channels)                â”‚
â”‚  [Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ AVFAudioEngine Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ‡Ğ°Ğ½ĞºĞ°]              â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ñ‡Ğ°Ğ½Ğº:                                        â”‚   â”‚
â”‚  â”‚  - Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ sample_rate/channels                  â”‚   â”‚
â”‚  â”‚  - Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸Ğº (min/max/mean/std)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: _is_streaming_session_live(session_id)?  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚        â”‚                       â”‚                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚  TRUE   â”‚          â”‚    FALSE     â”‚                    â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚        â”‚                       â”‚                            â”‚
â”‚        â”‚                       â”‚                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚  sf_recognizer.append_audio(data)  â”‚                   â”‚
â”‚   â”‚                                     â”‚                   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚
â”‚   â”‚  â”‚  SFSpeechRecognizer           â”‚ â”‚                   â”‚
â”‚   â”‚  â”‚  (macOS native streaming)    â”‚ â”‚                   â”‚
â”‚   â”‚  â”‚                               â”‚ â”‚                   â”‚
â”‚   â”‚  â”‚  â†’ on_result(text, is_final)  â”‚ â”‚                   â”‚
â”‚   â”‚  â”‚    Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸   â”‚ â”‚                   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚
â”‚   â”‚                                     â”‚                   â”‚
â”‚   â”‚  Ğ•ÑĞ»Ğ¸ append_audio() failed:        â”‚                   â”‚
â”‚   â”‚  - _handle_streaming_failure()     â”‚                   â”‚
â”‚   â”‚  - ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ½Ğ° batch                 â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FALLBACK (ĞµÑĞ»Ğ¸ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ Ğ¸Ğ»Ğ¸ failed):    â”‚   â”‚
â”‚  â”‚  - _audio_buffer.append(data)                       â”‚   â”‚
â”‚  â”‚  - _audio_buffer_bytes += len(data)                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _on_recording_stop(event)                                  â”‚
â”‚                                                               â”‚
â”‚  1. AVFAudioEngine.stop_input()                             â”‚
â”‚     â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: frames_recorded, duration_ms â”‚
â”‚                                                               â”‚
â”‚  2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: _is_streaming_session_live(session_id)?       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Ğ’Ğ•Ğ¢ĞšĞ A: Ğ¡Ğ¢Ğ Ğ˜ĞœĞ˜ĞĞ“                                    â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  await sf_recognizer.finish_recognition(timeout)     â”‚   â”‚
â”‚  â”‚  â”œâ”€â–º ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°                 â”‚   â”‚
â”‚  â”‚  â”‚   (Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾, ~0-200ms)                     â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â–º Ğ•ÑĞ»Ğ¸ final_text Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹:                         â”‚   â”‚
â”‚  â”‚  â”‚   final_text = _streaming_partial_result          â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚  â””â”€â–º ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°:                          â”‚   â”‚
â”‚  â”‚      voice.recognition_completed{                    â”‚   â”‚
â”‚  â”‚        session_id,                                    â”‚   â”‚
â”‚  â”‚        text=final_text,                               â”‚   â”‚
â”‚  â”‚        source="sf_speech_streaming"                  â”‚   â”‚
â”‚  â”‚      }                                                â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑĞµÑÑĞ¸Ğ¸:                                      â”‚   â”‚
â”‚  â”‚  - _streaming_session_active = False                 â”‚   â”‚
â”‚  â”‚  - _streaming_session_id = None                      â”‚   â”‚
â”‚  â”‚  - _streaming_partial_result = None                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Ğ’Ğ•Ğ¢ĞšĞ B: BATCH (fallback)                            â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğ±ÑƒÑ„ĞµÑ€Ğ°:                                 â”‚   â”‚
â”‚  â”‚  total_audio = b''.join(_audio_buffer)               â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  await _recognize_avf_audio(                         â”‚   â”‚
â”‚  â”‚    total_audio, sample_rate, channels, session_id     â”‚   â”‚
â”‚  â”‚  )                                                    â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  1. ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ bytes â†’ numpy int16                 â”‚   â”‚
â”‚  â”‚  2. Ğ ĞµÑĞµĞ¼Ğ¿Ğ»Ğ¸Ğ½Ğ³ 48kHz â†’ 16kHz (scipy.signal.resample)â”‚   â”‚
â”‚  â”‚  3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ WAV (ĞµÑĞ»Ğ¸ NEXY_DEBUG_SAVE_AUDIO=true) â”‚   â”‚
â”‚  â”‚  4. SpeechRecognition.recognize_google()            â”‚   â”‚
â”‚  â”‚  5. ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: voice.recognition_completed/failed   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  finally:                                                    â”‚
â”‚  - _clear_audio_buffer()                                    â”‚
â”‚  - _recording_start_time = None                            â”‚
â”‚  - state_manager.set_microphone_state("idle")             â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ¯ Ğ¡Ğ¢Ğ Ğ˜ĞœĞ˜ĞĞ“Ğ                      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IDLE (Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ)                          â”‚   â”‚
â”‚  â”‚  - _use_streaming = False                           â”‚   â”‚
â”‚  â”‚  - _sf_recognizer = None                            â”‚   â”‚
â”‚  â”‚  - _streaming_session_active = False                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                          â”‚
â”‚                    â”‚ _ensure_streaming_ready()               â”‚
â”‚                    â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  READY (recognizer Ğ³Ğ¾Ñ‚Ğ¾Ğ²)                            â”‚   â”‚
â”‚  â”‚  - _use_streaming = True                             â”‚   â”‚
â”‚  â”‚  - _sf_recognizer != None                            â”‚   â”‚
â”‚  â”‚  - _streaming_session_active = False                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                          â”‚
â”‚                    â”‚ _start_streaming_session()              â”‚
â”‚                    â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ACTIVE (ÑĞµÑÑĞ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°)                              â”‚   â”‚
â”‚  â”‚  - _use_streaming = True                              â”‚   â”‚
â”‚  â”‚  - _sf_recognizer != None                             â”‚   â”‚
â”‚  â”‚  - _streaming_session_active = True                   â”‚   â”‚
â”‚  â”‚  - _streaming_session_id = <session_id>              â”‚   â”‚
â”‚  â”‚  - Ğ§Ğ°Ğ½ĞºĞ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ² append_audio()                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                          â”‚
â”‚                    â”‚ finish_recognition() Ğ¸Ğ»Ğ¸ error           â”‚
â”‚                    â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FINISHED (ÑĞµÑÑĞ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°)                          â”‚   â”‚
â”‚  â”‚  - _streaming_session_active = False                  â”‚   â”‚
â”‚  â”‚  - _streaming_session_id = None                      â”‚   â”‚
â”‚  â”‚  - Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ² READY Ğ¸Ğ»Ğ¸ IDLE                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DISABLED (Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸)                      â”‚   â”‚
â”‚  â”‚  - _use_streaming = False                             â”‚   â”‚
â”‚  â”‚  - _sf_recognizer = None                              â”‚   â”‚
â”‚  â”‚  - _streaming_retry_after = <future_time>             â”‚   â”‚
â”‚  â”‚  - ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· _streaming_retry_interval  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ EventBus

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ¯ EVENTBUS                          â”‚
â”‚                                                               â”‚
â”‚  Ğ’Ğ¥ĞĞ”Ğ¯Ğ©Ğ˜Ğ•:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  voice.recording_start{session_id}                    â”‚   â”‚
â”‚  â”‚  â””â”€â–º _on_recording_start()                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  voice.recording_stop{session_id}                     â”‚   â”‚
â”‚  â”‚  â””â”€â–º _on_recording_stop()                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  Ğ˜Ğ¡Ğ¥ĞĞ”Ğ¯Ğ©Ğ˜Ğ•:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  microphone.opened{session_id}                        â”‚   â”‚
â”‚  â”‚  â””â”€â–º ĞŸĞ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ start_input()                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  voice.recognition_completed{                         â”‚   â”‚
â”‚  â”‚    session_id,                                         â”‚   â”‚
â”‚  â”‚    text,                                               â”‚   â”‚
â”‚  â”‚    source="sf_speech_streaming" | "avf_recognition"   â”‚   â”‚
â”‚  â”‚  }                                                     â”‚   â”‚
â”‚  â”‚  â””â”€â–º ĞŸĞ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  voice.recognition_failed{                             â”‚   â”‚
â”‚  â”‚    session_id,                                          â”‚   â”‚
â”‚  â”‚    error,                                               â”‚   â”‚
â”‚  â”‚    source="sf_speech_streaming" | "avf_recognition"    â”‚   â”‚
â”‚  â”‚  }                                                      â”‚   â”‚
â”‚  â”‚  â””â”€â–º ĞŸÑ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ¢ĞĞ§ĞšĞ˜ ĞĞ¢ĞšĞĞ—Ğ Ğ˜ ĞĞ¨Ğ˜Ğ‘ĞšĞ˜

### ĞšĞ°Ñ€Ñ‚Ğ° Ñ‚Ğ¾Ñ‡ĞµĞº Ğ¾Ñ‚ĞºĞ°Ğ·Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ĞšĞĞ Ğ¢Ğ Ğ¢ĞĞ§Ğ•Ğš ĞĞ¢ĞšĞĞ—Ğ                                   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Ğ¢ĞĞ§ĞšĞ 1: Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ Ğ¡Ğ¢Ğ Ğ˜ĞœĞ˜ĞĞ“Ğ                                â”‚  â”‚
â”‚  â”‚  _ensure_streaming_ready()                                        â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ˜:                                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º Feature flag Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½: _streaming_feature_enabled = False â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º Env Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ: NEXY_DISABLE_STREAMING_RECOGNITION=true    â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º AVF Ğ½Ğµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½: _use_avf = False                           â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½: _SF_SPEECH_AVAILABLE = False            â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º Retry Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½: now < _streaming_retry_after         â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º is_available() = False: Ğ½ĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ macOS               â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: Speech Recognition Ğ½Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½ Ğ² System Prefs â”‚  â”‚
â”‚  â”‚  â””â”€â–º Exception Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸: ImportError, RuntimeError          â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  ğŸ”„ Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ•:                                                     â”‚  â”‚
â”‚  â”‚  â””â”€â–º _disable_streaming() + retry Ñ‡ĞµÑ€ĞµĞ· 60 ÑĞµĞº                  â”‚  â”‚
â”‚  â”‚  â””â”€â–º Fallback Ğ½Ğ° batch Ñ€ĞµĞ¶Ğ¸Ğ¼                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Ğ¢ĞĞ§ĞšĞ 2: Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ¡Ğ¢Ğ Ğ˜ĞœĞ˜ĞĞ“ĞĞ’ĞĞ™ Ğ¡Ğ•Ğ¡Ğ¡Ğ˜Ğ˜                            â”‚  â”‚
â”‚  â”‚  _start_streaming_session()                                      â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ˜:                                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º _is_streaming_active() = False                             â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º _sf_recognizer = None                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º start_recognition() Ğ²ĞµÑ€Ğ½ÑƒĞ» False                           â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: SFSpeechRecognizer Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ  â”‚  â”‚
â”‚  â”‚  â””â”€â–º Exception Ğ² start_recognition()                            â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  ğŸ”„ Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ•:                                                     â”‚  â”‚
â”‚  â”‚  â””â”€â–º _handle_streaming_failure(disable=True)                     â”‚  â”‚
â”‚  â”‚  â””â”€â–º Fallback Ğ½Ğ° batch Ñ€ĞµĞ¶Ğ¸Ğ¼                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Ğ¢ĞĞ§ĞšĞ 3: ĞĞ¢ĞŸĞ ĞĞ’ĞšĞ ĞĞ£Ğ”Ğ˜Ğ Ğ§ĞĞĞšĞĞ’                                  â”‚  â”‚
â”‚  â”‚  audio_callback() â†’ append_audio()                               â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ˜:                                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º _is_streaming_session_live() = False                       â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º Ğ¡ĞµÑÑĞ¸Ñ Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ° Ğ¸Ğ»Ğ¸ session_id Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚           â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º append_audio() Ğ²ĞµÑ€Ğ½ÑƒĞ» False                                â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: SFSpeechRecognizer Ğ² Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¼ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸     â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: Recognition request Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½         â”‚  â”‚
â”‚  â”‚  â””â”€â–º Exception Ğ² append_audio()                                 â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  ğŸ”„ Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ•:                                                     â”‚  â”‚
â”‚  â”‚  â””â”€â–º _handle_streaming_failure(disable=True)                     â”‚  â”‚
â”‚  â”‚  â””â”€â–º ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ½Ğ° batch: _audio_buffer.append(data)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Ğ¢ĞĞ§ĞšĞ 4: Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ˜Ğ• Ğ¡Ğ¢Ğ Ğ˜ĞœĞ˜ĞĞ“Ğ                                    â”‚  â”‚
â”‚  â”‚  finish_recognition()                                              â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ˜:                                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º _is_streaming_session_live() = False                       â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º Ğ¡ĞµÑÑĞ¸Ñ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°                 â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º finish_recognition() Ğ²ĞµÑ€Ğ½ÑƒĞ» Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚                 â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º Fallback Ğ½Ğ° _streaming_partial_result                    â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º Timeout Ğ¿Ñ€Ğ¸ finish_recognition()                            â”‚  â”‚
â”‚  â”‚  â””â”€â–º Exception Ğ² finish_recognition()                            â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  ğŸ”„ Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ•:                                                     â”‚  â”‚
â”‚  â”‚  â””â”€â–º ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ voice.recognition_failed                          â”‚  â”‚
â”‚  â”‚  â””â”€â–º ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑĞµÑÑĞ¸Ğ¸ Ğ² finally Ğ±Ğ»Ğ¾ĞºĞµ                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Ğ¢ĞĞ§ĞšĞ 5: BATCH Ğ ĞĞ¡ĞŸĞĞ—ĞĞĞ’ĞĞĞ˜Ğ• (fallback)                         â”‚  â”‚
â”‚  â”‚  _recognize_avf_audio()                                           â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ˜:                                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º speech_recognition Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½                         â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: voice.recognition_failed                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ±ÑƒÑ„ĞµÑ€: len(audio_data) == 0                   â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: voice.recognition_failed                     â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º ĞÑƒĞ´Ğ¸Ğ¾ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğµ: duration < 0.5s                     â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ warning, Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º scipy Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ´Ğ»Ñ Ñ€ĞµÑĞµĞ¼Ğ¿Ğ»Ğ¸Ğ½Ğ³Ğ°                            â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º Fallback Ğ½Ğ° Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğµ ÑƒÑÑ€ĞµĞ´Ğ½ĞµĞ½Ğ¸Ğµ (ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ…ÑƒĞ¶Ğµ)          â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º UnknownValueError Ğ¾Ñ‚ Google Speech API                       â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: Ñ‚Ğ¸ÑˆĞ¸Ğ½Ğ°, Ğ½ĞµÑ€Ğ°Ğ·Ğ±Ğ¾Ñ€Ñ‡Ğ¸Ğ²Ğ°Ñ Ñ€ĞµÑ‡ÑŒ, Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº  â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: voice.recognition_failed                     â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º RequestError Ğ¾Ñ‚ Google Speech API                           â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: Ğ½ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ğ°, Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ API                  â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â–º ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: voice.recognition_failed                     â”‚  â”‚
â”‚  â”‚  â””â”€â–º Exception Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ Ğ°ÑƒĞ´Ğ¸Ğ¾                               â”‚  â”‚
â”‚  â”‚     â””â”€â–º ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: voice.recognition_failed                      â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  ğŸ”„ Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ•:                                                     â”‚  â”‚
â”‚  â”‚  â””â”€â–º Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ÑÑ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ (completed Ğ¸Ğ»Ğ¸ failed)           â”‚  â”‚
â”‚  â”‚  â””â”€â–º ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ±ÑƒÑ„ĞµÑ€Ğ° Ğ² finally Ğ±Ğ»Ğ¾ĞºĞµ                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

#### 1. **ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _ensure_streaming_ready() â†’ False                          â”‚
â”‚                                                               â”‚
â”‚  ĞŸĞ Ğ˜Ğ§Ğ˜ĞĞ«:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Feature flag Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½                             â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "â„¹ï¸ [SFSpeech] Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½: feature flag disabled"â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ² unified_config.yaml          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. Env Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ°                          â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "â„¹ï¸ [SFSpeech] Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½: env variable disabled"â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ NEXY_DISABLE_STREAMING_RECOGNITIONâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. is_available() = False                            â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âš ï¸ [SFSpeech] ĞĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· 60s"â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹:                                          â”‚   â”‚
â”‚  â”‚     - ĞĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Speech Recognition Ğ² macOS       â”‚   â”‚
â”‚  â”‚     - Ğ¯Ğ·Ñ‹Ğº Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ                         â”‚   â”‚
â”‚  â”‚     - ĞœĞ¾Ğ´ÑƒĞ»ÑŒ pyobjc-framework-Speech Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½    â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ System Preferences â†’ Privacy  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4. Exception Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸                           â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âŒ [SFSpeech] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸: ..."    â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹: ImportError, RuntimeError               â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸, Ğ»Ğ¾Ğ³Ğ¸            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:                                                   â”‚
â”‚  â””â”€â–º Fallback Ğ½Ğ° batch Ñ€ĞµĞ¶Ğ¸Ğ¼ (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸)                â”‚
â”‚  â””â”€â–º Retry Ñ‡ĞµÑ€ĞµĞ· 60 ÑĞµĞºÑƒĞ½Ğ´ (ĞµÑĞ»Ğ¸ is_available() = False)    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. **ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° ÑĞµÑÑĞ¸Ğ¸**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _start_streaming_session() â†’ False                         â”‚
â”‚                                                               â”‚
â”‚  ĞŸĞ Ğ˜Ğ§Ğ˜ĞĞ«:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. _is_streaming_active() = False                   â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: ĞĞµÑ‚ (Ğ¼ĞµÑ‚Ğ¾Ğ´ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ False)         â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: _use_streaming = False Ğ¸Ğ»Ğ¸ recognizer = Noneâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. start_recognition() Ğ²ĞµÑ€Ğ½ÑƒĞ» False                  â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âš ï¸ [SFSpeech] ĞÑˆĞ¸Ğ±ĞºĞ° ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°: start_failed"â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹:                                          â”‚   â”‚
â”‚  â”‚     - SFSpeechRecognizer Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ     â”‚   â”‚
â”‚  â”‚     - Recognition request Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½         â”‚   â”‚
â”‚  â”‚     - Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° macOS                          â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ SFSpeechRecognizerWrapper â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:                                                   â”‚
â”‚  â””â”€â–º _handle_streaming_failure(disable=True)                â”‚
â”‚  â””â”€â–º Fallback Ğ½Ğ° batch Ñ€ĞµĞ¶Ğ¸Ğ¼                                â”‚
â”‚  â””â”€â–º Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½ Ğ´Ğ¾ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¹ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸                â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. **ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ²**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  audio_callback() â†’ append_audio() â†’ False                 â”‚
â”‚                                                               â”‚
â”‚  ĞŸĞ Ğ˜Ğ§Ğ˜ĞĞ«:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. _is_streaming_session_live() = False             â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: ĞĞµÑ‚ (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ½Ğ° batch)        â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹:                                          â”‚   â”‚
â”‚  â”‚     - Ğ¡ĞµÑÑĞ¸Ñ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ° Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ°                        â”‚   â”‚
â”‚  â”‚     - session_id Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚                         â”‚   â”‚
â”‚  â”‚     - Ğ¡ĞµÑÑĞ¸Ñ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. append_audio() Ğ²ĞµÑ€Ğ½ÑƒĞ» False                       â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âš ï¸ [SFSpeech] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ñ‡Ğ°Ğ½ĞºĞ°, Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ½Ğ° batch"â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹:                                          â”‚   â”‚
â”‚  â”‚     - SFSpeechRecognizer Ğ² ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸ != RECOGNIZING   â”‚   â”‚
â”‚  â”‚     - Recognition request Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½         â”‚   â”‚
â”‚  â”‚     - Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° macOS                          â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ recognizer           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:                                                   â”‚
â”‚  â””â”€â–º _handle_streaming_failure(disable=True)                â”‚
â”‚  â””â”€â–º Ğ§Ğ°Ğ½Ğº Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ² _audio_buffer (batch fallback)     â”‚
â”‚  â””â”€â–º Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½ Ğ´Ğ»Ñ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ñ… Ñ‡Ğ°Ğ½ĞºĞ¾Ğ²                â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. **ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  finish_recognition() â†’ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¸Ğ»Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°          â”‚
â”‚                                                               â”‚
â”‚  ĞŸĞ Ğ˜Ğ§Ğ˜ĞĞ«:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚                        â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âš ï¸ [SFSpeech] ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°"   â”‚   â”‚
â”‚  â”‚     Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ _streaming_partial_result  â”‚   â”‚
â”‚  â”‚     Ğ•ÑĞ»Ğ¸ Ğ¸ partial Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ â†’ voice.recognition_failed  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. Timeout Ğ¿Ñ€Ğ¸ finish_recognition()                   â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âŒ [SFSpeech] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°: timeout"â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: SFSpeechRecognizer Ğ½Ğµ Ğ²ĞµÑ€Ğ½ÑƒĞ» Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚   â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ timeout Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğµ              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. Exception Ğ² finish_recognition()                  â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âŒ [SFSpeech] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°: ..."â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹: RuntimeError, ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:                                                   â”‚
â”‚  â””â”€â–º ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ voice.recognition_failed                     â”‚
â”‚  â””â”€â–º ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑĞµÑÑĞ¸Ğ¸ Ğ² finally Ğ±Ğ»Ğ¾ĞºĞµ                         â”‚
â”‚  â””â”€â–º Fallback Ğ½Ğ° batch (ĞµÑĞ»Ğ¸ Ğ±ÑƒÑ„ĞµÑ€ Ğ½Ğµ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹)               â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5. **ĞÑˆĞ¸Ğ±ĞºĞ¸ batch Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _recognize_avf_audio() â†’ voice.recognition_failed          â”‚
â”‚                                                               â”‚
â”‚  ĞŸĞ Ğ˜Ğ§Ğ˜ĞĞ«:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. ĞœĞ¾Ğ´ÑƒĞ»ÑŒ speech_recognition Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½                â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âŒ [AVF] speech_recognition Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½"     â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: pip install SpeechRecognition             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ±ÑƒÑ„ĞµÑ€                                 â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âŒ [AVF] ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ±ÑƒÑ„ĞµÑ€ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸"â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: ĞĞµ Ğ±Ñ‹Ğ»Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾ Ğ°ÑƒĞ´Ğ¸Ğ¾                   â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸ĞºÑ€Ğ¾Ñ„Ğ¾Ğ½ Ğ¸ AVFAudioEngine       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. UnknownValueError Ğ¾Ñ‚ Google Speech API             â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "âš ï¸ [AVF] Google Speech API Ğ½Ğµ ÑĞ¼Ğ¾Ğ³ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ñ‚ÑŒ Ñ€ĞµÑ‡ÑŒ"â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹:                                           â”‚   â”‚
â”‚  â”‚     - Ğ¢Ğ¸ÑˆĞ¸Ğ½Ğ° Ğ² Ğ°ÑƒĞ´Ğ¸Ğ¾ (RMS < 100)                      â”‚   â”‚
â”‚  â”‚     - ĞĞµÑ€Ğ°Ğ·Ğ±Ğ¾Ñ€Ñ‡Ğ¸Ğ²Ğ°Ñ Ñ€ĞµÑ‡ÑŒ                              â”‚   â”‚
â”‚  â”‚     - ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº (en-US vs ru-RU)              â”‚   â”‚
â”‚  â”‚     - ĞÑƒĞ´Ğ¸Ğ¾ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğµ (< 0.5s)                â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ WAV Ñ„Ğ°Ğ¹Ğ» (NEXY_DEBUG_SAVE_AUDIO)â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4. RequestError Ğ¾Ñ‚ Google Speech API                  â”‚   â”‚
â”‚  â”‚     Ğ›Ğ¾Ğ³: "ğŸ’¡ Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ñ ÑĞµÑ‚ÑŒÑ"          â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹:                                           â”‚   â”‚
â”‚  â”‚     - ĞĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ğ°                                    â”‚   â”‚
â”‚  â”‚     - Google Speech API Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½                    â”‚   â”‚
â”‚  â”‚     - Rate limit Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½                             â”‚   â”‚
â”‚  â”‚     Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:                                                   â”‚
â”‚  â””â”€â–º Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ÑÑ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ (completed Ğ¸Ğ»Ğ¸ failed)      â”‚
â”‚  â””â”€â–º ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ±ÑƒÑ„ĞµÑ€Ğ° Ğ² finally Ğ±Ğ»Ğ¾ĞºĞµ                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸ Ğ¾Ñ‚ĞºĞ°Ğ·Ğ°

#### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ
```
ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ batch Ñ€ĞµĞ¶Ğ¸Ğ¼
Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°:
  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸: "âš ï¸ [SFSpeech] ĞĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½"
  2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ System Preferences â†’ Privacy â†’ Speech Recognition
  3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ unified_config.yaml â†’ speech_recognition.streaming.enabled
  4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ env: NEXY_DISABLE_STREAMING_RECOGNITION

Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:
  - Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ² macOS
  - Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ Ñ‡Ñ‚Ğ¾ pyobjc-framework-Speech ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½
  - ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ feature flags
```

#### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ, Ğ½Ğ¾ Ñ‡Ğ°Ğ½ĞºĞ¸ Ğ½Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ
```
ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: append_audio() Ğ²ÑĞµĞ³Ğ´Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ False
Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°:
  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸: "âš ï¸ [SFSpeech] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ñ‡Ğ°Ğ½ĞºĞ°"
  2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ recognizer: _is_streaming_session_live()
  3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ ÑĞµÑÑĞ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°: _streaming_session_active = True

Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:
  - ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ _start_streaming_session() Ğ²ĞµÑ€Ğ½ÑƒĞ» True
  - ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ SFSpeechRecognizerWrapper
  - ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
```

#### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 3: Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ½Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹
```
ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: finish_recognition() Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿ÑƒÑÑ‚ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ
Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°:
  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸: "âš ï¸ [SFSpeech] ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°"
  2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ _streaming_partial_result (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ĞºĞ°Ğº fallback)
  3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ Ğ¼Ğ¸ĞºÑ€Ğ¾Ñ„Ğ¾Ğ½ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ (WAV Ñ„Ğ°Ğ¹Ğ»)

Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:
  - ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ WAV Ñ„Ğ°Ğ¹Ğ»: ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ğ³Ğ¾Ğ»Ğ¾Ñ
  - Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ timeout Ğ´Ğ»Ñ finish_recognition()
  - ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ
```

#### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 4: Batch Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ UnknownValueError
```
ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Google Speech API Ğ½Ğµ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ñ‘Ñ‚ Ñ€ĞµÑ‡ÑŒ
Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°:
  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ WAV Ñ„Ğ°Ğ¹Ğ» (NEXY_DEBUG_SAVE_AUDIO=true)
  2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ RMS Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ… (Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ > 100)
  3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ > 0.5s)
  4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ² unified_config.yaml

Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:
  - Ğ•ÑĞ»Ğ¸ Ğ² WAV Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ¸ÑˆĞ¸Ğ½Ğ° â†’ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ñ Ğ¼Ğ¸ĞºÑ€Ğ¾Ñ„Ğ¾Ğ½Ğ¾Ğ¼
  - Ğ•ÑĞ»Ğ¸ Ğ² WAV ĞµÑÑ‚ÑŒ Ğ³Ğ¾Ğ»Ğ¾Ñ â†’ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ñ ÑĞ·Ñ‹ĞºĞ¾Ğ¼ Ğ¸Ğ»Ğ¸ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾Ğ¼
  - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ)
```

## ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

### 1. **Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸**
- **Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ (Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚)**: Real-time Ñ‡ĞµÑ€ĞµĞ· SFSpeechRecognizer, Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° (~0-200ms)
- **Batch (fallback)**: ĞĞ°ĞºĞ¾Ğ¿Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ğ±ÑƒÑ„ĞµÑ€Ğµ â†’ Ñ€ĞµÑĞµĞ¼Ğ¿Ğ»Ğ¸Ğ½Ğ³ â†’ Google Speech API

### 2. **Ğ£Ğ¼Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼**
- Retry-Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ¿Ñ€Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ fallback Ğ½Ğ° batch Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…
- ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑĞµÑÑĞ¸Ğ¸ Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ

### 3. **Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°**
- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ WAV Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (ĞµÑĞ»Ğ¸ `NEXY_DEBUG_SAVE_AUDIO=true`)
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸Ğº Ğ°ÑƒĞ´Ğ¸Ğ¾ (RMS, min/max/mean)
- Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ ÑÑ‚Ğ°Ğ¿Ğµ

### 4. **Thread-safety**
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ² `audio_callback`
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° `_is_streaming_session_live()` Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ²
- Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ² `finally` Ğ±Ğ»Ğ¾ĞºĞ°Ñ…

