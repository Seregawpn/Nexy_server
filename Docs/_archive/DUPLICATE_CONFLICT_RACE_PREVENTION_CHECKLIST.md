# üõ°Ô∏è –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ race conditions

**–¶–ï–õ–¨**: –û–±–µ—Å–ø–µ—á–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ race conditions –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ –≤–Ω–µ—Å–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

**–í–ê–ñ–ù–û**: –≠—Ç–æ—Ç —á–µ–∫-–ª–∏—Å—Ç **–û–ë–Ø–ó–ê–¢–ï–õ–ï–ù** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∫–æ–¥–∞. –ë–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ race conditions –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –¥–æ–ª–∂–Ω—ã –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è.

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –≠—Ç–æ—Ç —á–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ü–û–°–õ–ï** –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (CONTEXT_AWARE ‚Üí ARCHITECTURE ‚Üí CONFIGURATION ‚Üí PLANNING) –∏ **–ü–ï–†–ï–î** –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–¥–∞.

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-01-XX  
**–í–µ—Ä—Å–∏—è**: 1.0

---

## üîç –≠—Ç–∞–ø 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ race conditions.

### 1.1 –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

**–ù–ï –ü–†–û–°–¢–û –ü–†–û–ß–ò–¢–ê–¢–¨**, –∞ **–ù–ê–ô–¢–ò –í–°–ï –ú–ï–°–¢–ê**:

- [ ] **–ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É**: –í—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (grep, codebase_search)
- [ ] **–ü–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º**: –í—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
- [ ] **–ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏**: –í—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ git log
- [ ] **–°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç**: –°–æ—Å—Ç–∞–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Å—Ç, –≥–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ—Ö–æ–∂–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] **–ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–ª–∏—á–∏–π**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞)**:
```bash
# ‚úÖ –•–û–†–û–®–û: –ù–∞—à–µ–ª –≤—Å–µ –º–µ—Å—Ç–∞ —Å is_bluetooth_device:
# - modules/voice_recognition/core/speech_recognizer.py:1364
# - modules/speech_playback/core/player.py:1669
# - modules/audio_system/core/device_manager.py:...
# - modules/audio_system/utils/device_utils.py (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
# 
# –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å device_utils.is_bluetooth_device() –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
```

### 1.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

**–ù–ï –ü–†–û–°–¢–û –ü–†–û–í–ï–†–ò–¢–¨**, –∞ **–ü–û–ù–Ø–¢–¨ –õ–û–ì–ò–ö–£**:

- [ ] **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π**: –ù–∞–π–¥–µ–Ω—ã –ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–æ—Ö–æ–∂–µ–π –ª–æ–≥–∏–∫–æ–π –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö?
- [ ] **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤**: –ù–∞–π–¥–µ–Ω—ã –ª–∏ –∫–ª–∞—Å—Å—ã —Å –ø–æ—Ö–æ–∂–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é?
- [ ] **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**: –ù–∞–π–¥–µ–Ω—ã –ª–∏ –ø–æ—Ö–æ–∂–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏?
- [ ] **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã**: –ï—Å—Ç—å –ª–∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏?

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**:

1. **–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**:
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
   - ‚úÖ –†–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - ‚ùå –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

2. **–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**:
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∫ –æ—Å–Ω–æ–≤—É
   - ‚úÖ –†–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
   - ‚ùå –ù–ï –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É

3. **–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**:
   - ‚úÖ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ (–º–æ–¥—É–ª—å/—É—Ç–∏–ª–∏—Ç—ã)
   - ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
   - ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ is_bluetooth_device)**:
```python
# ‚ùå –ü–õ–û–•–û: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é _is_bluetooth_device()
def _is_bluetooth_device(self, name: str) -> bool:
    return "bluetooth" in name.lower()

# ‚úÖ –•–û–†–û–®–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
from modules.audio_system.utils.device_utils import is_bluetooth_device
is_bluetooth = is_bluetooth_device(device_name)
```

### 1.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

- [ ] **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**: –ï—Å—Ç—å –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥—É–±–ª–∏—Ä—É—é—Ç –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã?
- [ ] **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π**: –ï—Å—Ç—å –ª–∏ hardcoded –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏?
- [ ] **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º**: –ï—Å—Ç—å –ª–∏ —Å—Ö–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥—É–±–ª–∏—Ä—É—é—Ç –¥—Ä—É–≥–∏–µ —Å—Ö–µ–º—ã?

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**:

1. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã**: –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `unified_config.yaml`
2. **–ù–µ—Ç hardcoded –∑–Ω–∞—á–µ–Ω–∏–π**: –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. **–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º**: –°—Ö–µ–º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ sample_rate)**:
```python
# ‚ùå –ü–õ–û–•–û: Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è
self._streaming_sample_rate: int = 48000
self._batch_sample_rate: int = 48000

# ‚úÖ –•–û–†–û–®–û: –ß—Ç–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
config = self._config_loader.get_config()
self._streaming_sample_rate = config.get("audio.input.target_rate", 48000)
self._batch_sample_rate = config.get("audio.input.target_rate", 48000)
```

---

## ‚öîÔ∏è –≠—Ç–∞–ø 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` —Ä–∞–∑–¥–µ–ª 2 –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

### 2.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

**–ù–ï –ü–†–û–°–¢–û –ü–†–û–í–ï–†–ò–¢–¨**, –∞ **–ü–û–ù–Ø–¢–¨ –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø**:

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è.

- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω**: –ï—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "variable_name\|function_name\|ClassName" . --include="*.py"`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "from.*import.*Name\|import.*Name" . --include="*.py"`
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–ø–æ—Ä—Ç–æ–≤**: –ï—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–ø–æ—Ä—Ç–æ–≤ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏–º–µ–Ω–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥—É–ª–µ–π)?
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –ï—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏)?
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π**: –ï—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π (–¥–≤–∞ –º–µ—Å—Ç–∞ —É–ø—Ä–∞–≤–ª—è—é—Ç –æ–¥–Ω–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º)?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "\.state\s*=\|_state\s*=\|set_state\|update_state" . --include="*.py"`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "axis_name\|state_name" Docs/STATE_CATALOG.md` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã

**–°–º. `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` —Ä–∞–∑–¥–µ–ª 2** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**:

1. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞**: –í—Å–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å—ã/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–º–ø–æ—Ä—Ç—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã**: –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ - –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π)**:
```python
# ‚ùå –ü–õ–û–•–û: –î–≤–∞ –º–µ—Å—Ç–∞ —É–ø—Ä–∞–≤–ª—è—é—Ç –æ–¥–Ω–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
# –í MicrophoneStateManager:
self._set_state("opening")

# –í ApplicationStateManager:
self.state_manager.set_microphone_state("opening")

# ‚úÖ –•–û–†–û–®–û: –û–¥–Ω–æ –º–µ—Å—Ç–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
# –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ MicrophoneStateManager, –∫–æ—Ç–æ—Ä—ã–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å ApplicationStateManager
```

### 2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –ø–æ—Ä—è–¥–∫–æ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**: –ú–æ–∂–µ—Ç –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Ä—É—à–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏?
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å EventBus**: –ú–æ–≥—É—Ç –ª–∏ –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏?
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å workflows**: –ú–æ–≥—É—Ç –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Ä—É—à–∏—Ç—å –ª–æ–≥–∏–∫—É workflows?
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å selectors/gateways**: –ú–æ–≥—É—Ç –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Ä—É—à–∏—Ç—å –ª–æ–≥–∏–∫—É selectors/gateways?

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**:

1. **–°–æ–±–ª—é–¥–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**: –ù–µ –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è
2. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è**: –í—Å–µ –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
3. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å workflows**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ workflows
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å selectors/gateways**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ selectors/gateways

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ - –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ–±—ã—Ç–∏–π)**:
```python
# ‚ùå –ü–õ–û–•–û: –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∏–º–µ–Ω–µ–º
await self.event_bus.publish("audio.device.changed", {...})  # –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!

# ‚úÖ –•–û–†–û–®–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º
await self.event_bus.publish("audio.device.output_changed", {...})  # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è
```

### 2.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**: –ú–æ–≥—É—Ç –ª–∏ –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏?
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–Ω–∞—á–µ–Ω–∏–π**: –ú–æ–≥—É—Ç –ª–∏ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏?
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å—Ö–µ–º**: –ú–æ–≥—É—Ç –ª–∏ –Ω–æ–≤—ã–µ —Å—Ö–µ–º—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏?

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**:

1. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**: –í—Å–µ –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
2. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π**: –ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏
3. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å—Ö–µ–º**: –ù–æ–≤—ã–µ —Å—Ö–µ–º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏

---

## üèÉ –≠—Ç–∞–ø 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ race conditions

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` —Ä–∞–∑–¥–µ–ª 3 –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è race conditions.

### 3.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ thread-safety (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

**–ù–ï –ü–†–û–°–¢–û –ü–†–û–í–ï–†–ò–¢–¨**, –∞ **–ü–û–ù–Ø–¢–¨ –ü–û–¢–û–ö–ò**:

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è.

- [ ] **–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø**: –ï—Å—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "self\._[a-z_]*\s*=" . --include="*.py"` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–∞
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "callback\|threading\|async def" . --include="*.py"` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Ç–æ–∫–æ–≤
- [ ] **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "threading\.Lock\|asyncio\.Lock\|Lock()" . --include="*.py"`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "with.*lock\|with.*Lock" . --include="*.py" -i`
- [ ] **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π?
- [ ] **Deadlock —Ä–∏—Å–∫–∏**: –ï—Å—Ç—å –ª–∏ —Ä–∏—Å–∫–∏ deadlock (–≤–∑–∞–∏–º–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)?

**–°–º. `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` —Ä–∞–∑–¥–µ–ª 3** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ race conditions.

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions**:

1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö**: –í—Å–µ –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
2. **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏
3. **–ò–∑–±–µ–≥–∞–Ω–∏–µ deadlock**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–Ω—ã –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å—Å—è –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ
4. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–Ω—ã —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ - race condition –≤ _google_audio_chunks)**:
```python
# ‚ùå –ü–õ–û–•–û: –î–æ—Å—Ç—É–ø –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
def callback(recognizer, audio):
    self._google_audio_chunks.append(audio)  # –ü–æ—Ç–æ–∫ 1

async def process_audio():
    self._google_audio_chunks = []  # –ü–æ—Ç–æ–∫ 2 (race condition!)

# ‚úÖ –•–û–†–û–®–û: –î–æ—Å—Ç—É–ø —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
self._google_audio_chunks_lock = threading.Lock()

def callback(recognizer, audio):
    with self._google_audio_chunks_lock:
        self._google_audio_chunks.append(audio)

async def process_audio():
    with self._google_audio_chunks_lock:
        if self._google_audio_chunks:
            self._google_audio_data = self._google_audio_chunks[-1]
        self._google_audio_chunks = []
```

### 3.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ async/await –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è.

- [ ] **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á**: –û—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –ª–∏ –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ `asyncio.create_task()`?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "asyncio\.create_task\|create_task" . --include="*.py"`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "_task\s*=\|\.task\s*=" . --include="*.py"` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- [ ] **–û—Ç–º–µ–Ω–∞ –∑–∞–¥–∞—á**: –û—Ç–º–µ–Ω—è—é—Ç—Å—è –ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "\.cancel()\|CancelledError" . --include="*.py"`
- [ ] **–¢–∞–π–º–∞—É—Ç—ã**: –ï—Å—Ç—å –ª–∏ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –≤—Å–µ—Ö async –æ–ø–µ—Ä–∞—Ü–∏–π?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "asyncio\.wait_for\|wait_for" . --include="*.py"`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "await.*\(\)" . --include="*.py" | grep -v "timeout\|wait_for"` –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –±–µ–∑ —Ç–∞–π–º–∞—É—Ç–æ–≤
- [ ] **–û–±—Ä–∞–±–æ—Ç–∫–∞ Future**: –û–∂–∏–¥–∞—é—Ç—Å—è –ª–∏ –≤—Å–µ Future –æ—Ç `run_coroutine_threadsafe`?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "run_coroutine_threadsafe" . --include="*.py"`

**–°–º. `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` —Ä–∞–∑–¥–µ–ª 3.2** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ async/await –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤.

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions –≤ async –∫–æ–¥–µ**:

1. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á**: –í—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å—Å—è –≤ —Å–ø–∏—Å–∫–µ
2. **–û—Ç–º–µ–Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ –æ—Ç–º–µ–Ω—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ
3. **–¢–∞–π–º–∞—É—Ç—ã**: –í—Å–µ async –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ç–∞–π–º–∞—É—Ç—ã
4. **–û–∂–∏–¥–∞–Ω–∏–µ Future**: –í—Å–µ Future –¥–æ–ª–∂–Ω—ã –æ–∂–∏–¥–∞—Ç—å—Å—è –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ - –¥—É–±–ª–∏–∫–∞—Ç—ã async –∑–∞–¥–∞—á)**:
```python
# ‚ùå –ü–õ–û–•–û: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –±–µ–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
async def start_listening():
    asyncio.create_task(self._listen_loop())  # –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã!

# ‚úÖ –•–û–†–û–®–û: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
self._listen_task: Optional[asyncio.Task] = None

async def start_listening():
    if self._listen_task and not self._listen_task.done():
        self._listen_task.cancel()
    self._listen_task = asyncio.create_task(self._listen_loop())
```

### 3.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ—à–∏–≤–∞–Ω–∏—è async –∏ threading (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è.

- [ ] **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ `asyncio.run_coroutine_threadsafe()` –¥–ª—è –≤—ã–∑–æ–≤–∞ async –º–µ—Ç–æ–¥–æ–≤ –∏–∑ –ø–æ—Ç–æ–∫–æ–≤?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "run_coroutine_threadsafe" . --include="*.py"`
- [ ] **Event loops**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π event loop –¥–ª—è `run_coroutine_threadsafe`?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `grep -r "event_bus\._loop\|get_event_loop\|new_event_loop" . --include="*.py"`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ `event_bus._loop` –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ loop
- [ ] **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –ï—Å—Ç—å –ª–∏ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ async –∫–æ–¥–µ?

**–°–º. `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` —Ä–∞–∑–¥–µ–ª 3.3** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–º–µ—à–∏–≤–∞–Ω–∏—è async –∏ threading.

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å async/threading**:

1. **run_coroutine_threadsafe**: –í—Å–µ –≤—ã–∑–æ–≤—ã async –º–µ—Ç–æ–¥–æ–≤ –∏–∑ –ø–æ—Ç–æ–∫–æ–≤ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `run_coroutine_threadsafe`
2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π event loop**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å event loop –∏–∑ EventBus, –∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π
3. **–ò–∑–±–µ–≥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**: –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ executor

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π event loop)**:
```python
# ‚ùå –ü–õ–û–•–û: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ event loop
def callback_from_thread():
    loop = asyncio.new_event_loop()
    loop.run_until_complete(self._publish_event())

# ‚úÖ –•–û–†–û–®–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ event loop –∏–∑ EventBus
def callback_from_thread():
    loop = self.event_bus._loop  # Event loop –∏–∑ EventBus
    asyncio.run_coroutine_threadsafe(self._publish_event(), loop)
```

---

## üîÑ –≠—Ç–∞–ø 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 4.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

- [ ] **–ï–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º**: –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∏–∑ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞?
- [ ] **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏?
- [ ] **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π?

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π**:

1. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã**: –ö–∞–∂–¥–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è EventBus
3. **–ó–∞–ø—Ä–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞**: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –∑–∞–ø—Ä–µ—â–µ–Ω (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ selectors/gateways)

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ - –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π)**:
```python
# ‚ùå –ü–õ–û–•–û: –î–≤–∞ –º–µ—Å—Ç–∞ —É–ø—Ä–∞–≤–ª—è—é—Ç –æ–¥–Ω–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
# –í MicrophoneStateManager:
self._state = "opening"

# –í ApplicationStateManager:
self._mic_state = "opening"  # –ö–æ–Ω—Ñ–ª–∏–∫—Ç!

# ‚úÖ –•–û–†–û–®–û: –û–¥–Ω–æ –º–µ—Å—Ç–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
# –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ MicrophoneStateManager, –∫–æ—Ç–æ—Ä—ã–π –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```

### 4.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

- [ ] **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –Ø–≤–ª—è—é—Ç—Å—è –ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏?
- [ ] **TOCTOU –∑–∞—â–∏—Ç–∞**: –ï—Å—Ç—å –ª–∏ –∑–∞—â–∏—Ç–∞ –æ—Ç TOCTOU (Time-Of-Check-Time-Of-Use) –ø—Ä–æ–±–ª–µ–º?
- [ ] **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å**: –Ø–≤–ª—è—é—Ç—Å—è –ª–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–º–∏?

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏**:

1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
2. **TOCTOU –∑–∞—â–∏—Ç–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏
3. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å**: –°–≤—è–∑–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ

**–ü—Ä–∏–º–µ—Ä (–∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ - TOCTOU –∑–∞—â–∏—Ç–∞)**:
```python
# ‚ùå –ü–õ–û–•–û: TOCTOU –ø—Ä–æ–±–ª–µ–º–∞
if not os.path.exists(lock_file):
    # –ú–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ñ–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º!
    os.open(lock_file, os.O_CREAT)

# ‚úÖ –•–û–†–û–®–û: TOCTOU –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ O_CREAT | O_EXCL
try:
    lock_fd = os.open(lock_file, os.O_CREAT | os.O_EXCL | os.O_WRONLY)
except FileExistsError:
    # –§–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–ª –µ–≥–æ
    return False
```

---

## üìã –≠—Ç–∞–ø 5: –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–¥–∞

### 5.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] **–ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω**: –í—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ**: –ù–µ –Ω–∞–π–¥–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞/–ª–æ–≥–∏–∫–∏/–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- [ ] **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è**: –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ (–º–æ–¥—É–ª—å/—É—Ç–∏–ª–∏—Ç—ã)

### 5.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω**: –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–ø–æ—Ä—Ç–æ–≤**: –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–ø–æ—Ä—Ç–æ–≤
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π**: –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π (–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**: –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (–ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, EventBus, workflows)

### 5.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ race conditions

- [ ] **Thread-safety**: –í—Å–µ –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
- [ ] **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã
- [ ] **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á**: –í—Å–µ async –∑–∞–¥–∞—á–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
- [ ] **–û—Ç–º–µ–Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–¥–∞—á–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö
- [ ] **–¢–∞–π–º–∞—É—Ç—ã**: –í—Å–µ async –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–º–µ—é—Ç —Ç–∞–π–º–∞—É—Ç—ã
- [ ] **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `run_coroutine_threadsafe` –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ –∏–∑ –ø–æ—Ç–æ–∫–æ–≤
- [ ] **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π event loop**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π event loop

---

## üéØ –®–∞–±–ª–æ–Ω –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–¥–∞

### –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç | –î–µ–π—Å—Ç–≤–∏–µ |
|-----------|----------|-----------|----------|
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ | –ù–∞–π–¥–µ–Ω–æ/–ù–µ –Ω–∞–π–¥–µ–Ω–æ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ/–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ | –ï—Å—Ç—å/–ù–µ—Ç | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é/–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π | –ï—Å—Ç—å/–ù–µ—Ç | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é/–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é |
| **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã** | –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω | –ï—Å—Ç—å/–ù–µ—Ç | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å/–û—Å—Ç–∞–≤–∏—Ç—å |
| **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã** | –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π | –ï—Å—Ç—å/–ù–µ—Ç | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã |
| **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã** | –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã | –ï—Å—Ç—å/–ù–µ—Ç | –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π |
| **Race conditions** | Thread-safety | –ó–∞—â–∏—â–µ–Ω–æ/–ù–µ –∑–∞—â–∏—â–µ–Ω–æ | –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ |
| **Race conditions** | –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å | –ê—Ç–æ–º–∞—Ä–Ω–æ/–ù–µ –∞—Ç–æ–º–∞—Ä–Ω–æ | –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ |
| **Race conditions** | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á | –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è/–ù–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è | –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ |

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–¥–∞

- [ ] **–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã**: –í—Å–µ —ç—Ç–∞–ø—ã 1-5 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ**: –ù–µ –Ω–∞–π–¥–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞/–ª–æ–≥–∏–∫–∏/–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- [ ] **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã**: –ù–µ –Ω–∞–π–¥–µ–Ω–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω/—Å–æ—Å—Ç–æ—è–Ω–∏–π/–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- [ ] **Race conditions –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã**: –í—Å–µ race conditions –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã —á–µ—Ä–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å
- [ ] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è/–∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤/race conditions

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `CONTEXT_AWARE_PLANNING_GUIDE.md` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–ü–ï–†–í–´–ô —ç—Ç–∞–ø)
- `ARCHITECTURE_ANALYSIS_CHECKLIST.md` ‚Äî –∞–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–í–¢–û–†–û–ô —ç—Ç–∞–ø)
- `CONFIGURATION_ANALYSIS_CHECKLIST.md` ‚Äî –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (–¢–†–ï–¢–ò–ô —ç—Ç–∞–ø)
- `PRE_CHANGE_PLANNING_CHECKLIST.md` ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ß–ï–¢–í–ï–†–¢–´–ô —ç—Ç–∞–ø)
- `DETECTION_GUIDE_DUPLICATES_CONFLICTS_RACES.md` ‚Äî **–ò–ù–°–¢–†–£–ö–¶–ò–Ø** –ø–æ –≤—ã—è–≤–ª–µ–Ω–∏—é –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ race conditions
- `CODE_CONFLICTS_AND_RACE_CONDITIONS_ANALYSIS.md` ‚Äî –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ race conditions
- `PLANNING_PROCESS_ORDER.md` ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-01-XX



