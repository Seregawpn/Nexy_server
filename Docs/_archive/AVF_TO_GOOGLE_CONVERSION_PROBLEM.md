# –ü—Ä–æ–±–ª–µ–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö AVF ‚Üí Google Speech API

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–î–∞–Ω–Ω—ã–µ, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ AVF, —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ Google Speech API:
- ‚ùå `UnknownValueError` –¥–∞–∂–µ –ø—Ä–∏ —Ö–æ—Ä–æ—à–µ–º RMS –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
- ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ (48kHz ‚Üí 16kHz, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è)

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:

```
AVF –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç (48kHz, int16)
    ‚Üì
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: int16 ‚Üí float32 ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
    ‚Üì
–†–µ—Å–µ–º–ø–ª–∏–Ω–≥: 48kHz ‚Üí 16kHz (scipy.signal.resample)
    ‚Üì
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: float32 ‚Üí int16 ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ
    ‚Üì
Google Speech API ‚Üí ‚ùå UnknownValueError
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ö–∞—á–µ—Å—Ç–≤–æ —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞**
   - `scipy.signal.resample` –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
   - –ü–æ—Ç–µ—Ä—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ 48kHz ‚Üí 16kHz

2. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**
   - –î–≤–æ–π–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (int16 ‚Üí float32 ‚Üí int16)
   - –í–æ–∑–º–æ–∂–Ω—ã –ø–æ—Ç–µ—Ä–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏

3. **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**
   - Google –º–æ–∂–µ—Ç –æ–∂–∏–¥–∞—Ç—å –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç
   - –ü–æ—Ä—è–¥–æ–∫ –±–∞–π—Ç, endianness

4. **–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏**
   - –ò—Å–∫–∞–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞
   - –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–∑–æ–π —Å–∏–≥–Ω–∞–ª–∞

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: Google –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

1. **Google –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ**
   - `sr.Microphone()` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ä–∞–∑—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–Ω–∏–º–∞–µ—Ç Google
   - –ù–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ ‚Üí –Ω–µ—Ç –ø–æ—Ç–µ—Ä—å –∫–∞—á–µ—Å—Ç–≤–∞

2. **–ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–æ–º**
   - Google —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
   - –ù–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

3. **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç `sr.Microphone()` ‚Üí `recognize_google()` —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
   - AVF ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ‚Üí Google –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ùå

---

## üéØ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è)

### –í–∞—Ä–∏–∞–Ω—Ç 1: AVF —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ë–ï–ó –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

```
1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   ‚îú‚îÄ AVF –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (–ë–ï–ó –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç: —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —Ñ–æ—Ä–º–∞—Ç—ã, etc.

2. –ü—Ä–∏ voice.recording_start:
   ‚îú‚îÄ Google –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω —á–µ—Ä–µ–∑ sr.Microphone()
   ‚îî‚îÄ –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ—á—å –Ω–∞–ø—Ä—è–º—É—é

3. –ü—Ä–∏ voice.recording_stop:
   ‚îú‚îÄ Google –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å
   ‚îî‚îÄ –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —á–µ—Ä–µ–∑ recognize_google()
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ù–µ—Ç –¥–≤–æ–π–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (AVF –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω)
- ‚úÖ Google –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –±–µ–∑ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: AVF –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –Ω–∞ –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è (0.1 —Å–µ–∫)

```
1. –ü—Ä–∏ voice.recording_start:
   ‚îú‚îÄ AVF –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –Ω–∞ 0.1 —Å–µ–∫ ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É ‚Üí –¥–µ–∑–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç
   ‚îî‚îÄ Google –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ—á—å

2. –ü—Ä–∏ voice.recording_stop:
   ‚îî‚îÄ Google —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ï—Å—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—Ç AVF
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (0.1 —Å–µ–∫)

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –í—Å—ë –µ—â—ë –¥–≤–æ–π–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è (–Ω–æ –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∞—è)
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç, –Ω–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–æ–ª—å–∫–æ Google (–±–µ–∑ AVF –¥–ª—è –∑–∞–ø–∏—Å–∏)

```
1. –ü—Ä–∏ voice.recording_start:
   ‚îî‚îÄ Google –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ—á—å

2. –ü—Ä–∏ voice.recording_stop:
   ‚îî‚îÄ Google —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ—Ç AVF
- ‚ùå –ú–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å Bluetooth (–∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ä–µ—à–∞–ª–∏ —á–µ—Ä–µ–∑ AVF)

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 1 –∏–ª–∏ –í–∞—Ä–∏–∞–Ω—Ç 3:

**–ï—Å–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ AVF –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞:**
- ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–æ–ª—å–∫–æ Google
- –ü—Ä–æ—â–µ –≤—Å–µ–≥–æ, —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ï—Å–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ AVF –Ω—É–∂–Ω–∞:**
- ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1: AVF –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ë–ï–ó –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –±–µ–∑ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å

### 1. –£–±—Ä–∞—Ç—å AVF –∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–ø–∏—Å–∏

```python
# –í _on_recording_start():
if self._use_avf:
    # –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º AVF –¥–ª—è –∑–∞–ø–∏—Å–∏
    # –¢–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    pass

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º Google –Ω–∞–ø—Ä—è–º—É—é
if self._recognizer:
    await self._recognizer.start_listening()
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Google –¥–ª—è –∑–∞–ø–∏—Å–∏

```python
# –í _on_recording_stop():
if self._recognizer:
    audio_data = await self._recognizer.stop_listening()
    # –†–∞—Å–ø–æ–∑–Ω–∞—ë–º –Ω–∞–ø—Ä—è–º—É—é (—É–∂–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ)
    text = recognizer.recognize_google(audio_data, language=language)
```

### 3. –£–±—Ä–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é AVF ‚Üí Google

```python
# –£–±—Ä–∞—Ç—å:
# - _recognize_avf_audio()
# - –†–µ—Å–µ–º–ø–ª–∏–Ω–≥ 48kHz ‚Üí 16kHz
# - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é int16 ‚Üí float32 ‚Üí int16
```

---

## ‚úÖ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö AVF ‚Üí Google —Å–æ–∑–¥–∞—ë—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã ‚Üí UnknownValueError

**–†–µ—à–µ–Ω–∏–µ:** Google –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `sr.Microphone()` ‚Üí –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ ‚Üí —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Google –¥–ª—è –∑–∞–ø–∏—Å–∏, AVF —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞) –ë–ï–ó –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
