# 📋 Правильный порядок выполнения чек-листов планирования

**ЦЕЛЬ**: Единый источник истины для порядка выполнения всех чек-листов планирования изменений.

**ВАЖНО**: Этот документ описывает **ОБЯЗАТЕЛЬНЫЙ** порядок выполнения чек-листов. Без выполнения всех чек-листов в правильном порядке изменения кода **НЕ НАЧИНАЮТСЯ**.

**Дата создания**: 2025-01-XX  
**Версия**: 1.0

---

## 🔄 Визуальная схема процесса

```
┌─────────────────────────────────────────────────────────────┐
│                    ИЗМЕНЕНИЕ КОДА                           │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 1: CONTEXT_AWARE_PLANNING_GUIDE.md                   │
│  Контекстный анализ (ЧТО учесть)                          │
│  - unified_config.yaml (высокоуровневый)                   │
│  - Feature flags (высокоуровневый)                         │
│  - Архитектурные ограничения                               │
│  - Существующий функционал                                  │
│  - Инварианты системы                                      │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 2: ARCHITECTURE_ANALYSIS_CHECKLIST.md                │
│  Анализ архитектуры (КАК устроено)                         │
│  - Структура проекта                                        │
│  - Взаимодействия (EventBus, workflows)                    │
│  - Конфигурация (общий обзор)                              │
│  - Зависимости                                              │
│  - Инварианты и правила                                     │
│  - Текущее состояние                                        │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 3: CONFIGURATION_ANALYSIS_CHECKLIST.md               │
│  Анализ конфигураций (КАКИЕ параметры)                     │
│  - Идентификация конфигураций                              │
│  - Детальный анализ параметров                             │
│  - Feature flags и kill-switches (детально)                 │
│  - Зависимости между конфигурациями                        │
│  - Влияние изменений на конфигурации                        │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 4: PRE_CHANGE_PLANNING_CHECKLIST.md                  │
│  Планирование изменений (КАК изменить)                     │
│  - Понимание задачи                                         │
│  - Анализ зависимостей и влияния                           │
│  - Анализ рисков                                            │
│  - Планирование реализации                                  │
│  - Проверка перед началом кода                             │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 5: DUPLICATE_CONFLICT_RACE_PREVENTION_CHECKLIST.md  │
│  Проверка дублирования, конфликтов и race conditions       │
│  - Проверка дублирования кода                              │
│  - Проверка конфликтов                                      │
│  - Проверка race conditions                                 │
│  - Проверка состояния и синхронизации                       │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                    ГЕНЕРАЦИЯ КОДА                           │
└─────────────────────────────────────────────────────────────┘
```

---

## 📋 Детальное описание этапов

### Этап 1: CONTEXT_AWARE_PLANNING_GUIDE.md (ПЕРВЫЙ)

**Цель**: Обеспечить учет всех конфигураций, флагов, архитектурных особенностей и существующего функционала ДО генерации кода.

**Что делает**:
- Высокоуровневый анализ конфигураций (unified_config.yaml, feature flags)
- Анализ архитектурных ограничений (порядок инициализации, EventBus, selectors/gateways)
- Анализ существующего функционала (поиск похожих реализаций, текущая логика)
- Проверка архитектурных ограничений (инварианты, правила взаимодействия)
- Создание детальной Impact Map

**Результат**: Понимание контекста изменения, детальная Impact Map.

**Время выполнения**: 30-60 минут (зависит от сложности изменения)

---

### Этап 2: ARCHITECTURE_ANALYSIS_CHECKLIST.md (ВТОРОЙ)

**Цель**: Обеспечить полный анализ текущей архитектуры, структуры, взаимодействий ДО создания плана изменений.

**Что делает**:
- Изучение ключевых архитектурных документов
- Анализ структуры проекта (модули, интеграции, workflows)
- Анализ взаимодействий (EventBus события, workflows, selectors/gateways)
- Анализ конфигурации (общий обзор)
- Анализ зависимостей (прямые, обратные, внешние)
- Анализ инвариантов и правил
- Анализ текущего состояния (код, тесты, метрики)

**Результат**: Полное понимание архитектуры системы.

**Время выполнения**: 45-90 минут (зависит от сложности изменения)

---

### Этап 3: CONFIGURATION_ANALYSIS_CHECKLIST.md (ТРЕТИЙ)

**Цель**: Обеспечить полный анализ всех конфигураций, флагов и параметров, влияющих на изменяемый функционал.

**Что делает**:
- Идентификация затронутых конфигураций (домен, разделы unified_config.yaml, схемы)
- Детальный анализ конфигураций (структура, значения, логика использования)
- Анализ Feature Flags и Kill-Switches (идентификация, логика, влияние)
- Анализ зависимостей между конфигурациями (внутри домена, между доменами)
- Анализ влияния изменений на конфигурации (новые параметры, изменения, удаление)
- Проверка конфигураций перед изменениями (готовность, документация, тестирование)

**Результат**: Таблица анализа конфигураций, понимание всех параметров и их зависимостей.

**Время выполнения**: 30-60 минут (зависит от количества конфигураций)

---

### Этап 4: PRE_CHANGE_PLANNING_CHECKLIST.md (ЧЕТВЕРТЫЙ)

**Цель**: Убедиться, что все нюансы, зависимости и риски учтены ДО начала написания кода.

**Что делает**:
- Понимание задачи и контекста
- Анализ зависимостей и влияния (модули, EventBus, конфигурации, оси состояния, правила взаимодействия)
- Анализ рисков и инвариантов
- Планирование реализации (Impact Map, change_impact.yaml, план изменений)
- Проверка перед началом кода (документация, конфигурация, тесты, мониторинг)
- Финальная проверка готовности

**Результат**: Полный план изменений, Impact Map, change_impact.yaml.

**Время выполнения**: 60-120 минут (зависит от сложности изменения)

---

### Этап 5: DUPLICATE_CONFLICT_RACE_PREVENTION_CHECKLIST.md (ПЯТЫЙ - НОВЫЙ)

**Цель**: Обеспечить отсутствие дублирования кода, конфликтов и race conditions при создании или внесении изменений.

**Что делает**:
- Проверка дублирования кода (поиск существующей функциональности, проверка дублирования логики/конфигураций)
- Проверка конфликтов (конфликты с существующим кодом, архитектурой, конфигурациями)
- Проверка race conditions (thread-safety, async/await паттерны, смешивание async и threading)
- Проверка состояния и синхронизации (единый источник истины, атомарность операций)

**Результат**: Таблица проверки дублирования/конфликтов/race conditions, готовность к генерации кода без проблем.

**Время выполнения**: 20-40 минут (зависит от сложности изменения)

---

## ✅ Чек-лист выполнения

### Перед началом

- [ ] Определена область изменения (какие модули/интеграции/файлы затрагиваются)
- [ ] Понятна цель изменения (что нужно изменить и почему)

### Этап 1: CONTEXT_AWARE_PLANNING_GUIDE.md

- [ ] Пройден Этап 0: Подготовка
- [ ] Пройден Этап 1: Глубокий анализ конфигураций и флагов
- [ ] Пройден Этап 2: Анализ архитектурных ограничений
- [ ] Пройден Этап 3: Анализ существующего функционала
- [ ] Пройден Этап 4: Проверка архитектурных ограничений
- [ ] Пройден Этап 5: Создание детальной Impact Map
- [ ] Пройден Этап 6: Финальная проверка готовности

**Результат**: Детальная Impact Map, понимание контекста.

### Этап 2: ARCHITECTURE_ANALYSIS_CHECKLIST.md

- [ ] Пройден Этап 0: Изучение ключевых архитектурных документов
- [ ] Пройден Этап 1: Анализ структуры проекта
- [ ] Пройден Этап 2: Анализ взаимодействий и коммуникаций
- [ ] Пройден Этап 3: Анализ конфигурации (общий обзор)
- [ ] Пройден Этап 4: Анализ зависимостей
- [ ] Пройден Этап 5: Анализ инвариантов и правил
- [ ] Пройден Этап 6: Анализ текущего состояния

**Результат**: Полное понимание архитектуры системы.

### Этап 3: CONFIGURATION_ANALYSIS_CHECKLIST.md

- [ ] Пройден Этап 1: Идентификация затронутых конфигураций
- [ ] Пройден Этап 2: Детальный анализ конфигураций
- [ ] Пройден Этап 3: Анализ Feature Flags и Kill-Switches
- [ ] Пройден Этап 4: Анализ зависимостей между конфигурациями
- [ ] Пройден Этап 5: Анализ влияния изменений на конфигурации
- [ ] Пройден Этап 6: Проверка конфигураций перед изменениями

**Результат**: Таблица анализа конфигураций.

### Этап 4: PRE_CHANGE_PLANNING_CHECKLIST.md

- [ ] Пройден Этап 0: Анализ архитектуры и конфигураций (проверка выполнения предыдущих этапов)
- [ ] Пройден Этап 1: Понимание задачи и контекста
- [ ] Пройден Этап 2: Анализ зависимостей и влияния
- [ ] Пройден Этап 3: Анализ рисков и инвариантов
- [ ] Пройден Этап 4: Планирование реализации
- [ ] Пройден Этап 5: Проверка перед началом кода (включая проверку дублирования/конфликтов/race conditions)
- [ ] Пройден Этап 6: Финальная проверка готовности

**Результат**: Полный план изменений, Impact Map, change_impact.yaml.

### Этап 5: DUPLICATE_CONFLICT_RACE_PREVENTION_CHECKLIST.md (НОВЫЙ - ОБЯЗАТЕЛЕН)

- [ ] Пройден Этап 1: Проверка дублирования кода
- [ ] Пройден Этап 2: Проверка конфликтов
- [ ] Пройден Этап 3: Проверка race conditions
- [ ] Пройден Этап 4: Проверка состояния и синхронизации
- [ ] Пройден Этап 5: Чек-лист перед генерацией кода

**Результат**: Таблица проверки дублирования/конфликтов/race conditions, готовность к генерации кода без проблем.

### После выполнения всех этапов

- [ ] Все чек-листы выполнены в правильном порядке
- [ ] Impact Map создана и заполнена
- [ ] change_impact.yaml создан и заполнен
- [ ] Дублирование проверено и предотвращено
- [ ] Конфликты проверены и предотвращены
- [ ] Race conditions проверены и предотвращены
- [ ] Документация обновлена (если нужно)
- [ ] Конфигурация обновлена (если нужно)
- [ ] Готовность к генерации кода подтверждена

---

## ⚠️ Критически важные правила

### Правило 1: Порядок обязателен
**НЕ МОЖНО** пропускать этапы или менять их порядок. Каждый этап опирается на результаты предыдущего.

### Правило 2: Фиксация результатов обязательна
**ОБЯЗАТЕЛЬНО** фиксировать результаты каждого этапа:
- Impact Map обновляется после каждого этапа
- change_impact.yaml обновляется после каждого этапа
- Результаты выполнения фиксируются в комментариях/документах

### Правило 3: Проверка перед переходом
**ПЕРЕД ПЕРЕХОДОМ** к следующему этапу нужно убедиться, что текущий этап выполнен полностью:
- Все чекбоксы отмечены
- Все результаты зафиксированы
- Все вопросы из этапа имеют ответы

---

## 📚 Связанные документы

**Порядок выполнения (обязателен!)**:
1. `CONTEXT_AWARE_PLANNING_GUIDE.md` — контекстный анализ (ПЕРВЫЙ этап)
2. `ARCHITECTURE_ANALYSIS_CHECKLIST.md` — анализ архитектуры (ВТОРОЙ этап)
3. `CONFIGURATION_ANALYSIS_CHECKLIST.md` — анализ конфигураций (ТРЕТИЙ этап)
4. `PRE_CHANGE_PLANNING_CHECKLIST.md` — планирование изменений (ЧЕТВЕРТЫЙ этап)
5. `DUPLICATE_CONFLICT_RACE_PREVENTION_CHECKLIST.md` — проверка дублирования/конфликтов/race conditions (ПЯТЫЙ этап - НОВЫЙ)

**Другие документы**:
- `.cursorrules` (раздел 11.1) — правила изменений
- `PLANNING_SYSTEM_ISSUES_AND_FIXES.md` — анализ проблем и решений
- `CODE_CONFLICTS_AND_RACE_CONDITIONS_ANALYSIS.md` — анализ конфликтов и race conditions

---

**Версия**: 1.1  
**Дата создания**: 2025-01-XX  
**Последнее обновление**: 2025-01-XX (добавлен этап 5: проверка дублирования/конфликтов/race conditions)



