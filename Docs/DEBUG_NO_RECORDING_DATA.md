# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∑–∞–ø–∏—Å–∏"

## –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:
```
2025-12-10 13:03:17,233 - üé§ [Google] –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ speech_recognition...
2025-12-10 13:03:17,233 - üõë [Google] –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è...
2025-12-10 13:03:17,233 - ‚úÖ [Google] –§–æ–Ω–æ–≤–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
2025-12-10 13:03:17,776 - ‚ö†Ô∏è [Google] –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∑–∞–ø–∏—Å–∏ (–Ω—É–ª–µ–≤–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–ª–∏ –æ—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏)
```

**–ù–û:** –í –ª–æ–≥–∞—Ö **–ù–ï–¢** –∑–∞–ø–∏—Å–µ–π –æ:
- ‚ùå `üîç [AVF] –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞...`
- ‚ùå `üé§ [Google] –ê–∫—Ç–∏–≤–∞—Ü–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ speech_recognition...`
- ‚ùå `‚úÖ [Google] –§–æ–Ω–æ–≤–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ`
- ‚ùå `üîç [Google] –ü–æ–ª—É—á–µ–Ω —á–∞–Ω–∫ –∞—É–¥–∏–æ`

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **`voice.recording_start` –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è**
   - –°–æ–±—ã—Ç–∏–µ –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è
   - –°–æ–±—ã—Ç–∏–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è, –Ω–æ `_on_recording_start` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   - `_on_recording_start` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ `_first_run_in_progress`

2. **AVF –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
   - `self._use_avf` = False
   - `self._avf_engine` = None
   - –£—Å–ª–æ–≤–∏–µ `if self._use_avf and self._avf_engine is not None:` –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

3. **Google –∑–∞–ø–∏—Å—å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
   - –û—à–∏–±–∫–∞ –≤ –±–ª–æ–∫–µ `try` –¥–ª—è Google –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
   - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

4. **Callback –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è**
   - `listen_in_background` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç
   - Callback –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è

## üîß –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `_on_recording_start`

–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–æ –º–µ—Ç–æ–¥–∞:
```python
async def _on_recording_start(self, event: Dict[str, Any]):
    logger.info("üîç [DEBUG] _on_recording_start –í–´–ó–í–ê–ù! event=%s", event)
    try:
        # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É first_run

–í –ª–æ–≥–∞—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–∏ `‚ö†Ô∏è [VOICE_RECOGNITION] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏`, –∑–Ω–∞—á–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç.

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ AVF

–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
logger.info(f"üîç [DEBUG] _use_avf={self._use_avf}, _avf_engine={self._avf_engine is not None}")
if self._use_avf and self._avf_engine is not None:
    # ...
else:
    logger.warning(f"‚ö†Ô∏è [DEBUG] AVF –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: _use_avf={self._use_avf}, _avf_engine={self._avf_engine is not None}")
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –ª–∏ `voice.recording_start`

–í –ª–æ–≥–∞—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–∏ `VOICE: recording_start, session=...`, –∑–Ω–∞—á–∏—Ç –º–µ—Ç–æ–¥ –ª–∏–±–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –ª–∏–±–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏.

## üéØ –ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞

**`_on_recording_start` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.**

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. –°–æ–±—ã—Ç–∏–µ `voice.recording_start` –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –∏–∑ `input_processing_integration`
2. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –ú–µ—Ç–æ–¥ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ `_first_run_in_progress` (–Ω–æ –≤ –ª–æ–≥–∞—Ö –Ω–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)

## üîß –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```python
async def _on_recording_start(self, event: Dict[str, Any]):
    logger.info("üîç [DEBUG] _on_recording_start –í–´–ó–í–ê–ù! event=%s", event)
    try:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ first_run
        if self._first_run_in_progress:
            logger.warning("‚ö†Ô∏è [VOICE_RECOGNITION] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ - first_run –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ")
            return
        
        # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
        
        logger.info(f"üîç [DEBUG] _use_avf={self._use_avf}, _avf_engine={self._avf_engine is not None}")
        if self._use_avf and self._avf_engine is not None:
            logger.info("üîç [DEBUG] –í—Ö–æ–¥–∏–º –≤ –±–ª–æ–∫ AVF –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏")
            # ...
        else:
            logger.warning(f"‚ö†Ô∏è [DEBUG] AVF –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: _use_avf={self._use_avf}, _avf_engine={self._avf_engine is not None}")
    except Exception as e:
        logger.error(f"‚ùå [DEBUG] –û—à–∏–±–∫–∞ –≤ _on_recording_start: {e}", exc_info=True)
```






