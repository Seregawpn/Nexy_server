# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —è–≤–Ω–æ–π —ç—Å—Ç–∞—Ñ–µ—Ç—ã AVF ‚Üí SpeechRecognition

## –°—Ç–∞—Ç—É—Å: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

1. **–†–∞—Å—à–∏—Ä–µ–Ω AudioInputResult**:
   - `device_info`: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (–∏–º—è, UID)
   - `input_format`: –§–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω–æ–≥–æ –∞—É–¥–∏–æ (sample_rate, channels, bit_depth)
   - `diagnostics`: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–ø–∏—Å–∏ (–ø–µ—Ä–≤—ã–π —á–∞–Ω–∫, RMS, min/max, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤)

2. **AVFAudioEngine —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ**:
   - –ü—Ä–∏ `start_input()`: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç device_info –∏ input_format
   - –í `recording_callback()`: —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞
   - –ü—Ä–∏ `stop_input()`: —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π `AudioInputResult` —Å –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏

3. **–°–æ–±—ã—Ç–∏–µ voice.mic_data_ready**:
   - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è –ø–æ—Å–ª–µ `stop_input()` (–º–∏–∫—Ä–æ—Ñ–æ–Ω —É–∂–µ –æ—Å–≤–æ–±–æ–∂–¥—ë–Ω)
   - –°–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: PCM bytes, sample_rate, channels, device_info, format, diagnostics
   - SpeechRecognition –º–æ–∂–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

4. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ _on_mic_data_ready**:
   - –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–±—ã—Ç–∏—è
   - –í—ã–∑—ã–≤–∞–µ—Ç `_recognize_avf_audio()` –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞)

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –≠—Å—Ç–∞—Ñ–µ—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```
üì• [EVENT] voice.mic_data_ready:
   - Session: test_handoff_123
   - PCM bytes: 921600
   - Sample rate: 48000Hz
   - Channels: 1
   - Device: System Default Input
   - Diagnostics: {...}
```

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: sample_rate = 48000Hz
- –û–∂–∏–¥–∞–ª–æ—Å—å: 24000Hz (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏: 48000Hz (—Å–∏—Å—Ç–µ–º–Ω–æ–µ default —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
- –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π –¥–ª—è —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞ (48kHz ‚Üí 16kHz)

### ‚ùå –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- UnknownValueError –¥–∞–∂–µ –ø–æ—Å–ª–µ —ç—Å—Ç–∞—Ñ–µ—Ç—ã
- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
  1. Sample rate 48kHz –≤–º–µ—Å—Ç–æ 24kHz (–±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥)
  2. –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞
  3. –ö–∞—á–µ—Å—Ç–≤–æ –∞—É–¥–∏–æ

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –≠—Å—Ç–∞—Ñ–µ—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á–µ–º—É sample_rate = 48000Hz –≤–º–µ—Å—Ç–æ 24000Hz
3. ‚è≥ –°—Ä–∞–≤–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ —ç—Å—Ç–∞—Ñ–µ—Ç—ã —Å –ø—Ä—è–º—ã–º —Ç–µ—Å—Ç–æ–º
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å VAD –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ —Ç–∏—à–∏–Ω—ã

## –í—ã–≤–æ–¥

‚úÖ **–≠—Å—Ç–∞—Ñ–µ—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** - –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—Ç AVF –∫ SpeechRecognition –±–µ–∑ –¥–≤–æ–π–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.  
‚ö†Ô∏è **–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ/–∫–∞—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

