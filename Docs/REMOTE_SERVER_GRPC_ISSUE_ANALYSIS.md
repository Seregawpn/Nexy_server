# üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã: gRPC –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

**–î–∞—Ç–∞:** 13 —è–Ω–≤–∞—Ä—è 2026  
**–°–µ—Ä–≤–µ—Ä:** nexy-prod-sergiy.canadacentral.cloudapp.azure.com  
**–°—Ç–∞—Ç—É—Å:** üî¥ –ü—Ä–æ–±–ª–µ–º–∞ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–µ–Ω–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

---

## üìã –°–∏–º–ø—Ç–æ–º—ã

1. ‚úÖ HTTP endpoints —Ä–∞–±–æ—Ç–∞—é—Ç (`/health`, `/status`)
2. ‚úÖ HTTP/2 –≤–∫–ª—é—á–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ gRPC —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 50051
4. ‚úÖ –ü–æ—Ä—è–¥–æ–∫ location –±–ª–æ–∫–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (`/health` –∏ `/status` –ø–µ—Ä–µ–¥ `/`)
5. ‚ùå gRPC –∑–∞–ø—Ä–æ—Å—ã –≤—Å—ë –µ—â—ë –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
6. ‚ùå –û—à–∏–±–∫–∞: `Trying to connect an http1.x server (HTTP status 400)`

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ location –±–ª–æ–∫–æ–≤:
   - `location /health` ‚Üí —Å—Ç—Ä–æ–∫–∞ 50
   - `location /status` ‚Üí —Å—Ç—Ä–æ–∫–∞ 64  
   - `location /` (gRPC) ‚Üí —Å—Ç—Ä–æ–∫–∞ 78

2. ‚úÖ –£–¥–∞–ª–µ–Ω—ã backup —Ñ–∞–π–ª—ã –∏–∑ `/etc/nginx/sites-enabled/`

3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
   - `listen 443 ssl http2;` ‚úÖ
   - `grpc_pass grpc://grpc_backend;` ‚úÖ
   - gRPC —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –Ω–∞ `127.0.0.1:50051` ‚úÖ

### –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

–û—à–∏–±–∫–∞ "Trying to connect an http1.x server" –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞:
- gRPC –∫–ª–∏–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å HTTP/2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- Nginx –æ—Ç–≤–µ—á–∞–µ—Ç HTTP/1.x –≤–º–µ—Å—Ç–æ HTTP/2
- –ò–ª–∏ Nginx –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –∑–∞–ø—Ä–æ—Å –∫–∞–∫ gRPC

---

## üéØ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –ú–æ–¥—É–ª—å ngx_http_grpc_module –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
sudo nginx -V 2>&1 | grep -i grpc
```

–ï—Å–ª–∏ –º–æ–¥—É–ª—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Nginx —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π gRPC.

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Content-Type –¥–ª—è gRPC

gRPC —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π Content-Type: `application/grpc`

Nginx –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å gRPC –∑–∞–ø—Ä–æ—Å—ã –ø–æ:
- Content-Type: `application/grpc`
- –ò–ª–∏ –ø–æ –ø—É—Ç–∏ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

### 3. –ü—Ä–æ–±–ª–µ–º–∞ —Å ALPN negotiation

HTTP/2 —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é ALPN negotiation. –í–æ–∑–º–æ–∂–Ω–æ, –∫–ª–∏–µ–Ω—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ALPN –ø—Ä–æ—Ç–æ–∫–æ–ª—ã.

### 4. –ü—Ä–æ–±–ª–µ–º–∞ —Å grpc_pass –¥–∏—Ä–µ–∫—Ç–∏–≤–æ–π

–í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `grpc_pass` –≤–º–µ—Å—Ç–æ `proxy_pass` –¥–ª—è gRPC.

---

## üîß –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥—É–ª—å ngx_http_grpc_module

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo nginx -V 2>&1 | grep -i grpc

# –ï—Å–ª–∏ –º–æ–¥—É–ª—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Nginx —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π gRPC
# –î–ª—è Ubuntu/Debian:
sudo apt-get update
sudo apt-get install nginx-extras  # –∏–ª–∏ nginx-full —Å grpc –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
```

### –†–µ—à–µ–Ω–∏–µ 2: –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É Content-Type

```nginx
location / {
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º Content-Type –¥–ª—è gRPC
    if ($http_content_type = "application/grpc") {
        grpc_pass grpc://grpc_backend;
        break;
    }
    
    # Fallback –¥–ª—è –¥—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    return 404;
}
```

### –†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è gRPC

```nginx
# gRPC —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—É—Ç—å
location /grpc/ {
    grpc_pass grpc://grpc_backend/;
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
}

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å
location ~ ^/(streaming\.|grpc\.) {
    grpc_pass grpc://grpc_backend;
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
}
```

### –†–µ—à–µ–Ω–∏–µ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é Nginx

gRPC –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–µ–±—É–µ—Ç Nginx 1.13.10+ —Å –º–æ–¥—É–ª–µ–º `ngx_http_grpc_module`.

```bash
nginx -v
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 1.13.10
```

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é Nginx –∏ –Ω–∞–ª–∏—á–∏–µ –º–æ–¥—É–ª—è grpc
2. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Nginx –ø—Ä–∏ gRPC –∑–∞–ø—Ä–æ—Å–µ
3. ‚è≥ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è gRPC
4. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Content-Type

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `server/nginx/grpc-passthrough.conf` - –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `server/scripts/test_grpc_connection.py` - —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- `Docs/CLIENT_CONNECTION_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é

---

**–°—Ç–∞—Ç—É—Å:** üü° –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º–æ–¥—É–ª—è grpc –≤ Nginx
