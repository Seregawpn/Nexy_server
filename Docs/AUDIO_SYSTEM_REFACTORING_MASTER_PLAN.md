# ๐ฏ ะะฐััะตั-ะะปะฐะฝ ะะตัะฐะบัะพัะธะฝะณะฐ ะัะดะธะพัะธััะตะผั

**ะะฐัะฐ:** 2025-12-13  
**ะกัะฐััั:** ะะดะธะฝัะน ะดะพะบัะผะตะฝั ะดะปั ะฟะปะฐะฝะธัะพะฒะฐะฝะธั ะธ ัะตะฐะปะธะทะฐัะธะธ ะธะดะตะฐะปัะฝะพะน ะฐััะธัะตะบัััั ะฐัะดะธะพัะธััะตะผั

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต

1. [ะขะตะบััะฐั ะััะธัะตะบัััะฐ ะธ ะัะพะฑะปะตะผั](#1-ัะตะบััะฐั-ะฐััะธัะตะบัััะฐ-ะธ-ะฟัะพะฑะปะตะผั)
2. [ะะดะตะฐะปัะฝะฐั ะััะธัะตะบัััะฐ](#2-ะธะดะตะฐะปัะฝะฐั-ะฐััะธัะตะบัััะฐ)
3. [ะัะธัะตัะธะธ ะธ ะขัะตะฑะพะฒะฐะฝะธั](#3-ะบัะธัะตัะธะธ-ะธ-ััะตะฑะพะฒะฐะฝะธั)
4. [ะะพะผะผัะฝะธะบะฐัะธะธ ะธ ะขะพัะบะธ ะกะพะตะดะธะฝะตะฝะธั](#4-ะบะพะผะผัะฝะธะบะฐัะธะธ-ะธ-ัะพัะบะธ-ัะพะตะดะธะฝะตะฝะธั)
5. [ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะคะปะฐะณะพะฒ ะธ ะะพะฝัะธะณััะฐัะธะน](#5-ะธัะฟะพะปัะทะพะฒะฐะฝะธะต-ัะปะฐะณะพะฒ-ะธ-ะบะพะฝัะธะณััะฐัะธะน)
6. [ะะปะฐะฝ ะะตะฐะปะธะทะฐัะธะธ](#6-ะฟะปะฐะฝ-ัะตะฐะปะธะทะฐัะธะธ)
7. [ะงะตะบ-ะปะธััั ะัะพะฒะตัะบะธ](#7-ัะตะบ-ะปะธััั-ะฟัะพะฒะตัะบะธ)

---

## 1. ะขะตะบััะฐั ะััะธัะตะบัััะฐ ะธ ะัะพะฑะปะตะผั

### 1.1 ะขะตะบััะฐั ััััะบัััะฐ

**ะคะฐะนะป:** `integration/integrations/voice_recognition_integration.py`  
**ะะฐะทะผะตั:** 3260 ัััะพะบ  
**ะะตััะธะบะธ:**
- 257 ะฑะปะพะบะพะฒ try/except
- 434 ะฟัะตะดัะฟัะตะถะดะตะฝะธั/ะฟัะพะฑะปะตะผ
- 27 ะผะตัะพะดะพะฒ/ััะฝะบัะธะน
- 15+ ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ ัะพััะพัะฝะธั

**ะกัััะบัััะฐ:**
```
VoiceRecognitionIntegration (3260 ัััะพะบ)
โ
โโโ __init__() (ัััะพะบะธ 80-158)
โ   โโโ AVF ะฟะตัะตะผะตะฝะฝัะต (ัััะพะบะธ 101-108)
โ   โโโ Google ะฟะตัะตะผะตะฝะฝัะต (ัััะพะบะธ 109-120)
โ   โโโ ะกะพััะพัะฝะธะต (ัััะพะบะธ 94-98, 118-120)
โ
โโโ initialize() (ัััะพะบะธ 222-450)  # 228 ัััะพะบ!
โ   โโโ AVF ะธะฝะธัะธะฐะปะธะทะฐัะธั (ัััะพะบะธ 228-280)
โ   โโโ SFSpeech ะธะฝะธัะธะฐะปะธะทะฐัะธั (ัััะพะบะธ 282-344)
โ   โโโ Google ะธะฝะธัะธะฐะปะธะทะฐัะธั (ัััะพะบะธ 370-450)
โ
โโโ _on_recording_start() (ัััะพะบะธ 735-1300)  # 565 ัััะพะบ!
โ   โโโ AVF ะฐะบัะธะฒะฐัะธั (ัััะพะบะธ 832-1148)
โ   โโโ Google ะฐะบัะธะฒะฐัะธั (ัััะพะบะธ 1148-1300)
โ
โโโ _on_recording_stop() (ัััะพะบะธ 1549-1770)  # 221 ัััะพะบะฐ!
    โโโ Google ะดะตะฐะบัะธะฒะฐัะธั (ัััะพะบะธ 1549-1707)
    โโโ AVF ะดะตะฐะบัะธะฒะฐัะธั (ัััะพะบะธ 1769-1770)
```

---

### 1.2 ะััะฒะปะตะฝะฝัะต ะฟัะพะฑะปะตะผั

#### ะัะพะฑะปะตะผะฐ #1: ะะพะฝะพะปะธัะฝะฐั ะธะฝัะตะณัะฐัะธั
- โ 3260 ัััะพะบ ะฒ ะพะดะฝะพะผ ัะฐะนะปะต
- โ ะกะผะตัะฐะฝะฝะฐั ะพัะฒะตัััะฒะตะฝะฝะพััั (AVF + Google + ะบะพะพัะดะธะฝะฐัะธั)
- โ ะกะปะพะถะฝะพ ะฝะฐัะพะดะธัั ะฑะฐะณะธ (ะฝะตะฟะพะฝััะฝะพ, ะณะดะต ะฟัะพะฑะปะตะผะฐ)
- โ ะกะปะพะถะฝะพ ัะตััะธัะพะฒะฐัั ะธะทะพะปะธัะพะฒะฐะฝะฝะพ

#### ะัะพะฑะปะตะผะฐ #2: ะะฐััะธะฝััะพะฝะธะทะฐัะธั ัะพััะพัะฝะธะน
- โ ะะฝะพะถะตััะฒะตะฝะฝัะต ะธััะพัะฝะธะบะธ ะธััะธะฝั:
  - `_recording_active` (ะปะพะบะฐะปัะฝัะน ัะปะฐะณ)
  - `_google_recording_active` (ะปะพะบะฐะปัะฝัะน ัะปะฐะณ)
  - `_playback_active` (ะปะพะบะฐะปัะฝัะน ัะปะฐะณ)
  - `state_manager.is_microphone_active()` (ัะตะฝััะฐะปะธะทะพะฒะฐะฝะฝัะน)
- โ ะะพะฝัะปะธะบัั ะผะตะถะดั ะธััะพัะฝะธะบะฐะผะธ
- โ ะกะพััะพัะฝะธะต ะพััะฐะตััั ะฝะตะบะพะฝัะธััะตะฝัะฝัะผ

#### ะัะพะฑะปะตะผะฐ #3: ะัะพะฑะปะตะผั ั ะธะฝะธัะธะฐะปะธะทะฐัะธะตะน
- โ `initialize()` ะฝะต ะฒัะทัะฒะฐะตััั ะธะปะธ ะฝะต ะฒะธะดะฝะพ ะปะพะณะพะฒ
- โ AVF ะฝะต ะธะฝะธัะธะฐะปะธะทะธััะตััั (`_avf_engine = None`)
- โ Google ะฝะต ะธะฝะธัะธะฐะปะธะทะธััะตััั (`_google_recognizer = None`)
- โ ะะตะฟะพะฝััะฝะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั

#### ะัะพะฑะปะตะผะฐ #4: ะกะปะพะถะฝะพััั ะดะธะฐะณะฝะพััะธะบะธ
- โ ะกะปะพะถะฝะพ ะฝะฐะนัะธ ะฟัะพะฑะปะตะผั (AVF ะธะปะธ Google?)
- โ ะะพะณะธ ะฝะต ะฟะพะบะฐะทัะฒะฐัั ะฟะพะปะฝัั ะบะฐััะธะฝั
- โ ะะตั ัะตัะบะพะน ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ ะปะพะณะพะฒ

---

### 1.3 ะะตััะธะบะธ ะฟัะพะฑะปะตะผะฝะพััะธ

| ะะตััะธะบะฐ | ะขะตะบััะตะต ะทะฝะฐัะตะฝะธะต | ะฆะตะปะตะฒะพะต ะทะฝะฐัะตะฝะธะต |
|---------|------------------|------------------|
| ะะฐะทะผะตั ัะฐะนะปะฐ | 3260 ัััะพะบ | โค 500 ัััะพะบ |
| ะะปะพะบะธ try/except | 257 | โค 50 |
| ะัะตะดัะฟัะตะถะดะตะฝะธั | 434 | โค 50 |
| ะััะพัะฝะธะบะธ ะธััะธะฝั | 4 | 1 |
| ะะพะบะฐะปัะฝัะต ัะปะฐะณะธ | 15+ | 0 |
| ะัะตะผั ะฟะพะธัะบะฐ ะฑะฐะณะฐ | 2-4 ัะฐัะฐ | 15-30 ะผะธะฝัั |

---

## 2. ะะดะตะฐะปัะฝะฐั ะััะธัะตะบัััะฐ

### 2.1 ะัะธะฝัะธะฟั ะธะดะตะฐะปัะฝะพะน ะฐััะธัะตะบัััั

1. **ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ**
   - ะะพะดัะปะธ (`modules/`) โ ะฝะธะทะบะพััะพะฒะฝะตะฒะฐั ะปะพะณะธะบะฐ, ะธะทะพะปะธัะพะฒะฐะฝะฝะฐั ะพัะฒะตัััะฒะตะฝะฝะพััั
   - ะะฝัะตะณัะฐัะธะธ (`integration/integrations/`) โ ะบะพะพัะดะธะฝะฐัะธั ัะตัะตะท EventBus, ัะพะฝะบะธะต ะพะฑัััะบะธ
   - Core (`integration/core/`) โ ะธะฝััะฐััััะบัััะฐ (EventBus, StateManager, ErrorHandler)

2. **ะะดะธะฝัะน ะธััะพัะฝะธะบ ะธััะธะฝั**
   - ะขะพะปัะบะพ `ApplicationStateManager` ัะฟัะฐะฒะปัะตั ัะพััะพัะฝะธะตะผ
   - ะะตั ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ ัะพััะพัะฝะธั
   - ะัะพะผะฐัะฝัะต ะพะฟะตัะฐัะธะธ ั lock

3. **ะะทะพะปััะธั ะธ ัะตััะธััะตะผะพััั**
   - ะะพะดัะปะธ ะธะทะพะปะธัะพะฒะฐะฝั ะดััะณ ะพั ะดััะณะฐ
   - ะะตะณะบะพ ัะตััะธัะพะฒะฐัั ะธะทะพะปะธัะพะฒะฐะฝะฝะพ (< 1 ัะตะบัะฝะดั)
   - ะะฐะฒะธัะธะผะพััะธ ัะตัะตะท ะบะพะฝััััะบัะพั

4. **ะงะตัะบะฐั ะธะฝะธัะธะฐะปะธะทะฐัะธั**
   - ะะพะฝััะฝะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั
   - ะะธะฐะณะฝะพััะธัะตัะบะพะต ะปะพะณะธัะพะฒะฐะฝะธะต
   - ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

---

### 2.2 ะะดะตะฐะปัะฝะฐั ััััะบัััะฐ ะผะพะดัะปะตะน

```
modules/
โโโ audio_avf/                    # โ AVF ะผะพะดัะปั (ะดะธะฐะณะฝะพััะธะบะฐ ะธ ะฐะบัะธะฒะฐัะธั)
โ   โโโ core/
โ   โ   โโโ avf_audio_engine.py   # ะะธะทะบะพััะพะฒะฝะตะฒัะน ะดะฒะธะถะพะบ (ัััะตััะฒัััะธะน)
โ   โ   โโโ avf_manager.py        # ๐ ะฃะฟัะฐะฒะปะตะฝะธะต ะถะธะทะฝะตะฝะฝัะผ ัะธะบะปะพะผ
โ   โ   โโโ types.py              # ะขะธะฟั AVF ะผะพะดัะปั
โ   โโโ README.md                 # ะะพะบัะผะตะฝัะฐัะธั AVF ะผะพะดัะปั
โ   โโโ tests/                    # ะขะตััั AVF ะผะพะดัะปั
โ
โโโ audio_google/                 # ๐ Google ะผะพะดัะปั (ะทะฐะฟะธัั ะธ ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต)
    โโโ core/
    โ   โโโ google_manager.py     # ๐ ะฃะฟัะฐะฒะปะตะฝะธะต ะถะธะทะฝะตะฝะฝัะผ ัะธะบะปะพะผ
    โ   โโโ types.py             # ะขะธะฟั Google ะผะพะดัะปั
    โโโ README.md                 # ะะพะบัะผะตะฝัะฐัะธั Google ะผะพะดัะปั
    โโโ tests/                    # ะขะตััั Google ะผะพะดัะปั
```

**ะัะฒะตัััะฒะตะฝะฝะพััั ะผะพะดัะปะตะน:**

**AVF ะผะพะดัะปั:**
- โ ะะฝะธัะธะฐะปะธะทะฐัะธั AVF (ัะพะทะดะฐะฝะธะต AVFAudioEngine)
- โ ะะบัะธะฒะฐัะธั ะผะธะบัะพัะพะฝะฐ ะดะปั ะดะธะฐะณะฝะพััะธะบะธ (~1 ัะตะบ)
- โ ะะตะฐะบัะธะฒะฐัะธั ะผะธะบัะพัะพะฝะฐ
- โ ะะพะปััะตะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพะฑ ััััะพะนััะฒะต
- โ ะะ ัะฟัะฐะฒะปัะตั Google Speech Recognition
- โ ะะ ะบะพะพัะดะธะฝะธััะตั ัะตัะตะท EventBus

**Google ะผะพะดัะปั:**
- โ ะะฝะธัะธะฐะปะธะทะฐัะธั Google Speech Recognition
- โ ะะบัะธะฒะฐัะธั ะทะฐะฟะธัะธ
- โ ะะตะฐะบัะธะฒะฐัะธั ะทะฐะฟะธัะธ
- โ ะะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต ัะตัะธ
- โ ะะ ัะฟัะฐะฒะปัะตั AVF
- โ ะะ ะบะพะพัะดะธะฝะธััะตั ัะตัะตะท EventBus

---

### 2.3 ะะดะตะฐะปัะฝะฐั ััััะบัััะฐ ะธะฝัะตะณัะฐัะธะธ

```
integration/integrations/voice_recognition_integration.py (~500 ัััะพะบ)

class VoiceRecognitionIntegration:
    """ะะฝัะตะณัะฐัะธั ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั ัะตัะธ - ัะพะปัะบะพ ะบะพะพัะดะธะฝะฐัะธั ัะตัะตะท EventBus"""
    
    def __init__(self, event_bus, state_manager, error_handler, config):
        # ะกะพะทะดะฐะตะผ ะผะตะฝะตะดะถะตัั (ะปะพะณะธะบะฐ ะฒ ะผะพะดัะปัั)
        self._avf_manager = AVFManager(avf_config)
        self._google_manager = GoogleManager(google_config)
    
    async def initialize(self) -> bool:
        """ะะฝะธัะธะฐะปะธะทะฐัะธั ะผะตะฝะตะดะถะตัะพะฒ"""
        avf_ok = await self._avf_manager.initialize()
        google_ok = await self._google_manager.initialize()
        # ะะพะดะฟะธัะบะธ ะฝะฐ ัะพะฑััะธั
        await self.event_bus.subscribe(...)
        return avf_ok and google_ok
    
    async def _on_recording_start(self, event: Dict[str, Any]):
        """ะะฑัะฐะฑะพัะบะฐ ัะพะฑััะธั voice.recording_start - ะบะพะพัะดะธะฝะฐัะธั"""
        # 1. AVF ะดะธะฐะณะฝะพััะธะบะฐ (~1 ัะตะบ)
        device_info = await self._avf_manager.activate(duration_sec=1.0)
        # 2. ะะตะฐะบัะธะฒะฐัะธั AVF
        await self._avf_manager.deactivate()
        # 3. ะะฐัะทะฐ 0.2 ัะตะบ
        await asyncio.sleep(0.2)
        # 4. Google ะฐะบัะธะฒะฐัะธั
        await self._google_manager.activate(callback=self._on_google_audio_chunk)
        # 5. ะะฑะฝะพะฒะปะตะฝะธะต ัะพััะพัะฝะธั (ะตะดะธะฝัะน ะธััะพัะฝะธะบ ะธััะธะฝั)
        self.state_manager.set_microphone_state("active", session_id)
        # 6. ะัะฑะปะธะบะฐัะธั ัะพะฑััะธะน
        await self.event_bus.publish("microphone.opened", {...})
```

**ะะฐะทะผะตั:** ~500 ัััะพะบ (ะฒะผะตััะพ 3260)

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะขะพะปัะบะพ ะบะพะพัะดะธะฝะฐัะธั ัะตัะตะท EventBus
- โ ะะพะณะธะบะฐ ะฒ ะผะพะดัะปัั (ะปะตะณะบะพ ัะตััะธัะพะฒะฐัั)
- โ ะะตะณะบะพ ะฝะฐัะพะดะธัั ะฑะฐะณะธ (ะฟะพะฝััะฝะพ, ะณะดะต ะฟัะพะฑะปะตะผะฐ)
- โ ะะดะธะฝัะน ะธััะพัะฝะธะบ ะธััะธะฝั (ัะพะปัะบะพ state_manager)

---

### 2.4 ะะธะทัะฐะปัะฝะพะต ััะฐะฒะฝะตะฝะธะต

**ะขะตะบััะฐั ะฐััะธัะตะบัััะฐ (ะะะ ะะกะขะฌ):**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ VoiceRecognitionIntegration (3260 ัััะพะบ)                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ โ
โ  โ AVF ะะพะณะธะบะฐ   โ  โ Google ะะพะณะธะบะฐโ  โ ะะพะพัะดะธะฝะฐัะธั  โ โ
โ  โ (ัะผะตัะฐะฝะฐ)    โ  โ (ัะผะตัะฐะฝะฐ)    โ  โ (ัะผะตัะฐะฝะฐ)    โ โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ะกะพััะพัะฝะธะต (ะผะฝะพะถะตััะฒะตะฝะฝัะต ะธััะพัะฝะธะบะธ)              โ  โ
โ  โ - _recording_active (ะปะพะบะฐะปัะฝัะน)                  โ  โ
โ  โ - _google_recording_active (ะปะพะบะฐะปัะฝัะน)           โ  โ
โ  โ - _playback_active (ะปะพะบะฐะปัะฝัะน)                   โ  โ
โ  โ - state_manager (ัะตะฝััะฐะปะธะทะพะฒะฐะฝะฝัะน)                โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะดะตะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ (ะะะ ะะะะะะ ะะซะขะฌ):**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ VoiceRecognitionIntegration (~500 ัััะพะบ)                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  ะขะพะปัะบะพ ะบะพะพัะดะธะฝะฐัะธั ัะตัะตะท EventBus:                      โ
โ  - ะะฑัะฐะฑะพัะบะฐ ัะพะฑััะธะน                                     โ
โ  - ะัะทะพะฒั ะผะตะฝะตะดะถะตัะพะฒ                                     โ
โ  - ะัะฑะปะธะบะฐัะธั ัะพะฑััะธะน                                    โ
โ                                                          โ
โ  โโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโ     โ
โ  โ AVF Manager      โ         โ Google Manager   โ     โ
โ  โ (ะผะพะดัะปั)         โ         โ (ะผะพะดัะปั)         โ     โ
โ  โ                  โ         โ                  โ     โ
โ  โ - initialize()   โ         โ - initialize()   โ     โ
โ  โ - activate()     โ         โ - activate()     โ     โ
โ  โ - deactivate()   โ         โ - deactivate()   โ     โ
โ  โโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโ     โ
โ         โ                         โ                      โ
โ         โโโโโโโโโโโฌโโโโโโโโโโโโโโโโ                      โ
โ                   โ                                       โ
โ         โโโโโโโโโโโโผโโโโโโโโโโโ                          โ
โ         โ ApplicationState    โ                          โ
โ         โ Manager             โ                          โ
โ         โ (ะตะดะธะฝัะน ะธััะพัะฝะธะบ)   โ                          โ
โ         โโโโโโโโโโโโโโโโโโโโโโ                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 3. ะัะธัะตัะธะธ ะธ ะขัะตะฑะพะฒะฐะฝะธั

### 3.1 ะัะธัะตัะธะธ ะธะดะตะฐะปัะฝะพะน ะฐััะธัะตะบัััั

#### ะัะธัะตัะธะน #1: ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ
- โ ะะพะดัะปั ะพัะฒะตัะฐะตั ะทะฐ ะพะดะฝั ะทะฐะดะฐัั
- โ ะะฐะทะผะตั ะผะพะดัะปั โค 500 ัััะพะบ
- โ ะะฝัะตะณัะฐัะธั ัะพะปัะบะพ ะบะพะพัะดะธะฝะธััะตั ัะตัะตะท EventBus
- โ ะะฐะทะผะตั ะธะฝัะตะณัะฐัะธะธ โค 500 ัััะพะบ

#### ะัะธัะตัะธะน #2: ะะดะธะฝัะน ะธััะพัะฝะธะบ ะธััะธะฝั
- โ ะขะพะปัะบะพ `ApplicationStateManager` ัะฟัะฐะฒะปัะตั ัะพััะพัะฝะธะตะผ
- โ ะะตั ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ ัะพััะพัะฝะธั
- โ ะัะต ะธะทะผะตะฝะตะฝะธั ัะตัะตะท `state_manager.set_*()`
- โ ะัะต ะฟัะพะฒะตัะบะธ ัะตัะตะท `state_manager.is_*()`

#### ะัะธัะตัะธะน #3: ะะทะพะปััะธั ะธ ัะตััะธััะตะผะพััั
- โ ะะพะดัะปะธ ะธะทะพะปะธัะพะฒะฐะฝั ะดััะณ ะพั ะดััะณะฐ
- โ ะะตะณะบะพ ัะตััะธัะพะฒะฐัั ะธะทะพะปะธัะพะฒะฐะฝะฝะพ (< 1 ัะตะบัะฝะดั)
- โ ะะฐะฒะธัะธะผะพััะธ ัะตัะตะท ะบะพะฝััััะบัะพั

#### ะัะธัะตัะธะน #4: ะงะตัะบะฐั ะธะฝะธัะธะฐะปะธะทะฐัะธั
- โ ะะพะฝััะฝะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั
- โ ะะธะฐะณะฝะพััะธัะตัะบะพะต ะปะพะณะธัะพะฒะฐะฝะธะต
- โ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

---

### 3.2 ะขัะตะฑะพะฒะฐะฝะธั ะบ ะผะพะดัะปัะผ

**REQ-MOD-001: ะะฐะทะผะตั ะผะพะดัะปั**
- โ ะะฐะทะผะตั ะผะพะดัะปั โค 500 ัััะพะบ
- โ ะะพะปะธัะตััะฒะพ ะผะตัะพะดะพะฒ โค 20
- โ ะะพะปะธัะตััะฒะพ ะฑะปะพะบะพะฒ try/except โค 50

**REQ-MOD-002: ะัะฒะตัััะฒะตะฝะฝะพััั ะผะพะดัะปั**
- โ ะะพะดัะปั ะพัะฒะตัะฐะตั ะทะฐ ะพะดะฝั ะบะพะฝะบัะตัะฝัั ะทะฐะดะฐัั
- โ ะะพะดัะปั ะฝะต ะทะฝะฐะตั ะพ ะดััะณะธั ะผะพะดัะปัั
- โ ะะพะดัะปั ะฝะต ะทะฝะฐะตั ะพ EventBus
- โ ะะพะดัะปั ะฒะพะทะฒัะฐัะฐะตั ัะตะทัะปััะฐัั

**REQ-MOD-003: ะะฐะฒะธัะธะผะพััะธ ะผะพะดัะปั**
- โ ะะฐะฒะธัะธะผะพััะธ ัะตัะตะท ะบะพะฝััััะบัะพั
- โ ะะพะฝัะธะณััะฐัะธั ัะตัะตะท ะบะพะฝััััะบัะพั
- โ ะะตั ะณะปะพะฑะฐะปัะฝัั ะทะฐะฒะธัะธะผะพััะตะน
- โ ะะตะณะบะพ ัะตััะธัะพะฒะฐัั ะธะทะพะปะธัะพะฒะฐะฝะฝะพ

**REQ-MOD-004: ะะพะบัะผะตะฝัะฐัะธั ะผะพะดัะปั**
- โ README.md ั ะพะฟะธัะฐะฝะธะตะผ ะผะพะดัะปั
- โ ะัะฑะปะธัะฝัะต ะธะฝัะตััะตะนัั ะฒ types.py
- โ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั
- โ ะะธะฐะณะฝะพััะธัะตัะบะธะต ัะฝะดะฟะพะธะฝัั (ะตัะปะธ ะฝัะถะฝะพ)

---

### 3.3 ะขัะตะฑะพะฒะฐะฝะธั ะบ ะธะฝัะตะณัะฐัะธัะผ

**REQ-INT-001: ะะฐะทะผะตั ะธะฝัะตะณัะฐัะธะธ**
- โ ะะฐะทะผะตั ะธะฝัะตะณัะฐัะธะธ โค 500 ัััะพะบ
- โ ะะพะปะธัะตััะฒะพ ะผะตัะพะดะพะฒ โค 15
- โ ะะพะปะธัะตััะฒะพ ะฑะปะพะบะพะฒ try/except โค 30

**REQ-INT-002: ะัะฒะตัััะฒะตะฝะฝะพััั ะธะฝัะตะณัะฐัะธะธ**
- โ ะะฝัะตะณัะฐัะธั ัะพะปัะบะพ ะบะพะพัะดะธะฝะธััะตั ัะตัะตะท EventBus
- โ ะะพะณะธะบะฐ ะฒ ะผะพะดัะปัั, ะฝะต ะฒ ะธะฝัะตะณัะฐัะธะธ
- โ ะะพะดะฟะธัะบะธ ะธ ะฟัะฑะปะธะบะฐัะธะธ ัะพะฑััะธะน ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝั
- โ ะะพะฝััะฐะบัั ัะพะฑััะธะน ะฒะฐะปะธะดะธัััััั

**REQ-INT-003: ะกะพััะพัะฝะธะต ะฒ ะธะฝัะตะณัะฐัะธะธ**
- โ ะะตั ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ ัะพััะพัะฝะธั
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะพะปัะบะพ `ApplicationStateManager`
- โ ะัะต ะธะทะผะตะฝะตะฝะธั ัะพััะพัะฝะธั ัะตัะตะท `state_manager.set_*()`
- โ ะัะต ะฟัะพะฒะตัะบะธ ัะพััะพัะฝะธั ัะตัะตะท `state_manager.is_*()`

**REQ-INT-004: ะะฝะธัะธะฐะปะธะทะฐัะธั ะธะฝัะตะณัะฐัะธะธ**
- โ ะะพะฝััะฝะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
- โ ะะธะฐะณะฝะพััะธัะตัะบะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฝะฐ ะบะฐะถะดะพะผ ััะฐะฟะต
- โ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
- โ ะะพะทะฒัะฐั bool ัะตะทัะปััะฐัะฐ

---

### 3.4 ะขัะตะฑะพะฒะฐะฝะธั ะบ ัะตะฝััะฐะปะธะทะฐัะธะธ

**REQ-CENT-STATE-001: ะะดะธะฝัะน ะธััะพัะฝะธะบ ะธััะธะฝั**
- โ ะขะพะปัะบะพ `ApplicationStateManager` ัะฟัะฐะฒะปัะตั ัะพััะพัะฝะธะตะผ
- โ ะะตั ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ ัะพััะพัะฝะธั ะฒ ะธะฝัะตะณัะฐัะธัั/ะผะพะดัะปัั
- โ ะัะต ะธะทะผะตะฝะตะฝะธั ัะพััะพัะฝะธั ัะตัะตะท `state_manager.set_*()`
- โ ะัะต ะฟัะพะฒะตัะบะธ ัะพััะพัะฝะธั ัะตัะตะท `state_manager.is_*()`

**REQ-CENT-CONFIG-001: ะะดะธะฝัะน ะธััะพัะฝะธะบ ะบะพะฝัะธะณััะฐัะธะธ**
- โ ะะดะธะฝััะฒะตะฝะฝัะน ะธััะพัะฝะธะบ: `config/unified_config.yaml`
- โ ะะฐะณััะทะบะฐ ัะตัะตะท `UnifiedConfigLoader`
- โ ะะฐะปะธะดะฐัะธั ัะตัะตะท ััะตะผั `config/schemas/`
- โ ะะพะบัะผะตะฝัะฐัะธั ะบะพะฝัะธะณััะฐัะธะธ

**REQ-CENT-ERROR-001: ะะดะธะฝัะน ะพะฑัะฐะฑะพััะธะบ ะพัะธะฑะพะบ**
- โ ะัะต ะพัะธะฑะบะธ ัะตัะตะท `ErrorHandler`
- โ ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ะบะพะดั ะพัะธะฑะพะบ (E_*)
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะพัะธะฑะพะบ ั ะบะพะฝัะตะบััะพะผ
- โ ะะพัััะฐะฝะพะฒะปะตะฝะธะต ัะพััะพัะฝะธั ะฟะพัะปะต ะพัะธะฑะพะบ

---

## 4. ะะพะผะผัะฝะธะบะฐัะธะธ ะธ ะขะพัะบะธ ะกะพะตะดะธะฝะตะฝะธั

### 4.1 ะะพะผะผัะฝะธะบะฐัะธั ัะตัะตะท EventBus

**REQ-COMM-EVENT-001: ะะพะดะฟะธัะบะธ ะฝะฐ ัะพะฑััะธั**
- โ ะัะต ะฟะพะดะฟะธัะบะธ ะฒ ะผะตัะพะดะต `initialize()` ะธะฝัะตะณัะฐัะธะธ
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต `EventPriority` ะดะปั ะฟัะธะพัะธัะตัะพะฒ
- โ ะะพะบัะผะตะฝัะฐัะธั ะฟะพะดะฟะธัะพะบ ะฒ ะบะพะฝััะฐะบัะต EventBus
- โ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะฒ ะฟะพะดะฟะธััะธะบะฐั

**REQ-COMM-EVENT-002: ะัะฑะปะธะบะฐัะธั ัะพะฑััะธะน**
- โ ะัะต ะฟัะฑะปะธะบะฐัะธะธ ัะตัะตะท `event_bus.publish()`
- โ Payload ะฒะฐะปะธะดะธััะตััั ะฟะตัะตะด ะฟัะฑะปะธะบะฐัะธะตะน
- โ ะกะพะฑััะธั ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝั ะฒ ะบะพะฝััะฐะบัะต EventBus
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะฟัะฑะปะธะบะฐัะธะธ ัะพะฑััะธะน

**REQ-COMM-EVENT-003: ะะพะฝััะฐะบัั EventBus**
- โ ะะพะฝััะฐะบั EventBus ัะพะทะดะฐะฝ ะธ ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝ
- โ ะกะพะฑััะธั ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝั ั ะฟะพะปะฝัะผะธ payload ััะตะผะฐะผะธ
- โ ะะฐะปะธะดะฐัะธั payload ะฝะฐ ะณัะฐะฝะธัะต ะธะฝัะตะณัะฐัะธะธ
- โ ะะตััะธะพะฝะธัะพะฒะฐะฝะธะต ะดะปั breaking changes

**ะัะธะผะตั ะบะพะฝััะฐะบัะฐ:**
```python
VOICE_RECOGNITION_CONTRACT = {
    "module": "voice_recognition",
    "version": "1.0",
    "events": {
        "input": {
            "voice.recording_start": {
                "payload": {
                    "session_id": "string (uuid4)",
                    "source": "string (keyboard|automatic)"
                },
                "required": ["session_id"]
            },
            "voice.recording_stop": {
                "payload": {
                    "session_id": "string (uuid4)"
                },
                "required": ["session_id"]
            }
        },
        "output": {
            "microphone.opened": {
                "payload": {
                    "session_id": "string (uuid4)",
                    "device_info": "dict"
                },
                "required": ["session_id", "device_info"]
            },
            "microphone.closed": {
                "payload": {
                    "session_id": "string (uuid4)"
                },
                "required": ["session_id"]
            }
        }
    }
}
```

---

### 4.2 ะะพะผะผัะฝะธะบะฐัะธั ัะตัะตะท ApplicationStateManager

**REQ-COMM-STATE-001: ะะทะผะตะฝะตะฝะธะต ัะพััะพัะฝะธั**
- โ ะัะต ะธะทะผะตะฝะตะฝะธั ัะพััะพัะฝะธั ัะตัะตะท `state_manager.set_*()`
- โ ะัะพะผะฐัะฝัะต ะพะฟะตัะฐัะธะธ ั lock
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะธะทะผะตะฝะตะฝะธะน ัะพััะพัะฝะธั
- โ ะะตั ะฟััะผะพะณะพ ะดะพัััะฟะฐ ะบ ะฒะฝัััะตะฝะฝะตะผั ัะพััะพัะฝะธั

**REQ-COMM-STATE-002: ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั**
- โ ะัะต ะฟัะพะฒะตัะบะธ ัะพััะพัะฝะธั ัะตัะตะท `state_manager.is_*()`
- โ ะะตั ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ ะดะปั ะฟัะพะฒะตัะบะธ ัะพััะพัะฝะธั
- โ ะัะพะผะฐัะฝัะต ะพะฟะตัะฐัะธะธ ั lock
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะฟัะพะฒะตัะพะบ (ะตัะปะธ ะฝัะถะฝะพ)

---

### 4.3 ะะพะผะผัะฝะธะบะฐัะธั ัะตัะตะท ErrorHandler

**REQ-COMM-ERROR-001: ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ**
- โ ะัะต ะพัะธะฑะบะธ ัะตัะตะท `error_handler.handle_error()`
- โ ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ะบะพะดั ะพัะธะฑะพะบ (E_*)
- โ ะะพะฝัะตะบัั ะพัะธะฑะพะบ (session_id, source, action)
- โ ะะพัััะฐะฝะพะฒะปะตะฝะธะต ัะพััะพัะฝะธั ะฟะพัะปะต ะพัะธะฑะพะบ

---

### 4.4 ะััะผัะต ะฒัะทะพะฒั (ะผะพะดัะปะธ โ ะธะฝัะตะณัะฐัะธะธ)

**REQ-COMM-DIRECT-001: ะััะผัะต ะฒัะทะพะฒั ะผะพะดัะปะตะน**
- โ ะะฝัะตะณัะฐัะธะธ ะฒัะทัะฒะฐัั ะผะพะดัะปะธ ะฝะฐะฟััะผัั (ัะฐะทัะตัะตะฝะพ)
- โ ะะพะดัะปะธ ะฝะต ะฒัะทัะฒะฐัั ะดััะณะธะต ะผะพะดัะปะธ (ะทะฐะฟัะตัะตะฝะพ)
- โ ะะฝัะตะณัะฐัะธะธ ะฝะต ะฒัะทัะฒะฐัั ะดััะณะธะต ะธะฝัะตะณัะฐัะธะธ (ะทะฐะฟัะตัะตะฝะพ)
- โ ะัะต ะบะพะผะผัะฝะธะบะฐัะธะธ ัะตัะตะท EventBus ะธะปะธ ะฟััะผัะต ะฒัะทะพะฒั ะผะตะฝะตะดะถะตัะพะฒ

**ะะฐะทัะตัะตะฝะพ:**
```python
# โ ะะะะะะะฌะะ: ะะฝัะตะณัะฐัะธั ะฒัะทัะฒะฐะตั ะผะพะดัะปั ะฝะฐะฟััะผัั
class VoiceRecognitionIntegration:
    async def _on_recording_start(self, event: Dict[str, Any]):
        device_info = await self._avf_manager.activate(duration_sec=1.0)
        await self._google_manager.activate(callback=self._on_google_audio_chunk)
```

**ะะฐะฟัะตัะตะฝะพ:**
```python
# โ ะะะะะะะะะฌะะ: ะะพะดัะปั ะฒัะทัะฒะฐะตั ะดััะณะพะน ะผะพะดัะปั
class AVFManager:
    async def activate(self):
        await self._google_manager.activate()  # โ ะะะะะะฉะะะ

# โ ะะะะะะะะะฌะะ: ะะฝัะตะณัะฐัะธั ะฒัะทัะฒะฐะตั ะดััะณัั ะธะฝัะตะณัะฐัะธั
class VoiceRecognitionIntegration:
    async def _on_recording_start(self, event: Dict[str, Any]):
        await self._input_integration.some_method()  # โ ะะะะะะฉะะะ
```

---

## 5. ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะคะปะฐะณะพะฒ ะธ ะะพะฝัะธะณััะฐัะธะน

### 5.1 Feature Flags ะธ Kill-Switches

**REQ-FLAGS-SOURCE-001: ะััะพัะฝะธะบะธ feature flags**
- โ `config/unified_config.yaml` โ ะพัะฝะพะฒะฝะพะน ะธััะพัะฝะธะบ
- โ ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (`os.getenv()`) โ ะฟะตัะตะพะฟัะตะดะตะปะตะฝะธะต
- โ ะัะธะพัะธัะตั: env ะฟะตัะตะผะตะฝะฝัะต > unified_config.yaml

**REQ-FLAGS-LOAD-001: ะะฐะณััะทะบะฐ feature flags**
- โ ะะฐะณััะทะบะฐ ัะตัะตะท `UnifiedConfigLoader`
- โ ะัะพะฒะตัะบะฐ env ะฟะตัะตะผะตะฝะฝัั
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะทะฐะณััะทะบะธ ัะปะฐะณะพะฒ
- โ ะะฐะปะธะดะฐัะธั ะทะฝะฐัะตะฝะธะน ัะปะฐะณะพะฒ

**REQ-FLAGS-USE-001: ะัะฟะพะปัะทะพะฒะฐะฝะธะต feature flags**
- โ ะัะพะฒะตัะบะฐ ัะปะฐะณะพะฒ ะฟะตัะตะด ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะธัะฟะพะปัะทะพะฒะฐะฝะธั ัะปะฐะณะพะฒ
- โ Fallback ะฝะฐ legacy ะฟััั ะฟัะธ ะพัะบะปััะตะฝะฝะพะผ ัะปะฐะณะต
- โ ะะพะบัะผะตะฝัะฐัะธั ัะปะฐะณะพะฒ ะฒ `Docs/FEATURE_FLAGS.md`

**ะัะธะผะตั:**
```python
class AVFManager:
    def _check_feature_flag(self) -> bool:
        """ะัะพะฒะตัะบะฐ feature flag ั ััะตัะพะผ ะฟัะธะพัะธัะตัะพะฒ"""
        # โ ะัะพะฒะตัะบะฐ kill-switch ะธะท env (ะฟัะธะพัะธัะตั)
        ks_env = os.getenv("NEXY_KS_AVF_ENABLED", "false").lower() == "true"
        if ks_env:
            logger.warning("โ๏ธ [AVF] Kill-switch ะฒะบะปััะตะฝ ัะตัะตะท env ะฟะตัะตะผะตะฝะฝัั")
            return False
        
        # โ ะัะพะฒะตัะบะฐ kill-switch ะธะท unified_config (fallback)
        loader = UnifiedConfigLoader()
        ks_config = loader.get_audio_avf_config().get("ks_avf", {})
        ks_unified = ks_config.get("enabled", False)
        if ks_unified:
            logger.warning("โ๏ธ [AVF] Kill-switch ะฒะบะปััะตะฝ ัะตัะตะท unified_config")
            return False
        
        # โ ะัะพะฒะตัะบะฐ feature flag
        return self._config.enabled
```

---

### 5.2 ะะพะฝัะธะณััะฐัะธะธ

**REQ-CONFIG-LOAD-001: ะะฐะณััะทะบะฐ ัะตัะตะท UnifiedConfigLoader**
- โ ะัะต ะทะฐะณััะทะบะธ ะบะพะฝัะธะณััะฐัะธะธ ัะตัะตะท `UnifiedConfigLoader`
- โ ะััะธัะพะฒะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะทะฐะณััะทะบะธ
- โ ะะฐะปะธะดะฐัะธั ัะตัะตะท ััะตะผั

**REQ-CONFIG-CREATE-001: ะกะพะทะดะฐะฝะธะต ะธะท unified_config**
- โ ะะตัะพะด `from_unified_config()` ะดะปั ัะพะทะดะฐะฝะธั ะบะพะฝัะธะณััะฐัะธะธ
- โ ะะฐะปะธะดะฐัะธั ัะตัะตะท ััะตะผั
- โ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะฒะฐะปะธะดะฐัะธะธ
- โ Fallback ะฝะฐ ะทะฝะฐัะตะฝะธั ะฟะพ ัะผะพะปัะฐะฝะธั

**ะัะธะผะตั:**
```python
@dataclass
class AVFConfig:
    enabled: bool = True
    input_format: str = "16kHz, mono, int16"
    buffer_size_ms: int = 100
    enable_hardware_optimization: bool = True
    
    @classmethod
    def from_unified_config(cls, loader: UnifiedConfigLoader) -> "AVFConfig":
        """ะกะพะทะดะฐะฝะธะต ะธะท unified_config"""
        logger.info("๐ [AVF] ะะฐะณััะทะบะฐ ะบะพะฝัะธะณััะฐัะธะธ ะธะท unified_config...")
        
        try:
            # โ ะะฐะณััะทะบะฐ ะธะท unified_config
            avf_config = loader.get_audio_avf_config()
            
            # โ ะะฐะปะธะดะฐัะธั ัะตัะตะท ััะตะผั
            validated_config = validate_avf_config(avf_config)
            
            # โ ะกะพะทะดะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ
            config = cls(
                enabled=validated_config.get("enabled", True),
                input_format=validated_config.get("input_format", "16kHz, mono, int16"),
                buffer_size_ms=validated_config.get("buffer_size_ms", 100),
                enable_hardware_optimization=validated_config.get("enable_hardware_optimization", True)
            )
            
            logger.info("โ [AVF] ะะพะฝัะธะณััะฐัะธั ัะพะทะดะฐะฝะฐ ะธะท unified_config")
            return config
        except Exception as e:
            logger.error(f"โ [AVF] ะัะธะฑะบะฐ ัะพะทะดะฐะฝะธั ะบะพะฝัะธะณััะฐัะธะธ: {e}")
            logger.exception("โ [AVF] ะะตัะฐะปะธ ะธัะบะปััะตะฝะธั:")
            # โ Fallback ะฝะฐ ะทะฝะฐัะตะฝะธั ะฟะพ ัะผะพะปัะฐะฝะธั
            return cls()
```

---

### 5.3 ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะทะฐะณััะทะบะธ

**REQ-LOAD-SEQ-001: ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะทะฐะณััะทะบะธ**
- โ 1. ะะฐะณััะทะบะฐ unified_config ัะตัะตะท UnifiedConfigLoader
- โ 2. ะัะพะฒะตัะบะฐ env ะฟะตัะตะผะตะฝะฝัั (ะฟัะธะพัะธัะตั)
- โ 3. ะัะพะฒะตัะบะฐ unified_config (fallback)
- โ 4. ะะฐะปะธะดะฐัะธั ัะตัะตะท ััะตะผั
- โ 5. ะกะพะทะดะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ
- โ 6. ะะพะณะธัะพะฒะฐะฝะธะต ะทะฐะณััะทะบะธ

---

## 6. ะะปะฐะฝ ะะตะฐะปะธะทะฐัะธะธ

### 6.1 ะะตะดะตะปั 1: ะัะธัะธัะตัะบะธะต ะธัะฟัะฐะฒะปะตะฝะธั (5-7 ะดะฝะตะน)

#### ะะตะฝั 1-2: ะะธะฐะณะฝะพััะธะบะฐ initialize() (0.5 ะดะฝั)

**ะฆะตะปั:** ะะพะฝััั, ะฟะพัะตะผั `initialize()` ะฝะต ะฒัะทัะฒะฐะตััั

**ะะตะนััะฒะธั:**
1. ะะพะฑะฐะฒะธัั ะดะธะฐะณะฝะพััะธัะตัะบะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒ `coordinator.run()`
2. ะะพะฑะฐะฒะธัั ะปะพะณะธัะพะฒะฐะฝะธะต ะฒ ะฝะฐัะฐะปะต `initialize()`
3. ะกะพะทะดะฐัั `Docs/INITIALIZATION_SEQUENCE.md`

**ะะตะทัะปััะฐั:**
- ะะพะฝััะฝะพ, ะฟะพัะตะผั `initialize()` ะฝะต ะฒัะทัะฒะฐะตััั
- ะัะฟัะฐะฒะปะตะฝะฐ ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ

---

#### ะะตะฝั 3-5: ะะฐะทะดะตะปะตะฝะธะต AVF ะธ Google (3-4 ะดะฝั)

**ะฆะตะปั:** ะัะฝะตััะธ AVF ะธ Google ะปะพะณะธะบั ะฒ ะพัะดะตะปัะฝัะต ะผะพะดัะปะธ

**ะะตะนััะฒะธั:**

**ะะตะฝั 3: ะกะพะทะดะฐะฝะธะต AVF ะผะพะดัะปั**
1. ะกะพะทะดะฐัั ััััะบัััั ะผะพะดัะปั:
   ```bash
   mkdir -p modules/audio_avf/core
   touch modules/audio_avf/__init__.py
   touch modules/audio_avf/core/__init__.py
   touch modules/audio_avf/core/avf_manager.py
   touch modules/audio_avf/core/types.py
   touch modules/audio_avf/README.md
   ```

2. ะกะพะทะดะฐัั `modules/audio_avf/core/types.py`:
   ```python
   @dataclass
   class AVFConfig:
       enabled: bool = True
       input_format: str = "16kHz, mono, int16"
       buffer_size_ms: int = 100
       enable_hardware_optimization: bool = True
       
       @classmethod
       def from_unified_config(cls, loader: UnifiedConfigLoader) -> "AVFConfig":
           # ะะฐะณััะทะบะฐ ะธ ะฒะฐะปะธะดะฐัะธั
           pass
   
   @dataclass
   class DeviceInfo:
       device_name: str
       device_uid: str
       format: Dict[str, Any]
       diagnostics: Dict[str, Any]
       
       def to_dict(self) -> Dict[str, Any]:
           return {...}
   ```

3. ะกะพะทะดะฐัั `modules/audio_avf/core/avf_manager.py`:
   ```python
   class AVFManager:
       def __init__(self, config: AVFConfig):
           self._config = config
           self._engine: Optional[AVFAudioEngine] = None
           self._initialized: bool = False
           self._active: bool = False
           self._lock = asyncio.Lock()
       
       async def initialize(self) -> bool:
           """ะะฝะธัะธะฐะปะธะทะฐัะธั AVF (ัะพะทะดะฐะตั AVFAudioEngine)"""
           # ะะพะณะธะบะฐ ะธะท VoiceRecognitionIntegration.initialize() (ัััะพะบะธ 228-280)
       
       async def activate(self, duration_sec: float = 1.0) -> DeviceInfo:
           """ะะบัะธะฒะฐัะธั ะผะธะบัะพัะพะฝะฐ ะดะปั ะดะธะฐะณะฝะพััะธะบะธ"""
           # ะะพะณะธะบะฐ ะธะท _get_device_info_via_avf() (ัััะพะบะธ 1282-1340)
       
       async def deactivate(self) -> bool:
           """ะะตะฐะบัะธะฒะฐัะธั ะผะธะบัะพัะพะฝะฐ"""
           # ะะพะณะธะบะฐ ะธะท _on_recording_stop() (ัััะพะบะธ 1769-1770)
   ```

4. ะะฑะฝะพะฒะธัั `VoiceRecognitionIntegration`:
   ```python
   from modules.audio_avf import AVFManager, AVFConfig
   
   class VoiceRecognitionIntegration:
       def __init__(self, ...):
           loader = UnifiedConfigLoader()
           avf_config = AVFConfig.from_unified_config(loader)
           self._avf_manager = AVFManager(avf_config)
       
       async def initialize(self) -> bool:
           avf_ok = await self._avf_manager.initialize()
   ```

**ะะตะฝั 4: ะกะพะทะดะฐะฝะธะต Google ะผะพะดัะปั**
1. ะกะพะทะดะฐัั ััััะบัััั ะผะพะดัะปั:
   ```bash
   mkdir -p modules/audio_google/core
   touch modules/audio_google/__init__.py
   touch modules/audio_google/core/__init__.py
   touch modules/audio_google/core/google_manager.py
   touch modules/audio_google/core/types.py
   touch modules/audio_google/README.md
   ```

2. ะกะพะทะดะฐัั `modules/audio_google/core/types.py`:
   ```python
   @dataclass
   class GoogleConfig:
       language: str = "en-US"
       phrase_time_limit: Optional[float] = None
       energy_threshold: int = 4000
       pause_threshold: float = 0.8
       
       @classmethod
       def from_unified_config(cls, loader: UnifiedConfigLoader) -> "GoogleConfig":
           # ะะฐะณััะทะบะฐ ะธ ะฒะฐะปะธะดะฐัะธั
           pass
   ```

3. ะกะพะทะดะฐัั `modules/audio_google/core/google_manager.py`:
   ```python
   class GoogleManager:
       def __init__(self, config: GoogleConfig):
           self._config = config
           self._recognizer: Optional[sr.Recognizer] = None
           self._microphone: Optional[sr.Microphone] = None
           self._stop_listening: Optional[Callable] = None
           self._recording_active: bool = False
           self._audio_data: Optional[sr.AudioData] = None
           self._lock = threading.Lock()
       
       async def initialize(self) -> bool:
           """ะะฝะธัะธะฐะปะธะทะฐัะธั Google (ัะพะทะดะฐะตั Recognizer ะธ Microphone)"""
           # ะะพะณะธะบะฐ ะธะท VoiceRecognitionIntegration.initialize() (ัััะพะบะธ 370-450)
       
       async def activate(self, callback: Callable) -> bool:
           """ะะบัะธะฒะฐัะธั ะทะฐะฟะธัะธ (ะทะฐะฟััะบะฐะตั listen_in_background)"""
           # ะะพะณะธะบะฐ ะธะท _on_recording_start() (ัััะพะบะธ 1148-1300)
       
       async def deactivate(self) -> bool:
           """ะะตะฐะบัะธะฒะฐัะธั ะทะฐะฟะธัะธ (ะพััะฐะฝะฐะฒะปะธะฒะฐะตั listen_in_background)"""
           # ะะพะณะธะบะฐ ะธะท _on_recording_stop() (ัััะพะบะธ 1549-1707)
   ```

4. ะะฑะฝะพะฒะธัั `VoiceRecognitionIntegration`:
   ```python
   from modules.audio_google import GoogleManager, GoogleConfig
   
   class VoiceRecognitionIntegration:
       def __init__(self, ...):
           loader = UnifiedConfigLoader()
           google_config = GoogleConfig.from_unified_config(loader)
           self._google_manager = GoogleManager(google_config)
   ```

**ะะตะฝั 5: ะฃะฟัะพัะตะฝะธะต ะธะฝัะตะณัะฐัะธะธ**
1. ะฃะดะฐะปะธัั AVF ะปะพะณะธะบั ะธะท `VoiceRecognitionIntegration`:
   - ะฃะดะฐะปะธัั ัััะพะบะธ 228-280 (ะธะฝะธัะธะฐะปะธะทะฐัะธั AVF)
   - ะฃะดะฐะปะธัั ัััะพะบะธ 832-1148 (ะฐะบัะธะฒะฐัะธั AVF)
   - ะฃะดะฐะปะธัั ัััะพะบะธ 1769-1770 (ะดะตะฐะบัะธะฒะฐัะธั AVF)
   - ะะฐะผะตะฝะธัั ะฝะฐ ะฒัะทะพะฒั `avf_manager`

2. ะฃะดะฐะปะธัั Google ะปะพะณะธะบั ะธะท `VoiceRecognitionIntegration`:
   - ะฃะดะฐะปะธัั ัััะพะบะธ 370-450 (ะธะฝะธัะธะฐะปะธะทะฐัะธั Google)
   - ะฃะดะฐะปะธัั ัััะพะบะธ 1148-1300 (ะฐะบัะธะฒะฐัะธั Google)
   - ะฃะดะฐะปะธัั ัััะพะบะธ 1549-1707 (ะดะตะฐะบัะธะฒะฐัะธั Google)
   - ะะฐะผะตะฝะธัั ะฝะฐ ะฒัะทะพะฒั `google_manager`

3. ะััะฐะฒะธัั ัะพะปัะบะพ ะบะพะพัะดะธะฝะฐัะธั:
   - ะะฑัะฐะฑะพัะบะฐ ัะพะฑััะธะน EventBus
   - ะัะทะพะฒั ะผะตะฝะตะดะถะตัะพะฒ
   - ะัะฑะปะธะบะฐัะธั ัะพะฑััะธะน

**ะะตะทัะปััะฐั:**
- AVF ะปะพะณะธะบะฐ ะธะทะพะปะธัะพะฒะฐะฝะฐ ะฒ ะผะพะดัะปะต
- Google ะปะพะณะธะบะฐ ะธะทะพะปะธัะพะฒะฐะฝะฐ ะฒ ะผะพะดัะปะต
- `VoiceRecognitionIntegration` ~500 ัััะพะบ (ะฒะผะตััะพ 3260)

---

#### ะะตะฝั 6-7: ะฃะฝะธัะธะบะฐัะธั ัะพััะพัะฝะธั (1-2 ะดะฝั)

**ะฆะตะปั:** ะัะฟะพะปัะทะพะฒะฐัั ัะพะปัะบะพ `ApplicationStateManager`

**ะะตะนััะฒะธั:**
1. ะฃะดะฐะปะธัั ะปะพะบะฐะปัะฝัะต ัะปะฐะณะธ ะธะท `VoiceRecognitionIntegration`:
   ```python
   # ะฃะะะะะขะฌ:
   self._recording_active: bool = False
   self._google_recording_active: bool = False
   self._playback_active: bool = False
   self._user_initiated_recording: bool = False
   ```

2. ะัะฟะพะปัะทะพะฒะฐัั ัะพะปัะบะพ `state_manager`:
   ```python
   # ะะะะกะขะ:
   if self._recording_active:
   
   # ะะกะะะะฌะะะะะขะฌ:
   if self.state_manager.is_microphone_active():
   ```

3. ะะพะฑะฐะฒะธัั ะฐัะพะผะฐัะฝัะต ะพะฟะตัะฐัะธะธ ั lock:
   ```python
   with self.state_manager._lock:
       self.state_manager.set_microphone_state("active", session_id)
   ```

**ะะตะทัะปััะฐั:**
- ะะดะธะฝัะน ะธััะพัะฝะธะบ ะธััะธะฝั
- ะะตั ัะฐััะธะฝััะพะฝะธะทะฐัะธะธ
- ะัะพะผะฐัะฝัะต ะพะฟะตัะฐัะธะธ

---

### 6.2 ะะตะดะตะปั 2: ะฃะปัััะตะฝะธั (3-4 ะดะฝั)

#### ะะตะฝั 8-9: ะขะตััะธัะพะฒะฐะฝะธะต (1-2 ะดะฝั)

**ะฆะตะปั:** ะะทะพะปะธัะพะฒะฐะฝะฝัะต ัะตััั ะดะปั ะบะฐะถะดะพะณะพ ะผะพะดัะปั

**ะะตะนััะฒะธั:**
1. ะกะพะทะดะฐัั `tests/test_avf_manager.py`:
   ```python
   def test_avf_manager_initialize():
       """ะะทะพะปะธัะพะฒะฐะฝะฝัะน ัะตัั: ะฟัะพะฒะตััะตะผ ะธะฝะธัะธะฐะปะธะทะฐัะธั AVF"""
       config = AVFConfig(enabled=True)
       manager = AVFManager(config)
       result = await manager.initialize()
       assert result == True
   
   def test_avf_manager_activate():
       """ะะทะพะปะธัะพะฒะฐะฝะฝัะน ัะตัั: ะฟัะพะฒะตััะตะผ ะฐะบัะธะฒะฐัะธั AVF"""
       config = AVFConfig(enabled=True)
       manager = AVFManager(config)
       await manager.initialize()
       device_info = await manager.activate(duration_sec=1.0)
       assert device_info is not None
   ```

2. ะกะพะทะดะฐัั `tests/test_google_manager.py`:
   ```python
   def test_google_manager_initialize():
       """ะะทะพะปะธัะพะฒะฐะฝะฝัะน ัะตัั: ะฟัะพะฒะตััะตะผ ะธะฝะธัะธะฐะปะธะทะฐัะธั Google"""
       config = GoogleConfig(language="en-US")
       manager = GoogleManager(config)
       result = await manager.initialize()
       assert result == True
   ```

3. ะกะพะทะดะฐัั `tests/test_voice_recognition_integration.py`:
   ```python
   def test_voice_integration_coordination():
       """ะะฝัะตะณัะฐัะธะพะฝะฝัะน ัะตัั: ะฟัะพะฒะตััะตะผ ะบะพะพัะดะธะฝะฐัะธั ัะตัะตะท EventBus"""
       # ะขะตัั ะบะพะพัะดะธะฝะฐัะธะธ ะผะตะถะดั AVF ะธ Google
   ```

**ะะตะทัะปััะฐั:**
- ะะทะพะปะธัะพะฒะฐะฝะฝัะต ัะตััั ะดะปั AVF ะผะพะดัะปั
- ะะทะพะปะธัะพะฒะฐะฝะฝัะต ัะตััั ะดะปั Google ะผะพะดัะปั
- ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ะดะปั ะบะพะพัะดะธะฝะฐัะธะธ

---

#### ะะตะฝั 10-11: ะะพะบัะผะตะฝัะฐัะธั (1 ะดะตะฝั)

**ะฆะตะปั:** ะกะพะทะดะฐัั ะดะพะบัะผะตะฝัะฐัะธั ะดะปั ะบะฐะถะดะพะณะพ ะบะพะผะฟะพะฝะตะฝัะฐ

**ะะตะนััะฒะธั:**
1. ะกะพะทะดะฐัั `Docs/AUDIO_SYSTEM_INITIALIZATION.md`:
   - ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
   - ะะฐะฒะธัะธะผะพััะธ ะผะตะถะดั ะบะพะผะฟะพะฝะตะฝัะฐะผะธ
   - ะงะตะบ-ะปะธัั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ

2. ะกะพะทะดะฐัั `Docs/AUDIO_AVF_GUIDE.md`:
   - ะะฐะทะฝะฐัะตะฝะธะต ะธ ะพัะฒะตัััะฒะตะฝะฝะพััั
   - API ะธ ะฟัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั
   - ะะธะฐะณะฝะพััะธะบะฐ ะธ ะฐะบัะธะฒะฐัะธั
   - Troubleshooting

3. ะกะพะทะดะฐัั `Docs/AUDIO_GOOGLE_GUIDE.md`:
   - ะะฐะทะฝะฐัะตะฝะธะต ะธ ะพัะฒะตัััะฒะตะฝะฝะพััั
   - API ะธ ะฟัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั
   - ะะฐะฟะธัั ะธ ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต
   - Troubleshooting

4. ะกะพะทะดะฐัั `Docs/AUDIO_COORDINATION.md`:
   - ะะฐะบ AVF ะธ Google ัะฐะฑะพัะฐัั ะฒะผะตััะต
   - EventBus ัะพะฑััะธั
   - ะกัะตะผั ะฒะทะฐะธะผะพะดะตะนััะฒะธั

**ะะตะทัะปััะฐั:**
- ะะพะฝััะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
- ะะตะณะบะพ ะฟะพะฝะธะผะฐัั ัะธััะตะผั
- ะะตะณะบะพ ะดะพะฑะฐะฒะปััั ะฝะพะฒัะต ััะฝะบัะธะธ

---

#### ะะตะฝั 12-14: ะคะธะฝะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ (1 ะดะตะฝั)

**ะฆะตะปั:** ะะพะปะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต ะธ ะฟัะพะฒะตัะบะฐ

**ะะตะนััะฒะธั:**
1. ะะพะปะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต ะฒัะตั ะผะพะดัะปะตะน
2. ะัะพะฒะตัะบะฐ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
3. ะัะพะฒะตัะบะฐ ัะพะฒะผะตััะธะผะพััะธ
4. ะัะพะฒะตัะบะฐ ัะตะบ-ะปะธััะพะฒ

**ะะตะทัะปััะฐั:**
- ะัะต ัะตััั ะฟัะพัะพะดัั
- ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ัะพะพัะฒะตัััะฒัะตั ััะตะฑะพะฒะฐะฝะธัะผ
- ะกะพะฒะผะตััะธะผะพััั ะฟัะพะฒะตัะตะฝะฐ

---

## 7. ะคะฐะทั ะขะตััะธัะพะฒะฐะฝะธั

### 7.1 ะัะธะฝัะธะฟั ัะตััะธัะพะฒะฐะฝะธั ะฝะฐ ะบะฐะถะดะพะผ ััะฐะฟะต

**ะะะฏะะะขะะะฌะะ:** ะะพัะปะต ะบะฐะถะดะพะณะพ ะธัะฟัะฐะฒะปะตะฝะธั ะธะปะธ ัะตะฐะปะธะทะฐัะธะธ ะฝะพะฒะพะน ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ **ะะะฏะะะขะะะฌะะ** ัะพะทะดะฐัั ะธะทะพะปะธัะพะฒะฐะฝะฝัะน ัะตัั, ะบะพัะพััะน ะฟัะพะฒะตััะตั, ััะพ ัะตะฐะปะธะทะฐัะธั ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั.

**ะขัะตะฑะพะฒะฐะฝะธั ะบ ัะตััะฐะผ:**
- โ ะะทะพะปะธัะพะฒะฐะฝะฝัะต: ะฟัะพะฒะตัััั ัะพะปัะบะพ ะธัะฟัะฐะฒะปะตะฝะฝัั/ัะตะฐะปะธะทะพะฒะฐะฝะฝัั ััะฝะบัะธะพะฝะฐะปัะฝะพััั
- โ ะะพัะฟัะพะธะทะฒะพะดะธะผัะต: ะทะฐะฟััะบะฐัััั ะฝะตะทะฐะฒะธัะธะผะพ ะธ ะดะฐัั ัะตัะบะธะน ัะตะทัะปััะฐั (ะฟัะพัะตะป/ะฝะต ะฟัะพัะตะป)
- โ ะัััััะต: ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั < 1 ัะตะบัะฝะดั
- โ ะะตะท ะทะฐะฒะธัะธะผะพััะตะน: ะฝะต ััะตะฑััั ัะตะฐะปัะฝะพะณะพ ะผะธะบัะพัะพะฝะฐ ะธะปะธ ะฒะฝะตัะฝะธั ัะตัะฒะธัะพะฒ

**ะะฐะฟัะตัะตะฝะพ:**
- โ ะกัะธัะฐัั ะธัะฟัะฐะฒะปะตะฝะธะต ะทะฐะฒะตััะตะฝะฝัะผ ะฑะตะท ะธะทะพะปะธัะพะฒะฐะฝะฝะพะณะพ ัะตััะฐ
- โ ะขะตััะธัะพะฒะฐัั ะฒัั ัะธััะตะผั ัะตะปะธะบะพะผ ะฑะตะท ะธะทะพะปััะธะธ
- โ ะัะฟะพะปัะทะพะฒะฐัั ัะตะฐะปัะฝัะน ะผะธะบัะพัะพะฝ ะฒ unit-ัะตััะฐั

**ะะตัะฐะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั:** ะกะผ. `Docs/TESTING_PHASES_DETAILED_PLAN.md` โ ะฟะพะปะฝัะน ะฟะปะฐะฝ ัะตััะธัะพะฒะฐะฝะธั ั ะฟัะธะผะตัะฐะผะธ ะบะพะดะฐ ะดะปั ะบะฐะถะดะพะณะพ ััะฐะฟะฐ

---

### 7.2 ะคะฐะทั ัะตััะธัะพะฒะฐะฝะธั ะฟะพ ััะฐะฟะฐะผ

#### ะคะฐะทะฐ 1: ะขะตััะธัะพะฒะฐะฝะธะต ะดะธะฐะณะฝะพััะธะบะธ initialize() (ะะตะฝั 1-2)

**ะขะตััั:**
1. `tests/test_initialize_call.py` โ ะฟัะพะฒะตัะบะฐ ะฒัะทะพะฒะฐ initialize()
2. `tests/test_initialize_logging.py` โ ะฟัะพะฒะตัะบะฐ ะปะพะณะธัะพะฒะฐะฝะธั

**ะงะตะบ-ะปะธัั:**
- [ ] ะขะตัั ะฒัะทะพะฒะฐ initialize() ะฟัะพัะพะดะธั
- [ ] ะขะตัั ะปะพะณะธัะพะฒะฐะฝะธั ะฟัะพัะพะดะธั
- [ ] ะะพะณะธ ะฟะพะบะฐะทัะฒะฐัั ะฟะพะปะฝัั ะบะฐััะธะฝั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ

---

#### ะคะฐะทะฐ 2: ะขะตััะธัะพะฒะฐะฝะธะต AVF ะผะพะดัะปั (ะะตะฝั 3)

**ะขะตััั:**
1. `tests/test_avf_config.py` โ ัะพะทะดะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ
2. `tests/test_avf_manager_init.py` โ ะธะฝะธัะธะฐะปะธะทะฐัะธั ะผะตะฝะตะดะถะตัะฐ
3. `tests/test_avf_manager_initialize.py` โ ะผะตัะพะด initialize()
4. `tests/test_avf_manager_activate.py` โ ะผะตัะพะด activate()
5. `tests/test_avf_manager_deactivate.py` โ ะผะตัะพะด deactivate()

**ะงะตะบ-ะปะธัั:**
- [ ] ะัะต ัะตััั AVF ะผะพะดัะปั ะฟัะพัะพะดัั
- [ ] ะขะตััั ะธะทะพะปะธัะพะฒะฐะฝั (ะฝะต ััะตะฑััั ัะตะฐะปัะฝะพะณะพ ะผะธะบัะพัะพะฝะฐ)
- [ ] ะขะตััั ะฑัััััะต (< 1 ัะตะบัะฝะดั)

---

#### ะคะฐะทะฐ 3: ะขะตััะธัะพะฒะฐะฝะธะต Google ะผะพะดัะปั (ะะตะฝั 4)

**ะขะตััั:**
1. `tests/test_google_config.py` โ ัะพะทะดะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ
2. `tests/test_google_manager_init.py` โ ะธะฝะธัะธะฐะปะธะทะฐัะธั ะผะตะฝะตะดะถะตัะฐ
3. `tests/test_google_manager_initialize.py` โ ะผะตัะพะด initialize()
4. `tests/test_google_manager_activate.py` โ ะผะตัะพะด activate()
5. `tests/test_google_manager_deactivate.py` โ ะผะตัะพะด deactivate()

**ะงะตะบ-ะปะธัั:**
- [ ] ะัะต ัะตััั Google ะผะพะดัะปั ะฟัะพัะพะดัั
- [ ] ะขะตััั ะธะทะพะปะธัะพะฒะฐะฝั (ะฝะต ััะตะฑััั ัะตะฐะปัะฝะพะณะพ ะผะธะบัะพัะพะฝะฐ)
- [ ] ะขะตััั ะฑัััััะต (< 1 ัะตะบัะฝะดั)

---

#### ะคะฐะทะฐ 4: ะขะตััะธัะพะฒะฐะฝะธะต ะบะพะพัะดะธะฝะฐัะธะธ (ะะตะฝั 5)

**ะขะตััั:**
1. `tests/test_voice_integration_coordination.py` โ ะบะพะพัะดะธะฝะฐัะธั ัะตัะตะท EventBus
2. `tests/test_voice_integration_size.py` โ ัะฐะทะผะตั ะธะฝัะตะณัะฐัะธะธ
3. `tests/test_voice_integration_no_local_flags.py` โ ะพััััััะฒะธะต ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ

**ะงะตะบ-ะปะธัั:**
- [ ] ะขะตัั ะบะพะพัะดะธะฝะฐัะธะธ ะฟัะพัะพะดะธั
- [ ] ะขะตัั ัะฐะทะผะตัะฐ ะธะฝัะตะณัะฐัะธะธ ะฟัะพัะพะดะธั (โค 500 ัััะพะบ)
- [ ] ะขะตัั ะพััััััะฒะธั ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ ะฟัะพัะพะดะธั

---

#### ะคะฐะทะฐ 5: ะขะตััะธัะพะฒะฐะฝะธะต ัะฝะธัะธะบะฐัะธะธ ัะพััะพัะฝะธั (ะะตะฝั 6-7)

**ะขะตััั:**
1. `tests/test_voice_integration_state_manager.py` โ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต state_manager
2. `tests/test_state_manager_atomic.py` โ ะฐัะพะผะฐัะฝัะต ะพะฟะตัะฐัะธะธ
3. `tests/test_no_state_desync.py` โ ะพััััััะฒะธะต ัะฐััะธะฝััะพะฝะธะทะฐัะธะธ

**ะงะตะบ-ะปะธัั:**
- [ ] ะขะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั state_manager ะฟัะพัะพะดะธั
- [ ] ะขะตัั ะฐัะพะผะฐัะฝัั ะพะฟะตัะฐัะธะน ะฟัะพัะพะดะธั
- [ ] ะขะตัั ะพััััััะฒะธั ัะฐััะธะฝััะพะฝะธะทะฐัะธะธ ะฟัะพัะพะดะธั

---

#### ะคะฐะทะฐ 6: ะะฐััะธัะตะฝะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต (ะะตะฝั 8-9)

**ะขะตััั:**
1. `tests/test_integration_full_cycle.py` โ ะฟะพะปะฝัะน ัะธะบะป ะฐะบัะธะฒะฐัะธะธ
2. `tests/test_integration_error_handling.py` โ ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
3. `tests/test_integration_sequence.py` โ ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะพะฟะตัะฐัะธะน
4. `tests/test_integration_performance.py` โ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
5. `tests/test_integration_edge_cases.py` โ ะณัะฐะฝะธัะฝัะต ัะปััะฐะธ

**ะงะตะบ-ะปะธัั:**
- [ ] ะขะตัั ะฟะพะปะฝะพะณะพ ัะธะบะปะฐ ะฟัะพัะพะดะธั
- [ ] ะขะตัั ะพะฑัะฐะฑะพัะบะธ ะพัะธะฑะพะบ ะฟัะพัะพะดะธั
- [ ] ะขะตัั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ ะฟัะพัะพะดะธั
- [ ] ะขะตัั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะฟัะพัะพะดะธั
- [ ] ะขะตัั ะณัะฐะฝะธัะฝัั ัะปััะฐะตะฒ ะฟัะพัะพะดะธั

---

#### ะคะฐะทะฐ 7: ะคะธะฝะฐะปัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต (ะะตะฝั 12-14)

**ะขะตััั:**
1. ะะฐะฟััะบ ะฒัะตั ัะตััะพะฒ (`pytest tests/ -v`)
2. `tests/test_requirements_compliance.py` โ ัะพะพัะฒะตัััะฒะธะต ััะตะฑะพะฒะฐะฝะธัะผ
3. `tests/test_performance_requirements.py` โ ััะตะฑะพะฒะฐะฝะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
4. `tests/test_backward_compatibility.py` โ ะพะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

**ะงะตะบ-ะปะธัั:**
- [ ] ะัะต unit-ัะตััั ะฟัะพัะพะดัั (100%)
- [ ] ะัะต ะธะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ะฟัะพัะพะดัั (100%)
- [ ] ะะพะบัััะธะต ะบะพะดะฐ โฅ 80%
- [ ] ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ัะพะพัะฒะตัััะฒัะตั ััะตะฑะพะฒะฐะฝะธัะผ
- [ ] ะกะพะฒะผะตััะธะผะพััั ะฟัะพะฒะตัะตะฝะฐ

---

### 7.3 ะกัััะบัััะฐ ัะตััะพะฒ

**ะะปั ะผะพะดัะปะตะน:**
```
tests/
โโโ test_avf_manager.py
โ   โโโ test_avf_config_from_unified_config()
โ   โโโ test_avf_manager_initialization()
โ   โโโ test_avf_manager_initialize()
โ   โโโ test_avf_manager_activate()
โ   โโโ test_avf_manager_deactivate()
โ
โโโ test_google_manager.py
    โโโ test_google_config_from_unified_config()
    โโโ test_google_manager_initialization()
    โโโ test_google_manager_initialize()
    โโโ test_google_manager_activate()
    โโโ test_google_manager_deactivate()
```

**ะะปั ะธะฝัะตะณัะฐัะธะน:**
```
tests/
โโโ test_voice_integration.py
    โโโ test_voice_integration_coordination()
    โโโ test_voice_integration_size()
    โโโ test_voice_integration_no_local_flags()
    โโโ test_voice_integration_state_manager()
    โโโ test_voice_integration_full_cycle()
    โโโ test_voice_integration_error_handling()
```

---

## 8. ะงะตะบ-ะปะธััั ะัะพะฒะตัะบะธ

### 7.1 ะงะตะบ-ะปะธัั ะผะพะดัะปะตะน

- [ ] ะะฐะทะผะตั ะผะพะดัะปั โค 500 ัััะพะบ
- [ ] ะะพะดัะปั ะพัะฒะตัะฐะตั ะทะฐ ะพะดะฝั ะทะฐะดะฐัั
- [ ] ะะพะดัะปั ะฝะต ะทะฝะฐะตั ะพ EventBus
- [ ] ะะพะดัะปั ะฝะต ะทะฝะฐะตั ะพ ะดััะณะธั ะผะพะดัะปัั
- [ ] ะะฐะฒะธัะธะผะพััะธ ัะตัะตะท ะบะพะฝััััะบัะพั
- [ ] ะะตะณะบะพ ัะตััะธัะพะฒะฐัั ะธะทะพะปะธัะพะฒะฐะฝะฝะพ
- [ ] README.md ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝ
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ัะพะพัะฒะตัััะฒัะตั ััะฐะฝะดะฐััั
- [ ] ะะตั PII/ัะตะบัะตัะพะฒ ะฒ ะปะพะณะฐั
- [ ] ะะพะฝัะธะณััะฐัะธั ัะตัะตะท from_unified_config()

---

### 7.2 ะงะตะบ-ะปะธัั ะธะฝัะตะณัะฐัะธะน

- [ ] ะะฐะทะผะตั ะธะฝัะตะณัะฐัะธะธ โค 500 ัััะพะบ
- [ ] ะะฝัะตะณัะฐัะธั ัะพะปัะบะพ ะบะพะพัะดะธะฝะธััะตั ัะตัะตะท EventBus
- [ ] ะะพะณะธะบะฐ ะฒ ะผะพะดัะปัั, ะฝะต ะฒ ะธะฝัะตะณัะฐัะธะธ
- [ ] ะะตั ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ ัะพััะพัะฝะธั
- [ ] ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะพะปัะบะพ state_manager
- [ ] ะะพะฝััะฐะบัั EventBus ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝั
- [ ] ะะพะดะฟะธัะบะธ ะธ ะฟัะฑะปะธะบะฐัะธะธ ั ะฟัะธะพัะธัะตัะฐะผะธ
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ะบะพะพัะดะธะฝะฐัะธะธ
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ัะพะฑััะธะน
- [ ] ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ัะตัะตะท ErrorHandler

---

### 7.3 ะงะตะบ-ะปะธัั ัะตะฝััะฐะปะธะทะฐัะธะธ

- [ ] ะขะพะปัะบะพ ApplicationStateManager ัะฟัะฐะฒะปัะตั ัะพััะพัะฝะธะตะผ
- [ ] ะะตั ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ ัะพััะพัะฝะธั
- [ ] ะัะต ะธะทะผะตะฝะตะฝะธั ัะพััะพัะฝะธั ัะตัะตะท state_manager.set_*()
- [ ] ะัะต ะฟัะพะฒะตัะบะธ ัะพััะพัะฝะธั ัะตัะตะท state_manager.is_*()
- [ ] ะะพะฝัะธะณััะฐัะธั ัะตัะตะท UnifiedConfigLoader
- [ ] ะัะธะฑะบะธ ัะตัะตะท ErrorHandler
- [ ] ะัะพะผะฐัะฝัะต ะพะฟะตัะฐัะธะธ ั lock

---

### 7.4 ะงะตะบ-ะปะธัั ะปะพะณะธัะพะฒะฐะฝะธั

- [ ] ะคะพัะผะฐั ะปะพะณะพะฒ ัะพะพัะฒะตัััะฒัะตั ััะฐะฝะดะฐััั
- [ ] ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ัะพะฑััะธั ั session_id
- [ ] ะัะธะฑะบะธ ัะตัะตะท ErrorHandler
- [ ] ะฃัะพะฒะฝะธ ะปะพะณะธัะพะฒะฐะฝะธั ะธัะฟะพะปัะทััััั ะฟัะฐะฒะธะปัะฝะพ
- [ ] ะะตั PII/ัะตะบัะตัะพะฒ ะฒ ะปะพะณะฐั
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ะบัะธัะธัะตัะบะธั ะพะฟะตัะฐัะธะน
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ะบะพะพัะดะธะฝะฐัะธะธ
- [ ] Decision-ะปะพะณ ะดะปั gateways (ะตัะปะธ ะฟัะธะผะตะฝะธะผะพ)

---

### 7.5 ะงะตะบ-ะปะธัั ัะปะฐะณะพะฒ ะธ ะบะพะฝัะธะณััะฐัะธะน

- [ ] Feature flags ะทะฐะณััะถะฐัััั ัะตัะตะท UnifiedConfigLoader
- [ ] Kill-switches ะฟัะพะฒะตัััััั ะธะท env ะฟะตัะตะผะตะฝะฝัั (ะฟัะธะพัะธัะตั)
- [ ] Kill-switches ะฟัะพะฒะตัััััั ะธะท unified_config (fallback)
- [ ] ะัะธะพัะธัะตั: env > unified_config
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ะทะฐะณััะทะบะธ ัะปะฐะณะพะฒ
- [ ] ะะฐะปะธะดะฐัะธั ะทะฝะฐัะตะฝะธะน ัะปะฐะณะพะฒ
- [ ] ะัะพะฒะตัะบะฐ ัะปะฐะณะพะฒ ะฟะตัะตะด ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ
- [ ] Fallback ะฝะฐ legacy ะฟััั ะฟัะธ ะพัะบะปััะตะฝะฝะพะผ ัะปะฐะณะต
- [ ] ะะพะบัะผะตะฝัะฐัะธั ะฒ Docs/FEATURE_FLAGS.md
- [ ] ะะพะฝัะธะณััะฐัะธั ัะตัะตะท from_unified_config()
- [ ] ะะฐะปะธะดะฐัะธั ัะตัะตะท ััะตะผั

---

### 7.6 ะงะตะบ-ะปะธัั ะบะพะผะผัะฝะธะบะฐัะธะน

- [ ] ะัะต ะฟะพะดะฟะธัะบะธ ะฒ `initialize()`
- [ ] ะัะฟะพะปัะทะพะฒะฐะฝะธะต EventPriority
- [ ] ะะพะบัะผะตะฝัะฐัะธั ะฟะพะดะฟะธัะพะบ
- [ ] ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะฒ ะฟะพะดะฟะธััะธะบะฐั
- [ ] ะัะต ะฟัะฑะปะธะบะฐัะธะธ ัะตัะตะท event_bus.publish()
- [ ] Payload ะฒะฐะปะธะดะธััะตััั ะฟะตัะตะด ะฟัะฑะปะธะบะฐัะธะตะน
- [ ] ะกะพะฑััะธั ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝั ะฒ ะบะพะฝััะฐะบัะต
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ะฟัะฑะปะธะบะฐัะธะธ ัะพะฑััะธะน
- [ ] ะะพะฝััะฐะบั EventBus ัะพะทะดะฐะฝ
- [ ] ะะตััะธะพะฝะธัะพะฒะฐะฝะธะต ะดะปั breaking changes
- [ ] ะะฝัะตะณัะฐัะธะธ โ ะะพะดัะปะธ (ัะฐะทัะตัะตะฝะพ)
- [ ] ะะพะดัะปะธ โ ะะพะดัะปะธ (ะทะฐะฟัะตัะตะฝะพ)
- [ ] ะะฝัะตะณัะฐัะธะธ โ ะะฝัะตะณัะฐัะธะธ (ะทะฐะฟัะตัะตะฝะพ)

---

### 7.7 ะงะตะบ-ะปะธัั ัะตััะธัะพะฒะฐะฝะธั

**ะะปั ะบะฐะถะดะพะณะพ ััะฐะฟะฐ ัะตะฐะปะธะทะฐัะธะธ:**
- [ ] ะะทะพะปะธัะพะฒะฐะฝะฝัะน ัะตัั ัะพะทะดะฐะฝ ะดะปั ะฝะพะฒะพะน ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ
- [ ] ะขะตัั ะธะทะพะปะธัะพะฒะฐะฝ (ะฝะต ััะตะฑัะตั ัะตะฐะปัะฝะพะณะพ ะผะธะบัะพัะพะฝะฐ)
- [ ] ะขะตัั ะฑัััััะน (< 1 ัะตะบัะฝะดั)
- [ ] ะขะตัั ะฒะพัะฟัะพะธะทะฒะพะดะธะผัะน (ัะตัะบะธะน ัะตะทัะปััะฐั ะฟัะพัะตะป/ะฝะต ะฟัะพัะตะป)
- [ ] ะขะตัั ะฟัะพัะพะดะธั ััะฟะตัะฝะพ

**ะะปั ะผะพะดัะปะตะน:**
- [ ] ะขะตัั ัะพะทะดะฐะฝะธั ะบะพะฝัะธะณััะฐัะธะธ
- [ ] ะขะตัั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะผะตะฝะตะดะถะตัะฐ
- [ ] ะขะตัั initialize()
- [ ] ะขะตัั activate()
- [ ] ะขะตัั deactivate()

**ะะปั ะธะฝัะตะณัะฐัะธะน:**
- [ ] ะขะตัั ะบะพะพัะดะธะฝะฐัะธะธ ัะตัะตะท EventBus
- [ ] ะขะตัั ัะฐะทะผะตัะฐ ะธะฝัะตะณัะฐัะธะธ (โค 500 ัััะพะบ)
- [ ] ะขะตัั ะพััััััะฒะธั ะปะพะบะฐะปัะฝัั ัะปะฐะณะพะฒ
- [ ] ะขะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั state_manager
- [ ] ะขะตัั ะฟะพะปะฝะพะณะพ ัะธะบะปะฐ ะฐะบัะธะฒะฐัะธะธ
- [ ] ะขะตัั ะพะฑัะฐะฑะพัะบะธ ะพัะธะฑะพะบ

**ะคะธะฝะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ:**
- [ ] ะัะต unit-ัะตััั ะฟัะพัะพะดัั (100%)
- [ ] ะัะต ะธะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ะฟัะพัะพะดัั (100%)
- [ ] ะะพะบัััะธะต ะบะพะดะฐ โฅ 80%
- [ ] ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ัะพะพัะฒะตัััะฒัะตั ััะตะฑะพะฒะฐะฝะธัะผ

---

## 8. ะขัะตะฑะพะฒะฐะฝะธั ะบ ะะพะณะธัะพะฒะฐะฝะธั

### 8.1 ะคะพัะผะฐั ะปะพะณะพะฒ

**REQ-LOG-001: ะคะพัะผะฐั ะปะพะณะพะฒ**
- โ ะคะพัะผะฐั: `YYYY-MM-DD HH:MM:SS - Nexy - LEVEL - [session_id] - Message`
- โ ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ัะพะฑััะธั: `module.start|ok|fail` ั session_id, duration_ms, ะบะพะฝัะตะบััะพะผ
- โ ะัะธะฑะบะธ: code, reason, module, retries, timeout_ms ัะตัะตะท ErrorHandler

**ะัะธะผะตั:**
```
2024-01-15 10:30:45 - Nexy - INFO - [abc123] - avf_manager.initialize.start - duration_ms=150
2024-01-15 10:30:46 - Nexy - INFO - [abc123] - avf_manager.initialize.ok - duration_ms=150
2024-01-15 10:30:47 - Nexy - ERROR - [abc123] - avf_manager.activate.fail - error_code=E_MIC_ACTIVATION_FAILED
```

---

### 8.2 ะะพะณะธัะพะฒะฐะฝะธะต ะธะฝะธัะธะฐะปะธะทะฐัะธะธ

**REQ-LOG-INIT-001: ะะพะณะธัะพะฒะฐะฝะธะต ััะฐะฟะพะฒ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ**
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะฝะฐัะฐะปะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะบะฐะถะดะพะณะพ ััะฐะฟะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะทะฐะฒะตััะตะฝะธั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะพัะธะฑะพะบ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ

**ะัะธะผะตั:**
```python
async def initialize(self) -> bool:
    logger.info("๐ [AVF] ะะฐัะฐะปะพ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ AVF...")
    
    # ะญัะฐะฟ 1: ะะฐะณััะทะบะฐ ะบะพะฝัะธะณััะฐัะธะธ
    logger.info("๐ [AVF] ะญัะฐะฟ 1: ะะฐะณััะทะบะฐ ะบะพะฝัะธะณััะฐัะธะธ...")
    audio_config = self._load_audio_config()
    logger.info("โ [AVF] ะะพะฝัะธะณััะฐัะธั ะทะฐะณััะถะตะฝะฐ")
    
    # ะญัะฐะฟ 2: ะกะพะทะดะฐะฝะธะต AVFAudioEngine
    logger.info("๐ [AVF] ะญัะฐะฟ 2: ะกะพะทะดะฐะฝะธะต AVFAudioEngine...")
    try:
        self._engine = AVFAudioEngine(audio_config)
        logger.info("โ [AVF] AVFAudioEngine ัะพะทะดะฐะฝ")
    except Exception as e:
        logger.error(f"โ [AVF] ะัะธะฑะบะฐ ัะพะทะดะฐะฝะธั AVFAudioEngine: {e}")
        logger.exception("โ [AVF] ะะตัะฐะปะธ ะธัะบะปััะตะฝะธั:")
        return False
    
    logger.info("โ [AVF] ะะฝะธัะธะฐะปะธะทะฐัะธั ะทะฐะฒะตััะตะฝะฐ")
    return True
```

---

### 8.3 ะะพะณะธัะพะฒะฐะฝะธะต ะบะพะพัะดะธะฝะฐัะธะธ

**REQ-LOG-COORD-001: ะะพะณะธัะพะฒะฐะฝะธะต ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ ะพะฟะตัะฐัะธะน**
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะบะฐะถะดะพะณะพ ัะฐะณะฐ ะบะพะพัะดะธะฝะฐัะธะธ
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะฒัะทะพะฒะพะฒ ะผะตะฝะตะดะถะตัะพะฒ
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะฟัะฑะปะธะบะฐัะธะธ ัะพะฑััะธะน
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะพะฑะฝะพะฒะปะตะฝะธั ัะพััะพัะฝะธั

**ะัะธะผะตั:**
```python
async def _on_recording_start(self, event: Dict[str, Any]):
    session_id = event.get("data", {}).get("session_id")
    logger.info(f"๐ [VOICE] ะะฐัะฐะปะพ ะบะพะพัะดะธะฝะฐัะธะธ ะทะฐะฟะธัะธ: session_id={session_id}")
    
    # ะจะฐะณ 1: AVF ะดะธะฐะณะฝะพััะธะบะฐ
    logger.info("๐ [VOICE] ะจะฐะณ 1: AVF ะดะธะฐะณะฝะพััะธะบะฐ...")
    device_info = await self._avf_manager.activate(duration_sec=1.0)
    logger.info(f"โ [VOICE] AVF ะดะธะฐะณะฝะพััะธะบะฐ ะฟะพะปััะตะฝะฐ: {device_info.device_name}")
    
    # ะจะฐะณ 2: ะะตะฐะบัะธะฒะฐัะธั AVF
    logger.info("๐ [VOICE] ะจะฐะณ 2: ะะตะฐะบัะธะฒะฐัะธั AVF...")
    await self._avf_manager.deactivate()
    logger.info("โ [VOICE] AVF ะดะตะฐะบัะธะฒะธัะพะฒะฐะฝ")
    
    # ะจะฐะณ 3: ะะฐัะทะฐ
    logger.info("๐ [VOICE] ะจะฐะณ 3: ะะฐัะทะฐ 0.2 ัะตะบ...")
    await asyncio.sleep(0.2)
    
    # ะจะฐะณ 4: Google ะฐะบัะธะฒะฐัะธั
    logger.info("๐ [VOICE] ะจะฐะณ 4: Google ะฐะบัะธะฒะฐัะธั...")
    await self._google_manager.activate(callback=self._on_google_audio_chunk)
    logger.info("โ [VOICE] Google ะทะฐะฟะธัั ะฐะบัะธะฒะธัะพะฒะฐะฝะฐ")
    
    # ะจะฐะณ 5: ะะฑะฝะพะฒะปะตะฝะธะต ัะพััะพัะฝะธั
    logger.info("๐ [VOICE] ะจะฐะณ 5: ะะฑะฝะพะฒะปะตะฝะธะต ัะพััะพัะฝะธั...")
    self.state_manager.set_microphone_state("active", session_id)
    logger.info("โ [VOICE] ะกะพััะพัะฝะธะต ะพะฑะฝะพะฒะปะตะฝะพ")
    
    # ะจะฐะณ 6: ะัะฑะปะธะบะฐัะธั ัะพะฑััะธั
    logger.info("๐ [VOICE] ะจะฐะณ 6: ะัะฑะปะธะบะฐัะธั ัะพะฑััะธั...")
    await self.event_bus.publish("microphone.opened", {...})
    logger.info("โ [VOICE] ะกะพะฑััะธะต ะพะฟัะฑะปะธะบะพะฒะฐะฝะพ")
    
    logger.info("โ [VOICE] ะะพะพัะดะธะฝะฐัะธั ะทะฐะฟะธัะธ ะทะฐะฒะตััะตะฝะฐ")
```

---

### 8.4 Decision-ะปะพะณ ะดะปั gateways

**REQ-LOG-DECISION-001: ะะฐะฝะพะฝะธัะตัะบะธะน ัะพัะผะฐั decision-ะปะพะณะฐ**
- โ ะคะพัะผะฐั: `decision=<start|abort|retry|degrade> ctx={mic=...,screen=...,device=...,network=...,firstRun=...,appMode=...} source=<domain> duration_ms=<int>`
- โ ะะฑัะทะฐัะตะปะตะฝ ะดะปั ะฒัะตั gateways, ะฟัะธะฝะธะผะฐััะธั ัะตัะตะฝะธั
- โ ะัะพะฒะตััะตััั ะฟัะธ ัะตะฒัั ะธ ัะตะปะธะทะต

**ะัะธะผะตั:**
```python
def decide_start_listening(snapshot: Snapshot, source: str) -> Decision:
    start_time = time.monotonic()
    
    # ะะพะณะธะบะฐ ะฟัะธะฝััะธั ัะตัะตะฝะธั
    if snapshot.perm_mic != PermissionStatus.GRANTED:
        decision = Decision.ABORT
    elif snapshot.network != NetworkStatus.ONLINE:
        decision = Decision.DEGRADE
    else:
        decision = Decision.START
    
    duration_ms = int((time.monotonic() - start_time) * 1000)
    logger.info(
        f"decision={decision.value} "
        f"ctx={{mic={snapshot.perm_mic.value},screen={snapshot.perm_screen.value},"
        f"device={snapshot.device_input.value},network={snapshot.network.value},"
        f"firstRun={snapshot.first_run},appMode={snapshot.app_mode.value}}} "
        f"source=audio_gateway duration_ms={duration_ms}"
    )
    
    return decision
```

---

## 9. ะะฝัะตะณัะฐัะธั ะฒ ะัะพะตะบั

### 9.1 ะะฝัะตะณัะฐัะธั ะฒ SimpleModuleCoordinator

**REQ-INTEG-COORD-001: ะะพััะดะพะบ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ**
- โ ะัะฐะฒะธะปัะฝัะน ะฟะพััะดะพะบ ะฒ `SimpleModuleCoordinator._create_integrations()`
- โ ะะฐะฒะธัะธะผะพััะธ ะผะตะถะดั ะธะฝัะตะณัะฐัะธัะผะธ ัััะตะฝั
- โ ะะปะพะบะธััััะธะต ะธะฝัะตะณัะฐัะธะธ ะธะฝะธัะธะฐะปะธะทะธัััััั ะฟะตัะฒัะผะธ

**ะะพััะดะพะบ:**
1. InstanceManager
2. HardwareId
3. FirstRunPermissions (ะฑะปะพะบะธััััะฐั)
4. PermissionRestart (ะฑะปะพะบะธััััะฐั)
5. Tray
6. ModeManagement
7. InputProcessing
8. VoiceRecognition โ ะะดะตัั
9. NetworkManager
10. ...

---

### 9.2 ะะฝัะตะณัะฐัะธั ะฒ EventBus

**REQ-INTEG-EVENT-001: ะะพะฝััะฐะบัั ัะพะฑััะธะน**
- โ ะะพะฝััะฐะบั EventBus ัะพะทะดะฐะฝ ะธ ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝ
- โ ะกะพะฑััะธั ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝั ั ะฟะพะปะฝัะผะธ payload ััะตะผะฐะผะธ
- โ ะะฐะปะธะดะฐัะธั payload ะฝะฐ ะณัะฐะฝะธัะต ะธะฝัะตะณัะฐัะธะธ
- โ ะะตััะธะพะฝะธัะพะฒะฐะฝะธะต ะดะปั breaking changes

**REQ-INTEG-EVENT-002: ะัะธะพัะธัะตัั ัะพะฑััะธะน**
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต `EventPriority` ะดะปั ะฟะพะดะฟะธัะพะบ
- โ ะัะธัะธัะตัะบะธะต ัะพะฑััะธั ั `EventPriority.HIGH`
- โ ะะฑััะฝัะต ัะพะฑััะธั ั `EventPriority.MEDIUM`
- โ ะะธะทะบะพะฟัะธะพัะธัะตัะฝัะต ัะพะฑััะธั ั `EventPriority.LOW`

---

### 9.3 ะะฝัะตะณัะฐัะธั ะฒ ะบะพะฝัะธะณััะฐัะธั

**REQ-INTEG-CONFIG-001: ะัะฟะพะปัะทะพะฒะฐะฝะธะต UnifiedConfigLoader**
- โ ะะฐะณััะทะบะฐ ะบะพะฝัะธะณััะฐัะธะธ ัะตัะตะท `UnifiedConfigLoader`
- โ ะะฐะปะธะดะฐัะธั ัะตัะตะท ััะตะผั
- โ ะะพะบัะผะตะฝัะฐัะธั ะบะพะฝัะธะณััะฐัะธะธ

---

## 10. ะะตััะธะบะธ ะฃัะฟะตัะฐ

### 10.1 ะะตััะธะบะธ ะบะพะดะฐ

| ะะตััะธะบะฐ | ะะพ | ะะพัะปะต | ะฃะปัััะตะฝะธะต |
|---------|-----|-------|-----------|
| ะะฐะทะผะตั ะธะฝัะตะณัะฐัะธะธ | 3260 ัััะพะบ | ~500 ัััะพะบ | 6.5x ะผะตะฝััะต |
| ะะฐะทะผะตั ะผะพะดัะปะตะน | ะกะผะตัะฐะฝะพ | ~500 ัััะพะบ ะบะฐะถะดัะน | ะงะตัะบะพะต ัะฐะทะดะตะปะตะฝะธะต |
| ะะปะพะบะธ try/except | 257 | ~50 ะฒ ะบะฐะถะดะพะผ ะผะพะดัะปะต | 5x ะผะตะฝััะต |
| ะัะตะดัะฟัะตะถะดะตะฝะธั | 434 | ~50 ะฒ ะบะฐะถะดะพะผ ะผะพะดัะปะต | 8.7x ะผะตะฝััะต |
| ะััะพัะฝะธะบะธ ะธััะธะฝั | 4 | 1 | 100% ััััะฐะฝะตะฝะธะต ัะฐััะธะฝััะพะฝะธะทะฐัะธะธ |

---

### 10.2 ะะตััะธะบะธ ัะฐะทัะฐะฑะพัะบะธ

| ะะตััะธะบะฐ | ะะพ | ะะพัะปะต | ะฃะปัััะตะฝะธะต |
|---------|-----|-------|-----------|
| ะัะตะผั ะฟะพะธัะบะฐ ะฑะฐะณะฐ | 2-4 ัะฐัะฐ | 15-30 ะผะธะฝัั | 4-8x ะฑััััะตะต |
| ะัะตะผั ะฝะฐะฟะธัะฐะฝะธั ัะตััะฐ | 1-2 ัะฐัะฐ | 15-30 ะผะธะฝัั | 2-4x ะฑััััะตะต |
| ะัะตะผั ะดะพะฑะฐะฒะปะตะฝะธั ััะฝะบัะธะธ | 2-4 ัะฐัะฐ | 30-60 ะผะธะฝัั | 2-4x ะฑััััะตะต |
| ะะตัะพััะฝะพััั ะพัะธะฑะบะธ | ะััะพะบะฐั | ะะธะทะบะฐั | 3-5x ะผะตะฝััะต |

---

### 10.3 ะะตััะธะบะธ ะบะฐัะตััะฒะฐ

| ะะตััะธะบะฐ | ะะพ | ะะพัะปะต | ะฃะปัััะตะฝะธะต |
|---------|-----|-------|-----------|
| ะะฐััะธะฝััะพะฝะธะทะฐัะธั ัะพััะพัะฝะธะน | ะงะฐััะพ | ะะธะบะพะณะดะฐ | 100% ััััะฐะฝะตะฝะธะต |
| ะัะพะฑะปะตะผั ั ะธะฝะธัะธะฐะปะธะทะฐัะธะตะน | ะงะฐััะพ | ะะธะบะพะณะดะฐ | 100% ััััะฐะฝะตะฝะธะต |
| ะกะปะพะถะฝะพััั ัะตััะธัะพะฒะฐะฝะธั | ะััะพะบะฐั | ะะธะทะบะฐั | 10x ะฟัะพัะต |
| ะะพะฝััะฝะพััั ะบะพะดะฐ | ะะธะทะบะฐั | ะััะพะบะฐั | 5x ะฟะพะฝััะฝะตะต |

---

## 11. ะัะพะณะพะฒัะต ะขัะตะฑะพะฒะฐะฝะธั

### 11.1 ะะฑัะทะฐัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

1. **ะััะธัะตะบัััะฐ:**
   - โ ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ (ะผะพะดัะปะธ โค 500 ัััะพะบ, ะธะฝัะตะณัะฐัะธะธ โค 500 ัััะพะบ)
   - โ ะะดะธะฝัะน ะธััะพัะฝะธะบ ะธััะธะฝั (ัะพะปัะบะพ ApplicationStateManager)
   - โ ะะทะพะปััะธั ะธ ัะตััะธััะตะผะพััั (ะปะตะณะบะพ ัะตััะธัะพะฒะฐัั ะธะทะพะปะธัะพะฒะฐะฝะฝะพ)

2. **ะฆะตะฝััะฐะปะธะทะฐัะธั:**
   - โ ะกะพััะพัะฝะธะต: ัะพะปัะบะพ ApplicationStateManager
   - โ ะะพะฝัะธะณััะฐัะธั: ัะพะปัะบะพ UnifiedConfigLoader
   - โ ะัะธะฑะบะธ: ัะพะปัะบะพ ErrorHandler

3. **ะะพะณะธัะพะฒะฐะฝะธะต:**
   - โ ะคะพัะผะฐั: `YYYY-MM-DD HH:MM:SS - Nexy - LEVEL - [session_id] - Message`
   - โ ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ัะพะฑััะธั ั session_id, duration_ms
   - โ ะัะธะฑะบะธ ัะตัะตะท ErrorHandler
   - โ ะะตั PII/ัะตะบัะตัะพะฒ ะฒ ะปะพะณะฐั

4. **ะะพะผะผัะฝะธะบะฐัะธะธ:**
   - โ EventBus (ะฟะพะดะฟะธัะบะธ, ะฟัะฑะปะธะบะฐัะธะธ, ะบะพะฝััะฐะบัั)
   - โ ApplicationStateManager (ะธะทะผะตะฝะตะฝะธั, ะฟัะพะฒะตัะบะธ)
   - โ ErrorHandler (ะพะฑัะฐะฑะพัะบะฐ, ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต)
   - โ UnifiedConfigLoader (ะทะฐะณััะทะบะฐ, ะฒะฐะปะธะดะฐัะธั)

5. **ะคะปะฐะณะธ ะธ ะบะพะฝัะธะณััะฐัะธะธ:**
   - โ ะะฐะณััะทะบะฐ ัะตัะตะท UnifiedConfigLoader
   - โ ะัะพะฒะตัะบะฐ env ะฟะตัะตะผะตะฝะฝัั (ะฟัะธะพัะธัะตั)
   - โ ะัะพะฒะตัะบะฐ unified_config (fallback)
   - โ ะะฐะปะธะดะฐัะธั ัะตัะตะท ััะตะผั

---

### 11.2 ะะปะฐะฝ ัะตะฐะปะธะทะฐัะธะธ

**ะะตะดะตะปั 1: ะัะธัะธัะตัะบะธะต ะธัะฟัะฐะฒะปะตะฝะธั (5-7 ะดะฝะตะน)**
1. ะะธะฐะณะฝะพััะธะบะฐ initialize() (0.5 ะดะฝั)
2. ะะฐะทะดะตะปะตะฝะธะต AVF ะธ Google (3-4 ะดะฝั)
3. ะฃะฝะธัะธะบะฐัะธั ัะพััะพัะฝะธั (1-2 ะดะฝั)

**ะะตะดะตะปั 2: ะฃะปัััะตะฝะธั (3-4 ะดะฝั)**
4. ะขะตััะธัะพะฒะฐะฝะธะต (1-2 ะดะฝั)
5. ะะพะบัะผะตะฝัะฐัะธั (1 ะดะตะฝั)
6. ะคะธะฝะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ (1 ะดะตะฝั)

**ะะขะะะ:** 8-11 ะดะฝะตะน ะดะปั ะฟะพะปะฝะพะณะพ ัะตัะฐะบัะพัะธะฝะณะฐ

---

### 11.3 ะะตะทัะปััะฐั

**ะะพัะปะต ัะตัะฐะบัะพัะธะฝะณะฐ:**
- โ ะัะธะปะพะถะตะฝะธะต ะฑัะดะตั ัะฐะฑะพัะฐัั ะฟัะฐะฒะธะปัะฝะพ
- โ ะะตะณะบะพ ะฝะฐัะพะดะธัั ะธ ะธัะฟัะฐะฒะปััั ะฑะฐะณะธ
- โ ะะตะณะบะพ ะดะพะฑะฐะฒะปััั ะฝะพะฒัะต ััะฝะบัะธะธ
- โ ะะตะฝััะต ะฟัะพะฑะปะตะผ ะฒ ะฑัะดััะตะผ
- โ ะะตะฝััะต ะพัะธะฑะพะบ (3-5x)
- โ ะััััะตะต ะฝะฐัะพะดะธัั ะฟัะพะฑะปะตะผั (4-8x)
- โ ะะตั ัะฐััะธะฝััะพะฝะธะทะฐัะธะธ (100% ััััะฐะฝะตะฝะธะต)

---

## 12. ะกะฒัะทะฐะฝะฝัะต ะะพะบัะผะตะฝัั

- `Docs/INITIALIZATION_IMPLEMENTATION_PLAN.md` โ **ะะะญะขะะะะซะ ะะะะ ะะะะะะะะฆะะ** โ ะดะตัะฐะปัะฝัะน ะฟะปะฐะฝ ัะตะฐะปะธะทะฐัะธะธ ั 7 ัะฐะทะฐะผะธ, ะฟัะพะฒะตัะบะฐะผะธ ะธ ะบัะธัะตัะธัะผะธ ะณะพัะพะฒะฝะพััะธ
- `Docs/INITIALIZATION_MIGRATION_PLAN.md` โ **ะะะะ ะะะะะะฆะะ** โ ะดะตัะฐะปัะฝัะน ะฟะปะฐะฝ: ััะพ ัะดะฐะปะธัั, ััะพ ะดะพะฑะฐะฒะธัั, ะณะดะต ัะฐะทะผะตััะธัั, ะบะฐะบ ััััะบัััะธัะพะฒะฐัั
- `Docs/CURRENT_INITIALIZATION_REQUIREMENTS.md` โ **ะขะะะะะะะะะฏ ะ ะขะะะฃะฉะะ ะะะะะะะะฆะะ** โ ะฟะพะปะฝะพะต ะพะฟะธัะฐะฝะธะต ะฒัะตั ััะตะฑะพะฒะฐะฝะธะน ะบ ัะตะบััะตะน ะธะฝะธัะธะฐะปะธะทะฐัะธะธ (ะบะพะผะฟะพะฝะตะฝัั, ะฟะพััะดะพะบ, ะทะฐะฒะธัะธะผะพััะธ, ัะฟะตัะธะฐะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั)
- `Docs/INITIALIZATION_STRUCTURE_ANALYSIS.md` โ **ะะะะะะ ะกะขะะฃะะขะฃะะซ ะะะะฆะะะะะะะฆะะ** โ ะฐะฝะฐะปะธะท ัะตะบััะตะน ััััะบัััั ะธ ะธะดะตะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ ั ัะตะฝััะฐะปะธะทะฐัะธะตะน ัะตัะตะท ะบะพะฝัะธะณััะฐัะธะธ
- `Docs/INITIALIZATION_CENTRALIZATION_PROPOSAL.md` โ **ะฆะะะขะะะะะะะฆะะฏ ะะะะฆะะะะะะะฆะะ** โ ะตะดะธะฝะพะต ะผะตััะพ ะบะพะฝััะพะปั ะฒัะตั ะธะฝะธัะธะฐะปะธะทะฐัะธะน
- `Docs/TESTING_PHASES_DETAILED_PLAN.md` โ **ะะะขะะะฌะะซะ ะะะะ ะขะะกะขะะะะะะะะฏ** ั ะฟัะธะผะตัะฐะผะธ ะบะพะดะฐ ะดะปั ะบะฐะถะดะพะณะพ ััะฐะฟะฐ
- `Docs/ARCHITECTURE_REQUIREMENTS_FINAL.md` โ ะพัะฝะพะฒะฝัะต ััะตะฑะพะฒะฐะฝะธั
- `Docs/ARCHITECTURE_COMMUNICATION_AND_INTEGRATION.md` โ ะดะตัะฐะปัะฝะฐั ะบะฐััะฐ ะบะพะผะผัะฝะธะบะฐัะธะน
- `Docs/ARCHITECTURE_FLAGS_AND_CONFIG_USAGE.md` โ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะปะฐะณะพะฒ ะธ ะบะพะฝัะธะณััะฐัะธะน
- `Docs/ARCHITECTURE_CRITERIA_AND_REQUIREMENTS.md` โ ะบัะธัะตัะธะธ ะธ ััะตะฑะพะฒะฐะฝะธั
- `Docs/ARCHITECTURE_FULL_ANALYSIS_AND_PROPOSAL.md` โ ะฟะพะปะฝัะน ะฐะฝะฐะปะธะท ะธ ะฟัะตะดะปะพะถะตะฝะธะต
- `Docs/PROBLEM_HOTSPOTS_ANALYSIS.md` โ ะฐะฝะฐะปะธะท ะฟัะพะฑะปะตะผะฝัั ะทะพะฝ

---

## โ ะะฐะบะปััะตะฝะธะต

**ะญัะพั ะดะพะบัะผะตะฝั โ ะตะดะธะฝัะน ะผะฐััะตั-ะฟะปะฐะฝ ะดะปั:**
1. โ ะะพะฝะธะผะฐะฝะธั ัะตะบััะตะน ะฐััะธัะตะบัััั ะธ ะฟัะพะฑะปะตะผ
2. โ ะะปะฐะฝะธัะพะฒะฐะฝะธั ะธะดะตะฐะปัะฝะพะน ะฐััะธัะตะบัััั
3. โ ะะตะฐะปะธะทะฐัะธะธ ัะตัะฐะบัะพัะธะฝะณะฐ
4. โ ะัะพะฒะตัะบะธ ัะพะพัะฒะตัััะฒะธั ััะตะฑะพะฒะฐะฝะธัะผ

**ะัะต ััะตะฑะพะฒะฐะฝะธั ะฟัะพะฒะตััะตะผั ัะตัะตะท ัะตะบ-ะปะธััั.**

**ะะพัะพะฒ ะบ ัะตะฐะปะธะทะฐัะธะธ!**

