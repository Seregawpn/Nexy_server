# Review: Server Identifier Contract - Breaking Change Analysis

**–î–∞—Ç–∞:** 2026-01-12  
**–¢–∏–ø:** review  
**–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç:** cursor  
**–°—Ç–∞—Ç—É—Å:** üü° –¢—Ä–µ–±—É–µ—Ç —Ä–µ—à–µ–Ω–∏—è

---

## Executive Summary

–í —Ä–∞–º–∫–∞—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ (`session_id` –∏ `hardware_id`) –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤–≤–µ–¥–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç **–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π breaking change** –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç `session_id` (—Ö–æ—Ç—è –≤ proto –æ–Ω –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `optional`).

---

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### 1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `grpc_server.py`

**–°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è `session_id`:**
```python
# –ö–†–ò–¢–ò–ß–ù–û: –°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ - session_id –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
session_id = request.session_id
if not session_id or session_id.strip() == "":
    error_msg = "session_id is required and must be provided by client"
    log_decision(logger, decision="abort", method="StreamAudio", ctx={"reason": "missing_session_id"})
    yield streaming_pb2.StreamResponse(error_message=error_msg)
    return
```

**–°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è `hardware_id`:**
```python
# –ö–†–ò–¢–ò–ß–ù–û: hardware_id –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω (–Ω–µ "unknown")
hardware_id = request.hardware_id
if not hardware_id or hardware_id.strip() == "" or hardware_id.lower() == "unknown":
    error_msg = "hardware_id is required and must be valid (not empty or 'unknown')"
    log_decision(logger, decision="abort", method="StreamAudio", ctx={"reason": "invalid_hardware_id"})
    yield streaming_pb2.StreamResponse(error_message=error_msg)
    return
```

### 2. –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ —Å proto-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º

**–í `streaming.proto`:**
```protobuf
message StreamRequest {
  string prompt = 1;
  optional string screenshot = 2;
  optional int32 screen_width = 3;
  optional int32 screen_height = 4;
  string hardware_id = 5;      // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
  optional string session_id = 6;      // ‚ö†Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤ proto
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `session_id` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `optional` –≤ proto, –Ω–æ —Å–µ—Ä–≤–µ—Ä —Ç—Ä–µ–±—É–µ—Ç –µ–≥–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.

---

## –†–∏—Å–∫–∏

### 1. Breaking Change –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
- –°—Ç–∞—Ä—ã–π –∫–ª–∏–µ–Ω—Ç (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è) –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç `session_id`
- –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `error_message: "session_id is required and must be provided by client"`
- –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å ‚Üí **—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ª–æ–º–∞–µ—Ç—Å—è**

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ production)

### 2. –ü–æ—Ç–µ—Ä—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Å–µ—Å—Å–∏–π

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
- –ï—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–∏—Ç—å fallback-–≥–µ–Ω–µ—Ä–∞—Ü–∏—é `session_id` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —Ç–µ—Ä—è–µ—Ç—Å—è –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–æ–≥–∏–∫–∞ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å `session_id`) –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è
- –í–æ–∑–º–æ–∂–Ω—ã —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω—ã –∏ –ª–æ–∂–Ω—ã–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è (–µ—Å–ª–∏ –≤–µ—Ä–Ω—ë–º fallback)

---

## –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

**–ü–æ–¥—Ö–æ–¥:** –û—Å—Ç–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é, –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å breaking change.

**–ü–ª—é—Å—ã:**
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã (`InputProcessingIntegration` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ "—Ç–∏—Ö–∏—Ö" fallback'–æ–≤
- ‚úÖ –Ø–≤–Ω–∞—è –æ—à–∏–±–∫–∞ –≤–º–µ—Å—Ç–æ —Å–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å `session_id`)

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå Breaking change –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å breaking change –≤ `CHANGELOG.md`
2. –û–±–Ω–æ–≤–∏—Ç—å `GRPC_PROTOCOL_AUDIT.md` —Å –ø–æ–º–µ—Ç–∫–æ–π –æ —Å—Ç—Ä–æ–≥–æ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ
3. –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–ª–∏–∑-–Ω–æ—Ç—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –Ω–∞ `decision=abort` —Å `reason=missing_session_id`

**–°—Ä–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏:** 1-2 —Ä–µ–ª–∏–∑–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Degrade-—Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ feature-flag (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

**–ü–æ–¥—Ö–æ–¥:** –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π degrade-—Ä–µ–∂–∏–º —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π `session_id` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏.

**–ü–ª—é—Å—ã:**
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- ‚úÖ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ feature-flag
- ‚úÖ Kill-switch –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù–∞—Ä—É—à–∞–µ—Ç –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã (–¥–≤–∞ –ø–∏—Å–∞—Ç–µ–ª—è `session_id`)
- ‚ùå –°–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –≤–º–µ—Å—Ç–æ —è–≤–Ω—ã—Ö –æ—à–∏–±–æ–∫
- ‚ùå –£—Å–ª–æ–∂–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚ùå –†–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∞ –∏ –ª–æ–∂–Ω—ã—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í grpc_server.py
from config.unified_config import get_config

config = get_config()
allow_session_id_fallback = config.features.get('allow_session_id_fallback', False)

session_id = request.session_id
if not session_id or session_id.strip() == "":
    if allow_session_id_fallback:
        # –í–†–ï–ú–ï–ù–ù–´–ô degrade-—Ä–µ–∂–∏–º –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        import uuid
        session_id = str(uuid.uuid4())
        log_decision(
            logger,
            decision="degrade",
            method="StreamAudio",
            ctx={
                "reason": "missing_session_id_fallback",
                "generated_session_id": session_id[:8]
            }
        )
        logger.warning(
            f"‚ö†Ô∏è [COMPAT] session_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω fallback: {session_id[:8]}... "
            f"(feature-flag: allow_session_id_fallback=true)"
        )
    else:
        # –°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        error_msg = "session_id is required and must be provided by client"
        log_decision(logger, decision="abort", method="StreamAudio", ctx={"reason": "missing_session_id"})
        yield streaming_pb2.StreamResponse(error_message=error_msg)
        return
```

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
# unified_config.yaml
features:
  allow_session_id_fallback: false  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω (—Å—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç)
  
kill_switches:
  disable_session_id_fallback: true  # Kill-switch –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
```

**–°—Ä–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏:** 2-3 —Ä–µ–ª–∏–∑–∞ —Å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–º –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º fallback'–∞

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –í–∞—Ä–∏–∞–Ω—Ç 1 (—Å—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç)** –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å:** –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è `session_id` –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
2. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å:** –Ø–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ –ª—É—á—à–µ —Å–∫—Ä—ã—Ç—ã—Ö fallback'–æ–≤
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –ú–µ–Ω—å—à–µ –∫–æ–¥–∞, –º–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞
4. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –ò–∑–±–µ–≥–∞–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ª–≥–∞

**–£—Å–ª–æ–≤–∏—è –¥–ª—è –í–∞—Ä–∏–∞–Ω—Ç–∞ 2:**
- –ï—Å–ª–∏ –≤ production –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –±–µ–∑ `session_id`
- –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞–π–º—ë—Ç >2 —Ä–µ–ª–∏–∑–∞
- –ï—Å–ª–∏ –µ—Å—Ç—å –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

## –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–í–∞—Ä–∏–∞–Ω—Ç 1)

### 1. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è breaking change

**–û–±–Ω–æ–≤–∏—Ç—å `Docs/CHANGELOG.md`:**
```markdown
## [Breaking Change] 2026-01-12 - –°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤

### –ò–∑–º–µ–Ω–µ–Ω–∏—è
- `session_id` —Ç–µ–ø–µ—Ä—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤ `StreamAudio` (—Ä–∞–Ω–µ–µ –±—ã–ª optional –≤ proto)
- `hardware_id` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ "unknown"
- –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `INVALID_ARGUMENT` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏/–Ω–µ–≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤

### –ú–∏–≥—Ä–∞—Ü–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç –¥–æ –≤–µ—Ä—Å–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–¥–∞—ë—Ç `session_id` –æ—Ç `InputProcessingIntegration`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `hardware_id` –≤–∞–ª–∏–¥–µ–Ω (–Ω–µ –ø—É—Å—Ç–æ–π –∏ –Ω–µ "unknown")

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚ùå Breaking change: —Å—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –±–µ–∑ `session_id` –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–æ –≤–µ—Ä—Å–∏–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `session_id`
```

**–û–±–Ω–æ–≤–∏—Ç—å `server/server/Docs/GRPC_PROTOCOL_AUDIT.md`:**
```markdown
## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Breaking Changes (2026-01-12)
- **–°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç `session_id`:** –•–æ—Ç—è –≤ proto `session_id` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `optional`, —Å–µ—Ä–≤–µ—Ä —Ç—Ä–µ–±—É–µ—Ç –µ–≥–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã. –≠—Ç–æ breaking change –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.
- **–°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç `hardware_id`:** `hardware_id` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ "unknown".

### –ú–∏–≥—Ä–∞—Ü–∏—è
- –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –¥–æ –≤–µ—Ä—Å–∏–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ `session_id`.
- –°–º. `Docs/CHANGELOG.md` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏.
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**
- `grpc_stream_audio_abort{reason="missing_session_id"}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–∞–∑–æ–≤ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è `session_id`
- `grpc_stream_audio_abort{reason="invalid_hardware_id"}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–∞–∑–æ–≤ –∏–∑-–∑–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ `hardware_id`

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—Å–µ abort-—Ä–µ—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å `decision=abort` –∏ `ctx={"reason": "missing_session_id"}` –∏–ª–∏ `{"reason": "invalid_hardware_id"}`
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

### 3. –†–µ–ª–∏–∑-–Ω–æ—Ç—ã

**–î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–ª–∏–∑-–Ω–æ—Ç—ã:**
- –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ breaking change
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

---

## –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–í–∞—Ä–∏–∞–Ω—Ç 2 - –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

### 1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è degrade-—Ä–µ–∂–∏–º–∞

- –î–æ–±–∞–≤–∏—Ç—å feature-flag `allow_session_id_fallback` –≤ `unified_config.yaml`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –≤ `grpc_server.py` (—Å–º. –ø—Ä–∏–º–µ—Ä –≤—ã—à–µ)
- –î–æ–±–∞–≤–∏—Ç—å kill-switch `disable_session_id_fallback`

### 2. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä fallback'–∞
- –£–∫–∞–∑–∞—Ç—å —Å—Ä–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ (2-3 —Ä–µ–ª–∏–∑–∞)
- –ü–ª–∞–Ω –æ—Ç–∫–ª—é—á–µ–Ω–∏—è fallback'–∞

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –ú–µ—Ç—Ä–∏–∫–∞ `grpc_stream_audio_degrade{reason="missing_session_id_fallback"}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ fallback'–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö degrade-—Ä–µ—à–µ–Ω–∏–π
- –ü–ª–∞–Ω –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è fallback'–∞

---

## Verification (DoD)

### –î–ª—è –í–∞—Ä–∏–∞–Ω—Ç–∞ 1 (—Å—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç):

- [ ] `StreamAudio` –±–µ–∑ `session_id` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `error_message` –∏ `decision=abort`
- [ ] `StreamAudio` —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ `session_id`/`hardware_id` ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] `InterruptSession` —Å –≤–∞–ª–∏–¥–Ω—ã–º `hardware_id` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `message` (–Ω–µ `error_message`)
- [ ] –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç `decision=abort` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–º `session_id`
- [ ] `CHANGELOG.md` –æ–±–Ω–æ–≤–ª—ë–Ω —Å breaking change
- [ ] `GRPC_PROTOCOL_AUDIT.md` –æ–±–Ω–æ–≤–ª—ë–Ω —Å –ø–æ–º–µ—Ç–∫–æ–π –æ —Å—Ç—Ä–æ–≥–æ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ

### –î–ª—è –í–∞—Ä–∏–∞–Ω—Ç–∞ 2 (degrade-—Ä–µ–∂–∏–º):

- [ ] `StreamAudio` –±–µ–∑ `session_id` + `allow_session_id_fallback=true` ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `session_id` –∏ –ª–æ–≥–∏—Ä—É–µ—Ç `decision=degrade`
- [ ] `StreamAudio` –±–µ–∑ `session_id` + `allow_session_id_fallback=false` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `error_message` –∏ `decision=abort`
- [ ] Kill-switch `disable_session_id_fallback` –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç fallback
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç –≤—Å–µ degrade-—Ä–µ—à–µ–Ω–∏—è

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–í—ã–±—Ä–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 1 (—Å—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç)** –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å breaking change.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –Ø–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ –ª—É—á—à–µ —Å–∫—Ä—ã—Ç—ã—Ö fallback'–æ–≤
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
- –ú–∏–≥—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Äî —Ä–∞–∑–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ

**–ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 2 —Å feature-flag
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ fallback'–∞ —á–µ—Ä–µ–∑ 2-3 —Ä–µ–ª–∏–∑–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ degrade-—Ä–µ—à–µ–Ω–∏–π

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `server/server/Docs/GRPC_PROTOCOL_AUDIT.md` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- `server/server/Docs/SERVER_DEVELOPMENT_RULES.md` ‚Äî –ø–æ–ª–∏—Ç–∏–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ gRPC
- `Docs/CHANGELOG.md` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `server/server/modules/grpc_service/streaming.proto` ‚Äî proto-–∫–æ–Ω—Ç—Ä–∞–∫—Ç

---

**–°—Ç–∞—Ç—É—Å:** üü° –¢—Ä–µ–±—É–µ—Ç —Ä–µ—à–µ–Ω–∏—è (–≤—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ 1 –∏–ª–∏ 2)
