# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è AVF –∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º—ã

## ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ! (7/7)

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### ‚úÖ –¢–µ—Å—Ç 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AVFAudioEngine
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–†–û–ô–î–ï–ù

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- ‚úÖ EventBus —Å–æ–∑–¥–∞–Ω –∏ event loop –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞
- ‚úÖ –≠–∫–∑–µ–º–ø–ª—è—Ä AVFAudioEngine —Å–æ–∑–¥–∞–Ω
- ‚úÖ `_engine` —Å–æ–∑–¥–∞–Ω
- ‚úÖ `_player_node` —Å–æ–∑–¥–∞–Ω
- ‚úÖ `_output_node` —Å–æ–∑–¥–∞–Ω
- ‚úÖ `_output_completion_callback` —Å–æ–∑–¥–∞–Ω
- ‚úÖ `_player_node_connected = True`

**–í—ã–≤–æ–¥**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã.

---

#### ‚úÖ –¢–µ—Å—Ç 2: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ (Output)
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–†–û–ô–î–ï–ù

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –±—É—Ñ–µ—Ä —Å–æ–∑–¥–∞–Ω (48000 —Å—ç–º–ø–ª–æ–≤, 48000 Hz)
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º: `_output_state = IDLE`
- ‚úÖ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
- ‚úÖ **–°–æ–±—ã—Ç–∏–µ `audio.playback.completed` –ø–æ–ª—É—á–µ–Ω–æ!** (callback —Å—Ä–∞–±–æ—Ç–∞–ª!)
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: `_output_state = IDLE`

**–í—ã–≤–æ–¥**: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, completion callback —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –°–æ–±—ã—Ç–∏–µ `playback.started` –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è), –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ `audio.playback.completed` —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

#### ‚úÖ –¢–µ—Å—Ç 3: –ó–∞–ø–∏—Å—å –∞—É–¥–∏–æ (Input)
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–†–û–ô–î–ï–ù (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞—Ç—É—Ä—ã)

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é: `_input_state = IDLE`
- ‚úÖ –ó–∞–ø–∏—Å—å –∑–∞–ø—É—â–µ–Ω–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ `start_input()`)
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: `_input_state = IDLE`

**–í—ã–≤–æ–¥**: –ó–∞–ø–∏—Å—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –£–±—Ä–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `sample_rate` –∏ `channels` –∏–∑ –≤—ã–∑–æ–≤–∞ `start_input()` - –º–µ—Ç–æ–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ `callback`.

---

#### ‚úÖ –¢–µ—Å—Ç 4: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–†–û–ô–î–ï–ù

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- ‚úÖ –¢–µ–∫—É—â–µ–µ OUTPUT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–æ: `MacBook Air Speakers`
- ‚úÖ –¢–µ–∫—É—â–µ–µ INPUT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–æ: `MacBook Air Microphone`
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∞–∫—Ç–∏–≤–µ–Ω
- ‚ö†Ô∏è –°–æ–±—ã—Ç–∏–µ —Å–º–µ–Ω—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–ª–æ—Å—å)

**–í—ã–≤–æ–¥**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Å–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏.

---

#### ‚úÖ –¢–µ—Å—Ç 5: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è AVAudioEngine
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–†–û–ô–î–ï–ù

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –∞–∫—Ç–∏–≤–µ–Ω
- ‚ö†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–ª–æ—Å—å)

**–í—ã–≤–æ–¥**: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ï—Å—Ç—å –æ—à–∏–±–∫–∞ `Callable argument is not a PyObjC closure` –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Core Audio listeners, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

#### ‚úÖ –¢–µ—Å—Ç 6: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã AVFAudioEngine
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–†–û–ô–î–ï–ù

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- ‚úÖ –ü–µ—Ä–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ–∑–¥–∞–Ω
- ‚úÖ –í—Ç–æ—Ä–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ–∑–¥–∞–Ω
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π callback –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –æ–±–æ–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- ‚úÖ `engine._output_completion_callback` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –æ–±–æ–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- ‚úÖ `player_node` —Ä–∞–∑–Ω—ã–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

**–í—ã–≤–æ–¥**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, callback –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è.

---

#### ‚úÖ –¢–µ—Å—Ç 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å EventBus
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–†–û–ô–î–ï–ù

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- ‚úÖ Event loop –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω –∫ engine
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞–Ω—ã
- ‚ö†Ô∏è –°–æ–±—ã—Ç–∏—è –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã (–Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)

**–í—ã–≤–æ–¥**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å EventBus —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Å–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

---

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ callback (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–û—à–∏–±–∫–∞**: `BadPrototypeError: Objective-C expects 1 arguments, function has 2`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —Å `(player_node, finished)` –Ω–∞ `(finished)`.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, callback —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: AVAudioPlayerNode –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç weakref (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–û—à–∏–±–∫–∞**: `TypeError: cannot create weak reference to 'AVAudioPlayerNode' object`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω—ë–Ω –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ - —Å–Ω–∞—á–∞–ª–∞ fallback —Å–ª–æ–≤–∞—Ä—å `_PLAYER_NODE_ID_MAP`, –∑–∞—Ç–µ–º weakref.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, –ø—Ä–∏–≤—è–∑–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Callback —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞**: –í `play_audio()` –Ω–∞ —Å—Ç—Ä–æ–∫–µ 1487 –±—ã–ª –∫–æ–¥ `self._output_completion_callback = None`, –∫–æ—Ç–æ—Ä—ã–π —Å–±—Ä–∞—Å—ã–≤–∞–ª callback –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –£–±—Ä–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Å–±—Ä–æ—Å–∞ callback - callback —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∏ –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, callback —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ start_input() –≤ —Ç–µ—Å—Ç–µ (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–û—à–∏–±–∫–∞**: `AVFAudioEngine.start_input() got an unexpected keyword argument 'sample_rate'`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –£–±—Ä–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `sample_rate` –∏ `channels` –∏–∑ –≤—ã–∑–æ–≤–∞ `start_input()`.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç.

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 7
- **–ü—Ä–æ–π–¥–µ–Ω–æ**: 7 ‚úÖ
- **–ü—Ä–æ–≤–∞–ª–µ–Ω–æ**: 0 ‚ùå
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å**: 100%

---

## üéØ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

### ‚úÖ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- EventBus —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –∫ engine
- Completion callback —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è

### ‚úÖ Output (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ)
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Completion callback —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –ø—É–±–ª–∏–∫—É–µ—Ç `audio.playback.completed`
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∏–∑ IDLE ‚Üí RUNNING ‚Üí IDLE –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ Input (–∑–∞–ø–∏—Å—å)
- –ó–∞–ø–∏—Å—å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∏–∑ IDLE ‚Üí RUNNING ‚Üí IDLE –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∞–∫—Ç–∏–≤–µ–Ω
- –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏

### ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∞–∫—Ç–∏–≤–Ω–∞
- –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è callback'–æ–≤
- –ö–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∏–º–µ–µ—Ç —Å–≤–æ–π `player_node`
- Callback –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ EventBus –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Event loop –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∏ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ)

1. **Core Audio listeners**: –û—à–∏–±–∫–∞ `Callable argument is not a PyObjC closure` –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Core Audio listeners. –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —á–µ—Ä–µ–∑ Core Audio –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é.

2. **playback.started**: –°–æ–±—ã—Ç–∏–µ `playback.started` –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è (–∏–ª–∏ –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —Ç–µ—Å—Ç–∞). –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ `audio.playback.completed` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## ‚úÖ –í—ã–≤–æ–¥—ã

1. **–ê—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–∫–∞—Ö
2. **Completion callback —Ä–∞–±–æ—Ç–∞–µ—Ç** - —Å–æ–±—ã—Ç–∏–µ `audio.playback.completed` –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤–æ–≤—Ä–µ–º—è
3. **–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –∏–ª–∏ callback'–æ–≤
4. **–ù–µ—Ç –≥–æ–Ω–æ–∫ —É—Å–ª–æ–≤–∏–π** - –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
5. **EventBus –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç** - —Å–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∏ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ê—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ.


