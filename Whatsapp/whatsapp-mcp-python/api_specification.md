# Спецификация API WhatsApp MCP Server

## Стандартный формат запросов и ответов

### Общий формат

Все запросы используют JSON-RPC 2.0 протокол через MCP.

---

## 1. Поиск контактов (`search_contacts`)

### Запрос:
```json
{
  "method": "tools/call",
  "params": {
    "name": "search_contacts",
    "arguments": {
      "query": "Sophia"
    }
  }
}
```

### Ответ (стандартизированный):
```json
{
  "result": {
    "content": [{
      "type": "text",
      "text": "Найдено контактов: 1\n\n1. Sophia\n   JID: 14388554334@s.whatsapp.net\n   Телефон: 14388554334\n"
    }]
  }
}
```

### Формат текстового ответа:
```
Найдено контактов: <количество>

<номер>. <Имя контакта>
   JID: <jid>
   Телефон: <номер телефона>
```

---

## 2. Список чатов (`list_chats`)

### Запрос:
```json
{
  "method": "tools/call",
  "params": {
    "name": "list_chats",
    "arguments": {
      "limit": 5,
      "page": 0
    }
  }
}
```

### Ответ (стандартизированный):
```json
{
  "result": {
    "content": [{
      "type": "text",
      "text": "Чаты (страница 1):\n\n1. Sophia\n   JID: 14388554334@s.whatsapp.net\n   Телефон: 14388554334\n   Последнее сообщение: Вы: Привет!\n   Время: 2025-11-30T23:50:59.000Z\n\n2. John Doe\n   JID: 1234567890@s.whatsapp.net\n   Телефон: 1234567890\n   Последнее сообщение: John Doe: Как дела?\n   Время: 2025-11-30T22:30:15.000Z\n"
    }]
  }
}
```

### Формат текстового ответа:
```
Чаты (страница <номер>):

<номер>. <Имя контакта>
   JID: <jid>
   Телефон: <номер телефона>
   Последнее сообщение: <отправитель>: <текст сообщения>
   Время: <ISO timestamp>
```

### Параметры:
- `limit` (integer, optional) - количество чатов (по умолчанию 20, максимум 100)
- `page` (integer, optional) - номер страницы, начиная с 0 (по умолчанию 0)

---

## 3. Список сообщений (`list_messages`)

### Запрос:
```json
{
  "method": "tools/call",
  "params": {
    "name": "list_messages",
    "arguments": {
      "chat_jid": "14388554334@s.whatsapp.net",
      "limit": 10,
      "page": 0
    }
  }
}
```

Или по имени контакта:
```json
{
  "method": "tools/call",
  "params": {
    "name": "list_messages",
    "arguments": {
      "chat_jid": "Sophia",
      "limit": 10
    }
  }
}
```

### Ответ (стандартизированный):
```json
{
  "result": {
    "content": [{
      "type": "text",
      "text": "Сообщения из чата: Sophia (14388554334@s.whatsapp.net)\n\n[2025-11-30T23:50:59.000Z] Вы: How are you?\n[2025-11-30T23:45:30.000Z] Sophia: Привет!\n[2025-11-30T23:40:15.000Z] Вы: Как дела?\n"
    }]
  }
}
```

### Формат текстового ответа:
```
Сообщения из чата: <Имя контакта> (<JID>)

[<ISO timestamp>] <Отправитель>: <Текст сообщения>
```

### Параметры:
- `chat_jid` (string, required) - JID чата или имя контакта
- `limit` (integer, optional) - количество сообщений (по умолчанию 20, максимум 100)
- `page` (integer, optional) - номер страницы (по умолчанию 0)

---

## 4. Отправка сообщения (`send_message`)

### Запрос:
```json
{
  "method": "tools/call",
  "params": {
    "name": "send_message",
    "arguments": {
      "recipient": "Sophia",
      "message": "How are you?"
    }
  }
}
```

Или по JID:
```json
{
  "method": "tools/call",
  "params": {
    "name": "send_message",
    "arguments": {
      "recipient": "14388554334@s.whatsapp.net",
      "message": "How are you?"
    }
  }
}
```

### Ответ (стандартизированный):
```json
{
  "result": {
    "content": [{
      "type": "text",
      "text": "✅ Сообщение отправлено успешно\nПолучатель: Sophia (14388554334@s.whatsapp.net)\nID сообщения: 3EB09625E54AEB227140A4\nВремя отправки: 2025-11-30T23:50:59.000Z"
    }]
  }
}
```

### Формат текстового ответа (успех):
```
✅ Сообщение отправлено успешно
Получатель: <Имя> (<JID>)
ID сообщения: <message_id>
Время отправки: <ISO timestamp>
```

### Формат текстового ответа (ошибка):
```
❌ Ошибка отправки сообщения
Получатель: <Имя или JID>
Причина: <описание ошибки>
```

### Параметры:
- `recipient` (string, required) - JID получателя или имя контакта
- `message` (string, required) - текст сообщения (максимум 4096 символов)

---

## 5. Информация о чате (`get_chat`)

### Запрос:
```json
{
  "method": "tools/call",
  "params": {
    "name": "get_chat",
    "arguments": {
      "chat_jid": "Sophia"
    }
  }
}
```

### Ответ (стандартизированный):
```json
{
  "result": {
    "content": [{
      "type": "text",
      "text": "Информация о чате:\nИмя: Sophia\nJID: 14388554334@s.whatsapp.net\nТелефон: 14388554334\nПоследнее сообщение: 2025-11-30T23:50:59.000Z\nВсего сообщений: 42"
    }]
  }
}
```

### Формат текстового ответа:
```
Информация о чате:
Имя: <Имя контакта>
JID: <jid>
Телефон: <номер телефона>
Последнее сообщение: <ISO timestamp>
Всего сообщений: <количество>
```

---

## Стандарты форматирования

### Имена контактов
- Всегда отображаются в читаемом формате
- Если имя не найдено, используется номер телефона
- Автоматически обогащаются из macOS контактов

### Номера телефонов
- Формат: только цифры (например: `14388554334`)
- Извлекаются из JID (часть до `@`)

### JID (Jabber ID)
- Формат: `<номер>@s.whatsapp.net` для контактов
- Формат: `<id>@g.us` для групп

### Временные метки
- Формат: ISO 8601 (например: `2025-11-30T23:50:59.000Z`)
- Всегда в UTC

### Ошибки
- Все ошибки начинаются с `❌`
- Успешные операции начинаются с `✅`
- Всегда указывается причина ошибки

---

## Примеры использования

### Получить последние 5 чатов:
```json
{
  "method": "tools/call",
  "params": {
    "name": "list_chats",
    "arguments": {
      "limit": 5
    }
  }
}
```

### Получить сообщения из чата с именем и номерами:
```json
{
  "method": "tools/call",
  "params": {
    "name": "list_messages",
    "arguments": {
      "chat_jid": "Sophia",
      "limit": 10
    }
  }
}
```

### Отправить сообщение:
```json
{
  "method": "tools/call",
  "params": {
    "name": "send_message",
    "arguments": {
      "recipient": "Sophia",
      "message": "How are you?"
    }
  }
}
```

