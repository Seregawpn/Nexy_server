[tool.ruff]
target-version = "py311"
line-length = 100
exclude = [
  ".git",
  ".venv",
  "build",
  "dist",
  "resources",
]

[tool.ruff.lint]
select = [
  "E",  # pycodestyle errors
  "F",  # pyflakes
  "I",  # isort
  "B",  # flake8-bugbear
  "UP", # pyupgrade
  "PL", # pylint (subset)
  "C90", # complexity (McCabe)
]
max-complexity = 7

[tool.ruff.lint.per-file-ignores]
# Allow higher complexity in selectors/gateways (they are intentionally decision trees)
"integration/core/selectors.py" = ["C901"]
"integration/core/gateways/**/*.py" = ["C901"]

[tool.ruff.lint.isort]
known-first-party = ["integration", "modules", "client"]
force-sort-within-sections = true

[tool.nexy.lint]
# Patterns that should only be accessed through selectors/gateways
# Machine-enforced: ruff will fail if patterns found outside allowed_files
no_direct_state_access_patterns = [
  "\\bperm_mic\\b",
  "\\bperm_screen\\b",
  "\\bperm_accessibility\\b",
  "\\bnetwork_online\\b",
  "\\bfirst_run\\b",
  "\\bdevice_input\\b",
  "\\bapp_mode\\b",
  "\\bstate\\.get",
  "\\bstate\\.set",
  "\\bstate_manager\\.get",
  "\\bstate_manager\\.set",
  "\\bApplicationStateManager\\(\\)\\.get",
  "\\bcfg\\.",
  # Feature flags and kill-switches
  "\\b(perm_|first_run|network|feature_|flag|ks_)\\b",
]
# Files allowed to access state directly (selectors/gateways pattern)
allowed_files = [
  "**/selectors.py",
  "**/gateways.py",
  "**/gateways/**/*.py",
  # Test files are allowed for mocking
  "**/test*.py",
  "**/tests/**/*.py",
]

