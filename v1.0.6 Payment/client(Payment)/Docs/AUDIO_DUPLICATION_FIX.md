# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ä–µ—á–∏

**–î–∞—Ç–∞:** 2025-12-02  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª –æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ä–µ—á–∏. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. –î–≤–æ–π–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è (–µ—Å–ª–∏ `initialize()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã)
2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ –≤ EventBus (–æ–¥–∏–Ω callback –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã)
3. –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —á–∞–Ω–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã

## –ê–Ω–∞–ª–∏–∑

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫
- `SpeechPlaybackIntegration` –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `grpc.response.audio` –≤ –º–µ—Ç–æ–¥–µ `initialize()`
- –ï—Å–ª–∏ `initialize()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã, –ø–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã
- –í `EventBus.subscribe()` –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- `_on_audio_chunk` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `grpc.response.audio`
- `_on_raw_audio` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `playback.raw_audio`
- –≠—Ç–æ —Ä–∞–∑–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–∞–Ω–∫–æ–≤
- `add_audio_data` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞
- `chunk_buffer.add_chunk` —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `chunk_id` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –±—É—Ñ–µ—Ä–∞ –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª:** `integration/integrations/speech_playback_integration.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if self._initialized: return True` –≤ –Ω–∞—á–∞–ª–µ `initialize()`
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –¥–≤–æ–π–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Å–æ–±—ã—Ç–∏—è

### 2. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫ –≤ EventBus

**–§–∞–π–ª:** `integration/core/event_bus.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ –≤ `subscribe()`
- –ï—Å–ª–∏ callback —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Å–æ–±—ã—Ç–∏—è, –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏

### 3. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `integration/integrations/speech_playback_integration.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞ –≤ `_on_audio_chunk` —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ hash —á–∞–Ω–∫–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ `add_audio_data` —Å chunk_id
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ handler'–∞

**–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:**
- `üîç [AUDIT] _on_audio_chunk –≤—ã–∑–≤–∞–Ω: sid=..., handler_time=...`
- `üîä –ü–æ–ª—É—á–µ–Ω –∞—É–¥–∏–æ —á–∞–Ω–∫: ... hash=...`
- `üîç [AUDIT] –í—ã–∑–æ–≤ add_audio_data: sid=..., arr_shape=..., hash=...`
- `üîç [AUDIT] add_audio_data –∑–∞–≤–µ—Ä—à–µ–Ω: chunk_id=..., handler_duration=...`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç:
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `_on_audio_chunk` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `add_audio_data` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
1. **–õ–æ–≥–∏ –ø–æ–¥–ø–∏—Å–æ–∫:**
   - `üìù –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ: grpc.response.audio (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: HIGH, –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: 1)`
   - –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–µ

2. **–õ–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–∞–Ω–∫–æ–≤:**
   - `üîç [AUDIT] _on_audio_chunk –≤—ã–∑–≤–∞–Ω: sid=..., handler_time=...` (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —á–∞–Ω–∫)
   - `üîç [AUDIT] –í—ã–∑–æ–≤ add_audio_data: sid=..., hash=...` (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —á–∞–Ω–∫)
   - `üîç [AUDIT] add_audio_data –∑–∞–≤–µ—Ä—à–µ–Ω: chunk_id=..., handler_duration=...` (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —á–∞–Ω–∫)

3. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
   - –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—á–∏
   - –ö–∞–∂–¥—ã–π —á–∞–Ω–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `integration/integrations/speech_playback_integration.py` - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `integration/core/event_bus.py` - –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫

