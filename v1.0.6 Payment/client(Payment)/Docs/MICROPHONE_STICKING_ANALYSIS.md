# üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã "–∑–∞–ª–∏–ø–∞–Ω–∏—è" –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ:
```
2025-11-29 12:47:40,225 - modules.voice_recognition.core.speech_recognizer - DEBUG - ‚è≥ –û–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –∑–∞–ø–∏—Å–∏...
2025-11-29 12:47:41,230 - modules.voice_recognition.core.speech_recognizer - WARNING - ‚ö†Ô∏è –ü–æ—Ç–æ–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –∑–∞ 1—Å, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è
```

**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Ç–æ–∫ `_run_listening` –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∑–∞ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `stop_listening()`.

---

## üîé –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ `with stream:` –±–ª–æ–∫–µ (–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø)

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `speech_recognizer.py::_run_listening()` —Å—Ç—Ä–æ–∫–∏ 936-963

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥:**
```python
with stream:
    while self.is_listening and not self.stop_event.is_set():
        time.sleep(0.1)
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–ö–†–ò–¢–ò–ß–ù–û:** `with stream:` –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –≤ sounddevice **–±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã—Ö–æ–¥** –¥–æ –ø–æ–ª–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ç–æ–∫–∞, –¥–∞–∂–µ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `stream.stop()`
2. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö callback'–æ–≤ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ PortAudio
3. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ 1+ —Å–µ–∫—É–Ω–¥—ã, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "–ü–æ—Ç–æ–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –∑–∞ 1—Å"
4. `time.sleep(0.1)` –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —É—Å–ª–æ–≤–∏–π –Ω–∞ 100ms
5. –ï—Å–ª–∏ `stop_event` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–æ —Ü–∏–∫–ª –µ—â–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä–∏–ª —É—Å–ª–æ–≤–∏–µ, –ø–æ—Ç–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∂–¥–∞—Ç—å

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ—Ä—è–¥–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–æ–≤

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `speech_recognizer.py::stop_listening()` —Å—Ç—Ä–æ–∫–∞ 517-518

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥:**
```python
self.is_listening = False
self.stop_event.set()
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `is_listening` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ü–ï–†–ï–î `stop_event`
- –ü–æ—Ç–æ–∫ `_run_listening` –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `is_listening` –î–û —Ç–æ–≥–æ, –∫–∞–∫ `stop_event` –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç race condition

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –î–≤–æ–π–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ stream (–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø - –≤—ã–∑—ã–≤–∞–µ—Ç crash)

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `speech_recognizer.py::_run_listening()` —Å—Ç—Ä–æ–∫–∏ 945-995

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥:**
```python
# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π finally –±–ª–æ–∫ (—Å—Ç—Ä–æ–∫–∞ 945):
finally:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º stream –≤ daemon –ø–æ—Ç–æ–∫–µ
    close_thread = threading.Thread(target=close_stream_async, daemon=True)
    close_thread.start()

# –í–Ω–µ—à–Ω–∏–π finally –±–ª–æ–∫ (—Å—Ç—Ä–æ–∫–∞ 985):
finally:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º stream —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
    stream.close()
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–ö–†–ò–¢–ò–ß–ù–û:** `stream.close()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –î–í–ê –†–ê–ó–ê - –æ–¥–∏–Ω —Ä–∞–∑ –≤ daemon –ø–æ—Ç–æ–∫–µ, –æ–¥–∏–Ω —Ä–∞–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
2. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç race condition –≤ PortAudio/sounddevice
3. –†–µ–∑—É–ª—å—Ç–∞—Ç: crash –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å "trace trap" (SIGTRAP)
4. –ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, –∫–æ–≥–¥–∞ stream –µ—â–µ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ stream

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `speech_recognizer.py::_run_listening()` —Å—Ç—Ä–æ–∫–∏ 932-939

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Stream –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ü–û–°–õ–ï –≤—ã—Ö–æ–¥–∞ –∏–∑ `with stream:` –±–ª–æ–∫–∞
- –ï—Å–ª–∏ `with stream:` –±–ª–æ–∫–∏—Ä—É–µ—Ç, stream –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –£–±—Ä–∞—Ç—å `with stream:` –±–ª–æ–∫ + –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å –∑–∞—â–∏—Ç–æ–π (–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï)

**–ü—Ä–æ–±–ª–µ–º–∞ 1:** –î–≤–æ–π–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ `stream.close()` –≤—ã–∑—ã–≤–∞–ª–æ race condition –∏ crash –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (trace trap).

**–ü—Ä–æ–±–ª–µ–º–∞ 2:** `stream.close()` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—á—Ç–∏ –Ω–∞ 1 —Å–µ–∫—É–Ω–¥—É, –¥–∞–∂–µ –ø–æ—Å–ª–µ `stream.stop()`, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç "–∑–∞–ª–∏–ø–∞–Ω–∏–µ" –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. **–ö–†–ò–¢–ò–ß–ù–û:** –£–±—Ä–∞–Ω `with stream:` –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä - –æ–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã—Ö–æ–¥ –¥–æ –ø–æ–ª–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ç–æ–∫–∞
2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–º –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `stream.stop()` –∏ `stream.close()` –≤ `finally` –±–ª–æ–∫–µ
3. **–ö–†–ò–¢–ò–ß–ù–û:** –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `stream_closed` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è stream
4. **–ö–†–ò–¢–ò–ß–ù–û:** `stream.close()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º daemon –ø–æ—Ç–æ–∫–µ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —á–µ—Ä–µ–∑ `_stream_lock`
5. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç race condition –∏ crash, –Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Ç–æ–∫—É `_run_listening` –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –±—ã—Å—Ç—Ä–æ (< 0.1s –≤–º–µ—Å—Ç–æ > 1s)
6. –£–º–µ–Ω—å—à–µ–Ω `time.sleep(0.1)` –¥–æ `0.05` (50ms) –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏
7. –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `stop_event` –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞
8. –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (0.05s) –ø–æ—Å–ª–µ `stream.stop()` –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è callback'–æ–≤ –ø–µ—Ä–µ–¥ `stream.close()`

**–ù–æ–≤—ã–π –∫–æ–¥:**
```python
# ‚úÖ FIX: –£–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Ç–æ–∫–æ–º –≤—Ä—É—á–Ω—É—é (–ë–ï–ó `with stream:`) –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
stream_closed = False  # ‚úÖ FIX: –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
# –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç - –∂–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø—Ä–∏ stop_event
while self.is_listening and not self.stop_event.is_set():
    time.sleep(0.05)  # –ü—Ä–æ–≤–µ—Ä—è–µ–º stop_event —á–∞—Å—Ç–æ (–∫–∞–∂–¥—ã–µ 50ms)
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞
    if self.stop_event.is_set():
        logger.debug("üõë stop_event —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞")
        break

# ... (–≤ finally –±–ª–æ–∫–µ)
finally:
    # ‚úÖ FIX: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ç–æ–∫ (–û–î–ò–ù –†–ê–ó)
    # –ö–†–ò–¢–ò–ß–ù–û: stream.close() –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –º—ã –ù–ï –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å daemon –ø–æ—Ç–æ–∫
    # –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å race condition –∏ crash –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏
    if stream and not stream_closed:
        try:
            # –°–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫
            if stream.active:
                logger.debug("üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º")
                stream.stop()
                time.sleep(0.05)  # –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è callback'–æ–≤
            
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ç–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–Ω–æ –±—ã—Å—Ç—Ä–æ, —Ç–∞–∫ –∫–∞–∫ —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
            logger.debug("üõë –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ç–æ–∫")
            stream.close()
            stream_closed = True
            logger.debug("‚úÖ –ü–æ—Ç–æ–∫ –∑–∞–∫—Ä—ã—Ç")
        except Exception as e:
            logger.debug(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ç–æ–∫–∞: {e}")
            stream_closed = True  # –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∑–∞–∫—Ä—ã—Ç—ã–π –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–æ–≤

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. `stop_event.set()` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ü–ï–†–ï–î `is_listening = False`
2. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ—Ç–æ–∫ `_run_listening` —É–≤–∏–¥–∏—Ç `stop_event` —Ä–∞–Ω—å—à–µ

**–ù–æ–≤—ã–π –∫–æ–¥:**
```python
# –í stop_listening():
self.state = RecognitionState.PROCESSING
# ‚úÖ FIX: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º stop_event –ü–ï–†–ï–î is_listening –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏ –ø–æ—Ç–æ–∫–∞
self.stop_event.set()
# ‚úÖ FIX: –ò—Å–ø–æ–ª—å–∑—É–µ–º —è–≤–Ω–æ–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ –¥–ª—è memory barrier
self.is_listening = False

# –í _graceful_stop_listening():
# ‚úÖ FIX: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º stop_event –ü–ï–†–ï–î is_listening –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏
self.stop_event.set()
# ‚úÖ FIX: –ò—Å–ø–æ–ª—å–∑—É–µ–º memory barrier –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ –¥—Ä—É–≥–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö
self.is_listening = False
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. ‚úÖ –ü–æ—Ç–æ–∫ `_run_listening` –¥–æ–ª–∂–µ–Ω –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ (< 0.5s –≤–º–µ—Å—Ç–æ > 1s)
2. ‚úÖ Stream –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ `stop_event`
3. ‚úÖ –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ `with stream:` –±–ª–æ–∫–µ
4. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–æ–≤ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç race conditions

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–ø–∏—Å—å (LONG_PRESS)
2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å (RELEASE)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ - –ø–æ—Ç–æ–∫ –¥–æ–ª–∂–µ–Ω –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –∑–∞ < 0.5s
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `_current_stream = None` –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π "–ü–æ—Ç–æ–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è"

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `modules/voice_recognition/core/speech_recognizer.py` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
  - `_run_listening()` - –ø–æ—Ç–æ–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è (—Å—Ç—Ä–æ–∫–∏ 707-989)
  - `stop_listening()` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è (—Å—Ç—Ä–æ–∫–∏ 493-575)
  - `_graceful_stop_listening()` - graceful –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 257-323)
  - `_audio_callback()` - callback –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 1536-1600)

