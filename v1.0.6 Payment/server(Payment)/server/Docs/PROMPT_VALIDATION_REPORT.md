# –û—Ç—á—ë—Ç –æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è LLM

## ‚úÖ –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: –ü–†–û–ú–ü–¢ –ö–û–†–†–ï–ö–¢–ï–ù

–ü—Ä–æ–º–ø—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–µ–±—É–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã JSON –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º `AssistantResponseParser`.

---

## üìã –ê–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ–æ—Ä–º–∞—Ç–∞–º

### ‚úÖ –§–æ—Ä–º–∞—Ç 1: –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç

**–í –ø—Ä–æ–º–ø—Ç–µ:**
```json
{
  "text": "The Calculator app is already open. What would you like to do next?"
}
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è –ø–∞—Ä—Å–µ—Ä–æ–º:**
- ‚úÖ –ü–æ–ª–µ `text` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `command`, `args`, `session_id`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**

---

### ‚úÖ –§–æ—Ä–º–∞—Ç 2: –î–µ–π—Å—Ç–≤–∏–µ (Action Response)

**–í –ø—Ä–æ–º–ø—Ç–µ:**
```json
{
  "session_id": "<reuse incoming session_id or null>",
  "command": "open_app",
  "args": {
    "app_name": "Calculator"
  },
  "text": "Opening Calculator."
}
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è –ø–∞—Ä—Å–µ—Ä–æ–º:**
- ‚úÖ `session_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤–∞–ª–∏–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ `command` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- ‚úÖ `args` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–æ–≤–∞—Ä—ë–º)
- ‚úÖ `args.app_name` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è `open_app`)
- ‚úÖ `text` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**

---

## ‚ö†Ô∏è –ó–∞–º–µ—á–∞–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. Session ID –≤ –ø—Ä–æ–º–ø—Ç–µ

**–í –ø—Ä–æ–º–ø—Ç–µ:**
> "session_id": "<reuse incoming session_id or null>"

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ï—Å–ª–∏ `session_id` = `null`, –∫–æ–º–∞–Ω–¥–∞ –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∞ (fallback –Ω–∞ —Ç–µ–∫—Å—Ç)
- –õ—É—á—à–µ —É–∫–∞–∑–∞—Ç—å: "session_id": "<–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å session_id –∏–∑ –∑–∞–ø—Ä–æ—Å–∞>"

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```json
{
  "session_id": "<–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞, –Ω–µ null>",
  "command": "open_app",
  "args": {
    "app_name": "Calculator"
  },
  "text": "Opening Calculator."
}
```

### 2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ "single valid JSON object"

**–í –ø—Ä–æ–º–ø—Ç–µ:**
> "You MUST always respond with a **single valid JSON object**"

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–û**

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ LLM –Ω–µ –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å Markdown, –∫–æ–¥-–±–ª–æ–∫–∏ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç.

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–í –ø—Ä–æ–º–ø—Ç–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ:**
- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ `session_id` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ `app_name` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞:**
- –ï—Å–ª–∏ `session_id` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –∫–æ–º–∞–Ω–¥–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `text`
- –ï—Å–ª–∏ `app_name` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –∫–æ–º–∞–Ω–¥–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `text`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–º–ø—Ç:
> "If session_id is missing or null, the action will be ignored and only the text will be used."

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞

### –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ–∫—Ü–∏—é [Action Output Format]:

```
Rules for Action Response:

- session_id: REQUIRED, must be the exact session_id from the request (never null)
- command: REQUIRED, must be "open_app" for opening applications
- args.app_name: REQUIRED for open_app, must be a valid macOS app name
- text: REQUIRED, can be empty string, used for TTS

Validation:
- If session_id is missing or null ‚Üí action will be ignored, only text will be used
- If args.app_name is missing or empty ‚Üí action will be ignored, only text will be used
- Always include session_id from the request to ensure action execution
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| –§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ | ‚úÖ | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω |
| –§–æ—Ä–º–∞—Ç –¥–µ–π—Å—Ç–≤–∏—è | ‚úÖ | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω |
| –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è | ‚ö†Ô∏è | session_id –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º (–Ω–µ null) |
| –í–∞–ª–∏–¥–∞—Ü–∏—è | ‚ö†Ô∏è | –ù–µ –æ–ø–∏—Å–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ |
| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ JSON | ‚úÖ | –ß—ë—Ç–∫–æ —É–∫–∞–∑–∞–Ω–æ |
| –ü—Ä–∏–º–µ—Ä—ã | ‚úÖ | –ü—Ä–∏–≤–µ–¥–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã |

---

## üéØ –í—ã–≤–æ–¥

**–ü—Ä–æ–º–ø—Ç –≤ —Ü–µ–ª–æ–º –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω**, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. ‚úÖ –£—Ç–æ—á–Ω–∏—Ç—å, —á—Ç–æ `session_id` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º (–Ω–µ `null`)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ fallback-–ø–æ–≤–µ–¥–µ–Ω–∏–∏
3. ‚úÖ –£—Å–∏–ª–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ `session_id` –¥–æ–ª–∂–µ–Ω –±—Ä–∞—Ç—å—Å—è –∏–∑ –∑–∞–ø—Ä–æ—Å–∞

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ–º–ø—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**, –Ω–æ —Å —É—á—ë—Ç–æ–º —Ç–æ–≥–æ, —á—Ç–æ –µ—Å–ª–∏ LLM –≤–µ—Ä–Ω—ë—Ç `session_id: null`, –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è.

