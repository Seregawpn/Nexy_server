#!/bin/bash

cd /Users/sergiyzasorin/Development/Nexy/client

killall -9 Python 2>/dev/null || true
sleep 1

# –°–æ–∑–¥–∞—ë–º —Ñ–ª–∞–≥ first_run (—ç–º—É–ª–∏—Ä—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫)
touch ~/Library/Application\ Support/Nexy/permissions_first_run_completed.flag

echo "üöÄ –§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞"
echo "=========================================================="
echo ""

python3 main.py > /tmp/final_test.log 2>&1 &
PID=$!

echo "PID: $PID"
sleep 12

echo ""
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
if ps -p $PID > /dev/null 2>&1; then
    echo "  ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –†–ê–ë–û–¢–ê–ï–¢ (PID: $PID)"
else
    echo "  ‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ó–ê–í–ï–†–®–ï–ù–û"
fi

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –±—ã–ª–æ
if grep -q "–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ" /tmp/final_test.log; then
    echo "  ‚úÖ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–û"
else
    echo "  ‚ùå –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ù–ï –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ"
fi

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç –≤ SLEEPING –±—ã–ª
if grep -q "–í–æ–∑–≤—Ä–∞—Ç –≤ —Ä–µ–∂–∏–º SLEEPING" /tmp/final_test.log; then
    echo "  ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –≤ SLEEPING —Ä–µ–∂–∏–º"
else
    echo "  ‚ùå –ù–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ SLEEPING"
fi

# 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ù–ï –±—ã–ª–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
if grep -q "Exiting current process" /tmp/final_test.log; then
    echo "  ‚ùå –û–®–ò–ë–ö–ê: –ë—ã–ª –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å!)"
else
    echo "  ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ù–ï –ø—Ä–æ–∏–∑–æ—à—ë–ª (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)"
fi

echo ""
echo "=========================================================="
if ps -p $PID > /dev/null 2>&1; then
    echo "üéâ –¢–ï–°–¢ –£–°–ü–ï–®–ï–ù! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!"
    killall Python 2>/dev/null || true
else
    echo "‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å"
fi

