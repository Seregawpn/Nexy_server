# üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ Permission Restart

–ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è permission restart —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.

## üìä –¢–∞–±–ª–∏—Ü–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

| # | –£—Å–ª–æ–≤–∏—è | –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---|---------|---------------------|--------|
| 1 | ‚úÖ `enabled=true`<br>‚úÖ `respect_updates=true`<br>‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ **–î–û–°–¢–£–ü–ù–û** | ‚ùå Restart **–ù–ï** –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è<br>üìù –õ–æ–≥: "Update available - skipping"<br>‚è≥ –ñ–¥—ë–º update restart | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 2 | ‚úÖ `enabled=true`<br>‚úÖ `respect_updates=true`<br>‚ùå –û–±–Ω–æ–≤–ª–µ–Ω–∏—è **–ù–ï–¢** | ‚úÖ Restart **–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è**<br>‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ 5 —Å–µ–∫<br>üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 3 | ‚úÖ `enabled=true`<br>‚ùå `respect_updates=false`<br>‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ | ‚úÖ Restart **–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è** (–∏–≥–Ω–æ—Ä–∏—Ä—É—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)<br>üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 4 | ‚ùå `enabled=false` | ‚ùå –í—Å—è –ª–æ–≥–∏–∫–∞ **–æ—Ç–∫–ª—é—á–µ–Ω–∞**<br>üìù –õ–æ–≥: "Scheduler disabled" | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 5 | ‚úÖ `enabled=true`<br>‚ùå `max_attempts >= 3` | ‚ùå Restart **–ù–ï** –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è<br>üìù –õ–æ–≥: "Max restart attempts reached" | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 6 | ‚úÖ Restart –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω<br>‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ **–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è** –ø–æ—Å–ª–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è | ‚è≥ Restart **–∂–¥—ë—Ç** –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è<br>‚è±Ô∏è –¢–∞–π–º–∞—É—Ç 10 –º–∏–Ω—É—Ç | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 7 | ‚úÖ `respect_active_sessions=true`<br>‚öôÔ∏è Mode = **LISTENING** | ‚è≥ Restart **–∂–¥—ë—Ç** —Ä–µ–∂–∏–º–∞ SLEEPING<br>‚è±Ô∏è –¢–∞–π–º–∞—É—Ç 10 –º–∏–Ω—É—Ç | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 8 | ‚úÖ `respect_active_sessions=true`<br>‚öôÔ∏è Mode = **PROCESSING** | ‚è≥ Restart **–∂–¥—ë—Ç** —Ä–µ–∂–∏–º–∞ SLEEPING<br>‚è±Ô∏è –¢–∞–π–º–∞—É—Ç 10 –º–∏–Ω—É—Ç | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 9 | ‚úÖ `respect_active_sessions=false` | ‚úÖ Restart –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** (–Ω–µ –∂–¥—ë—Ç —Ä–µ–∂–∏–º–∞) | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 10 | üîß `NEXY_DISABLE_AUTO_RESTART=true` | üîç **Dry-run mode**<br>üìù –õ–æ–≥: "Dry-run mode enabled, restart skipped"<br>‚ùå –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 11 | ‚úÖ Restart –∂–¥—ë—Ç —É—Å–ª–æ–≤–∏–π<br>‚è±Ô∏è –ü—Ä–æ—à–ª–æ 10+ –º–∏–Ω—É—Ç | ‚ö†Ô∏è **–¢–∞–π–º–∞—É—Ç**<br>üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ<br>üìù –õ–æ–≥: "Timeout waiting..." | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| 12 | ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ transitions<br>(ACCESSIBILITY + INPUT_MONITORING) | ‚úÖ –û–¥–Ω–∞ –∑–∞–¥–∞—á–∞ restart<br>üìù –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π<br>üîÑ –û–¥–∏–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ | ‚¨ú –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |

---

## üéØ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (Must Test)

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–µ–π—Å)

**–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ permission restart –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ.

**–®–∞–≥–∏**:
1. –£–¥–∞–ª–∏—Ç—å —Ñ–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞: `rm ~/.Nexy/permissions_first_run_completed.flag`
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
4. –í—ã–¥–∞—Ç—å –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (Microphone, Accessibility, Input Monitoring)
5. –ù–∞–±–ª—é–¥–∞—Ç—å –ª–æ–≥–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```
[PERMISSION_RESTART] Update available - skipping permission restart (permissions will be applied after update restart)
[UPDATER] Found update to version X.X.X
[UPDATER] Installing update...
[UPDATER] Relaunching application...
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞**: ‚úÖ –¢–û–õ–¨–ö–û –û–î–ò–ù –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ—Ç (–±–∞–∑–æ–≤—ã–π –∫–µ–π—Å)

**–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ permission restart –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ—Ç.

**–®–∞–≥–∏**:
1. –£–¥–∞–ª–∏—Ç—å —Ñ–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞: `rm ~/.Nexy/permissions_first_run_completed.flag`
2. –û—Ç–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ò–õ–ò —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–µ—Ç
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
4. –í—ã–¥–∞—Ç—å –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
5. –ù–∞–±–ª—é–¥–∞—Ç—å –ª–æ–≥–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```
[UPDATER] No updates available
[PERMISSION_RESTART] Scheduling application restart (delay=5.0s)
[PERMISSION_RESTART] Executing restart...
[PERMISSION_RESTART] Relaunching Nexy
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞**: ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ ~5 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –≤—ã–¥–∞—á–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 6: Race condition - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ü–û–°–õ–ï –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ restart –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

**–®–∞–≥–∏**:
1. –£–¥–∞–ª–∏—Ç—å —Ñ–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ë–ï–ó –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (—á—Ç–æ–±—ã updater –Ω–µ –Ω–∞—à—ë–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
3. –í—ã–¥–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è ‚Üí permission restart –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω
4. –ë–´–°–¢–†–û –≤–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è restart)
5. Updater –Ω–∞–π–¥—ë—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
6. –ù–∞–±–ª—é–¥–∞—Ç—å –ª–æ–≥–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```
[PERMISSION_RESTART] Scheduling application restart (delay=5.0s)
[UPDATER] Found update to version X.X.X
[PERMISSION_RESTART] Waiting for update to complete...
[UPDATER] Installing update...
[UPDATER] Relaunching application...
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞**: ‚úÖ Permission restart –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## üîß –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
#!/bin/bash

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
reset_state() {
    echo "üßπ –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è..."
    rm -f ~/.Nexy/permissions_first_run_completed.flag
    rm -rf ~/Library/Logs/Nexy/
    killall Nexy 2>/dev/null || true
    sleep 2
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch_logs() {
    echo "üìã –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –ª–æ–≥–∞–º–∏..."
    tail -f ~/Library/Logs/Nexy/nexy.log | grep -E "(PERMISSION_RESTART|UPDATER|FIRST_RUN)"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–ª–∞–≥–∞
check_flag() {
    if [ -f ~/.Nexy/permissions_first_run_completed.flag ]; then
        echo "‚úÖ –§–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–æ–∑–¥–∞–Ω"
    else
        echo "‚ùå –§–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ù–ï —Å–æ–∑–¥–∞–Ω"
    fi
}
```

### –¢–µ—Å—Ç 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ

```bash
# –°—Ü–µ–Ω–∞—Ä–∏–π 1
reset_state
echo "üöÄ –°–¶–ï–ù–ê–†–ò–ô 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ"
echo "1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –≤–∫–ª—é—á–µ–Ω"
echo "2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
echo "3. –í—ã–¥–∞–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è"
echo "4. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏"
read -p "–ù–∞–∂–º–∏—Ç–µ Enter –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã..."

# –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ª–æ–≥–∞–º–∏
watch_logs
```

### –¢–µ—Å—Ç 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ—Ç

```bash
# –°—Ü–µ–Ω–∞—Ä–∏–π 2
reset_state
echo "üöÄ –°–¶–ï–ù–ê–†–ò–ô 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ—Ç"
echo "1. –û—Ç–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç"
echo "2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
echo "3. –í—ã–¥–∞–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è"
echo "4. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º —á–µ—Ä–µ–∑ ~5 —Å–µ–∫—É–Ω–¥"
read -p "–ù–∞–∂–º–∏—Ç–µ Enter –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã..."

watch_logs
```

---

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | Unit Tests | Integration Tests | Manual Tests |
|-----------|------------|-------------------|--------------|
| **–°—Ü–µ–Ω–∞—Ä–∏–π 1**: Update –¥–æ—Å—Ç—É–ø–Ω–æ | ‚úÖ | ‚¨ú | üéØ –ö–†–ò–¢–ò–ß–ù–û |
| **–°—Ü–µ–Ω–∞—Ä–∏–π 2**: Update –Ω–µ—Ç | ‚úÖ | ‚¨ú | üéØ –ö–†–ò–¢–ò–ß–ù–û |
| **–°—Ü–µ–Ω–∞—Ä–∏–π 3**: respect_updates=false | ‚úÖ | ‚¨ú | ‚¨ú |
| **–°—Ü–µ–Ω–∞—Ä–∏–π 4**: enabled=false | ‚úÖ | ‚¨ú | ‚¨ú |
| **–°—Ü–µ–Ω–∞—Ä–∏–π 5**: max_attempts | ‚úÖ | ‚¨ú | ‚¨ú |
| **–°—Ü–µ–Ω–∞—Ä–∏–π 6**: Race condition | ‚úÖ | ‚¨ú | üéØ –ö–†–ò–¢–ò–ß–ù–û |
| **–°—Ü–µ–Ω–∞—Ä–∏–π 7**: Active session | ‚úÖ | ‚¨ú | ‚¨ú |
| **–°—Ü–µ–Ω–∞—Ä–∏–π 8**: Dry-run mode | ‚úÖ | ‚¨ú | ‚¨ú |
| **–°—Ü–µ–Ω–∞—Ä–∏–π 11**: Timeout | ‚¨ú | ‚¨ú | ‚¨ú |
| **–°—Ü–µ–Ω–∞—Ä–∏–π 12**: Multiple transitions | ‚¨ú | ‚¨ú | ‚¨ú |

**–õ–µ–≥–µ–Ω–¥–∞**:
- ‚úÖ –¢–µ—Å—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- üéØ –ö—Ä–∏—Ç–∏—á–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚¨ú –¢–µ—Å—Ç –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

---

## üö® –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ edge cases

### 1. Updater –Ω–µ –∏–º–µ–µ—Ç is_update_available()

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –º–µ—Ç–æ–¥ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è False ‚Üí restart –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ**: ‚úÖ –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –≤ UpdaterIntegration

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ check_for_updates() –±–ª–æ–∫–∏—Ä—É—é—â–∞—è

**–ü—Ä–æ–±–ª–µ–º–∞**: `updater.check_for_updates()` –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ–π (—Å–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å).

**–†–∏—Å–∫**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ EventBus –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ `is_update_available()`

**–†–µ—à–µ–Ω–∏–µ**:
- Option A: –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç check_for_updates() –Ω–∞ N —Å–µ–∫—É–Ω–¥
- Option B: –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- Option C: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ `check_on_startup=true`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

### 3. Updater –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ü–û–°–õ–ï –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è restart

**–ü—Ä–æ–±–ª–µ–º–∞**:
1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç
2. –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤—ã–¥–∞–Ω—ã ‚Üí permission restart –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ 5 —Å–µ–∫
3. Updater –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–º–µ–¥–ª–µ–Ω–Ω–æ) ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫
4. Permission restart —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è (—Ä–∞–Ω—å—à–µ —á–µ–º updater –Ω–∞—à—ë–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

**–†–µ—à–µ–Ω–∏–µ**:
- –£–≤–µ–ª–∏—á–∏—Ç—å restart_delay_sec –¥–æ 15-30 —Å–µ–∫—É–Ω–¥?
- –ò–ª–∏: –≤ `_run_when_safe()` –ø—Ä–æ–≤–µ—Ä—è—Ç—å `is_update_available()` –µ—â—ë —Ä–∞–∑ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: ‚ö†Ô∏è –í–æ–∑–º–æ–∂–µ–Ω –¥–≤–æ–π–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

---

### 4. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ transitions –∑–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è

**–ü—Ä–æ–±–ª–µ–º–∞**: ACCESSIBILITY granted ‚Üí –ø–ª–∞–Ω–∏—Ä—É–µ–º restart ‚Üí INPUT_MONITORING granted ‚Üí –ø–ª–∞–Ω–∏—Ä—É–µ–º –µ—â—ë –æ–¥–∏–Ω?

**–†–µ—à–µ–Ω–∏–µ**: ‚úÖ –£–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ - `if self._pending_task and not self._pending_task.done()` –≤ maybe_schedule_restart()

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ–≤—å—é

- [x] –ú–µ—Ç–æ–¥ `is_update_available()` –¥–æ–±–∞–≤–ª–µ–Ω –≤ UpdaterIntegration
- [x] –ú–µ—Ç–æ–¥ `_is_update_available()` –¥–æ–±–∞–≤–ª–µ–Ω –≤ RestartScheduler
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ `maybe_schedule_restart()` –ø–µ—Ä–µ–¥ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- [x] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `respect_updates=true` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- [ ] Unit tests –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –°—Ü–µ–Ω–∞—Ä–∏—è 1 (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ)
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –°—Ü–µ–Ω–∞—Ä–∏—è 2 (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ—Ç)
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –°—Ü–µ–Ω–∞—Ä–∏—è 6 (race condition)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ `check_for_updates()`
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å unit tests**: `pytest tests/test_permission_restart_logic.py -v`
2. **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤** (1, 2, 6)
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** is_update_available()
4. **–†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É #3** (updater –º–µ–¥–ª–µ–Ω–Ω–µ–µ —á–µ–º restart_delay)
5. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**
