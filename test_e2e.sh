#!/bin/bash

# End-to-End —Ç–µ—Å—Ç: –ø–æ–ª–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π
# 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —Å –∑–∞–≥–ª—É—à–∫–æ–π
# 2. –í—ã–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ü–†–û–ë–ï–õ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥

cd /Users/sergiyzasorin/Development/Nexy/client

export NEXY_TEST_SKIP_PERMISSIONS=1

echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë  END-TO-END –¢–ï–°–¢ NEXY                                         ‚ïë"
echo "‚ïë  üß™ –†–ï–ñ–ò–ú: NEXY_TEST_SKIP_PERMISSIONS=1                       ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
killall -9 Python 2>/dev/null || true
sleep 2

# –û—á–∏—â–∞–µ–º –≤—Å–µ —Ñ–ª–∞–≥–∏ (—ç–º—É–ª–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫)
rm -f "$HOME/Library/Application Support/Nexy"/*.flag 2>/dev/null
echo "‚úì –û—á–∏—Å—Ç–∏–ª–∏ –≤—Å–µ —Ñ–ª–∞–≥–∏"
echo ""

# ============================================================================
# –®–ê–ì 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
# ============================================================================
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üì± –®–ê–ì 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

python3 main.py > /tmp/nexy_e2e_step1.log 2>&1 &
PID1=$!
echo "üöÄ –ó–∞–ø—É—â–µ–Ω–æ (PID: $PID1)"
echo "‚è≥ –ñ–¥—ë–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (8 —Å–µ–∫—É–Ω–¥)..."
sleep 8

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
echo ""
echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —à–∞–≥–∞ 1:"
if ps -p $PID1 > /dev/null 2>&1; then
    echo "  ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "  ‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç"
    echo ""
    echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∞:"
    tail -30 /tmp/nexy_e2e_step1.log
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∑–∞–≥–ª—É—à–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
if grep -q "NEXY_TEST_SKIP_PERMISSIONS" /tmp/nexy_e2e_step1.log; then
    echo "  ‚úÖ –ó–∞–≥–ª—É—à–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞"
else
    echo "  ‚ùå –ó–∞–≥–ª—É—à–∫–∞ –ù–ï –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ SLEEPING —Ä–µ–∂–∏–º–µ
if grep -q "–í–æ–∑–≤—Ä–∞—Ç –≤ —Ä–µ–∂–∏–º SLEEPING" /tmp/nexy_e2e_step1.log || grep -q "Mode changed.*SLEEPING" /tmp/nexy_e2e_step1.log; then
    echo "  ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ SLEEPING"
else
    echo "  ‚ö†Ô∏è  –†–µ–∂–∏–º SLEEPING –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ –µ—â—ë –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è)"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ keyboard monitor —Ä–∞–±–æ—Ç–∞–µ—Ç
if grep -q "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä –∑–∞–ø—É—â–µ–Ω" /tmp/nexy_e2e_step1.log || grep -q "keyboard monitor started" /tmp/nexy_e2e_step1.log; then
    echo "  ‚úÖ –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä –∑–∞–ø—É—â–µ–Ω"
else
    echo "  ‚ö†Ô∏è  –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω"
fi

echo ""
echo "‚úì –®–∞–≥ 1 –∑–∞–≤–µ—Ä—à—ë–Ω"

# ============================================================================
# –®–ê–ì 2: –í—ã–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# ============================================================================
echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üõë –®–ê–ì 2: –í—ã–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

killall Python 2>/dev/null || true
sleep 2

if ps -p $PID1 > /dev/null 2>&1; then
    echo "  ‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç"
    killall -9 Python 2>/dev/null || true
    sleep 1
fi

echo "  ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
echo ""
echo "‚úì –®–∞–≥ 2 –∑–∞–≤–µ—Ä—à—ë–Ω"
sleep 3

# ============================================================================
# –®–ê–ì 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# ============================================================================
echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üîÑ –®–ê–ì 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

python3 main.py > /tmp/nexy_e2e_step3.log 2>&1 &
PID3=$!
echo "üöÄ –ó–∞–ø—É—â–µ–Ω–æ (PID: $PID3)"
echo "‚è≥ –ñ–¥—ë–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (10 —Å–µ–∫—É–Ω–¥)..."
sleep 10

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
echo ""
echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —à–∞–≥–∞ 3:"
if ps -p $PID3 > /dev/null 2>&1; then
    echo "  ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "  ‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç"
    echo ""
    echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∞:"
    tail -30 /tmp/nexy_e2e_step3.log
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ù–ï –±—ã–ª–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
if ! grep -q "Exiting current process" /tmp/nexy_e2e_step3.log; then
    echo "  ‚úÖ –õ–∏—à–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ù–ï –ø—Ä–æ–∏–∑–æ—à—ë–ª (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)"
else
    echo "  ‚ùå –ü—Ä–æ–∏–∑–æ—à—ë–ª –ª–∏—à–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å!)"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ SLEEPING —Ä–µ–∂–∏–º–µ
if grep -q "–í–æ–∑–≤—Ä–∞—Ç –≤ —Ä–µ–∂–∏–º SLEEPING\|Mode.*SLEEPING" /tmp/nexy_e2e_step3.log; then
    echo "  ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ SLEEPING"
    SLEEPING_MODE=1
else
    echo "  ‚ö†Ô∏è  –†–µ–∂–∏–º SLEEPING –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω"
    SLEEPING_MODE=0
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ keyboard monitor —Ä–∞–±–æ—Ç–∞–µ—Ç
if grep -q "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä –∑–∞–ø—É—â–µ–Ω\|keyboard monitor started\|QuartzKeyboardMonitor.*started" /tmp/nexy_e2e_step3.log; then
    echo "  ‚úÖ –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç"
    KEYBOARD_OK=1
else
    echo "  ‚ùå –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç"
    KEYBOARD_OK=0
fi

echo ""
echo "‚úì –®–∞–≥ 3 –∑–∞–≤–µ—Ä—à—ë–Ω"

# ============================================================================
# –®–ê–ì 4: –≠–º—É–ª—è—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è –ü–†–û–ë–ï–õ–ê (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤)
# ============================================================================
echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "‚å®Ô∏è  –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

echo "üìù –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –†–£–ß–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:"
echo "   1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (PID: $PID3)"
echo "   2. –ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ 1-2 —Å–µ–∫—É–Ω–¥—ã"
echo "   3. –û—Ç–ø—É—Å—Ç–∏—Ç–µ –ü–†–û–ë–ï–õ"
echo "   4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–∏–ª–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–ø–∏—Å–∏ –≥–æ–ª–æ—Å–∞"
echo ""
echo "‚è≥ –ñ–¥—ë–º 15 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
echo "   (–Ω–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞)"
echo ""

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f /tmp/nexy_e2e_step3.log &
TAIL_PID=$!

sleep 15

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º tail
kill $TAIL_PID 2>/dev/null || true

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"

# ============================================================================
# –ò–¢–û–ì–û–í–´–ô –û–¢–ß–Å–¢
# ============================================================================
echo ""
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë  –ò–¢–û–ì–û–í–´–ô –û–¢–ß–Å–¢                                               ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""

TOTAL_SCORE=0

echo "üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:"
echo ""

if ps -p $PID3 > /dev/null 2>&1; then
    echo "  ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞"
    TOTAL_SCORE=$((TOTAL_SCORE + 1))
else
    echo "  ‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

if ! grep -q "Exiting current process" /tmp/nexy_e2e_step3.log; then
    echo "  ‚úÖ –õ–∏—à–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ù–ï –ø—Ä–æ–∏–∑–æ—à—ë–ª"
    TOTAL_SCORE=$((TOTAL_SCORE + 1))
else
    echo "  ‚ùå –ü—Ä–æ–∏–∑–æ—à—ë–ª –ª–∏—à–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫"
fi

if [ $SLEEPING_MODE -eq 1 ]; then
    echo "  ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ SLEEPING"
    TOTAL_SCORE=$((TOTAL_SCORE + 1))
else
    echo "  ‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –≤ —Ä–µ–∂–∏–º–µ SLEEPING"
fi

if [ $KEYBOARD_OK -eq 1 ]; then
    echo "  ‚úÖ –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç"
    TOTAL_SCORE=$((TOTAL_SCORE + 1))
else
    echo "  ‚ùå –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

if [ $TOTAL_SCORE -eq 4 ]; then
    echo "üéâ –í–°–ï –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´! ($TOTAL_SCORE/4)"
    echo ""
    echo "üìù –†–£–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê:"
    echo "   –ï—Å–ª–∏ –≤—ã –Ω–∞–∂–∞–ª–∏ –ü–†–û–ë–ï–õ –∏ —É–≤–∏–¥–µ–ª–∏ –≤ –ª–æ–≥–∞—Ö —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–ø–∏—Å–∏ –≥–æ–ª–æ—Å–∞ -"
    echo "   –∑–Ω–∞—á–∏—Ç –í–°–Å –†–ê–ë–û–¢–ê–ï–¢ –ö–û–†–†–ï–ö–¢–ù–û! ‚úÖ"
    echo ""
    echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:"
    echo "   grep -E \"PTT|PRESS|LISTENING|recording\" /tmp/nexy_e2e_step3.log | tail -20"
else
    echo "‚ö†Ô∏è  –ß–ê–°–¢–ò–ß–ù–û –ü–†–û–ô–î–ï–ù–û: ($TOTAL_SCORE/4)"
    echo ""
    echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π:"
    echo "   - /tmp/nexy_e2e_step1.log (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫)"
    echo "   - /tmp/nexy_e2e_step3.log (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)"
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
killall Python 2>/dev/null || true

echo "‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω"

