# Task Brief: Packaging preflight stabilization (Nexy.spec + ffmpeg)

## Context
- `./packaging/build_final.sh` stopped at preflight with:
  - missing `packaging/Nexy.spec`
  - missing `resources/ffmpeg/ffmpeg`

## Diagnosis
- `Nexy.spec` was missing in this checkout because `.gitignore` had global `*.spec` without exception for `packaging/Nexy.spec`.
- `resources/ffmpeg/ffmpeg` is generated by `scripts/stage_universal_binaries.py`, but staging happened after preflight checks.
- `build_final.sh` used `cmd | tee` without `pipefail`, so failing checks could appear as passed.

## Changes
1. Restored spec file:
   - copied `/Users/sergiyzasorin/Fix_new/client/packaging/Nexy.spec` to `packaging/Nexy.spec`.
2. `.gitignore`:
   - added `!packaging/Nexy.spec` to prevent accidental exclusion.
3. `packaging/build_final.sh`:
   - enabled `set -o pipefail`;
   - moved `stage_universal_binaries.py` execution to run before preflight;
   - removed duplicated later staging call.

## Verification
- `python .venv/bin/python scripts/stage_universal_binaries.py` -> success, `resources/ffmpeg/ffmpeg` is universal (`arm64 + x86_64`).
- `python .venv/bin/python scripts/verify_imports.py` -> success.
- `python .venv/bin/python scripts/verify_pyinstaller.py` -> success.
- `python .venv/bin/python scripts/verify_spec_dependencies.py` -> success.
- `python .venv/bin/python scripts/verify_packaging_readiness.py` -> success.

## Notes
- Workspace contains many unrelated local modifications before this task; they were not changed.
