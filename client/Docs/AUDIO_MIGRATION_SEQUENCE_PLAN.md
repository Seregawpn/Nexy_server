# –ü–ª–∞–Ω –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º—ã

**–°—Ç–∞—Ç—É—Å**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞**: 2025-01-XX  
**–û—Å–Ω–æ–≤–∞–Ω –Ω–∞**: `AUDIO_MIGRATION_MASTER_SPECIFICATION.md`, `AUDIO_MIGRATION_PR_PLAN.md`

---

## üìã –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**9 —ç—Ç–∞–ø–æ–≤, 42 –¥–Ω—è, 9 PR**

–ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö. –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–æ–≤.

---

## üéØ –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (PR 1)

**–í–µ—Ç–∫–∞**: `feature/avfoundation-audio-stage1-contracts-mapping`  
**–î–Ω–∏**: 1-4  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ù–µ—Ç

### –î–µ–Ω—å 1-2: contracts.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/contracts.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `Confidence` enum
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `DeviceTransport` enum
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `DeviceSignature` dataclass
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `RouteSnapshot` dataclass
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `MappingResult` dataclass
7. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã: `__str__()`, `input_changed()`, `output_changed()`, `is_usable()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_contracts.py`
- –°–æ–∑–¥–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**:
- [ ] –õ–∏–Ω—Ç–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (‚â•80% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- [ ] –í—Å–µ —Ç–∏–ø—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã

---

### –î–µ–Ω—å 3-4: mapping.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/mapping.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `contracts.py`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `normalize_device_name()`
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `detect_transport()`
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `build_signature()`
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `find_portaudio_match()`
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_device_index()`
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `clear_cache()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_mapping.py`
- –°–æ–∑–¥–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**:
- [ ] –õ–∏–Ω—Ç–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (‚â•80% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- [ ] –¢–µ—Å—Ç—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (Bluetooth/USB/Built-in)

---

## üéØ –≠—Ç–∞–ø 2: State Machines (PR 2)

**–í–µ—Ç–∫–∞**: `feature/avfoundation-audio-stage2-state-machines`  
**–î–Ω–∏**: 5-8  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø 1 (contracts.py)

### –î–µ–Ω—å 5-6: input_state_machine.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/input_state_machine.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `contracts.py`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `InputState` enum
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `InputStateMachine` dataclass
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `transition_to()`
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `update_heartbeat()`
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `check_heartbeat()`
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `can_retry()`
9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_retry_backoff_sec()`
10. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `should_rollback()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_state_machines.py` (input —á–∞—Å—Ç—å)

---

### –î–µ–Ω—å 7-8: output_state_machine.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/output_state_machine.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `contracts.py`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `OutputState` enum
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `OutputStateMachine` dataclass
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `transition_to()`
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `check_recreate_timeout()`
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `can_retry()`
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_retry_backoff_sec()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_state_machines.py` (output —á–∞—Å—Ç—å)

---

## üéØ –≠—Ç–∞–ø 3: Route Manager Core - Part 1 (PR 3)

**–í–µ—Ç–∫–∞**: `feature/avfoundation-audio-stage3-route-manager-core-1`  
**–î–Ω–∏**: 9-12  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø 1 (contracts.py, mapping.py), –≠—Ç–∞–ø 2 (state machines)

### –î–µ–Ω—å 9-10: debounce_manager.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/debounce_manager.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `contracts.py`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `DebounceConfig` dataclass
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `DebounceManager` –∫–ª–∞—Å—Å
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_debounce_delay_ms()`
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `reset_device()`
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `clear_all()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_route_manager.py` (debounce —á–∞—Å—Ç—å)

---

### –î–µ–Ω—å 11-12: decision_engine.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/decision_engine.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `contracts.py`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `Decision` enum
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `DecisionContext` dataclass
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `DecisionEngine` –∫–ª–∞—Å—Å
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `decide_route_manager_reconcile()` —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏:
   - Hard stop: first_run, restart_pending, update_in_progress
   - Hard stop: mic denied
   - Graceful: device_busy ‚Üí retry
   - Graceful: network_offline ‚Üí degrade
   - NOOP: –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - START: –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `format_decision_log()` (–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_route_manager.py` (decision —á–∞—Å—Ç—å)
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: ‚â•12 pairwise —Ç–µ—Å—Ç–æ–≤ + 2 –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö

---

## üéØ –≠—Ç–∞–ø 4: Route Manager Core - Part 2 (PR 4)

**–í–µ—Ç–∫–∞**: `feature/avfoundation-audio-stage3-route-manager-core-2`  
**–î–Ω–∏**: 13-16  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø 1, –≠—Ç–∞–ø 2, –≠—Ç–∞–ø 3 (debounce, decision)

### –î–µ–Ω—å 13-14: reconcile_engine.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/reconcile_engine.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `contracts.py`, `mapping.py`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ReconcileResult` dataclass
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ReconcileEngine` –∫–ª–∞—Å—Å
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `create_snapshot()`
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `determine_desired_route()` (priority: user ‚Üí system ‚Üí fallback)
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `compare_routes()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_route_manager.py` (reconcile —á–∞—Å—Ç—å)

---

### –î–µ–Ω—å 15-16: route_manager.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/route_manager.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (contracts, mapping, state machines, engines)
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `AudioRouteManager` –∫–ª–∞—Å—Å
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `__init__()`
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `set_event_loop()`
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `set_callbacks()`
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `reconcile_routes()` —Å single-flight –º–µ—Ö–∞–Ω–∏–∑–º–æ–º
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_apply_input_change()`
9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_apply_output_change()`
10. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_active_input_device()`
11. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_active_output_device()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_route_manager.py` (–æ—Å–Ω–æ–≤–Ω–æ–π)

---

## üéØ –≠—Ç–∞–ø 5: –ê–¥–∞–ø—Ç–µ—Ä—ã (PR 5)

**–í–µ—Ç–∫–∞**: `feature/avfoundation-audio-stage4-adapters`  
**–î–Ω–∏**: 17-21  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø 1 (contracts.py, mapping.py)

### –î–µ–Ω—å 17-18: avf_monitor.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/adapters/avf_monitor.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PyObjC
3. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `contracts.py`, `mapping.py`
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `DeviceInfo` dataclass
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `AVFoundationDeviceMonitor` –∫–ª–∞—Å—Å
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_setup_notifications()` (NSNotificationCenter)
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `routeChanged_()` (notification handler)
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_query_devices()` (AVFoundation query)
9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_process_device_changes()`
10. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `start_monitoring()` (dual mechanism: notifications + polling)
11. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_monitor_loop()` (polling thread)
12. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `stop_monitoring()`
13. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_current_devices()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_adapters.py` (monitor —á–∞—Å—Ç—å)

---

### –î–µ–Ω—å 19-20: avf_output.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/adapters/avf_output.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PyObjC
3. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `contracts.py`
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ChunkInfo` dataclass
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `AVFoundationAudioPlayback` –∫–ª–∞—Å—Å
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `initialize()` (AVAudioEngine setup)
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_numpy_to_pcm_buffer()` (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è)
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å sample rate conversion (16kHz ‚Üí 48kHz)
9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å channel conversion
10. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `play_chunk()`
11. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å —á–∞–Ω–∫–æ–≤ (max 5MB, 5s)
12. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `stop_playback()`
13. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `shutdown()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_adapters.py` (output —á–∞—Å—Ç—å)

---

### –î–µ–Ω—å 21: google_input.py

**–§–∞–π–ª**: `modules/voice_recognition/core/avfoundation/adapters/google_input.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `contracts.py`, `speech_recognition`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GoogleInputController` –∫–ª–∞—Å—Å
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_microphone()` (—Å device_index –∏–ª–∏ system default)
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `update_device()`
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_current_device()`

**–¢–µ—Å—Ç—ã**: `tests/test_avfoundation_adapters.py` (input —á–∞—Å—Ç—å)

---

## üéØ –≠—Ç–∞–ø 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (PR 6)

**–í–µ—Ç–∫–∞**: `feature/avfoundation-audio-stage5-integration`  
**–î–Ω–∏**: 22-24  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø—ã 1-5 (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã)

### –î–µ–Ω—å 22-23: audio_route_manager_integration.py

**–§–∞–π–ª**: `integration/integrations/audio_route_manager_integration.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (RouteManager, –∞–¥–∞–ø—Ç–µ—Ä—ã, EventBus, StateManager)
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `AudioRouteManagerIntegration` –∫–ª–∞—Å—Å
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `__init__()` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π feature flags
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `initialize()`:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ kill-switch
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ feature flags
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
   - –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `start()`
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `stop()`
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_on_reconcile_requested()`
9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_create_snapshot()` (–∏–∑ state_manager)
10. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_create_decision_context()` (–∏–∑ Snapshot)
11. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å callbacks (_on_input_start, _on_input_stop, _on_output_recreate)
12. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π (_on_device_changed, _on_first_run_started, etc.)
13. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_active_input_device()`
14. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_active_output_device()`

**–¢–µ—Å—Ç—ã**: `tests/integration/test_audio_route_manager.py`

---

### –î–µ–Ω—å 24: simple_module_coordinator.py

**–§–∞–π–ª**: `integration/core/simple_module_coordinator.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç `AudioRouteManagerIntegration`
2. –ù–∞–π—Ç–∏ –º–µ—Ç–æ–¥ `_create_integrations()`
3. –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ `AudioRouteManagerIntegration` –ø–æ—Å–ª–µ `speech_playback`
4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (voice_recognition, speech_playback)
5. –û–±–Ω–æ–≤–∏—Ç—å `startup_order` (–¥–æ–±–∞–≤–∏—Ç—å `'audio_route_manager'` –ø–æ—Å–ª–µ `'speech_playback'`)

**–¢–µ—Å—Ç—ã**: –û–±–Ω–æ–≤–∏—Ç—å `tests/test_init_order.py`

---

## üéØ –≠—Ç–∞–ø 7: –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (PR 7)

**–í–µ—Ç–∫–∞**: `feature/avfoundation-audio-stage6-adapt-integrations`  
**–î–Ω–∏**: 25-28  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø 6 (AudioRouteManagerIntegration –≥–æ—Ç–æ–≤)

### –î–µ–Ω—å 25-26: voice_recognition_integration.py

**–§–∞–π–ª**: `integration/integrations/voice_recognition_integration.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É feature flag `audio_system.avfoundation_route_manager_enabled`
2. –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ `AudioRouteManagerIntegration` (—á–µ—Ä–µ–∑ coordinator –∏–ª–∏ dependency injection)
3. –û–±–Ω–æ–≤–∏—Ç—å `_on_recording_start()`:
   - –ï—Å–ª–∏ feature flag –≤–∫–ª—é—á–µ–Ω ‚Üí –ø–æ–ª—É—á–∏—Ç—å device_index –æ—Ç RouteManager
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `GoogleInputController` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è Microphone
   - Fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É (–µ—Å–ª–∏ —Ñ–ª–∞–≥ –≤—ã–∫–ª—é—á–µ–Ω)
4. –û–±–Ω–æ–≤–∏—Ç—å `_on_recording_stop()` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
5. –£–±—Ä–∞—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `sd.default.device` (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–¢–µ—Å—Ç—ã**: –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã

---

### –î–µ–Ω—å 27-28: speech_playback_integration.py

**–§–∞–π–ª**: `integration/integrations/speech_playback_integration.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É feature flag `audio_system.avfoundation_output_enabled`
2. –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ `AVFoundationAudioPlayback` (—á–µ—Ä–µ–∑ RouteManager –∏–ª–∏ dependency injection)
3. –û–±–Ω–æ–≤–∏—Ç—å `_on_audio_chunk()`:
   - –ï—Å–ª–∏ feature flag –≤–∫–ª—é—á–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `AVFoundationAudioPlayback`
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è numpy ‚Üí AVAudioPCMBuffer
   - Fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É (–µ—Å–ª–∏ —Ñ–ª–∞–≥ –≤—ã–∫–ª—é—á–µ–Ω)
4. –û–±–Ω–æ–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å —á–∞–Ω–∫–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–¢–µ—Å—Ç—ã**: –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã

---

## üéØ –≠—Ç–∞–ø 8: –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π (PR 8)

**–í–µ—Ç–∫–∞**: `feature/avfoundation-audio-stage7-adapt-modules`  
**–î–Ω–∏**: 29-32  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø 7 (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã)

### –î–µ–Ω—å 29-30: speech_recognizer.py

**–§–∞–π–ª**: `modules/voice_recognition/core/speech_recognizer.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É feature flag
2. –ü–æ–ª—É—á–∏—Ç—å `device_index` –æ—Ç RouteManager (—á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é)
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `GoogleInputController` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è Microphone
4. –£–±—Ä–∞—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `sd.default.device`
5. –£–±—Ä–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `AudioDeviceMonitor` (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è fallback)
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É

**–¢–µ—Å—Ç—ã**: –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã

---

### –î–µ–Ω—å 31-32: player.py

**–§–∞–π–ª**: `modules/speech_playback/core/player.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É feature flag
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `AVFoundationAudioPlayback` –≤–º–µ—Å—Ç–æ `sounddevice.OutputStream`
3. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ (numpy ‚Üí AVAudioPCMBuffer)
4. –û–±–Ω–æ–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å —á–∞–Ω–∫–æ–≤
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É

**–¢–µ—Å—Ç—ã**: –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã

---

## üéØ –≠—Ç–∞–ø 9: Gateways, State Catalog, –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (PR 9)

**–í–µ—Ç–∫–∞**: `feature/avfoundation-audio-stage8-9-final`  
**–î–Ω–∏**: 33-42  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –≠—Ç–∞–ø—ã 1-8 (–≤—Å—è —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞)

### –î–µ–Ω—å 33-34: gateways.py

**–§–∞–π–ª**: `integration/core/gateways.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `decide_route_manager_reconcile(snapshot: Snapshot) -> Decision`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `interaction_matrix.yaml`:
   - Hard stop: first_run, restart_pending, update_in_progress
   - Graceful: device_busy, network_offline
3. –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç decision-–ª–æ–≥–æ–≤
4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `DecisionEngine` –∏–∑ RouteManager

**–¢–µ—Å—Ç—ã**: –û–±–Ω–æ–≤–∏—Ç—å `tests/test_gateways.py`
- ‚â•12 pairwise —Ç–µ—Å—Ç–æ–≤ + 2 –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö

---

### –î–µ–Ω—å 35: STATE_CATALOG.md

**–§–∞–π–ª**: `Docs/STATE_CATALOG.md`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –î–æ–±–∞–≤–∏—Ç—å –æ—Å–∏ `audio.input.device` –∏ `audio.output.device`
2. –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É ownership
3. –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
4. –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

---

### –î–µ–Ω—å 36-40: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª**: `tests/integration/test_audio_route_manager.py`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π: Happy path
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π: Device changed
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π: Blocking conditions (first_run, restart_pending, update_in_progress)
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π: Fallback (AVFoundation –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π: Mapping failures (LOW/NONE confidence)
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π: Network offline (degrade)
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π: Device busy (retry)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**:
- [ ] –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
- [ ] Decision-–ª–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è

---

### –î–µ–Ω—å 41-42: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–§–∞–π–ª—ã**:
- `modules/voice_recognition/core/avfoundation/README.md`
- `Docs/AUDIO_SYSTEM_ARCHITECTURE.md`
- `modules/voice_recognition/INTEGRATION_GUIDE.md`
- `modules/speech_playback/INTEGRATION_GUIDE.md`

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å README –¥–ª—è avfoundation –º–æ–¥—É–ª—è
2. –û–±–Ω–æ–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
3. –û–±–Ω–æ–≤–∏—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```mermaid
graph TD
    Stage1[–≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã<br/>–î–Ω–∏ 1-4] --> Stage2[–≠—Ç–∞–ø 2: State Machines<br/>–î–Ω–∏ 5-8]
    Stage2 --> Stage3[–≠—Ç–∞–ø 3: Route Manager Core-1<br/>–î–Ω–∏ 9-12]
    Stage3 --> Stage4[–≠—Ç–∞–ø 4: Route Manager Core-2<br/>–î–Ω–∏ 13-16]
    Stage4 --> Stage5[–≠—Ç–∞–ø 5: –ê–¥–∞–ø—Ç–µ—Ä—ã<br/>–î–Ω–∏ 17-21]
    Stage5 --> Stage6[–≠—Ç–∞–ø 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è<br/>–î–Ω–∏ 22-24]
    Stage6 --> Stage7[–≠—Ç–∞–ø 7: –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π<br/>–î–Ω–∏ 25-28]
    Stage7 --> Stage8[–≠—Ç–∞–ø 8: –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π<br/>–î–Ω–∏ 29-32]
    Stage8 --> Stage9[–≠—Ç–∞–ø 9: Gateways, Final<br/>–î–Ω–∏ 33-42]
    
    style Stage1 fill:#e8f5e9
    style Stage2 fill:#e8f5e9
    style Stage3 fill:#fff4e1
    style Stage4 fill:#fff4e1
    style Stage5 fill:#e1f5ff
    style Stage6 fill:#f3e5f5
    style Stage7 fill:#ffebee
    style Stage8 fill:#ffebee
    style Stage9 fill:#e0f2f1
```

---

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏

| –≠—Ç–∞–ø | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç | –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|------|------------|----------------------|
| 1 | - | –ù–µ—Ç |
| 2 | 1 | contracts.py |
| 3 | 1, 2 | contracts.py, state machines |
| 4 | 1, 2, 3 | contracts.py, mapping.py, state machines, debounce, decision |
| 5 | 1 | contracts.py, mapping.py |
| 6 | 1-5 | –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã RouteManager |
| 7 | 6 | AudioRouteManagerIntegration |
| 8 | 7 | –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ |
| 9 | 1-8 | –í—Å—è —Å–∏—Å—Ç–µ–º–∞ |

---

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ù–µ–ª—å–∑—è –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —ç—Ç–∞–ø—ã

1. **–≠—Ç–∞–ø 1 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–≤—ã–º** - –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç contracts.py –∏ mapping.py
2. **–≠—Ç–∞–ø 2 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –≠—Ç–∞–ø–æ–º 3** - state machines –Ω—É–∂–Ω—ã –¥–ª—è RouteManager
3. **–≠—Ç–∞–ø 3-4 –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –ø–µ—Ä–µ–¥ –≠—Ç–∞–ø–æ–º 6** - RouteManager –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤
4. **–≠—Ç–∞–ø 5 –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º —Å –≠—Ç–∞–ø–æ–º 3-4** - –∞–¥–∞–ø—Ç–µ—Ä—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –æ—Ç RouteManager core
5. **–≠—Ç–∞–ø 6 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –≠—Ç–∞–ø–æ–º 7** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≥–æ—Ç–æ–≤–∞
6. **–≠—Ç–∞–ø 7 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –≠—Ç–∞–ø–æ–º 8** - –º–æ–¥—É–ª–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

- **–≠—Ç–∞–ø 5 (–ê–¥–∞–ø—Ç–µ—Ä—ã)** –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º —Å **–≠—Ç–∞–ø–æ–º 3-4** (Route Manager Core)
- **–¢–µ—Å—Ç—ã** —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç—Ç–∞–ø–æ–≤ –≥–æ—Ç–æ–≤—ã
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç—Ç–∞–ø–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –õ–∏–Ω—Ç–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] Feature flags –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (–≤—Å–µ `false`)

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] Code review –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö PR –ø—Ä–æ–π–¥–µ–Ω
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç—Ç–∞–ø–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

### –û–±—â–∏–π —à–∞–±–ª–æ–Ω

```bash
cd /Users/sergiyzasorin/Fix_new/client

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
scripts/prepare_audio_migration.sh
python3 scripts/verify_audio_migration_compliance.py

# 2. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É –¥–ª—è —ç—Ç–∞–ø–∞
git checkout -b feature/avfoundation-audio-stage<N>-<name>

# 3. –ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É
# (—Å–º. –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≤ AUDIO_MIGRATION_PR_PLAN.md)
```

---

## üìã –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –≠—Ç–∞–ø | PR | –î–Ω–∏ | –§–∞–π–ª–æ–≤ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | –ú–æ–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ |
|------|----|-----|--------|-------------|-------------------|
| 1 | PR 1 | 1-4 | 2 –Ω–æ–≤—ã—Ö | –ù–µ—Ç | - |
| 2 | PR 2 | 5-8 | 2 –Ω–æ–≤—ã—Ö | –≠—Ç–∞–ø 1 | - |
| 3 | PR 3 | 9-12 | 2 –Ω–æ–≤—ã—Ö | –≠—Ç–∞–ø—ã 1-2 | –≠—Ç–∞–ø 5 |
| 4 | PR 4 | 13-16 | 2 –Ω–æ–≤—ã—Ö | –≠—Ç–∞–ø—ã 1-3 | –≠—Ç–∞–ø 5 |
| 5 | PR 5 | 17-21 | 3 –Ω–æ–≤—ã—Ö | –≠—Ç–∞–ø 1 | –≠—Ç–∞–ø—ã 3-4 |
| 6 | PR 6 | 22-24 | 1 –Ω–æ–≤—ã–π + 1 –∏–∑–º–µ–Ω–µ–Ω–∏–µ | –≠—Ç–∞–ø—ã 1-5 | - |
| 7 | PR 7 | 25-28 | 2 –∏–∑–º–µ–Ω–µ–Ω–∏—è | –≠—Ç–∞–ø 6 | - |
| 8 | PR 8 | 29-32 | 2 –∏–∑–º–µ–Ω–µ–Ω–∏—è | –≠—Ç–∞–ø 7 | - |
| 9 | PR 9 | 33-42 | 2 –∏–∑–º–µ–Ω–µ–Ω–∏—è + docs | –≠—Ç–∞–ø—ã 1-8 | - |

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É

### –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

- [ ] –í—Å–µ –∑–∞–¥–∞—á–∏ —ç—Ç–∞–ø–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (‚â•80% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- [ ] –õ–∏–Ω—Ç–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] PR —Å–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ review
- [ ] Code review –ø—Ä–æ–π–¥–µ–Ω (–¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç—Ç–∞–ø–æ–≤)

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞

- [ ] –ü—Ä–µ–¥—ã–¥—É—â–∏–π PR –∑–∞–º–µ—Ä–∂–µ–Ω
- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] –í–µ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (git pull)

---

## ‚úÖ –ò—Ç–æ–≥

**–ü–ª–∞–Ω –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤.**

- 9 —ç—Ç–∞–ø–æ–≤ –≤ —Å—Ç—Ä–æ–≥–æ–º –ø–æ—Ä—è–¥–∫–µ
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤—ã–¥–µ–ª–µ–Ω—ã
- –ß–µ–∫-–ª–∏—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1, –î–µ–Ω—å 1-2 (—Å–æ–∑–¥–∞–Ω–∏–µ `contracts.py`)

---

**–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.**

