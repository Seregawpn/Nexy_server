# Production-—É—Ä–æ–≤–µ–Ω—å —Ñ–∏–∫—Å—ã: –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç–æ–Ω–∫–∏—Ö —Ä–∏—Å–∫–æ–≤

**–î–∞—Ç–∞:** 2025-12-24  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–∫—Å–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

## üìã –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–∫—Å—ã

### 1. ‚úÖ Per-callback generation —á–µ—Ä–µ–∑ closure (–≤–º–µ—Å—Ç–æ per-object)

**–ü—Ä–æ–±–ª–µ–º–∞:** `_callback_stream_gen` –±—ã–ª –æ–±—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –Ω–∞ –æ–±—ä–µ–∫—Ç, —á—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–Ω–æ–π –ø–æ—Ä—á–µ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö callback'–∞—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω –º–µ—Ç–æ–¥ `_make_audio_callback(stream_gen, stream_sr, content_sr)` –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç closure
- –ö–∞–∂–¥—ã–π callback –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–≤–æ–π `stream_gen` —á–µ—Ä–µ–∑ closure
- Generation —Ç–µ–ø–µ—Ä—å "per-callback", –∞ –Ω–µ "per-object"

**–ö–æ–¥:**
```python
def _make_audio_callback(self, stream_gen: int, stream_sr: int, content_sr: int):
    """–°–æ–∑–¥–∞–µ—Ç callback —Å closure, –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–º generation –∏ sample rates."""
    needs_resample = (stream_sr != content_sr) and (self._resample_audio_func is not None)
    
    def audio_callback(outdata, frames, time_info, status):
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º generation —á–µ—Ä–µ–∑ closure (per-callback)
        current_gen = self._current_stream_gen
        if stream_gen != current_gen:
            # Stream –±—ã–ª –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω - —ç—Ç–æ—Ç callback —É—Å—Ç–∞—Ä–µ–ª
            outdata[:] = 0
            return
        # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ ...
    
    return audio_callback
```

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ—Ç –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–Ω–æ–π –ø–æ—Ä—á–∏ –º–µ–∂–¥—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ callback'–∞–º–∏
- –ö–∞–∂–¥—ã–π callback –∏–º–µ–µ—Ç —Å–≤–æ–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π generation
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–∞–∂–µ –ø—Ä–∏ re-entrant –≤—ã–∑–æ–≤–∞—Ö PortAudio

---

### 2. ‚úÖ –†–µ–∞–ª—å–Ω—ã–π —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥ –≤ callback (–≤–º–µ—Å—Ç–æ mute)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `stream_sr != content_sr` –∏ —Ä–µ—Å–µ–º–ø–ª–µ—Ä –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, playback –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞–ª—Å—è ‚Üí –≤–µ—á–Ω–∞—è —Ç–∏—à–∏–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `resample_audio` –∏–∑ `modules/speech_playback/utils/device_utils.py`
- –†–µ—Å–µ–º–ø–ª–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ callback –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- Fallback scenario: –µ—Å–ª–∏ —Ä–µ—Å–µ–º–ø–ª–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –ª–æ–≥–∏—Ä—É–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–æ –Ω–µ mute (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ fallback –Ω–∞ device_sr)

**–ö–æ–¥:**
```python
# –í _make_audio_callback:
needs_resample = (stream_sr != content_sr) and (self._resample_audio_func is not None)

# –í callback:
if needs_resample and len(data) > 0:
    # –†–µ—Å–µ–º–ø–ª–∏–º –∫–∞–∂–¥—ã–π –∫–∞–Ω–∞–ª –æ—Ç–¥–µ–ª—å–Ω–æ
    if data.ndim == 1:
        data = self._resample_audio_func(data, content_sr, stream_sr)
    else:
        # 2D ‚Üí —Ä–µ—Å–µ–º–ø–ª–∏–º –∫–∞–∂–¥—ã–π –∫–∞–Ω–∞–ª
        resampled_channels = []
        for ch in range(data.shape[1]):
            channel_data = data[:, ch]
            resampled_ch = self._resample_audio_func(channel_data, content_sr, stream_sr)
            resampled_channels.append(resampled_ch)
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º –∫–∞–Ω–∞–ª—ã
        # ...
```

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ—Ç –≤–µ—á–Ω–æ–π —Ç–∏—à–∏–Ω—ã - —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- Playback —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ fallback –Ω–∞ device_sr
- –ö–∞—á–µ—Å—Ç–≤–æ: –ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–µ—á–∏)

---

### 3. ‚úÖ Cooldown —Ç–æ–ª—å–∫–æ –Ω–∞ failure-path (–±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —É—Å–ø–µ—Ö)

**–ü—Ä–æ–±–ª–µ–º–∞:** Cooldown –ø—Ä–∏–º–µ–Ω—è–ª—Å—è –∫–æ –≤—Å–µ–º device queries, —á—Ç–æ –º–æ–≥–ª–æ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- Cooldown –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ `device_id is None` (failure-path)
- –ï—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–æ –∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ä–∞–∑—É (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º cooldown)
- –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç timestamp, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è cooldown'–æ–º

**–ö–æ–¥:**
```python
# –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º device change (–¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏)
device_changed, detected_device_id, detected_device_sr = self._detect_output_device_change()

if device_changed:
    # –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ä–∞–∑—É (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º cooldown)
    device_id = detected_device_id
    device_sr = detected_device_sr
elif detected_device_id is None:
    # Device –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø—Ä–∏–º–µ–Ω—è–µ–º cooldown (failure-path)
    if current_time - self._last_device_query_ts >= self._device_query_cooldown_sec:
        self._last_device_query_ts = current_time
        device_id = detected_device_id
        device_sr = detected_device_sr
    else:
        # Cooldown –∞–∫—Ç–∏–≤–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à
        logger.debug("üîç [OUTPUT] Device query –≤ cooldown (device –Ω–µ –Ω–∞–π–¥–µ–Ω), –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à")
else:
    # Device –Ω–∞–π–¥–µ–Ω, –Ω–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è - –æ–±–Ω–æ–≤–ª—è–µ–º timestamp
    self._last_device_query_ts = current_time
```

**–ó–∞—â–∏—Ç–∞:**
- –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (AirPods –∏ —Ç.–¥.)
- –ù–µ—Ç —Å–ø–∞–º–∞ device queries –ø—Ä–∏ failure
- –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é

---

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Closure –¥–ª—è generation

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ stream: `stream_gen = self._stream_gen` (–ø–æ–¥ lock)
2. –°–æ–∑–¥–∞–µ–º callback: `callback = self._make_audio_callback(stream_gen, stream_sr, content_sr)`
3. Callback –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç `stream_gen` —á–µ—Ä–µ–∑ closure
4. –í callback: –ø—Ä–æ–≤–µ—Ä—è–µ–º `stream_gen != current_gen` ‚Üí —É—Å—Ç–∞—Ä–µ–≤—à–∏–π callback

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ò–∑–æ–ª—è—Ü–∏—è: –∫–∞–∂–¥—ã–π callback –∏–º–µ–µ—Ç —Å–≤–æ–π gen
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –Ω–µ—Ç race conditions –º–µ–∂–¥—É callback'–∞–º–∏
- –ü—Ä–æ—Å—Ç–æ—Ç–∞: –Ω–µ –Ω—É–∂–µ–Ω shared state –¥–ª—è gen

### –†–µ—Å–µ–º–ø–ª–∏–Ω–≥ –≤ callback

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ stream: –æ–ø—Ä–µ–¥–µ–ª—è–µ–º `needs_resample = (stream_sr != content_sr)`
2. –í callback: –µ—Å–ª–∏ `needs_resample` –∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Üí —Ä–µ—Å–µ–º–ø–ª–∏–º
3. –†–µ—Å–µ–º–ø–ª–∏–Ω–≥: –ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ `np.interp` (–∏–∑ `device_utils.py`)

**–ö–∞—á–µ—Å—Ç–≤–æ:**
- –õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–µ—á–∏
- –î–ª—è —Å—Ç—É–¥–∏–π–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞: –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `scipy.signal.resample_poly` –∏–ª–∏ `soxr`

### Cooldown –Ω–∞ failure-path

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º device change (–±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è)
2. –ï—Å–ª–∏ device –Ω–∞–π–¥–µ–Ω –∏ –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ä–∞–∑—É
3. –ï—Å–ª–∏ device –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ–º cooldown (500ms)
4. –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç timestamp, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

**–ë–∞–ª–∞–Ω—Å:**
- –†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –Ω–µ—Ç —Å–ø–∞–º–∞ –ø—Ä–∏ failure
- UX: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ AirPods —á—É–≤—Å—Ç–≤—É–µ—Ç—Å—è —Å—Ä–∞–∑—É

---

## üß™ –ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Per-callback generation: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ callback'—ã

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ –ù–µ—Ç –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–Ω–æ–π –ø–æ—Ä—á–∏ –º–µ–∂–¥—É callback'–∞–º–∏
- ‚úÖ –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ callback'—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- ‚úÖ Generation –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ stream

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í –ª–æ–≥–∞—Ö –∏—â–∏:
grep "–£—Å—Ç–∞—Ä–µ–≤—à–∏–π callback" logs.md  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏ recreate
grep "stream_gen" logs.md | tail -20  # Generation –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ stream
```

### 2. –†–µ—Å–µ–º–ø–ª–∏–Ω–≥: fallback scenario

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ Stream –æ—Ç–∫—Ä—ã–ª—Å—è –Ω–∞ device_sr (48kHz) –ø—Ä–∏ fallback
- ‚úÖ –†–µ—Å–µ–º–ø–ª–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ Playback –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è (–Ω–µ—Ç —Ç–∏—à–∏–Ω—ã)
- ‚úÖ –ó–≤—É–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í –ª–æ–≥–∞—Ö –∏—â–∏:
grep "RESAMPLE" logs.md  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å "–†–µ—Å–µ–º–ø–ª–∏–Ω–≥ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ callback"
grep "fallback" logs.md  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏ fallback –Ω–∞ device_sr
# –ü—Ä–æ–≤–µ—Ä—å –∑–≤—É–∫ - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
```

### 3. Cooldown: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ AirPods

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ (–Ω–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏)
- ‚úÖ –ù–µ—Ç —Å–ø–∞–º–∞ device queries –ø—Ä–∏ failure
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤—É–µ—Ç—Å—è —Å—Ä–∞–∑—É

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü–æ–¥–∫–ª—é—á–∏/–æ—Ç–∫–ª—é—á–∏ AirPods 5-10 —Ä–∞–∑
# –í –ª–æ–≥–∞—Ö –∏—â–∏:
grep "–°–º–µ–Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞" logs.md  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ä–∞–∑—É –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
grep "Device query –≤ cooldown" logs.md  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ failure
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–µ—Å–µ–º–ø–ª–∏–Ω–≥: –ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è**
   - –ö–∞—á–µ—Å—Ç–≤–æ: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–µ—á–∏, –Ω–æ –Ω–µ —Å—Ç—É–¥–∏–π–Ω–æ–µ
   - –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è: –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `scipy.signal.resample_poly` –∏–ª–∏ `soxr`

2. **Cooldown —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (500ms)**
   - –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —á–µ—Ä–µ–∑ config
   - –ù–æ 500ms –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

3. **–°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ `_audio_callback` —É—Å—Ç–∞—Ä–µ–ª**
   - –û—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
   - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö stream'–æ–≤

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ **Per-callback generation:** –ü—Ä–∏–º–µ–Ω–µ–Ω —á–µ—Ä–µ–∑ closure, –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–Ω–æ–π –ø–æ—Ä—á–∏
- ‚úÖ **–†–µ–∞–ª—å–Ω—ã–π —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥:** –ü—Ä–∏–º–µ–Ω–µ–Ω –≤ callback, –Ω–µ—Ç –≤–µ—á–Ω–æ–π —Ç–∏—à–∏–Ω—ã
- ‚úÖ **Cooldown –Ω–∞ failure-path:** –ü—Ä–∏–º–µ–Ω–µ–Ω, –±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —É—Å–ø–µ—Ö

**–í—Å–µ 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∏—Å–∫–∞ –∑–∞–∫—Ä—ã—Ç—ã! –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production!**

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ production
3. **–£–ª—É—á—à–µ–Ω–∏–µ —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞:** –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º

**Production-ready!**


