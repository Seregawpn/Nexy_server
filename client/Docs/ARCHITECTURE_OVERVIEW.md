# üß≠ Nexy ‚Äî –û–±–∑–æ—Ä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã Nexy. –ó–¥–µ—Å—å –æ–ø–∏—Å–∞–Ω—ã —Ä–æ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã, —Å–æ–±—ã—Ç–∏—è, –ø—Ä–∞–≤–∏–ª–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∂–∏–º–æ–≤ –∏ –æ–∂–∏–¥–∞–µ–º—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –º–µ–∂–¥—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ –∏ –º–æ–¥—É–ª—è–º–∏.

**Flow Interaction Spec (–∫–∞–Ω–æ–Ω –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π):** `Docs/FLOW_INTERACTION_SPEC.md`

- –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –∏ –º–æ–¥—É–ª–µ–π Nexy
- –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏: –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π (–∫–∞–∫ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —É—Å—Ç—Ä–æ–µ–Ω–æ –≤ –∫–æ–¥–µ)

---

## 1) –ö–∞—Ä—Ç–∏–Ω–∞ –≤ —Ü–µ–ª–æ–º

Nexy ‚Äî –º–æ–¥—É–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Å–æ–±—ã—Ç–∏–π–Ω–æ–π —à–∏–Ω–æ–π (EventBus), —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è (ApplicationStateManager) –∏ –µ–¥–∏–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º —Ä–µ–∂–∏–º–æ–≤ (ModeController) –≤ –æ–±–µ—Ä—Ç–∫–µ ModeManagementIntegration. –í—Å—è –º–µ–∂–º–æ–¥—É–ª—å–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è ‚Äî —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è, –∞ —Å–º–µ–Ω–∞ —Ä–µ–∂–∏–º–æ–≤ ‚Äî —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏.

–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Ä–µ–∂–∏–º–æ–≤: SLEEPING ‚Üí LISTENING ‚Üí PROCESSING ‚Üí SLEEPING.

## 1.1 –ü—Ä–∏–Ω—Ü–∏–ø—ã —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

- **Request-scoped state**: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞, —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞.
- **Single-flight –ø–æ session_id**: –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ `session_id`, –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è (–±–µ–∑ –æ—á–µ—Ä–µ–¥–∏ –æ–∂–∏–¥–∞–Ω–∏—è).
- **Source of Truth**: `session_id` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤—Ö–æ–¥–µ –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –¥–∞–ª—å—à–µ –±–µ–∑ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π.
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è guard-–ª–æ–≥–∏–∫–∏**: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (backpressure/rate limit) –∂–∏–≤—É—Ç –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è.
- **–ü–æ–ª–∏—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ —Å—Ç—Ä–∏–º–∞**: –æ—à–∏–±–∫–∞ –¥–æ –Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–∏–º–∞ = gRPC —Å—Ç–∞—Ç—É—Å + error_message, –ø–æ—Å–ª–µ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö = —Ç–∏—Ö–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–µ–∑ —Å–º–µ—à–∏–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –æ—à–∏–±–æ–∫.

```
client/                         # üñ•Ô∏è –ö–õ–ò–ï–ù–¢–°–ö–ê–Ø –ß–ê–°–¢–¨ (macOS)
‚îú‚îÄ main.py                      # üéØ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ requirements.txt             # üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (23 –ø–∞–∫–µ—Ç–∞, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã)
‚îú‚îÄ run.sh                       # üöÄ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ config/                      # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ  ‚îú‚îÄ unified_config.yaml       # üéØ –ï–î–ò–ù–´–ô –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ  ‚îú‚îÄ unified_config_loader.py  # üîß –ó–∞–≥—Ä—É–∑—á–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ  ‚îú‚îÄ tray_config.yaml          # üéØ –£—Å—Ç–∞—Ä–µ–ª - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ unified_config.yaml
‚îÇ  ‚îî‚îÄ README.md                 # üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ integration/                 # üèóÔ∏è –°–ª–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (–ó–ê–í–ï–†–®–ï–ù)
‚îÇ  ‚îú‚îÄ core/                     # –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚îÇ  ‚îÇ  ‚îú‚îÄ event_bus.py           # üì° –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π
‚îÇ  ‚îÇ  ‚îú‚îÄ event_types.py         # üè∑Ô∏è –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π (–ù–û–í–´–ô)
‚îÇ  ‚îÇ  ‚îú‚îÄ state_manager.py       # üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
‚îÇ  ‚îÇ  ‚îú‚îÄ state_keys.py          # üîë –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–ª—é—á–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è (–ù–û–í–´–ô)
‚îÇ  ‚îÇ  ‚îú‚îÄ selectors.py           # üéØ –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —á—Ç–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ  ‚îÇ  ‚îú‚îÄ simple_module_coordinator.py # üéØ –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
‚îÇ  ‚îÇ  ‚îî‚îÄ error_handler.py       # ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ  ‚îú‚îÄ integrations/             # üîó 25 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–º. —Ä–∞–∑–¥–µ–ª 13)
‚îÇ  ‚îÇ  ‚îú‚îÄ action_execution_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ autostart_manager_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ browser_progress_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ browser_use_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ first_run_permissions_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ grpc_client_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ hardware_id_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ input_processing_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ instance_manager_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ interrupt_management_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ mode_management_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ network_manager_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ payment_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ permission_restart_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ screenshot_capture_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ signal_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ speech_playback_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ tray_controller_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ tts_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ update_notification_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ updater_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ voice_recognition_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ voiceover_ducking_integration.py
‚îÇ  ‚îÇ  ‚îú‚îÄ welcome_message_integration.py
‚îÇ  ‚îÇ  ‚îî‚îÄ whatsapp_integration.py
‚îÇ  ‚îú‚îÄ workflows/                # ‚ö° WORKFLOWS (–ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê)
‚îÇ  ‚îÇ  ‚îú‚îÄ base_workflow.py       # üèóÔ∏è –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îÇ  ‚îÇ  ‚îú‚îÄ listening_workflow.py  # üé§ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä LISTENING
‚îÇ  ‚îÇ  ‚îú‚îÄ processing_workflow.py # ‚öôÔ∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä PROCESSING
‚îÇ  ‚îÇ  ‚îú‚îÄ workflow_config.py     # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è workflows
‚îÇ  ‚îÇ  ‚îî‚îÄ README.md              # üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è workflows
‚îÇ  ‚îî‚îÄ tests/                    # üß™ –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ modules/                     # üß© 20 –º–æ–¥—É–ª–µ–π (–±–µ–∑ –∑–Ω–∞–Ω–∏—è EventBus)
‚îÇ  ‚îú‚îÄ action_errors/             # ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ MCP –¥–µ–π—Å—Ç–≤–∏–π
‚îÇ  ‚îú‚îÄ autostart_manager/        # ‚ö° –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ  ‚îú‚îÄ browser_progress/         # üåê –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –±—Ä–∞—É–∑–µ—Ä–∞
‚îÇ  ‚îú‚îÄ grpc_client/              # üì° gRPC –∫–ª–∏–µ–Ω—Ç
‚îÇ  ‚îú‚îÄ hardware_id/              # üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
‚îÇ  ‚îú‚îÄ input_processing/         # ‚å®Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞
‚îÇ  ‚îú‚îÄ instance_manager/         # üîí –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
‚îÇ  ‚îú‚îÄ interrupt_management/     # ‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏
‚îÇ  ‚îú‚îÄ mcp_action/               # üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ MCP –∫–æ–º–∞–Ω–¥ (open_app/close_app)
‚îÇ  ‚îú‚îÄ mode_management/          # üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏
‚îÇ  ‚îú‚îÄ network_manager/          # üåê –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏
‚îÇ  ‚îú‚îÄ permission_restart/        # üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
‚îÇ  ‚îú‚îÄ permissions/              # üîê –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è + first_run –º–æ–¥—É–ª–∏
‚îÇ  ‚îú‚îÄ screenshot_capture/       # üì∏ –ó–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞
‚îÇ  ‚îú‚îÄ signals/                  # üéµ –ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏–≥–Ω–∞–ª—ã
‚îÇ  ‚îú‚îÄ speech_playback/          # üîä –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ä–µ—á–∏
‚îÇ  ‚îú‚îÄ tray_controller/          # üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ tray –∏–∫–æ–Ω–∫–æ–π
‚îÇ  ‚îú‚îÄ updater/                  # üîÑ –ù–û–í–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (HTTP + DMG)
‚îÇ  ‚îú‚îÄ voice_recognition/        # üé§ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏
‚îÇ  ‚îú‚îÄ voiceover_control/        # ‚ôø –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VoiceOver (macOS)
‚îÇ  ‚îî‚îÄ welcome_message/          # üîä –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
‚îú‚îÄ assets/                      # üé® –†–µ—Å—É—Ä—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ  ‚îî‚îÄ icons/                    # üéØ –ò–∫–æ–Ω–∫–∏ –¥–ª—è tray
‚îî‚îÄ Docs/                        # üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   ‚îú‚îÄ ARCHITECTURE_OVERVIEW.md  # üèóÔ∏è –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   ‚îú‚îÄ PRODUCT_CONCEPT.md        # üí° –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ –∏ UX
   ‚îú‚îÄ CURRENT_STATUS_REPORT.md  # üìä –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏ —Ç–µ—Å—Ç—ã
   ‚îú‚îÄ GLOBAL_DELIVERY_PLAN.md   # üöÄ –ü–ª–∞–Ω –ø–æ—Å—Ç–∞–≤–∫–∏ / Azure / AppCast
   ‚îú‚îÄ PERMISSIONS_REPORT.md     # üîê –°—Ç–∞—Ç—É—Å—ã TCC / first-run
   ‚îú‚îÄ PACKAGING_FINAL_GUIDE.md  # üì¶ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ PKG
   ‚îî‚îÄ PRE_PACKAGING_VERIFICATION.md  # ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç—ã –ø–µ—Ä–µ–¥ —É–ø–∞–∫–æ–≤–∫–æ–π

```

–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –æ–ø–∏—Å–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ: `server/server/Docs/ARCHITECTURE_OVERVIEW.md`.

---

## 2) –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–æ–ª–∏ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

### üñ•Ô∏è **–ö–õ–ò–ï–ù–¢–°–ö–ê–Ø –ß–ê–°–¢–¨ (macOS)**

- EventBus (integration/core/event_bus.py)
  - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–æ–±—ã—Ç–∏–π–Ω–∞—è —à–∏–Ω–∞ (publish/subscribe, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)
  - –ò–∑–æ–ª–∏—Ä—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–ª–æ—Ç–Ω—ã–µ —Å–≤—è–∑–∫–∏

- ApplicationStateManager (integration/core/state_manager.py)
  - –ò—Å—Ç–∏–Ω–Ω–æ–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ä–µ–∂–∏–º—ã/–∏—Å—Ç–æ—Ä–∏—è/–¥–∞–Ω–Ω—ã–µ)
  - **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è session_id** - –≤—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `get_current_session_id()` –∏ `update_session_id()`
  - –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞: `app.mode_changed`, `app.state_changed` (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞)
  - `set_mode()` - –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ (–ø—É–±–ª–∏–∫—É–µ—Ç `app.mode_changed`)
  - `update_session_id()` - –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ session_id –ë–ï–ó –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∂–Ω—ã–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è)
  - –ù–µ —Ä–µ—à–∞–µ—Ç –ö–ê–ö –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Ä–µ–∂–∏–º—ã ‚Äî —Ç–æ–ª—å–∫–æ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- ModeController (modules/mode_management/core/mode_controller.py)
  - –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ (–∫–∞—Ä—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –º–µ—Ç—Ä–∏–∫–∏)
  - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥–æ–Ω–∫–∏

- ModeManagementIntegration (integration/integrations/mode_management_integration.py)
  - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π ¬´—Ä—É–±–∏–ª—å–Ω–∏–∫¬ª —Ä–µ–∂–∏–º–æ–≤
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞—è–≤–∫–∏ `mode.request` –∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç ModeController
  - –ü–æ –∫–æ–ª–±—ç–∫—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `state_manager.set_mode(...)` –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
  - –ñ–µ—Å—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã PROCESSING –æ—Ç–∫–ª—é—á–µ–Ω—ã (–∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ Workflows)

- Workflows (integration/workflows/)
  - **ListeningWorkflow** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä LISTENING —Ä–µ–∂–∏–º–∞ (–¥–µ–±–∞—É–Ω—Å, —É–º–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã)
  - **ProcessingWorkflow** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä PROCESSING (capture‚Üígrpc‚Üíplayback‚ÜíSLEEPING)
  - **BaseWorkflow** - –æ–±—â–∞—è –±–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö workflows
  - Event-driven –ø–µ—Ä–µ—Ö–æ–¥—ã –≤–º–µ—Å—Ç–æ –∂–µ—Å—Ç–∫–∏—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (integration/integrations/*)
  - –ê–¥–∞–ø—Ç–∏—Ä—É—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏ –ø–æ–¥ —Å–æ–±—ã—Ç–∏–π–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç
  - –ù–ï –∏–∑–º–µ–Ω—è—é—Ç —Ä–µ–∂–∏–º –Ω–∞–ø—Ä—è–º—É—é; —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏–∫—É—é—Ç `mode.request`

- –ú–æ–¥—É–ª–∏ (client/modules/*)
  - –°–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–∑–∞—Ö–≤–∞—Ç, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ, –∞—É–¥–∏–æ –∏ —Ç.–ø.)
  - –ù–µ –∑–Ω–∞—é—Ç –ø—Ä–æ EventBus/—Ä–µ–∂–∏–º—ã; –∏—Ö ¬´–ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–∞—Ö¬ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### üñ•Ô∏è **–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å**

–°–µ—Ä–≤–µ—Ä–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Ä–æ–ª–∏ –º–æ–¥—É–ª–µ–π –∏ gRPC –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –æ–ø–∏—Å–∞–Ω—ã –≤ `server/server/Docs/ARCHITECTURE_OVERVIEW.md`.

---

## 3) Dependency Enforcement & Contracts

–î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (Enforced by `scripts/check_dependency_violations.py`):

1. **Core Independence**: `integration/core` (EventBus, StateManager) –ù–ï –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π.
2. **Integrations Layering**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç Core –∏ Modules, –Ω–æ –ù–ï –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.
3. **Modules Isolation**: –ú–æ–¥—É–ª–∏ (`client/modules/*`) –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –∏ –Ω–µ –∑–Ω–∞—é—Ç –ø—Ä–æ EventBus/Integrations.
4. **Runtime Enforcement**: (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è) Runtime-–ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.

## 3.1) Quality Gates (Lint/CI)

- `ruff` –≤–∫–ª—é—á—ë–Ω –≤ `scripts/pre_build_gate.sh` –≤ —Ä–µ–∂–∏–º–µ soft‚Äëblock (WARN) –¥–æ —Å–Ω–∏–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ lint‚Äëdebt.
- –ü–æ—Å–ª–µ —Å–Ω–∏–∂–µ–Ω–∏—è debt –ø–µ—Ä–µ–≤–æ–¥–∏–º `ruff` –≤ hard‚Äëblock (–æ—à–∏–±–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–±–æ—Ä–∫—É).
- –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π consolidated scan: `scripts/problem_scan.sh` (ruff + basedpyright + verify scripts + pytest + priority report).
- –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π release/CI –±–ª–æ–∫–µ—Ä: `scripts/problem_scan_gate.sh`.
  - –†–µ—à–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ `blocking_issues` –∏–∑ `build_logs/problem_scan_latest.json`.
  - –î–ª—è —Ä–µ–ª–∏–∑–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω `REQUIRE_BASEDPYRIGHT_IN_SCAN=true` (status –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `ok`).

---

## 4) –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤ (Single Source of Truth)

- AppMode: –µ–¥–∏–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∏–∑ `modules/mode_management` (–¥—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã)
- –ó–∞–ø—Ä–æ—Å —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞: —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–µ–º `mode.request`
- –†–µ–∞–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ —Ä–µ–∂–∏–º–∞: —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `ModeManagementIntegration ‚Üí ModeController`
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ —Å–º–µ–Ω—ã: —Ç–æ–ª—å–∫–æ `ApplicationStateManager.set_mode(...)`

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞–ø—Ä–æ—Å–∞:

```python
await event_bus.publish("mode.request", {
  "target": AppMode.LISTENING,   # –∏–ª–∏ SLEEPING / PROCESSING
  "source": "<integration|module>",
  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: session_id, priority, data
})
```

–ö–æ–Ω—Ç—Ä–∞–∫—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

```python
# –§–∞–∫—Ç —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞
await event_bus.publish("app.mode_changed", {"mode": AppMode.LISTENING})

# –ú–æ—Å—Ç (–≤—Ä–µ–º–µ–Ω–Ω—ã–π): —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
await event_bus.publish("app.state_changed", {"old_mode": ..., "new_mode": ...})
```

–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
- SLEEPING ‚Üí LISTENING
- LISTENING ‚Üí PROCESSING, SLEEPING
- PROCESSING ‚Üí SLEEPING

–¢–∞–π–º–∞—É—Ç—ã PROCESSING: –∂–µ—Å—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã, –ø–µ—Ä–µ—Ö–æ–¥—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è Workflows –ø–æ —Å–æ–±—ã—Ç–∏—è–º.

---

## 4) –ì–ª–∞–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö (PTT –æ—Ç –∫–ª–∞–≤–∏—à–∏ –¥–æ –æ—Ç–≤–µ—Ç–∞)

**–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:** [`FLOW_INTERACTION_SPEC.md`](FLOW_INTERACTION_SPEC.md) ‚Äî —Ä–∞–∑–¥–µ–ª—ã 4.4 (PTT/Listening Flow) –∏ 4.5 (Processing Flow).

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏:
- **PTT Flow**: SLEEPING ‚Üí LISTENING ‚Üí PROCESSING ‚Üí SLEEPING (—Å–º. —Ä–∞–∑–¥–µ–ª—ã 4.4-4.5 –∫–∞–Ω–æ–Ω–∞)
- **Interrupt Flow**: `interrupt.request` ‚Üí `grpc.request_cancel` (publisher: InterruptManagement) ‚Üí `playback.cancelled` (publisher: SpeechPlaybackIntegration) (—Å–º. —Ä–∞–∑–¥–µ–ª 4.6 –∫–∞–Ω–æ–Ω–∞)

–î–µ—Ç–∞–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π, –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã payload –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω—ã –≤ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ.

---

## 5) –°–æ–±—ã—Ç–∏–π–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã)

**–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:** [`FLOW_INTERACTION_SPEC.md`](FLOW_INTERACTION_SPEC.md) ‚Äî —Ä–∞–∑–¥–µ–ª 3 (–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–æ–±—ã—Ç–∏–π).

–ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤–∫–ª—é—á–∞—é—Ç:
- –†–µ–∂–∏–º—ã (`mode.request`, `app.mode_changed`)
- –ì–æ–ª–æ—Å/—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (`voice.recording_*`, `voice.recognition_*`)
- gRPC (`grpc.request_*`, `grpc.response.*`)
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (`playback.*`)
- –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (`interrupt.request`, `grpc.request_cancel`, `playback.cancelled`)
- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è (`permissions.*`)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è (`updater.*`)
- –°–µ—Ç—å (`network.*`)
- –ò –¥—Ä—É–≥–∏–µ —Å–æ–±—ã—Ç–∏—è

–ü–æ–ª–Ω—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ payload, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ/–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –∏ –ø—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–ø–∏—Å–∞–Ω—ã –≤ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ.

---

## 6) –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –≥–æ–Ω–æ–∫ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `ModeController` (–≤–Ω—É—Ç—Ä–∏ ‚Äî `asyncio.Lock`) ‚Üí –æ–¥–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–∞ —Ä–∞–∑
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞—è–≤–æ–∫ –º–∞—Ä–∫–∏—Ä—É—é—Ç—Å—è `source` (+ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `priority`) ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ—à–∞—é—Ç—Å—è –≤ ModeManagementIntegration
- –ù–∏–∫–∞–∫–∏—Ö –ø—Ä—è–º—ã—Ö `state_manager.set_mode(...)` –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ ModeManagementIntegration
- –ü—Ä–∏ –≤–Ω–µ—à–Ω–µ–π —Å–º–µ–Ω–µ (–Ω–∞ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏) ModeManagementIntegration —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ `app.mode_changed`

---

## 6.1) –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫ (StateKeys –∏ EventTypes)

–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫ –≤ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö –≤–≤–µ–¥–µ–Ω—ã —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:

### StateKeys (integration/core/state_keys.py)

–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π `state_manager.get_state_data()` / `set_state_data()`:

```python
from integration.core.state_keys import StateKeys

# –í–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ª–∏—Ç–µ—Ä–∞–ª–æ–≤:
# state_manager.get_state_data("first_run_in_progress", False)  ‚ùå

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
state_manager.get_state_data(StateKeys.FIRST_RUN_IN_PROGRESS, False)  # ‚úÖ
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
- `FIRST_RUN_IN_PROGRESS`, `FIRST_RUN_REQUIRED`, `FIRST_RUN_COMPLETED`
- `PERMISSIONS_RESTART_PENDING`, `PERMISSIONS_RESTART_COMPLETED_FALLBACK`
- `PTT_PRESSED`, `UPDATE_IN_PROGRESS`

### EventTypes (integration/core/event_types.py)

–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π EventBus:

```python
from integration.core.event_types import EventTypes

# –í–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ª–∏—Ç–µ—Ä–∞–ª–æ–≤:
# await event_bus.subscribe("app.mode_changed", handler)  ‚ùå

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
await event_bus.subscribe(EventTypes.APP_MODE_CHANGED, handler)  # ‚úÖ
```

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π (60+ –∫–æ–Ω—Å—Ç–∞–Ω—Ç):**
- **Application**: `APP_STARTUP`, `APP_SHUTDOWN`, `APP_MODE_CHANGED`
- **Voice**: `VOICE_RECORDING_START`, `VOICE_RECORDING_STOP`, `VOICE_MIC_OPENED`
- **gRPC**: `GRPC_REQUEST_COMPLETED`, `GRPC_REQUEST_FAILED`
- **Playback**: `PLAYBACK_STARTED`, `PLAYBACK_COMPLETED`
- **Permissions**: `PERMISSIONS_CHANGED`, `PERMISSIONS_FIRST_RUN_COMPLETED`
- –ò –¥—Ä—É–≥–∏–µ

**–ü—Ä–∞–≤–∏–ª–æ –¥–ª—è PR:** –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏/–ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–∑ `StateKeys` –∏ `EventTypes`.

---


## 7) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

- UnifiedConfigLoader ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –∏ –º–æ–¥—É–ª–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è:
  1) –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å –≤ `client/modules/<name>` –±–µ–∑ –∑–Ω–∞–Ω–∏—è EventBus
  2) –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ `client/integration/integrations/<name>_integration.py`
  3) –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è/–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω—É–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –∑–∞–ø—Ä–æ—Å—ã —Ä–µ–∂–∏–º–æ–≤ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `mode.request`
  4) –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é/–∑–∞–ø—É—Å–∫ –≤ `SimpleModuleCoordinator`

- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:
  - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ `ModeTransition` –≤ ModeManagementIntegration (–∏–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
  - –î–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ ‚Äî —É–∫–∞–∑–∞—Ç—å `action`, `priority`, `timeout`

  - –î–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ ‚Äî —É–∫–∞–∑–∞—Ç—å `action`, `priority`, `timeout`

---

## 7.1) Feature Flags & Conditional Loading (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

–ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Factory-pattern –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—è–∂–µ–ª—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (`integration_factory.py`).

**1. –ü–∞–º—è—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- `browser.enabled=false` ‚Üí `BrowserUseIntegration` –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è. –ü—Ä–æ—Ü–µ—Å—Å Playwright/Chrome –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (—ç–∫–æ–Ω–æ–º–∏—è ~200MB RAM).
- `payment.enabled=false` ‚Üí `PaymentIntegration` –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è.

**2. UI & Tray:**
- –ú–µ–Ω—é —Ç—Ä–µ—è —Å—Ç—Ä–æ–∏—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏.
- `payment.enabled=false` ‚Üí –ü—É–Ω–∫—Ç "Manage Subscription" —Å–∫—Ä—ã—Ç.

**3. Execution Guards:**
- `ActionExecutionIntegration` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–ª–∞–≥–∏ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º.
- –î–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏—à–ª–µ—Ç `open_browser`, –∫–ª–∏–µ–Ω—Ç –æ—Ç–∫–ª–æ–Ω–∏—Ç –∫–æ–º–∞–Ω–¥—É —Å –æ—à–∏–±–∫–æ–π `feature_disabled`.

---

## 8) –ó–∞–ø—É—Å–∫ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

- SimpleModuleCoordinator —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π/—Å—Ç–∞—Ä—Ç–æ–º/–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π
  - –°–æ–∑–¥–∞—ë—Ç EventBus, StateManager, ErrorHandler
  - –ü–æ–¥–Ω–∏–º–∞–µ—Ç —Ñ–æ–Ω–æ–≤–æ–π asyncio loop –∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –∫ EventBus
  - –°–æ–∑–¥–∞—ë—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–≤ —Ç.—á. ModeManagementIntegration)
  - –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç EventBus –∫ StateManager –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–æ–≤

**–ü–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è/–∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π**:
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `IntegrationFactory.STARTUP_ORDER`
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IntegrationFactory.get_startup_order(...)`
- –£—Å–ª–æ–≤–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (feature‚Äëflags) —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ —Ñ–∞–∫—Ç—É –Ω–∞–ª–∏—á–∏—è

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—É–ø—Ä–æ—â–µ–Ω–Ω–æ):
1) –°–æ–∑–¥–∞–Ω–∏–µ core-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ‚Üí 2) –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–≥–æ loop ‚Üí 2.5) **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫** (_setup_critical_subscriptions) ‚Üí 3) –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π ‚Üí 4) initialize() ‚Üí 5) start() ‚Üí 6) –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ EventBus

**–ö–†–ò–¢–ò–ß–ù–û:** –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è `permissions.first_run_*` –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ —à–∞–≥–µ 2.5 (–î–û –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π), —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å —Å–æ–±—ã—Ç–∏—è, –ø—É–±–ª–∏–∫—É–µ–º—ã–µ FirstRunPermissionsIntegration.initialize() –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ñ–ª–∞–≥–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞. –°–º. ADR_PERMISSION_EVENT_RACE_FIX.md –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

**–í–ê–ñ–ù–û:** FirstRunPermissionsIntegration —Å–æ–∑–¥–∞—ë—Ç—Å—è –ü–û–°–õ–ï–î–ù–ï–ô –≤ `_create_integrations()`, –Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è 4-–π –≤ `startup_order` (–ø–æ—Å–ª–µ tray). –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: tray –≥–æ—Ç–æ–≤ ‚Üí first_run_permissions ‚Üí permission_restart.

---

## 9) –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—à–∏–±–∫–∏

- ErrorHandler –ø—É–±–ª–∏–∫—É–µ—Ç/–ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π –∏ –≤–∞–∂–Ω–æ—Å—Ç—å—é
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
  - –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–∂–∏–º: –≤—Ö–æ–¥—è—â–∏–µ `mode.request`
  - –°–º–µ–Ω–∞ —Ä–µ–∂–∏–º–æ–≤: `app.mode_changed` (+ –º–µ—Ç—Ä–∏–∫–∏ ModeController)
  - –¢–∞–π–º–∞—É—Ç PROCESSING: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
  - –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è: `interrupt.request`, –æ—Ç–º–µ–Ω—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –õ–æ–≥–∏—Ä—É–π—Ç–µ `source` –∏ `session_id` –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –ø—É—Ç–µ–π
- –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ ¬´–¥—É–±–ª–∏—Ä—É—é—â–∏–µ¬ª —Ñ–∞–∫—Ç—ã —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ ‚Äî —Ç–æ–ª—å–∫–æ StateManager
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `state_manager.get_current_session_id()` –¥–ª—è —á—Ç–µ–Ω–∏—è session_id (–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `state_manager.update_session_id()` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ session_id –ë–ï–ó –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `state_manager.set_mode()` —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ (–ø—É–±–ª–∏–∫—É–µ—Ç `app.mode_changed`)

‚Äî –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ PROCESSING
- –°–∏–≥–Ω–∞–ª–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–ª—É–∂–∏—Ç `grpc.request_completed` (–ø–æ–ª—É—á–µ–Ω end‚Äëof‚Äëstream) –ª–∏–±–æ `playback.completed`
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: `ModeManagementIntegration`/workflow PROCESSING –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ SLEEPING –ø–æ –æ–¥–Ω–æ–º—É –∏–∑ —Å–∏–≥–Ω–∞–ª–æ–≤ (—á—Ç–æ –Ω–∞—Å—Ç—É–ø–∏—Ç —Ä–∞–Ω—å—à–µ), –∞ —Ç–∞–π–º–∞—É—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∑–∞—â–∏—Ç–∞

‚Äî –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è gRPC (–ø–ª–∞–Ω)
- –í—ã–∑–æ–≤—ã gRPC –¥–æ–ª–∂–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å `metadata.authorization: Bearer <token>`
- –¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ macOS Keychain (Auth/Chat ‚Äî –æ—Ç–ª–æ–∂–µ–Ω–æ)

---

## 10) –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ —á–µ–∫‚Äë–ª–∏—Å—Ç –¥–ª—è PR

- [ ] –í –∫–æ–¥–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –Ω–µ—Ç –ø—Ä—è–º—ã—Ö `set_mode(...)`
- [ ] –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–º–µ–Ω—É —Ä–µ–∂–∏–º–∞ –∏–¥—É—Ç —á–µ—Ä–µ–∑ `mode.request`
- [ ] –ò–º–ø–æ—Ä—Ç `AppMode` ‚Äî —Ç–æ–ª—å–∫–æ –∏–∑ `modules/mode_management`
- [ ] –ü–æ–¥–ø–∏—Å–∫–∏/–ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É —Å–æ–±—ã—Ç–∏–π
- [ ] –ù–æ–≤—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ ModeManagementIntegration

---

## 11) –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Å—Å—ã–ª–∫–∏

### üîó **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª (—Å–º. `.cursorrules` —Ä–∞–∑–¥–µ–ª 1.1):**
- **STATE_CATALOG.md** ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö –æ—Å–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è (permissions.mic, device.input, network, firstRun, appMode)
  - –í–∫–ª—é—á–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É ownership (–≤–ª–∞–¥–µ–ª—å—Ü—ã –æ—Å–µ–π –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤)
  - –°–º. `Docs/STATE_CATALOG.md`
- **interaction_matrix.yaml** ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –æ—Å–µ–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ (hard_stop, graceful, preference)
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å STATE_CATALOG.md
  - –°–º. `config/interaction_matrix.yaml`
- **gateways.py** ‚Äî –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Å–µ–π
  - –†–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ interaction_matrix.yaml
  - –°–º. `integration/core/gateways.py`

---

- **–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** `Docs/CURRENT_STATUS_REPORT.md`
- **–ü–ª–∞–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:** `Docs/GLOBAL_DELIVERY_PLAN.md`
- **–ü—Ä–∞–≤–∞ –∏ first-run:** `PERMISSIONS_REPORT.md`, `Docs/first_run_flow_spec.md`
- **–ü–ª–∞–Ω —É–ø–∞–∫–æ–≤–∫–∏:** `Docs/PACKAGING_FINAL_GUIDE.md` + `Docs/PRE_PACKAGING_VERIFICATION.md`
- **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞:** `Docs/PRODUCT_CONCEPT.md`
- **STATE_CATALOG (–æ—Å–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è):** `Docs/STATE_CATALOG.md` ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –æ—Å–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ç–∞–±–ª–∏—Ü–∞ ownership
- **Interaction Matrix (–ø—Ä–∞–≤–∏–ª–∞):** `config/interaction_matrix.yaml` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –æ—Å–µ–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å STATE_CATALOG.md)
- **ADR: AVFoundation –º–∏–≥—Ä–∞—Ü–∏—è:** `Docs/ADRs/ADR_2025-01-XX_avfoundation_audio_migration.md`

### üèóÔ∏è **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- **Workflows –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `client/integration/workflows/README.md`
- **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä:** `client/integration/core/simple_module_coordinator.py`
- **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Ä–µ–∂–∏–º–æ–≤:** `client/modules/mode_management/core/mode_controller.py`
- **–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è:** `client/integration/core/state_manager.py`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `config/unified_config.yaml`

### üñ•Ô∏è **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
–°–º. `server/server/Docs/ARCHITECTURE_OVERVIEW.md`.

–ï—Å–ª–∏ —á–µ–≥–æ‚Äë—Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤ —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –ø—Ä–∞–≤–∫–∏, –º—ã –æ–±–Ω–æ–≤–∏–º ¬´–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã¬ª –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

---

## 12) –ö–∞—Ç–∞–ª–æ–≥ –º–æ–¥—É–ª–µ–π

### üíª **–ö–õ–ò–ï–ù–¢–°–ö–ò–ï –ú–û–î–£–õ–ò (client/modules) - 25 –ú–û–î–£–õ–ï–ô**

_macOS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∞—É–¥–∏–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è._
- `action_errors` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ MCP –¥–µ–π—Å—Ç–≤–∏–π: —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è open_app/close_app, –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
- `autostart_manager` ‚Äî –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: LaunchAgent —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, Login Items, bundle_id –ø–æ–¥—Ö–æ–¥, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.
- `browser_automation` ‚Äî –ù–û–í–´–ô: –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –º–æ–¥—É–ª—å browser-use –¥–ª—è AI-—É–ø—Ä–∞–≤–ª—è–µ–º–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞. –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –ª–æ–∫–∞–ª—å–Ω–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
- `browser_progress` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞: —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π –∏ —Å—Ç–∞—Ç—É—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –±—Ä–∞—É–∑–µ—Ä–∞ (Feature F-2025-015).
- `grpc_client` ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π gRPC –∫–ª–∏–µ–Ω—Ç, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º/—Ä–µ—Ç—Ä–∞—è–º–∏.
- `hardware_id` ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –∫—ç—à/TTL, —Ñ–æ–Ω–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
- `input_processing` ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (Quartz/pynput), –¥–µ—Ç–µ–∫—Ü–∏—è LONG/SHORT/RELEASE, –∫–æ–Ω—Ñ–∏–≥ –ø–æ—Ä–æ–≥–æ–≤.
- `instance_manager` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤: —Ñ–∞–π–ª–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, PID –ø—Ä–æ–≤–µ—Ä–∫–∞, TOCTOU –∑–∞—â–∏—Ç–∞, –∞—É–¥–∏–æ-—Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –Ω–µ–∑—Ä—è—á–∏—Ö.
- `interrupt_management` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π (—Ç–∏–ø—ã/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã/–∏—Å—Ç–æ—Ä–∏—è), API –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø–∏—Å–∏/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.
- `mcp_action` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ MCP –∫–æ–º–∞–Ω–¥ –æ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞: open_app/close_app —á–µ—Ä–µ–∑ macOS AppleScript/NSWorkspace.
- `mode_management` ‚Äî `ModeController`, —Ç–∏–ø—ã, —Ä–µ–∂–∏–º—ã (S/L/P), –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.
- `network_manager` ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏ (ping/HTTP), —Å–æ–±—ã—Ç–∏—è —Å—Ç–∞—Ç—É—Å–∞, —Å–Ω–∞–ø—à–æ—Ç—ã.
- `permissions` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–ø—Ä–æ—Å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (–º–∏–∫—Ä–æ—Ñ–æ–Ω/–∑–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞/—Å–µ—Ç—å/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è) + –º–æ–¥—É–ª–∏ first_run –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.
- `permission_restart` ‚Äî —è–¥—Ä–æ –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞: –¥–µ—Ç–µ–∫—Ç–æ—Ä –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ macOS —Ä–µ—Å—Ç–∞—Ä—Ç-—Ö–µ–Ω–¥–ª–µ—Ä, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ EventBus.
- `screenshot_capture` ‚Äî –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∑–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞/—Ä–∞–∑–º–µ—Ä–∞; –Ω–∞ macOS ‚Äî bridge/CLI fallback.
- `signals` ‚Äî –∞–∫—É—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏–≥–Ω–∞–ª—ã: listen_start/done/error/cancel + duplicate_instance.
- `speech_playback` ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ —á–∞–Ω–∫–æ–≤, –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º.
- `telegram` ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –º–æ–¥—É–ª—å Telegram‚Äë–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (MCP –∫–æ–º–∞–Ω–¥—ã, —Å–æ–±—ã—Ç–∏—è).
- `tray_controller` ‚Äî UI-–∏–∫–æ–Ω–∫–∞/–º–µ–Ω—é, —Å—Ç–∞—Ç—É—Å—ã –¥–ª—è —Ä–µ–∂–∏–º–æ–≤.
- `updater` ‚Äî –ù–û–í–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: HTTP –º–∞–Ω–∏—Ñ–µ—Å—Ç, DMG —Ñ–∞–π–ª—ã, –º–∏–≥—Ä–∞—Ü–∏—è –≤ ~/Applications, 3 —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SHA256 + Ed25519 + codesign).
- `voice_recognition` ‚Äî –∑–∞–ø–∏—Å—å/—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏, —Å–∏–º—É–ª—è—Ç–æ—Ä/—Ä–µ–∞–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫, —Ç–∞–π–º–∞—É—Ç—ã, –æ—Ç–º–µ–Ω–∞.
- `voiceover_control` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VoiceOver –Ω–∞ macOS: —É–º–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ/–≤–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Command+F5, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.
- `welcome_message` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
- `whatsapp` ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –º–æ–¥—É–ª—å WhatsApp‚Äë–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (MCP –∫–æ–º–∞–Ω–¥—ã, —Å–æ–±—ã—Ç–∏—è).
- `messages` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Apple Messages (iMessage/SMS): —á—Ç–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –ø–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ AppleScript –∏ SQLite. –¢—Ä–µ–±—É–µ—Ç Full Disk Access –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ `chat.db`.

### üñ•Ô∏è **–°–µ—Ä–≤–µ—Ä–Ω—ã–µ –º–æ–¥—É–ª–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

–û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –º–æ–¥—É–ª–µ–π, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ gRPC —Å–µ—Ä–≤–∏—Å–∞ ‚Äî –≤ `server/server/Docs/ARCHITECTURE_OVERVIEW.md`.

**–ö–ª—é—á–µ–≤–æ–π –º–æ–¥—É–ª—å (—Å–µ—Ä–≤–µ—Ä): `browser_use` (Proxy)** (Feature ID: F-2025-015)
- –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç: —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É -> –ø–µ—Ä–µ–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É -> –∫–ª–∏–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç.
- –ù–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—É—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤).
- –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç—á–µ—Ç—ã –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞.

**–ö–ª—é—á–µ–≤–æ–π –º–æ–¥—É–ª—å (–∫–ª–∏–µ–Ω—Ç): `messages`** (Feature ID: F-2025-016)
- MCP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Apple Messages (iMessage/SMS)
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —á–∏—Ç–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`chat.db`) –∏ AppleScript –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- –¢—Ä–µ–±—É–µ—Ç Full Disk Access –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ `chat.db`
- MCP –∫–æ–º–∞–Ω–¥—ã: `read_messages`, `send_message`, `find_contact`
- –ì–æ–ª–æ—Å–æ–≤–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å: –æ–∑–≤—É—á–∏–≤–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∏–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏


---

## 13) –ö–∞—Ç–∞–ª–æ–≥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### üñ•Ô∏è **–ö–õ–ò–ï–ù–¢–°–ö–ò–ï –ò–ù–¢–ï–ì–†–ê–¶–ò–ò (client/integration/integrations) - 25 –ò–ù–¢–ï–ì–†–ê–¶–ò–ô**

- `action_execution_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ MCP –∫–æ–º–∞–Ω–¥ –æ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (open_app, close_app).
  - –ü–æ–¥–ø–∏—Å–∫–∏: `mcp.command_request`, `action.execute_request`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `action.execution_started|completed|failed`, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã.

- `autostart_manager_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º - LaunchAgent, Login Items, bundle_id –ø–æ–¥—Ö–æ–¥.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `autostart.request`, `autostart.status_check`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `autostart.status_checked`, —Å–æ–±—ã—Ç–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º.
  - –ö–†–ò–¢–ò–ß–ù–û: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ü–û–°–õ–ï–î–ù–ò–ú –∏ –ù–ï –ë–õ–û–ö–ò–†–£–Æ–©–ò–ú.

- `browser_progress_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ browser-use –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (Feature F-2025-015).
  - –ü–æ–¥–ø–∏—Å–∫–∏: `browser.progress` (–æ—Ç gRPC).
  - –ü—É–±–ª–∏–∫—É–µ—Ç: –ª–æ–≥–∏—Ä—É–µ—Ç steps/tasks, —Ç—Ä–µ–∫–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏.

- `browser_use_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ù–û–í–´–ô - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ browser-use –º–æ–¥—É–ª—è —Å EventBus.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `browser.task_request`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `browser.started|completed|failed|cancelled`, —Å–æ–±—ã—Ç–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –±—Ä–∞—É–∑–µ—Ä–∞.

- `first_run_permissions_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å —É–º–Ω—ã–º–∏ –ø–∞—É–∑–∞–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `permissions.*`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `permissions.first_run_*`, —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

- `grpc_client_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç `text + screenshot + hardware_id`, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç StreamRequest, —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –≤ —Å–æ–±—ã—Ç–∏—è.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `voice.recognition_completed`, `screenshot.captured`, `hardware.id_*`, `keyboard.short_press` (cancel), `interrupt.request`, `network.status_changed`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `grpc.request_started|completed|failed`, `grpc.response.audio`.

- `hardware_id_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ hardware_id; –æ—Ç–≤–µ—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `hardware.id_request`, `hardware.id_refresh`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `hardware.id_obtained`, `hardware.id_response`, `hardware.id_error`.

- `input_processing_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: PTT-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `voice.recording_start/stop`, –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–∂–∏–º LISTENING/PROCESSING.
  - –ü–æ–¥–ø–∏—Å–∫–∏: –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–ª–±—ç–∫–∏ –æ—Ç KeyboardMonitor, `voice.recognition_*` (fail/timeout).
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `keyboard.press/short_press/long_press/release`, `voice.recording_start/stop`, `mode.request(LISTENING|PROCESSING|SLEEPING)`.

- `instance_manager_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ - –±–ª–æ–∫–∏—Ä—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, —Ñ–∞–π–ª–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, PID –≤–∞–ª–∏–¥–∞—Ü–∏—è.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `app.shutdown`, `instance.check_request`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `instance.status_checked`, `signal.duplicate_instance` (–∞—É–¥–∏–æ-—Å–∏–≥–Ω–∞–ª –¥–ª—è –Ω–µ–∑—Ä—è—á–∏—Ö).
  - –ö–†–ò–¢–ò–ß–ù–û: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ü–ï–†–í–´–ú –∏ –ë–õ–û–ö–ò–†–£–Æ–©–ò–ú - –ø—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `sys.exit(1)`.

- `interrupt_management_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π (—Ç–∏–ø—ã/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã/–∏—Å—Ç–æ—Ä–∏—è), API –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø–∏—Å–∏/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `keyboard.short_press`, `voice.recognition_*`, `playback.*`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `interrupt.request`, `interrupt.completed`, `mode.request(SLEEPING)`.

- `mode_management_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –µ–¥–∏–Ω—ã–π ¬´—Ä—É–±–∏–ª—å–Ω–∏–∫¬ª —Ä–µ–∂–∏–º–æ–≤; –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `mode.request`, –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç `ModeController`, –ø—É–±–ª–∏–∫—É–µ—Ç —Ñ–∞–∫—Ç —á–µ—Ä–µ–∑ `StateManager`.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `mode.request`, `app.mode_changed`, –º–æ—Å—Ç—ã `keyboard.*`, `grpc.request_*`, `playback.*`, `interrupt.request`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: –ø—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Äî `app.mode_changed` (—á–µ—Ä–µ–∑ StateManager), –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ—Å—Ç—ã.

- `network_manager_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏, —Å–Ω–∞–ø—à–æ—Ç—ã, —Å–æ–±—ã—Ç–∏—è —Å–º–µ–Ω—ã.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `network.status_snapshot`, `network.status_changed`.

- `permission_restart_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –≤—ã–¥–∞—á–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (–º–∏–∫—Ä–æ—Ñ–æ–Ω, accessibility, input monitoring, screen capture).
  - –ü–æ–¥–ø–∏—Å–∫–∏: `permissions.changed`, `permissions.status_checked`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `permission_restart.scheduled`, `permission_restart.executing`.
  - –õ–æ–≥–∏–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `modules.permission_restart` –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –∂–¥—ë—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è LISTENING/PROCESSING –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (`UpdaterIntegration`).

- `screenshot_capture_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ–¥–∏–Ω —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ PROCESSING; CLI‚Äëfallback –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –º–æ–¥—É–ª—è.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.mode_changed`, `voice.recording_stop`, `permissions.*` —Å—Ç–∞—Ç—É—Å—ã.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `screenshot.captured` (jpeg/webp), `screenshot.error`.

- `signal_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞–∫—É—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `signal.request`, —Å–æ–±—ã—Ç–∏—è, —Ç—Ä–µ–±—É—é—â–∏–µ –∑–≤—É–∫–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `signal.completed|failed`.

- `speech_playback_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ —á–∞–Ω–∫–æ–≤ –æ—Ç–≤–µ—Ç–∞, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `grpc.response.audio`, `grpc.request_completed|failed`, `keyboard.short_press`, `interrupt.request`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `playback.started|completed|failed|cancelled`, `mode.request(SLEEPING)` –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é/–æ—à–∏–±–∫–µ/—Ç–∏—à–∏–Ω–µ.

- `tray_controller_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞/–º–µ–Ω—é –≤ —Ç—Ä–µ–µ.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.mode_changed`, `keyboard.*`, `voice.mic_opened|closed`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `tray.status_updated`.

- `tts_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: **—Ñ–æ–ª–ª–±—ç–∫** –ª–æ–∫–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—á–∏ —á–µ—Ä–µ–∑ macOS `say` –∫–æ–º–∞–Ω–¥—É.
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º: –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä EdgeTTS –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É, –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π TTS.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `speech.playback.request` (–ø—Ä–∏ —Ñ–æ–ª–ª–±—ç–∫–µ).
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `tts.completed|failed`, –∞—É–¥–∏–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π `say`.
  - –ü–æ—Ç–æ–∫: `grpc.tts_request` ‚Üí `GrpcClientIntegration` –ø—ã—Ç–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä EdgeTTS ‚Üí –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø—É–±–ª–∏–∫—É–µ—Ç `speech.playback.request` ‚Üí `TTSIntegration` –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ª–æ–∫–∞–ª—å–Ω–æ.

- `update_notification_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `updater.update_available`, —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: —Å–æ–±—ã—Ç–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

- `updater_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ù–û–í–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π - HTTP –º–∞–Ω–∏—Ñ–µ—Å—Ç, DMG —Ñ–∞–π–ª—ã, –º–∏–≥—Ä–∞—Ü–∏—è –≤ ~/Applications, –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `app.shutdown`, `updater.check_manual`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

- `voice_recognition_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∑–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è, –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `mode.switch` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è), –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç–∞—Ä—Ç/—Å—Ç–æ–ø –∑–∞–ø–∏—Å–∏, —Ç–∞–π–º–µ—Ä—ã; —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–º–µ–Ω—É —Ä–µ–∂–∏–º–∞.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `voice.recognition_started|completed|failed|timeout`, `mode.request(SLEEPING)` –ø—Ä–∏ fail/timeout.

- `voiceover_ducking_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VoiceOver –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏ –∑—Ä–µ–Ω–∏—è - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ/–≤–∫–ª—é—á–µ–Ω–∏–µ VoiceOver –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.mode_changed`, `keyboard.press`, `app.shutdown`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: —Å–æ–±—ã—Ç–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VoiceOver, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
  - –õ–æ–≥–∏–∫–∞: –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ VoiceOver, –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏ LISTENING/PROCESSING, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∏ SLEEPING.

- `welcome_message_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ ‚Äî –∑–∞–ø—Ä–æ—Å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `app.startup`, `speech_playback.ready`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: —Å–æ–±—ã—Ç–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
  - –õ–æ–≥–∏–∫–∞: –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

- `payment_integration.py`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ù–û–í–´–ô - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –æ–ø–ª–∞—Ç—ã.
  - –ü–æ–¥–ø–∏—Å–∫–∏: `payment.sync_requested`, `subscription.status_check`, `app.startup`.
  - –ü—É–±–ª–∏–∫—É–µ—Ç: `subscription.status_updated`, —Å–æ–±—ã—Ç–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏.

–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç: –≤—Å–µ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–æ–≤ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `mode.request`; —Ñ–∞–∫—Ç —Å–º–µ–Ω—ã ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç StateManager.

### üñ•Ô∏è **–°–µ—Ä–≤–µ—Ä–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

–û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π ‚Äî –≤ `server/server/Docs/ARCHITECTURE_OVERVIEW.md`.

---

## 14) –î–∏–∞–≥—Ä–∞–º–º—ã (Mermaid)

–ë—ã—Å—Ç—Ä—ã–µ —Å—Ö–µ–º—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤ –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏. GitHub —Ä–µ–Ω–¥–µ—Ä–∏—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã Mermaid, –≤ IDE –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å Markdown Preview.

### üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞**

```mermaid
graph TB
    subgraph "üñ•Ô∏è –ö–ª–∏–µ–Ω—Ç (macOS)"
        A[EventBus] --> B[ModeManagementIntegration]
        B --> C[ModeController]
        C --> D[ApplicationStateManager]
        D --> E[Workflows]
        E --> F[–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏]
        F --> G[–ú–æ–¥—É–ª–∏]
        G --> H[gRPC Client]
    end
```

### üîÑ **PTT: SLEEPING ‚Üí LISTENING ‚Üí PROCESSING ‚Üí SLEEPING (happy path)**

```mermaid
sequenceDiagram
    participant User
    participant Input as InputProcessingIntegration
    participant Bus as EventBus
    participant ModeMgmt as ModeManagementIntegration
    participant Ctrl as ModeController
    participant State as ApplicationStateManager
    participant VRec as VoiceRecognitionIntegration
    participant Shot as ScreenshotCaptureIntegration
    participant Grpc as GrpcClientIntegration
    participant Speech as SpeechPlaybackIntegration

    User->>Input: Long press (LEFT_SHIFT)
    Input->>Bus: voice.recording_start(session_id)
    Input->>Bus: mode.request(LISTENING)
    Bus->>ModeMgmt: mode.request
    ModeMgmt->>Ctrl: switch_mode(LISTENING)
    Ctrl-->>ModeMgmt: on_mode_changed(LISTENING)
    ModeMgmt->>State: set_mode(LISTENING)
    State->>Bus: app.mode_changed(mode=LISTENING)
    Bus-->>VRec: start listening

    User->>Input: Release (LEFT_SHIFT)
    Input->>Bus: voice.recording_stop(session_id)
    Input->>Bus: mode.request(PROCESSING)
    Bus->>ModeMgmt: mode.request
    ModeMgmt->>Ctrl: switch_mode(PROCESSING)
    Ctrl-->>ModeMgmt: on_mode_changed(PROCESSING)
    ModeMgmt->>State: set_mode(PROCESSING)
    State->>Bus: app.mode_changed(mode=PROCESSING)
    Bus-->>Shot: capture once
    VRec-->>Bus: voice.recognition_completed(text, session_id)
    Bus-->>Grpc: send (text+screenshot+hardware_id)
    Grpc-->>Bus: grpc.response.audio (chunks)
    Bus-->>Speech: play chunks
    Grpc-->>Bus: grpc.request_completed
    Speech-->>Bus: playback.completed
    Speech-->>Bus: mode.request(SLEEPING)
    Bus->>ModeMgmt: mode.request
    ModeMgmt->>Ctrl: switch_mode(SLEEPING)
    Ctrl-->>ModeMgmt: on_mode_changed(SLEEPING)
    ModeMgmt->>State: set_mode(SLEEPING)
    State->>Bus: app.mode_changed(mode=SLEEPING)
```

–ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∂–∞—Ç–∏–µ (interrupt): –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –≤ SLEEPING

```mermaid
sequenceDiagram
    participant Input as InputProcessingIntegration
    participant Bus as EventBus
    participant ModeMgmt as ModeManagementIntegration
    participant Ctrl as ModeController
    participant State as ApplicationStateManager
    participant Speech as SpeechPlaybackIntegration

    Input->>Bus: keyboard.short_press
    Speech-->>Bus: playback.cancelled (stop)
    Bus->>Bus: publish mode.request(SLEEPING)
    Bus->>ModeMgmt: mode.request(SLEEPING)
    ModeMgmt->>Ctrl: switch_mode(SLEEPING)
    Ctrl-->>ModeMgmt: on_mode_changed
    ModeMgmt->>State: set_mode(SLEEPING)
    State->>Bus: app.mode_changed(SLEEPING)
```

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞

```mermaid
flowchart LR
    subgraph Integrations
      A[InputProcessing] -->|mode.request| MM
      B[VoiceRecognition] -->|mode.request| MM
      C[SpeechPlayback] -->|mode.request| MM
      D[Permissions] -->|mode.request| MM
      E[Interrupts] -->|mode.request| MM
    end
    MM[ModeManagementIntegration]\n(–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞—è–≤–∫–∏) --> MC[ModeController]\n(–ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤)
    MC -->|callback| SM[ApplicationStateManager]\nset_mode()
    SM --> EB[EventBus]\napp.mode_changed
    EB --> Consumers[–í—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏]
```
