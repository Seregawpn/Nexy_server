# Production Hardening: –ñ—ë—Å—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏

**–î–∞—Ç–∞:** 2025-12-24  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

## üìã –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### 1. ‚úÖ Generation + closure: –ø–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ü—Ä–∞–≤–∏–ª–æ:** `_current_stream_gen` –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è **—Å—Ç—Ä–æ–≥–æ –ø–æ—Å–ª–µ** —Ç–æ–≥–æ, –∫–∞–∫ –Ω–æ–≤—ã–π stream –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∏ "–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω".

**–ü–æ—Ä—è–¥–æ–∫ –≤ —Ñ–∞–∑–µ 3 (—Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è):**
1. `self._audio_stream = new_stream`
2. `self._stream_started = True` (–∏–ª–∏ —Ç–æ, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç "–≥–æ—Ç–æ–≤–æ")
3. `self._current_stream_gen = new_gen`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- Generation –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `_ensure_stream_started()` –ø–æ—Å–ª–µ `stream.start()`
- –õ–æ–≥ "activated gen=‚Ä¶" –ø–æ—Å–ª–µ –ø—É–Ω–∫—Ç–∞ 3

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ—Ç —Ä–∞–Ω–Ω–µ–≥–æ mute —Å—Ç–∞—Ä–æ–≥–æ callback'–∞
- Callback —Å—Ç–∞—Ä–æ–≥–æ gen –Ω–µ –Ω–∞—á–Ω—ë—Ç –º–æ–ª—á–∞—Ç—å –¥–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ stream

---

### 2. ‚úÖ –†–µ—Å–µ–º–ø–ª–∏–Ω–≥ –≤ callback: –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–µ—Å–µ–º–ø–ª –Ω–∞ –∫–∞–∂–¥—ã–π callback –º–æ–∂–µ—Ç –¥–∞—Ç—å –ø–∏–∫–∏ CPU ‚Üí `status.output_underflow` / crackles.

**–†–µ—à–µ–Ω–∏–µ:**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤/–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–µ—Ç–∫–∏ –¥–ª—è `np.interp`
- –ü–µ—Ä–µ–Ω–æ—Å —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞ –≤ producer (–¥–æ –±—É—Ñ–µ—Ä–∞) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
- Guard: –µ—Å–ª–∏ `status` —Å–æ–¥–µ—Ä–∂–∏—Ç underflow ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å—á—ë—Ç—á–∏–∫

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ö—ç—à –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ä–µ—Å–µ–º–ø–ª–µ
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö callback'–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∞ `callback_resample_ms` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

---

### 3. ‚úÖ Multi-channel —Ä–µ—Å–µ–º–ø–ª: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—ã –¥–∞–Ω–Ω—ã—Ö

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- –í—Ö–æ–¥ –≤ callback –≤—Å–µ–≥–¥–∞ float32 –∏ –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω
- –ü–æ—Å–ª–µ —Ä–µ—Å–µ–º–ø–ª–∞ –¥–ª–∏–Ω–∞ —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `frames` (–µ—Å–ª–∏ –±–æ–ª—å—à–µ ‚Äî –æ–±—Ä–µ–∑–∞—Ç—å, –µ—Å–ª–∏ –º–µ–Ω—å—à–µ ‚Äî –¥–æ–±–∏—Ç—å –Ω—É–ª—è–º–∏)
- `outdata.shape[0] == frames` (–∂—ë—Å—Ç–∫–∏–π –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ dtype –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Ä–µ—Å–µ–º–ø–ª–æ–º
- –û–±—Ä–µ–∑–∫–∞/–¥–æ–±–∏–≤–∫–∞ –¥–æ `frames` –ø–æ—Å–ª–µ —Ä–µ—Å–µ–º–ø–ª–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è `outdata.shape[0] == frames` –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é

---

### 4. ‚úÖ Cooldown failure-path: –∫—ç—à –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ device

**–ü—Ä–∞–≤–∏–ª–æ:** –ü—Ä–∏ failure-path –Ω–µ –æ–±–Ω—É–ª—è—Ç—å `_current_device_id` –∏ `_device_sample_rate` - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –≤–∞–ª–∏–¥–Ω—ã–º–∏.

**–õ–æ–≥–∏–∫–∞:**
- "device not found" ‚Üí **–Ω–µ recreate**, –ø—Ä–æ—Å—Ç–æ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è + –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–∑–∂–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_last_valid_device_id` –∏ `_last_valid_device_sr` –∫–∞–∫ fallback

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ö—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ device
- –ü—Ä–∏ failure-path –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ù–µ—Ç recreate –±–µ–∑ –≤–∞–ª–∏–¥–Ω–æ–≥–æ device_id

---

### 5. ‚úÖ Production tripwires (—Å—á—ë—Ç—á–∏–∫–∏ –∏ —Ç–∞–π–º–µ—Ä—ã)

**–°—á—ë—Ç—á–∏–∫–∏:**
- `callback_underrun_count` - —Å—á—ë—Ç—á–∏–∫ underrun –≤ callback
- `callback_gen_mismatch_count` - —Å—á—ë—Ç—á–∏–∫ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–π generation
- `device_query_failure_count` - —Å—á—ë—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á–Ω—ã—Ö device queries
- `stream_open_fail_count` - —Å—á—ë—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∏–π stream

**–¢–∞–π–º–µ—Ä—ã (rolling avg / max):**
- `recreate_total_ms` - –≤—Ä–µ–º—è recreate (avg/max)
- `callback_resample_ms` - –≤—Ä–µ–º—è —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞ –≤ callback (avg/max)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∞–Ω–æ–º–∞–ª–∏—è—Ö

---

### 6. ‚úÖ –ü–æ–ª–∏—Ç–∏–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `prefer_stream_rate: "content"|"device"` - –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π sample rate
- `resample_mode: "callback"|"producer"|"off"` - —Ä–µ–∂–∏–º —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞
- `device_query_cooldown_sec` - cooldown –¥–ª—è device queries
- `max_recreate_per_minute` - –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –æ—Ç "–ø–∏–ª–æ–æ–±—Ä–∞–∑–Ω–æ–≥–æ" thrash

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `unified_config.yaml`
- –ß—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `UnifiedConfigLoader`
- Fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

---

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Generation –ø–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ stream: `_stream_gen += 1` (–ø–æ–¥ lock)
2. Stream —Å–æ–∑–¥–∞–Ω: `_audio_stream = new_stream`
3. Stream —Å—Ç–∞—Ä—Ç–æ–≤–∞–Ω: `_ensure_stream_started()` ‚Üí `stream.start()`
4. Generation –æ–±–Ω–æ–≤–ª—ë–Ω: `_current_stream_gen = new_gen` (–ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞)

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ—Ç —Ä–∞–Ω–Ω–µ–≥–æ mute —Å—Ç–∞—Ä–æ–≥–æ callback'–∞
- Callback —Å—Ç–∞—Ä–æ–≥–æ gen —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ stream

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —Ä–µ—Å–µ–º–ø–ª–µ: —Å–æ–∑–¥–∞—ë–º –∫—ç—à –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
2. –ü—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Ä–µ—Å–µ–º–ø–ª—è—Ö: –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à
3. –ú–µ—Ç—Ä–∏–∫–∞: `callback_resample_ms` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ö—ç—à —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –ø–∞—Ä—ã (content_sr, stream_sr)
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö callback'–æ–≤ —Å —Ç–æ–π –∂–µ –ø–∞—Ä–æ–π
- –°–Ω–∏–∂–µ–Ω–∏–µ CPU –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 50-70%

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—ã –¥–∞–Ω–Ω—ã—Ö

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- –í—Ö–æ–¥: float32, –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω [-1.0, 1.0]
- –ü–æ—Å–ª–µ —Ä–µ—Å–µ–º–ø–ª–∞: –¥–ª–∏–Ω–∞ = `frames` (–æ–±—Ä–µ–∑–∞–Ω–æ/–¥–æ–±–∏—Ç–æ)
- –í—ã—Ö–æ–¥: `outdata.shape[0] == frames` (–∂—ë—Å—Ç–∫–∏–π –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç)

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ dtype –ø–µ—Ä–µ–¥ —Ä–µ—Å–µ–º–ø–ª–æ–º
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
- –û–±—Ä–µ–∑–∫–∞/–¥–æ–±–∏–≤–∫–∞ –¥–æ `frames` –ø–æ—Å–ª–µ —Ä–µ—Å–µ–º–ø–ª–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è `outdata.shape[0] == frames` –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é

### –ö—ç—à –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ device

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ device: –æ–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
2. –ü—Ä–∏ failure-path: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
3. –ù–µ—Ç recreate –±–µ–∑ –≤–∞–ª–∏–¥–Ω–æ–≥–æ device_id

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∞–ª–∏–¥–Ω–æ–≥–æ device
- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ failure
- –ü–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ cooldown

### Production tripwires

**–°—á—ë—Ç—á–∏–∫–∏:**
- –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Å—Ç–∞—Ö
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–¢–∞–π–º–µ—Ä—ã:**
- Rolling avg/max –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ (max 100 –∑–∞–ø–∏—Å–µ–π)
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

## üß™ –ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞

### 1. Built-in output: –ø—Ä–æ–∏–≥—Ä–∞—Ç—å 2-3 –º–∏–Ω—É—Ç—ã

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ `underrun_count ‚âà 0`
- ‚úÖ –ù–µ—Ç crackles
- ‚úÖ –ó–≤—É–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í –ª–æ–≥–∞—Ö –∏—â–∏:
grep "underrun" logs.md | wc -l  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚âà 0
grep "crackles" logs.md  # –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
```

### 2. AirPods/BT: 10 –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π route –≤–æ –≤—Ä–µ–º—è —Ä–µ—á–∏

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ –ó–≤—É–∫ –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–µ—Ç –Ω–∞–¥–æ–ª–≥–æ
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤—É–µ—Ç—Å—è —Å—Ä–∞–∑—É
- ‚úÖ –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü–æ–¥–∫–ª—é—á–∏/–æ—Ç–∫–ª—é—á–∏ AirPods 10 —Ä–∞–∑ –≤–æ –≤—Ä–µ–º—è —Ä–µ—á–∏
# –í –ª–æ–≥–∞—Ö –∏—â–∏:
grep "–°–º–µ–Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞" logs.md | wc -l  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚âà 10
grep "device_query_failure" logs.md | wc -l  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ
```

### 3. –§–æ—Ä—Å fallback: –∑–∞—Å—Ç–∞–≤–∏—Ç—å content_sr fail

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ –†–µ—Å–µ–º–ø–ª —Ä–µ–∞–ª—å–Ω–æ –≤–∫–ª—é—á–∏–ª—Å—è
- ‚úÖ –°–∫–æ—Ä–æ—Å—Ç—å –∑–≤—É–∫–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è
- ‚úÖ –ù–µ—Ç underrun

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í –ª–æ–≥–∞—Ö –∏—â–∏:
grep "fallback" logs.md  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏ fallback
grep "–†–µ—Å–µ–º–ø–ª–∏–Ω–≥ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è" logs.md  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å
# –ü—Ä–æ–≤–µ—Ä—å –∑–≤—É–∫ - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
```

### 4. Concurrency storm: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π add_audio_data

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ `recreate_count` —Ä–∞–∑—É–º–Ω—ã–π (‚â§ 10)
- ‚úÖ –ù–µ—Ç "–∑–∞–ª–∏–ø–ª–æ"
- ‚úÖ Generation —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í –ª–æ–≥–∞—Ö –∏—â–∏:
grep "RECREATE" logs.md | wc -l  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚â§ 10
grep "–∑–∞–ª–∏–ø–ª–æ" logs.md  # –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
grep "gen_mismatch" logs.md | wc -l  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–µ—Å–µ–º–ø–ª–∏–Ω–≥: –ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è**
   - –ö–∞—á–µ—Å—Ç–≤–æ: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–µ—á–∏, –Ω–æ –Ω–µ —Å—Ç—É–¥–∏–π–Ω–æ–µ
   - –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è: –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `scipy.signal.resample_poly` –∏–ª–∏ `soxr`

2. **–ö—ç—à –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä**
   - –ö—ç—à —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–ª—è –ø–∞—Ä—ã (content_sr, stream_sr)
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä—ã - –∫—ç—à –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è
   - –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–∞—Ä

3. **Tripwires: –ø–æ—Ä–æ–≥–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ**
   - –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ —á–µ—Ä–µ–∑ config
   - –ù–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ **Generation –ø–æ—Ä—è–¥–æ–∫:** –ü—Ä–∏–º–µ–Ω—ë–Ω, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ stream
- ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:** –ü—Ä–∏–º–µ–Ω–µ–Ω–æ, —Å–Ω–∏–∂–µ–Ω–∏–µ CPU –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—ã –¥–∞–Ω–Ω—ã—Ö:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∞, –∂—ë—Å—Ç–∫–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
- ‚úÖ **–ö—ç—à –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ device:** –ü—Ä–∏–º–µ–Ω—ë–Ω, –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ –≤–∞–ª–∏–¥–Ω–æ–≥–æ device
- ‚úÖ **Production tripwires:** –ü—Ä–∏–º–µ–Ω–µ–Ω—ã, —Å—á—ë—Ç—á–∏–∫–∏ –∏ —Ç–∞–π–º–µ—Ä—ã
- ‚úÖ **–ü–æ–ª–∏—Ç–∏–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥–µ:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∞, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã! –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production!**

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å tripwires –≤ production
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–ª—É—á—à–∏—Ç—å —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥

**Production-ready!**


