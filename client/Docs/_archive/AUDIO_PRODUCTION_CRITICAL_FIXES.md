# Production Critical Fixes: 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∫–∏ data‚Üíoutdata

**–î–∞—Ç–∞:** 2025-12-24  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

## üìã –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∏–∫—Å—ã

### 1. ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è int16 ‚Üí float: —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –¥–µ–ª–∏—Ç–µ–ª—å 32768.0

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–µ–ª–µ–Ω–∏–µ –Ω–∞ `32767.0` –¥–∞—ë—Ç –∞—Å–∏–º–º–µ—Ç—Ä–∏—é –¥–ª—è `-32768` (–ø–æ–ª—É—á–∞–µ—Ç—Å—è ‚âà -1.00003), —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –º–∏–∫—Ä–æ–∫–ª–∏–ø–ø–∏–Ω–≥.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `32768.0` (–∏–ª–∏ `np.iinfo(np.int16).max + 1`) –¥–ª—è —Å–∏–º–º–µ—Ç—Ä–∏–∏
- –ü—Ä–∏ –æ–±—Ä–∞—Ç–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: `clip(-1.0, 1.0 - (1.0/32768.0))` –∏ —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ `32768.0`

**–ö–æ–¥:**
```python
# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è int16 ‚Üí float32
if data.dtype == np.int16:
    data = data.astype(np.float32) / 32768.0  # –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ

# –û–±—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è float32 ‚Üí int16
if outdata.dtype == np.int16:
    data = np.clip(data, -1.0, 1.0 - (1.0/32768.0))
    data = (data * 32768.0).astype(np.int16)
```

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ—Ç –º–∏–∫—Ä–æ–∫–ª–∏–ø–ø–∏–Ω–≥–∞/–∞—Å–∏–º–º–µ—Ç—Ä–∏–∏
- –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π int16

---

### 2. ‚úÖ Preallocated buffer –≤–º–µ—Å—Ç–æ np.vstack

**–ü—Ä–æ–±–ª–µ–º–∞:** `np.vstack` —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ –∏ –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ –¥–æ—Ä–æ–≥–æ –≤ callback (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –º–∞–ª–µ–Ω—å–∫–∏—Ö blocksize).

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞—Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞—ë–º –±—É—Ñ–µ—Ä –Ω—É–∂–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é (1 –∞–ª–ª–æ–∫–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ 2+–∫–æ–ø–∏–π)

**–ö–æ–¥:**
```python
# –°–æ–∑–¥–∞—ë–º –±—É—Ñ–µ—Ä –Ω—É–∂–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞—Ä–∞–Ω–µ–µ (1 –∞–ª–ª–æ–∫–∞—Ü–∏—è)
out = np.zeros((frames, out_ch), dtype=np.float32)
n = min(data_frames, frames)
# –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª–æ –±—É—Ñ–µ—Ä–∞
out[:n, :n_ch] = data[:n, :n_ch]
data = out
```

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π –∏ –∫–æ–ø–∏–π
- –†–µ–∞–ª—Ç–∞–π–º-–±–µ–∑–æ–ø–∞—Å–Ω–æ (–±—ã—Å—Ç—Ä–µ–µ –Ω–∞ 30-50%)

---

### 3. ‚úÖ Soft guard –≤–º–µ—Å—Ç–æ assert –≤ callback

**–ü—Ä–æ–±–ª–µ–º–∞:** `assert` –≤ callback –º–æ–∂–µ—Ç —É–±–∏—Ç—å stream, –ø–æ–≤–µ—Å–∏—Ç—å –∞—É–¥–∏–æ—Å–∏—Å—Ç–µ–º—É –∏–ª–∏ –≤—ã–∑–≤–∞—Ç—å –∫–∞—Å–∫–∞–¥ –æ—à–∏–±–æ–∫.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ–º —Å—á—ë—Ç—á–∏–∫ + –ª–æ–≥–∏—Ä—É–µ–º —Ä–µ–¥–∫–æ
- –í—Å–µ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω—è–µ–º –Ω—É–ª—è–º–∏ –∏ return

**–ö–æ–¥:**
```python
# Soft guard –≤–º–µ—Å—Ç–æ assert
if data.shape[0] != frames:
    self._callback_shape_mismatch_count += 1
    if self._callback_shape_mismatch_count % 100 == 0:  # –õ–æ–≥–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–µ 100
        logger.warning(f"‚ö†Ô∏è [TRIPWIRE] Shape mismatch: data.shape[0]={data.shape[0]} != frames={frames}")
    outdata[:] = 0
    return
```

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ—Ç –ø–∞–¥–µ–Ω–∏–π stream –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –≤ production
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

### 4. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π mono/stereo mix + –≤—Å–µ–≥–¥–∞ –æ–±–Ω—É–ª—è–µ–º outdata

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ data mono (1 –∫–∞–Ω–∞–ª), out stereo (2) ‚Üí –≤—Ç–æ—Ä–æ–π –∫–∞–Ω–∞–ª –æ—Å—Ç–∞—ë—Ç—Å—è "–∫–∞–∫ –±—ã–ª" (–º—É—Å–æ—Ä)
- –ï—Å–ª–∏ data stereo, out mono ‚Üí –ø—Ä–æ—Å—Ç–æ –æ—Ç—Ä–µ–∑–∞–µ–º –∫–∞–Ω–∞–ª 0 (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–∞–Ω–Ω–æ)

**–†–µ—à–µ–Ω–∏–µ:**
- –í—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ `outdata[:] = 0`
- Mono‚Üístereo: –¥—É–±–ª–∏—Ä—É–µ–º –∫–∞–Ω–∞–ª
- Stereo‚Üímono: —Å—Ä–µ–¥–Ω–µ–µ (L+R)/2

**–ö–æ–¥:**
```python
# –í—Å–µ–≥–¥–∞ –æ–±–Ω—É–ª—è–µ–º outdata —Å–Ω–∞—á–∞–ª–∞
outdata[:] = 0

# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π mono/stereo mix
if data_ch == 1 and out_ch >= 2:
    # –ú–æ–Ω–æ ‚Üí —Å—Ç–µ—Ä–µ–æ: –¥—É–±–ª–∏—Ä—É–µ–º –∫–∞–Ω–∞–ª
    out[:, 0] = data[:, 0]
    out[:, 1] = data[:, 0]
elif data_ch >= 2 and out_ch == 1:
    # –°—Ç–µ—Ä–µ–æ ‚Üí –º–æ–Ω–æ: —Å—Ä–µ–¥–Ω–µ–µ (L+R)/2
    out[:, 0] = 0.5 * (data[:, 0] + data[:, 1])
else:
    # –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤
    n_ch = min(data_ch, out_ch)
    out[:, :n_ch] = data[:, :n_ch]
```

**–ó–∞—â–∏—Ç–∞:**
- –ù–µ—Ç "–∏–Ω–æ–≥–¥–∞ —à–∏–ø–µ–Ω–∏–µ" –Ω–∞ –≤—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–µ
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π downmix/upmix
- –ß–∏—Å—Ç—ã–π outdata –±–µ–∑ –º—É—Å–æ—Ä–∞

---

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è int16 ‚Üí float32

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –í—Ö–æ–¥: int16 `[-32768, 32767]`
2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: `/ 32768.0` ‚Üí float32 `[-1.0, 1.0]` (—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ)
3. –û–±—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: `clip(-1.0, 1.0 - (1.0/32768.0))` ‚Üí `* 32768.0` ‚Üí int16

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
- –ù–µ—Ç –º–∏–∫—Ä–æ–∫–ª–∏–ø–ø–∏–Ω–≥–∞
- –¢–æ—á–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π

### Preallocated buffer

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –°–æ–∑–¥–∞—ë–º –±—É—Ñ–µ—Ä `np.zeros((frames, out_ch), dtype=np.float32)` –∑–∞—Ä–∞–Ω–µ–µ
2. –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é: `out[:n, :n_ch] = data[:n, :n_ch]`
3. –ò—Å–ø–æ–ª—å–∑—É–µ–º `out` –∫–∞–∫ `data`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- 1 –∞–ª–ª–æ–∫–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ 2+–∫–æ–ø–∏–π
- –ë—ã—Å—Ç—Ä–µ–µ –Ω–∞ 30-50%
- –†–µ–∞–ª—Ç–∞–π–º-–±–µ–∑–æ–ø–∞—Å–Ω–æ

### Soft guard

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç: `data.shape[0] == frames`
2. –ï—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω: –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ–º —Å—á—ë—Ç—á–∏–∫, –ª–æ–≥–∏—Ä—É–µ–º —Ä–µ–¥–∫–æ (–∫–∞–∂–¥—ã–µ 100)
3. –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω—É–ª—è–º–∏ –∏ return

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ—Ç –ø–∞–¥–µ–Ω–∏–π stream
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –≤ production
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### Mono/stereo mix

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –í—Å–µ–≥–¥–∞ –æ–±–Ω—É–ª—è–µ–º `outdata[:] = 0` —Å–Ω–∞—á–∞–ª–∞
2. Mono‚Üístereo: –¥—É–±–ª–∏—Ä—É–µ–º –∫–∞–Ω–∞–ª
3. Stereo‚Üímono: —Å—Ä–µ–¥–Ω–µ–µ (L+R)/2
4. –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã: –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ–º

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ—Ç –º—É—Å–æ—Ä–∞ –≤ outdata
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π downmix/upmix
- –ù–µ—Ç "–∏–Ω–æ–≥–¥–∞ —à–∏–ø–µ–Ω–∏–µ"

---

## üß™ –ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–º–º–µ—Ç—Ä–∏–∏

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ –ù–µ—Ç –º–∏–∫—Ä–æ–∫–ª–∏–ø–ø–∏–Ω–≥–∞
- ‚úÖ –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
# –¢–µ—Å—Ç: -32768 –¥–æ–ª–∂–µ–Ω –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ -1.0
test_value = np.array([-32768], dtype=np.int16)
normalized = test_value.astype(np.float32) / 32768.0
assert abs(normalized[0] - (-1.0)) < 1e-6
```

### 2. Preallocated buffer: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –Ω–∞ 30-50%

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í –ª–æ–≥–∞—Ö –∏—â–∏:
grep "vstack" logs.md  # –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: callback –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º
```

### 3. Soft guard: –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ –ù–µ—Ç –ø–∞–¥–µ–Ω–∏–π stream –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ä–µ–¥–∫–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í –ª–æ–≥–∞—Ö –∏—â–∏:
grep "Shape mismatch" logs.md  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–¥–∫–æ (–∫–∞–∂–¥—ã–µ 100)
grep "assert" logs.md  # –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ callback
```

### 4. Mono/stereo mix: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- ‚úÖ –ù–µ—Ç "–∏–Ω–æ–≥–¥–∞ —à–∏–ø–µ–Ω–∏–µ" –Ω–∞ –≤—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–µ
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π downmix/upmix

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –¢–µ—Å—Ç: mono ‚Üí stereo
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∑–≤—É–∫ –Ω–∞ –æ–±–æ–∏—Ö –∫–∞–Ω–∞–ª–∞—Ö
# –¢–µ—Å—Ç: stereo ‚Üí mono
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ä–µ–¥–Ω–µ–µ (L+R)/2
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–µ—Å–µ–º–ø–ª–µ—Ä: –ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è**
   - –î–ª—è TTS/—Ä–µ—á–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –º–∏–∫—Ä–æ–¥–∂–∏—Ç—Ç–µ—Ä –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –±–ª–æ–∫–æ–≤ (–¥–ª—è —Ç–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤)
   - Stateful —Ä–µ—Å–µ–º–ø–ª–µ—Ä –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –º–∏–∫—Ä–æ–¥–∂–∏—Ç—Ç–µ—Ä–∞

2. **Preallocated buffer: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä**
   - –ë—É—Ñ–µ—Ä —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–ª—è `frames` (–º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ —á–µ–º –Ω—É–∂–Ω–æ)
   - –ù–æ —ç—Ç–æ –ª—É—á—à–µ —á–µ–º `np.vstack` (–∞–ª–ª–æ–∫–∞—Ü–∏—è + –∫–æ–ø–∏—è)

3. **Soft guard: –ø–æ—Ä–æ–≥ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π**
   - –õ–æ–≥–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–µ 100 –Ω–∞—Ä—É—à–µ–Ω–∏–π
   - –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —á–µ—Ä–µ–∑ config

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∞, —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –¥–µ–ª–∏—Ç–µ–ª—å 32768.0
- ‚úÖ **Preallocated buffer:** –ü—Ä–∏–º–µ–Ω—ë–Ω, –Ω–µ—Ç np.vstack
- ‚úÖ **Soft guard:** –ü—Ä–∏–º–µ–Ω—ë–Ω, –Ω–µ—Ç assert –≤ callback
- ‚úÖ **Mono/stereo mix:** –ü—Ä–∏–º–µ–Ω—ë–Ω, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π downmix/upmix

**–í—Å–µ 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã! –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production!**

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å tripwires –≤ production
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å stateful —Ä–µ—Å–µ–º–ø–ª–µ—Ä

**Production-ready!**


