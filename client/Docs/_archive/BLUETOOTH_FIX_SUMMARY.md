# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Bluetooth

**–î–∞—Ç–∞:** 2025-01-08  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ê—É–¥–∏–æ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª–æ—Å—å –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–ª—è Bluetooth —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ú—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏ —Ñ–æ—Ä–º–∞—Ç **16kHz, –º–æ–Ω–æ** –¥–ª—è –≤—Å–µ—Ö Bluetooth —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ `voice_recognition`, —á—Ç–æ –º–æ–≥–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–§–∞–π–ª:** `modules/voice_recognition/core/speech_recognizer.py` (—Å—Ç—Ä–æ–∫–∏ 695-711)

### –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```python
if self._is_bluetooth_device(device_name):
    # –î–ª—è BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–æ–Ω–æ –∏ 16kHz
    self.actual_input_rate = 16000
    self.actual_input_channels = 1
    logger.info("üîµ Bluetooth —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ - —Ñ–æ—Ä–º–∞—Ç: 16kHz, –º–æ–Ω–æ")
```

### –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```python
# –î–ª—è Bluetooth —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–∞–Ω–∞–ª—ã –¥–æ –º–æ–Ω–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
if self._is_bluetooth_device(device_name):
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –Ω–æ –¥–ª—è BT –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º –º–æ–Ω–æ
    self.actual_input_rate = float(samplerate)
    # –î–ª—è BT —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º –º–æ–Ω–æ, –Ω–æ –Ω–µ –ø—Ä–∏–Ω—É–∂–¥–∞–µ–º
    self.actual_input_channels = 1 if channels_available >= 1 else max(1, min(channels_available, channels_target))
    logger.info(f"üîµ Bluetooth —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ - —Ñ–æ—Ä–º–∞—Ç: {self.actual_input_rate}Hz, {self.actual_input_channels} –∫–∞–Ω–∞–ª(–æ–≤)")
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è Bluetooth (–Ω–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π 16kHz)
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –º–µ–∂–¥—É –∑–∞–ø–∏—Å—å—é –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
- ‚úÖ –ö–∞–Ω–∞–ª—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –¥–æ –º–æ–Ω–æ –¥–ª—è BT, –Ω–æ –Ω–µ –ø—Ä–∏–Ω—É–∂–¥–∞—é—Ç—Å—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–±–ª–µ–º –≤ –ª–æ–≥–∞—Ö

### –ù–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö:

1. **Error 35 –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ IOProc** (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ state machine)
   - `HALC_ProxyIOContext::_StartIO(): Start failed - StartAndWaitForState returned error 35`
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ state machine –∏ –¥–µ–±–∞—É–Ω—Å

2. **Timeout –≤ welcome_message_integration**
   - `‚è±Ô∏è [WELCOME_INTEGRATION] Timeout –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (10 —Å–µ–∫—É–Ω–¥)`
   - –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å —É—Å–ø–µ—à–Ω–æ, –Ω–æ timeout —Å—Ä–∞–±–æ—Ç–∞–ª —Ä–∞–Ω—å—à–µ
   - –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å timeout

3. **TCC –≤—ã–∑–æ–≤—ã –±–µ–∑ entitlement** (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
   - `TCCAccessRequest for kTCCServiceAccessibility without the ... entitlement`
   - –≠—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –æ—à–∏–±–∫–∞

## –°—Ç–∞—Ç—É—Å

‚úÖ **–ù–ê–°–¢–†–û–ô–ö–ò BLUETOOTH –ò–°–ü–†–ê–í–õ–ï–ù–´**

–¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤–º–µ—Å—Ç–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ 16kHz, —á—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º.




