# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –¢–µ—Å—Ç fallback –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ tccd

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ `tccutil reset` —Å—Ç–∞—Ç—É—Å—ã –æ—Å—Ç–∞—é—Ç—Å—è `GRANTED` –∏–∑-–∑–∞ –∫–µ—à–∞ tccd. Fallback –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —É–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏.

## –†–µ—à–µ–Ω–∏–µ
–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å tccd –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫–µ—à–∞, –∑–∞—Ç–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å reset –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å fallback.

## –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –®–ê–ì 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ tccd (–í–´–ü–û–õ–ù–ò–¢–¨ –í–†–£–ß–ù–£–Æ)
```bash
sudo killall tccd
```
**–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**

### –®–ê–ì 2: –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ tccd –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```bash
sudo tccutil reset Microphone com.nexy.assistant
sudo tccutil reset Accessibility com.nexy.assistant
sudo tccutil reset ScreenCapture com.nexy.assistant
sudo tccutil reset ListenEvent com.nexy.assistant
```

### –®–ê–ì 3: –ó–∞–ø—É—Å–∫ activate_all_permissions()
```bash
python3 -c "import asyncio; from modules.permissions.first_run.activator import activate_all_permissions; print(asyncio.run(activate_all_permissions()))"
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:
```bash
python3 test_fallback_manual.py
```

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –ï—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ —Å–±—Ä–æ—à–µ–Ω—ã:
1. **–°—Ç–∞—Ç—É—Å—ã –î–û**: `not_determined` –∏–ª–∏ `denied`
2. **Helper exit code**: `1` (–¥–ª—è Accessibility) –∏–ª–∏ –¥—Ä—É–≥–∏–µ –∫–æ–¥—ã
3. **Fallback —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**: –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è:
   ```
   üîß [ACTIVATOR] Accessibility: –æ—Ç–∫—Ä—ã–≤–∞–µ–º System Settings...
   üîß [ACTIVATOR] Microphone: –æ—Ç–∫—Ä—ã–≤–∞–µ–º System Settings...
   ```
4. **System Settings –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –±—ã–ª–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ fallback –≤ –∫–æ–¥–µ
Fallback –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `modules/permissions/first_run/activator.py`:
- –§—É–Ω–∫—Ü–∏—è `_open_permission_settings()` (—Å—Ç—Ä–æ–∫–∞ 32)
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞:
  - Helper –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É (exit code -1, -2, 2)
  - Helper –≤–µ—Ä–Ω—É–ª 1, –Ω–æ —Å—Ç–∞—Ç—É—Å –≤—Å—ë –µ—â—ë –Ω–µ GRANTED
  - –î—Ä—É–≥–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è fallback

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ **Fallback —Å—Ä–∞–±–æ—Ç–∞–ª**, –µ—Å–ª–∏:
- –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è `üîß [ACTIVATOR] {label}: –æ—Ç–∫—Ä—ã–≤–∞–µ–º System Settings...`
- System Settings –æ—Ç–∫—Ä—ã–ª—Å—è –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –°—Ç–∞—Ç—É—Å—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å —Å `not_determined`/`denied` –Ω–∞ `granted` (–ø–æ—Å–ª–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è)

‚ùå **Fallback –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª**, –µ—Å–ª–∏:
- –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã —Å—Ä–∞–∑—É `granted` (–∫–µ—à –Ω–µ —Å–±—Ä–æ—à–µ–Ω)
- –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ –æ—Ç–∫—Ä—ã—Ç–∏–∏ System Settings
- Helper –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0

## –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

1. **`test_fallback_manual.py`** ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ç–∞—Ç—É—Å–æ–≤
2. **`test_fallback_after_tccd_reset.sh`** ‚Äî bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

## –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- –°—Ç–∞—Ç—É—Å—ã –î–û –∏ –ü–û–°–õ–ï
- Exit codes helper'–æ–≤
- –°–æ–æ–±—â–µ–Ω–∏—è –æ fallback –≤ –ª–æ–≥–∞—Ö
- –û—Ç–∫—Ä—ã–ª–∏—Å—å –ª–∏ System Settings
