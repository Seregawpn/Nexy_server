# Чек-лист готовности к упаковке (Packaging Readiness Checklist)

**Версия:** 2.0 (обновлено 2026-01-11)  
**Источник истины:** `Docs/PRE_PACKAGING_VERIFICATION.md`

> **ОБЯЗАТЕЛЬНО:** Этот чек-лист заполняется после прохождения `PRE_PACKAGING_VERIFICATION.md` и перед запуском `build_final.sh`.

---

## Информация о проверке

**Дата проверки:** _______________  
**Проверяющий:** _______________  
**Версия приложения:** _______________  
**Тип изменений:** _______________ (код / ресурсы / бинарники / конфигурация)

---

## Результаты проверки

### 1. Проверка триггеров изменений

- [ ] Измененные файлы определены
- [ ] Тип изменения определен
- [ ] Обязательный процесс из `PACKAGING_FINAL_GUIDE.md` (раздел 0.2) выполнен

**Примечания:**
```
(Указать измененные файлы и тип изменения)
```

---

### 2. Проверка окружения

#### 2.1. Python (Universal 2)

- [ ] Python Universal 2 установлен (arm64 + x86_64)
- [ ] Путь: `/Library/Frameworks/Python.framework/Versions/3.13/bin/python3`

**Результаты проверки:**
```bash
# arm64
python3 -c "import platform; print(platform.machine())"
# Результат: _______________

# x86_64
arch -x86_64 python3 -c "import platform; print(platform.machine())"
# Результат: _______________
```

#### 2.2. Сертификаты

- [ ] Developer ID Application сертификат найден
- [ ] Developer ID Installer сертификат найден (для PKG, опционально)

**Результаты проверки:**
```bash
# Developer ID Application
security find-identity -v -p codesigning | grep "Developer ID Application"
# Результат: _______________

# Developer ID Installer
security find-identity -v -p basic | grep "Developer ID Installer"
# Результат: _______________
```

#### 2.3. Инструменты

- [ ] PyInstaller установлен
- [ ] codesign доступен
- [ ] pkgbuild доступен
- [ ] productbuild доступен
- [ ] notarytool доступен
- [ ] stapler доступен
- [ ] lipo доступен

---

### 3. Проверка артефактов упаковки

#### 3.1. Nexy.spec

- [ ] Новые ресурсы добавлены в секцию `datas` (если добавлены)
- [ ] Новые бинарники добавлены в секцию `binaries` (если добавлены)
- [ ] Пути корректны (абсолютные пути через `client_dir`)

**Примечания:**
```
(Указать изменения в Nexy.spec, если были)
```

#### 3.2. stage_universal_binaries.py

- [ ] Новые бинарники добавлены в `BINARY_DEFS` (если добавлены)
- [ ] Пути к arm64 и x86_64 версиям корректны

**Примечания:**
```
(Указать изменения в stage_universal_binaries.py, если были)
```

#### 3.3. Universal 2 бинарники

- [ ] FFmpeg: Universal 2 (arm64 + x86_64)
- [ ] SwitchAudioSource: Universal 2 (arm64 + x86_64)
- [ ] FLAC: Universal 2 (arm64 + x86_64)
- [ ] Новые бинарники: Universal 2 (если добавлены)

**Результаты проверки:**
```bash
# FFmpeg
lipo -info resources/ffmpeg/ffmpeg
# Результат: _______________

# SwitchAudioSource
lipo -info resources/audio/SwitchAudioSource
# Результат: _______________

# FLAC
lipo -info resources/audio/flac
# Результат: _______________
```

---

### 4. Проверка зависимостей

#### 4.1. requirements.txt

- [ ] Все зависимости установлены
- [ ] Версии зависимостей соответствуют требованиям

**Примечания:**
```
(Указать проблемы с зависимостями, если есть)
```

#### 4.2. pyproject.toml

- [ ] Конфигурация актуальна
- [ ] Нет конфликтов с `requirements.txt`

---

### 5. Проверка конфигурации

#### 5.1. unified_config.yaml

- [ ] Файл валиден (нет синтаксических ошибок)
- [ ] Версия приложения обновлена (если нужно)

**Версия приложения:**
```
(Указать версию из unified_config.yaml)
```

#### 5.2. Info.plist

- [ ] Минимальная версия macOS = 12.0
- [ ] Bundle identifier = `com.nexy.assistant`
- [ ] Версия приложения соответствует `unified_config.yaml`

---

### 6. Проверка ресурсов

#### 6.1. Иконки

- [ ] Иконка приложения присутствует: `assets/icons/app_icon.icns`

#### 6.2. Аудио ресурсы

- [ ] Аудио ресурсы присутствуют (если используются)

#### 6.3. Бинарники

- [ ] Все бинарники Universal 2 (arm64 + x86_64)

---

### 7. Проверка кода

#### 7.1. Импорты

- [ ] Все импорты корректны
- [ ] Нет отсутствующих модулей

**Результаты проверки:**
```bash
python3 scripts/verify_imports.py
# Результат: _______________
```

#### 7.2. PyInstaller совместимость

- [ ] Код совместим с PyInstaller
- [ ] Нет проблем с hidden imports

**Результаты проверки:**
```bash
python3 scripts/verify_pyinstaller.py
# Результат: _______________
```

#### 7.3. ctypes/нативный код

- [ ] ctypes/нативный код корректно настроен
- [ ] Нет проблем с библиотеками

**Результаты проверки:**
```bash
python3 scripts/verify_ctypes.py
# Результат: _______________
```

---

### 8. Проверка тестов

- [ ] Все тесты пройдены (если есть)
- [ ] Нет критических ошибок

**Результаты проверки:**
```bash
python3 -m pytest tests/ -v
# Результат: _______________
```

---

## Итоговый статус

**Готовность к упаковке:**
- [ ] ✅ ВСЕ ПРОВЕРКИ ПРОЙДЕНЫ — готов к запуску `build_final.sh`
- [ ] ⚠️ ЕСТЬ ПРОБЛЕМЫ — требуется исправление перед упаковкой
- [ ] ❌ ПРОВЕРКИ НЕ ПРОЙДЕНЫ — упаковка заблокирована

**Найденные проблемы:**
```
(Указать найденные проблемы и план их решения)
```

**Следующие шаги:**
```
(Указать следующие шаги: исправление проблем, запуск build_final.sh и т.д.)
```

---

## Логи проверок

**Приложить логи проверок:**
- [ ] Логи проверки импортов
- [ ] Логи проверки PyInstaller
- [ ] Логи проверки ctypes
- [ ] Логи проверки конфигурации
- [ ] Логи проверки ресурсов
- [ ] Логи тестов (если есть)

**Пути к логам:**
```
(Указать пути к логам или приложить их содержимое)
```

---

## Связанные документы

- `Docs/PACKAGING_FINAL_GUIDE.md` — основной гайд по упаковке (раздел 0)
- `Docs/PRE_PACKAGING_VERIFICATION.md` — чек-лист проверки перед упаковкой
- `packaging/build_final.sh` — канонический скрипт упаковки
- `.cursorrules` — правила разработки (раздел 11.2)
