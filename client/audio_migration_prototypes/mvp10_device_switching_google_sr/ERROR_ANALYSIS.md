# –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## üî¥ –û—à–∏–±–∫–∞ 1: `'NoneType' object has no attribute 'close'`

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
```
2025-12-23 19:40:21,201 - __main__ - INFO -   üîä –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –¥–ª—è –æ–∫—Ä—É–∂–∞—é—â–µ–≥–æ —à—É–º–∞...
2025-12-23 19:40:21,202 - __main__ - ERROR -   ‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: 'NoneType' object has no attribute 'close'
```

### –ü—Ä–∏—á–∏–Ω–∞:
1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å context manager `speech_recognition.Microphone`:**
   - `speech_recognition.Microphone` - —ç—Ç–æ context manager
   - –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `with self.current_microphone as source:` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `__enter__()`
   - `__enter__()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `MicrophoneStream`, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥ `close()`
   - –ù–æ –µ—Å–ª–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω —É–∂–µ –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º `with` –±–ª–æ–∫–µ, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `None`

2. **–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
   - –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –≤ `with` –±–ª–æ–∫–µ, –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –∫–æ–≥–¥–∞ –µ–≥–æ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
   - `speech_recognition.Microphone` –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ `with`

### –†–µ—à–µ–Ω–∏–µ:
- **–ù–ï –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω** - —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –≤ `with` –±–ª–æ–∫–µ

---

## üî¥ –û—à–∏–±–∫–∞ 2: `PortAudio not initialized [PaErrorCode -10000]`

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
```
2025-12-23 19:40:22,210 - test_device_mapping - ERROR - ‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≤ PortAudio: PortAudio not initialized [PaErrorCode -10000]
```

### –ü—Ä–∏—á–∏–Ω–∞:
1. **PortAudio —Ç–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏:**
   - –ü–æ—Å–ª–µ –æ—à–∏–±–∫–∏ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º (`'NoneType' object has no attribute 'close'`)
   - PortAudio (–∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `speech_recognition` –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º) –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
   - –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã `sd.query_devices()` –∏–ª–∏ `sd.query_devices(device_index)` –ø–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–æ–π

2. **–ö–∞—Å–∫–∞–¥–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
   - –ü–µ—Ä–≤–∞—è –æ—à–∏–±–∫–∞ (–º–∏–∫—Ä–æ—Ñ–æ–Ω) ‚Üí PortAudio –¥–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
   - –í—Ç–æ—Ä–∞—è –æ—à–∏–±–∫–∞ (PortAudio) ‚Üí –º–∞–ø–ø–∏–Ω–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –¢—Ä–µ—Ç—å—è –æ—à–∏–±–∫–∞ ‚Üí —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

### –†–µ—à–µ–Ω–∏–µ:
- **–ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å PortAudio** –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å try-except —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à –º–∞–ø–ø–∏–Ω–≥–∞, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ PortAudio –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏

---

## üî¥ –û—à–∏–±–∫–∞ 3: `Audio Unit: Invalid Property Value [-10851]`

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
```
||PaMacCore (AUHAL)|| Warning on line 521: err=''!obj'', msg=Unknown Error
||PaMacCore (AUHAL)|| Warning on line 441: err=''!obj'', msg=Unknown Error
||PaMacCore (AUHAL)|| Error on line 1322: err='-10851', msg=Audio Unit: Invalid Property Value
```

### –ü—Ä–∏—á–∏–Ω–∞:
1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
   - PortAudio –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º, –∫–æ—Ç–æ—Ä–æ–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –∏–ª–∏ —Å—Ç–∞–ª–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º
   - –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞:
     - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏
     - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
     - PortAudio –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –±–æ–ª—å—à–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ

2. **Race condition:**
   - –ú–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
   - PortAudio –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ (sample_rate, channels) –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ —É–∂–µ –Ω–µ —Ç–æ

### –†–µ—à–µ–Ω–∏–µ:
- **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å debounce** –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ PortAudio** –∏ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–±–ª–µ–º–∞ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞:**
   - `speech_recognition.Microphone` –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è PortAudio:**
   - PortAudio —Ç–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫
   - –ù—É–∂–Ω–∞ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

3. **–ü—Ä–æ–±–ª–µ–º–∞ race condition:**
   - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
   - –ù—É–∂–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é:

1. **–ü–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:**
   ```python
   # –í–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
   # self.current_microphone = sr.Microphone(device_index=device_index)
   # with self.current_microphone as source:  # ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ
   
   # –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –∫–∞–∂–¥—ã–π —Ä–∞–∑:
   microphone = sr.Microphone(device_index=device_index)
   with microphone as source:  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
   ```

2. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ PortAudio:**
   ```python
   try:
       device_info = sd.query_devices(device_index)
   except Exception as e:
       # –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å PortAudio –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à
       logger.warning(f"PortAudio error, using cache: {e}")
       device_info = cached_device_info
   ```

3. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
   ```python
   # –ü—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
   available_devices = sd.query_devices()
   if device_index not in [d['index'] for d in available_devices]:
       logger.warning("Device no longer available")
       return False
   ```

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. ‚úÖ **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–∏
3. ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚úÖ **–ü–µ—Ä–≤–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google SR** - —Ä–∞–±–æ—Ç–∞–µ—Ç —É—Å–ø–µ—à–Ω–æ

## ‚ùå –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. ‚ùå **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞** - –º–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
2. ‚ùå **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏** - PortAudio —Ç–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
3. ‚ùå **–û–±—Ä–∞–±–æ—Ç–∫–∞ race condition** - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏

