# Тест-план: Новая система разрешений (Phase 6)

Чтобы быть на 100% уверенным в стабильности, необходимо проверить следующие «критические точки». Рекомендуется выполнять их вручную на реальной macOS.

## 1. Сценарий «Чистый запуск» (First Run)
**Цель**: Проверить базовый флоу блокировки.
- **Действие**: Сбросить все права через `tccutil reset All com.nexy.assistant`. Запустить приложение.
- **Ожидаемый результат**:
  - Иконка в трее появляется и становится **КРАСНОЙ**.
  - Автоматически открывается окно настроек macOS на нужном пункте.
  - Приложение НЕ переходит в режим SLEEP (не реагирует на горячие клавиши), пока права не выданы.

## 2. Сценарий «Выдача прав по одному»
**Цель**: Проверить цикл ожидания.
- **Действие**: Запустить приложение без прав. Выдать права только на Микрофон.
- **Ожидаемый результат**:
  - Приложение видит микрофон, переходит к следующему разрешению (например, Accessibility).
  - Иконка остается красной.
  - Открывается следующий раздел настроек.

## 3. Сценарий «Триггер перезапуска»
**Цель**: Проверить автоматический рестарт для критических прав.
- **Действие**: Выдать права на Accessibility или Input Monitoring.
- **Ожидаемый результат**:
  - Как только macOS подтверждает выдачу, приложение должно **самопроизвольно закрыться и открыться снова**.
  - После перезапуска проверка этого права должна пройти мгновенно.

## 4. Сценарий «Отзыв прав» (Revocation)
**Цель**: Проверить Every-Launch логику.
- **Действие**: Выдать все права, убедиться, что приложение работает (иконка серая/синяя). Закрыть приложение. Отозвать права в настройках macOS. Запустить снова.
- **Ожидаемый результат**:
  - Приложение НЕ должно зайти в рабочий режим.
  - Оно снова должно заблокироваться (иконка красная) и запросить права.

## 5. Сценарий «Микрофон без перезапуска»
**Цель**: Проверить, что мы не дергаем систему зря.
- **Действие**: Приложение запущено без прав. Выдать ТОЛЬКО микрофон.
- **Ожидаемый результат**:
  - Приложение продолжает проверку/работу БЕЗ перезагрузки процесса (микрофон — единственное право, не требующее рестарта).

## 6. Сценарий «Гонка с обновлением» (Edge Case)
**Цель**: Убедиться, что рестарт по правам не ломает установку апдейта.
- **Действие**: Имитировать начало загрузки обновления, и в этот момент выдать права в настройках.
- **Ожидаемый результат**:
  - Перезапуск по правам должен быть отложен, пока обновление не скачается полностью.

## 7. Сценарий «Отказ в настройках»
**Цель**: Проверить устойчивость цикла.
- **Действие**: Когда открылось окно настроек, нажать «Отмена» или закрыть настройки, не выдавая прав.
- **Ожидаемый результат**:
  - Приложение продолжает «висеть» с красной иконкой.
  - Оно не падает и не зацикливает открытие окна настроек (окно открывается один раз при входе в проверку конкретного права).

---
**Чек-лист готовности иконки**:
- [ ] Серый/Синий цвет -> Все ок.
- [ ] Красный цвет -> Ждём юзера.
- [ ] Иконка в трее видна даже если доступ к Accessibility еще не получен (Критично для UX).
