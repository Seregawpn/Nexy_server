# üçé –¢–†–ï–ë–û–í–ê–ù–ò–Ø –î–õ–Ø –£–ü–ê–ö–û–í–ö–ò macOS –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** Nexy AI Assistant
**–¢–∏–ø:** Menu Bar Application (—Ñ–æ–Ω–æ–≤—ã–π —Ä–µ–∂–∏–º)
**–¶–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞:** macOS 11.0+ (Universal 2: arm64 + x86_64)
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-09
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-11-17
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 3.0 (COMPLETED)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Universal 2 —Å–±–æ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

---

## üéâ –ò–¢–û–ì–ò –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### ‚úÖ Universal 2 —Å–±–æ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (2025-11-17)

**–§–∏–Ω–∞–ª—å–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (Universal 2):**
- ‚úÖ `dist/Nexy.app` - Universal 2 (arm64 + x86_64), –ø–æ–¥–ø–∏—Å–∞–Ω, –Ω–æ—Ç–∞—Ä–∏–∑–æ–≤–∞–Ω, ~374MB
- ‚úÖ `dist/Nexy.pkg` - Universal 2 (arm64 + x86_64), –ø–æ–¥–ø–∏—Å–∞–Ω, –Ω–æ—Ç–∞—Ä–∏–∑–æ–≤–∞–Ω, stapled, ~178MB
- ‚ö†Ô∏è `dist/Nexy.dmg` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ–∑–∂–µ)

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- ‚úÖ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: Universal 2 (arm64 + x86_64), macOS 26.0.1 (Sequoia)
- ‚úÖ Python: 3.13.7 Universal 2 (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π pkg)
- ‚úÖ PyInstaller: 6.16.0
- ‚úÖ –í—Å–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏: Universal 2 (arm64 + x86_64)
- ‚úÖ –í—Å–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã: –≤–∞–ª–∏–¥–Ω—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è: `packaging/build_final.sh` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é Universal 2 —Å–±–æ—Ä–∫—É

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**
- ‚úÖ –î–≤–æ–π–Ω–∞—è —Å–±–æ—Ä–∫–∞ PyInstaller (arm64 + x86_64)
- ‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `scripts/create_universal_app.py`
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª–∏–∑–∞—Ü–∏—è .so —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `scripts/merge_so_from_x86_64.py`
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å —á–µ—Ä–µ–∑ `scripts/sign_all_binaries.sh`
- ‚úÖ –ù–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏—è .app –∏ PKG

---

## üìã –û–ë–©–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 1. –¢–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:** –§–æ–Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –∏–∫–æ–Ω–∫–æ–π –≤ menu bar
- **LSUIElement:** `True` (—Å–∫—Ä—ã—Ç–æ –∏–∑ Dock, —Ç–æ–ª—å–∫–æ menu bar)
- **Bundle type:** `.app` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π macOS bundle)
- **–£–ø–∞–∫–æ–≤—â–∏–∫:** PyInstaller 6.16.0+
- **–†–µ–∂–∏–º —É–ø–∞–∫–æ–≤–∫–∏:** `onedir` (bundle —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏)

### 2. –¶–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Universal 2 (arm64 + x86_64)
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è macOS:** 11.0 (Big Sur) –¥–ª—è –æ–±–µ–∏—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –≤–µ—Ä—Å–∏—è:** 12.0+ (Monterey –∏ –≤—ã—à–µ)
- **Python –≤–µ—Ä—Å–∏—è:** 3.13.7 (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞)
- ‚ö†Ô∏è Arm64-only —Å–±–æ—Ä–∫–∏ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- `pyenv 2.6+` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ (—á–µ—Ä–µ–∑ Homebrew) –±–µ–∑ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
- –í –∫–æ—Ä–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è `.python-version` ‚Üí `3.13.7`, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è arm64/x86_64.
- –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ª—é–±—ã—Ö packaging-—Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `eval "$(pyenv init -)"`, —á—Ç–æ–±—ã `python3` —Ä–µ–∑–æ–ª–≤–∏–ª—Å—è —á–µ—Ä–µ–∑ pyenv shims.
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ pyenv-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä: `python3 -m pip install -r requirements.txt` –∏ `arch -x86_64 python3 -m pip install -r requirements.txt`.

### 3. –†–∞–∑–º–µ—Ä –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä bundle:** 300 MB
- **–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:** < 5 —Å–µ–∫—É–Ω–¥
- **–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ RAM:** < 200 MB –≤ idle
- **–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU:** < 5% –≤ idle

---

## ‚úÖ –ü–†–ï–î–°–ë–û–†–ù–´–ï –ü–†–û–í–ï–†–ö–ò (Pre-flight)

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º PyInstaller –∏ –ø–æ–¥–ø–∏—Å–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–π—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. `python3 scripts/check_dependencies.py` ‚Äî —Å–≤–µ—Ä—è–µ—Ç –≤–µ—Ä—Å–∏–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö Python-–±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –≤ `resources/` —Å–æ–¥–µ—Ä–∂–∞—Ç **arm64** –∏ **x86_64** —Å—Ä–µ–∑—ã (`lipo`).
2. `python3 -m pytest tests/packaging` (–µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã) ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ smoke-—Ç–µ—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π Python 3.13: `python3 -c "import platform; print(platform.machine())"` –¥–æ–ª–∂–Ω–æ –≤—ã–¥–∞–≤–∞—Ç—å `arm64` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ–¥ Apple Silicon –∏ `x86_64` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ Rosetta.
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ release-–Ω–æ—Ç–∞—Ö; –ø—Ä–∏ –ª—é–±–æ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–∏ —Å–±–æ—Ä–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –¥–æ —Ñ–∏–∫—Å–∞ –ø—Ä–æ–±–ª–µ–º—ã.

---

## üîÅ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –°–ë–û–†–ö–ê (arm64 + x86_64) - –ê–í–¢–û–ú–ê–¢–ò–ó–ò–†–û–í–ê–ù–ê

**–ö—Ä–∏—Ç–µ—Ä–∏–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:** –æ–¥–∏–Ω –Ω–∞–±–æ—Ä —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (`.app/.dmg/.pkg`), –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç smoke-—Ç–µ—Å—Ç—ã –Ω–∞ Apple Silicon –∏ Intel/Rosetta –±–µ–∑ –ø–æ–¥–º–µ–Ω—ã –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤.

**‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:** –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ `packaging/build_final.sh`

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å (—á–µ—Ä–µ–∑ build_final.sh):

1. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**
   - ‚úÖ `scripts/check_dependencies.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Universal Python 3.13.7

2. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª–∏–∑–∞—Ü–∏—è .so —Ñ–∞–π–ª–æ–≤** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `/tmp/x86_64_site_packages`
   - ‚úÖ –í—ã–∑–æ–≤ `scripts/merge_so_from_x86_64.py` –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö .so

3. **–î–≤–æ–π–Ω–æ–π –ø—Ä–æ–≥–æ–Ω PyInstaller**
   - ‚úÖ arm64: `PYI_TARGET_ARCH=arm64 python3 -m PyInstaller packaging/Nexy.spec --distpath dist-arm64 --workpath build-arm64 --clean`
   - ‚úÖ x86_64: `PYI_TARGET_ARCH=x86_64 arch -x86_64 python3 -m PyInstaller packaging/Nexy.spec --distpath dist-x86_64 --workpath build-x86_64 --clean`

4. **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –±–∞–Ω–¥–ª–∞**
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ `scripts/create_universal_app.py --arm64 dist-arm64/Nexy.app --x86 dist-x86_64/Nexy.app --output dist/Nexy.app --verbose`
   - ‚úÖ –°–∫—Ä–∏–ø—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –í–°–ï Mach-O —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ `lipo -create`
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —á–µ—Ä–µ–∑ `lipo -info`

5. **–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è**
   - ‚úÖ –ü–æ–¥–ø–∏—Å—å —á–µ—Ä–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `scripts/sign_all_binaries.sh`
   - ‚úÖ –ù–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏—è .app –∏ PKG
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

### –†—É—á–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):

–°–º. `Docs/PACKAGING_FINAL_GUIDE.md` —Ä–∞–∑–¥–µ–ª 3 –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.

### –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã:

- **Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Universal Python 3.13.7 –∏–∑ `/Library/Frameworks/Python.framework/Versions/3.13/bin`
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª–∏–∑–∞—Ü–∏—è .so:** –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è x86_64 —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏:** –ü—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–ª—è PKG –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ditto` –ë–ï–ó `--noextattr`
- **Smoke-—Ç–µ—Å—Ç—ã:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –Ω–∞ –æ–±–µ–∏—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Ö –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 1. –ë–ò–ù–ê–†–ù–´–ï –§–ê–ô–õ–´ (Executables)

#### 1.1 FFmpeg
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞—É–¥–∏–æ –¥–ª—è pydub (MP3 ‚Üí WAV –∏ –æ–±—Ä–∞—Ç–Ω–æ)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Mach-O Universal 2 (arm64 + x86_64)
- ‚úÖ **–ü—É—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ:** `resources/ffmpeg/ffmpeg`
- ‚úÖ **–ü—É—Ç—å –≤ bundle:** `Contents/Resources/resources/ffmpeg/ffmpeg`
- ‚úÖ **–ò—Å—Ö–æ–¥–Ω—ã–µ —Å—Ä–µ–∑—ã:** `vendor_binaries/ffmpeg/arm64/ffmpeg`, `vendor_binaries/ffmpeg/x86_64/ffmpeg`
- ‚úÖ **–†–∞–∑–º–µ—Ä:** ~40-50 MB (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞)
- ‚úÖ **–ü—Ä–∞–≤–∞:** –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π (`chmod +x`)
- ‚úÖ **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ (–±–µ–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫)
- ‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** –î–æ –ø–µ—Ä–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è pydub (–≤ `main.py:19-64`)
- ‚úÖ **Code signing:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
lipo -info resources/ffmpeg/ffmpeg
# –û–∂–∏–¥–∞–µ—Ç—Å—è: Architectures in the fat file: arm64 x86_64
file resources/ffmpeg/ffmpeg
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å fat binary (Universal)

./resources/ffmpeg/ffmpeg -version
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –≤–µ—Ä—Å–∏—è –∏ —Å–ø–∏—Å–æ–∫ –∫–æ–¥–µ–∫–æ–≤

otool -L resources/ffmpeg/ffmpeg
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –º–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ)
```

---

#### 1.2 SwitchAudioSource
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞—É–¥–∏–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–∞ macOS

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Mach-O Universal 2 (arm64 + x86_64)
- ‚úÖ **–ü—É—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ:** `resources/audio/SwitchAudioSource`
- ‚úÖ **–ü—É—Ç—å –≤ bundle:** `Contents/Resources/resources/audio/SwitchAudioSource`
- ‚úÖ **–ò—Å—Ö–æ–¥–Ω—ã–µ —Å—Ä–µ–∑—ã:** `vendor_binaries/switchaudio/arm64/SwitchAudioSource`, `vendor_binaries/switchaudio/x86_64/SwitchAudioSource`
- ‚úÖ **–†–∞–∑–º–µ—Ä:** ~100-500 KB
- ‚úÖ **–ü—Ä–∞–≤–∞:** –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π (`chmod +x`)
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –†–µ–∑–µ—Ä–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã macOS)
- ‚úÖ **Code signing:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
lipo -info resources/audio/SwitchAudioSource
# –û–∂–∏–¥–∞–µ—Ç—Å—è: Architectures in the fat file: arm64 x86_64

./resources/audio/SwitchAudioSource -a
# –û–∂–∏–¥–∞–µ—Ç—Å—è: —Å–ø–∏—Å–æ–∫ –∞—É–¥–∏–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
```

---

#### 1.3 FLAC Encoder (–¥–ª—è SpeechRecognition)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ –≤ FLAC –¥–ª—è Google Speech API

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ **–í–µ—Ä—Å–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:** SpeechRecognition 3.14.3+
- ‚úÖ **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π FLAC:** –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –ø–∞–∫–µ—Ç–µ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Universal 2 (arm64 + x86_64), –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–π –±–∏–Ω–∞—Ä–Ω–∏–∫ `resources/audio/flac`
- ‚úÖ **–ò—Å—Ö–æ–¥–Ω—ã–µ —Å—Ä–µ–∑—ã:** `vendor_binaries/flac/arm64/flac`, `vendor_binaries/flac/x86_64/flac`
- ‚úÖ **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Python encoder

**–í–û–ü–†–û–°:** –£—Ç–æ—á–Ω–∏—Ç—å –ø—É—Ç—å –∫ –Ω–æ–≤–æ–º—É FLAC encoder

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python3 -c "import speech_recognition as sr; print(sr.__file__)"
ls -la .venv/lib/python3.13/site-packages/speech_recognition/

# –ü–æ–∏—Å–∫ FLAC
find .venv/lib/python3.13/site-packages/speech_recognition/ -name "*flac*"
lipo -info resources/audio/flac  # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–π –±–∏–Ω–∞—Ä–Ω–∏–∫
```

---

### 2. PYTHON –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

#### 2.1 –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï)

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
|------------|--------|------------|-------------|
| **PyObjC-core** | 11.1 | macOS API –¥–æ—Å—Ç—É–ø | arm64 |
| **PyObjC-framework-Cocoa** | 11.1 | Cocoa —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ | arm64 |
| **PyObjC-framework-Quartz** | 11.1 | Quartz (keyboard, screen) | arm64 |
| **PyObjC-framework-AVFoundation** | 11.1 | Audio/Video | arm64 |
| **rumps** | 0.4.0 | Menu bar –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | pure Python |
| **grpcio** | 1.75.1 | gRPC –∫–ª–∏–µ–Ω—Ç | arm64 |
| **grpcio-tools** | 1.75.1 | Proto –∫–æ–º–ø–∏–ª—è—Ü–∏—è | arm64 |
| **protobuf** | 6.32.1 | Protocol Buffers | pure Python |
| **SpeechRecognition** | 3.14.3 | –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ | pure Python |
| **PyAudio** | 0.2.14 | –ú–∏–∫—Ä–æ—Ñ–æ–Ω –∑–∞—Ö–≤–∞—Ç | arm64 |
| **pydub** | 0.25.1 | –ê—É–¥–∏–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ | pure Python |
| **sounddevice** | 0.5.2 | –ê—É–¥–∏–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ | arm64 |
| **pynput** | 1.8.1 | Keyboard/mouse –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | arm64 |
| **mss** | 10.1.0 | Screenshot –∑–∞—Ö–≤–∞—Ç | arm64 |
| **psutil** | 7.1.0 | –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | arm64 |
| **aiohttp** | 3.12.15 | Async HTTP –∫–ª–∏–µ–Ω—Ç | pure Python |
| **PyYAML** | 6.0.3 | YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | pure Python |
| **Pillow** | 11.3.0 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | arm64 |
| **numpy** | 2.3.3 | –ß–∏—Å–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | arm64 |

#### 2.2 –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|--------|------------|
| **pyinstaller** | 6.16.0 | –£–ø–∞–∫–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| **pyinstaller-hooks-contrib** | 2025.9 | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ hooks |
| **altgraph** | 0.17.4 | –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| **macholib** | 1.16.3 | Mach-O —Ñ–∞–π–ª—ã |

#### 2.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
```bash
# –í—Å–µ –ø–∞–∫–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å arm64
pip list | grep -E "(PyObjC|grpcio|PyAudio|sounddevice|pynput|mss|numpy|Pillow)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è Intel-only –±–∏–±–ª–∏–æ—Ç–µ–∫
python3 -c "import platform; print(platform.machine())"
# –û–∂–∏–¥–∞–µ—Ç—Å—è: arm64

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –∏ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤
python3 scripts/check_dependencies.py
```

---

### 3. –†–ï–°–£–†–°–´ (Assets & Config)

#### 3.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- ‚úÖ **–§–∞–π–ª:** `config/unified_config.yaml`
- ‚úÖ **–ü—É—Ç—å –≤ bundle:** `Contents/Resources/config/unified_config.yaml`
- ‚úÖ **–†–∞–∑–º–µ—Ä:** ~10 KB
- ‚úÖ **–§–æ—Ä–º–∞—Ç:** YAML
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –ø–µ—Ä–µ–¥ —É–ø–∞–∫–æ–≤–∫–æ–π
- ‚úÖ **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `app.bundle_id`: com.nexy.assistant
  - `app.version`: 1.71.0
  - `integrations.grpc_client.server`: production
  - `tray.icon_active`: assets/icons/active.png
  - `tray.icon_inactive`: assets/icons/off.png

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- ‚úÖ `config/tray_config.yaml` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python3 -c "import yaml; yaml.safe_load(open('config/unified_config.yaml'))"
```

---

#### 3.2 –ò–∫–æ–Ω–∫–∏ (Icons)

**–ò–∫–æ–Ω–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
- ‚úÖ **–§–∞–π–ª:** `assets/logo.icns` –∏–ª–∏ `assets/icons/app.icns`
- ‚úÖ **–§–æ—Ä–º–∞—Ç:** Apple ICNS
- ‚úÖ **–†–∞–∑–º–µ—Ä—ã:** 16x16, 32x32, 128x128, 256x256, 512x512, 1024x1024
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –í `Nexy.spec` –ø–∞—Ä–∞–º–µ—Ç—Ä `icon=`

**Menu Bar –∏–∫–æ–Ω–∫–∏:**
- ‚úÖ **–ê–∫—Ç–∏–≤–Ω–∞—è:** `assets/icons/active.png` (18x18 –∏–ª–∏ 36x36@2x)
- ‚úÖ **–ù–µ–∞–∫—Ç–∏–≤–Ω–∞—è:** `assets/icons/off.png` (18x18 –∏–ª–∏ 36x36@2x)
- ‚úÖ **Retina:** `active@2x.png`, `off@2x.png` (36x36)
- ‚úÖ **–§–æ—Ä–º–∞—Ç:** PNG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
- ‚úÖ **–¶–≤–µ—Ç:** Template image (—á–µ—Ä–Ω–æ-–±–µ–ª–∞—è –¥–ª—è –∞–≤—Ç–æ-—Ç–µ–º—ã)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
file assets/logo.icns
# –û–∂–∏–¥–∞–µ—Ç—Å—è: Apple Icon Image

file assets/icons/active.png
# –û–∂–∏–¥–∞–µ—Ç—Å—è: PNG image data

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
sips -g pixelWidth -g pixelHeight assets/icons/active.png
```

---

#### 3.3 –ê—É–¥–∏–æ —Ñ–∞–π–ª—ã

**Welcome —Å–æ–æ–±—â–µ–Ω–∏–µ:**
- ‚úÖ **–§–∞–π–ª:** `resources/audio/welcome_en.mp3` –∏–ª–∏ `.wav`
- ‚úÖ **–ü—É—Ç—å –≤ bundle:** `Contents/Resources/resources/audio/`
- ‚úÖ **–§–æ—Ä–º–∞—Ç:** MP3 –∏–ª–∏ WAV (PCM 16-bit)
- ‚úÖ **Sample rate:** 48000 Hz (—Å–æ–≥–ª–∞—Å–Ω–æ config)
- ‚úÖ **Channels:** 1 (mono)
- ‚úÖ **–†–∞–∑–º–µ—Ä:** < 500 KB
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–æ–ª–∂–µ–Ω –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
ls -lh resources/audio/welcome_en.*
afplay resources/audio/welcome_en.mp3  # –¢–µ—Å—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
```

---

#### 3.4 gRPC Proto –º–æ–¥—É–ª–∏

**Proto —Ñ–∞–π–ª—ã:**
- ‚úÖ **streaming_pb2.py:** `modules/grpc_client/proto/streaming_pb2.py`
- ‚úÖ **streaming_pb2_grpc.py:** `modules/grpc_client/proto/streaming_pb2_grpc.py`
- ‚úÖ **–ü—É—Ç—å –≤ bundle:** `Contents/Resources/modules/grpc_client/proto/`
- ‚úÖ **–í–µ—Ä—Å–∏—è protobuf:** 6.32.1 (—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python3 -c "from modules.grpc_client.proto import streaming_pb2, streaming_pb2_grpc; print('OK')"
```

---

### 4. –†–ê–ó–†–ï–®–ï–ù–ò–Ø macOS (Permissions)

#### 4.1 –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ API

| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª | API/Framework | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ TCC | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|------------|---------------|----------------|-------------|
| **–ú–∏–∫—Ä–æ—Ñ–æ–Ω** | PyAudio, CoreAudio | Microphone | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| **Keyboard –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | pynput, Quartz | Accessibility + Input Monitoring | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| **Screenshot –∑–∞—Ö–≤–∞—Ç** | mss, Quartz | Screen Recording | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| **Audio –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ** | sounddevice, AVFoundation | - | üü¢ –ù–µ —Ç—Ä–µ–±—É–µ—Ç |
| **Menu bar** | rumps, Cocoa | - | üü¢ –ù–µ —Ç—Ä–µ–±—É–µ—Ç |
| **Network** | grpcio, aiohttp | - | üü¢ –ù–µ —Ç—Ä–µ–±—É–µ—Ç |
| **Apple Events** | (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) | Apple Events | üü° –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |

#### 4.2 Info.plist (Usage Descriptions)

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï:**
```xml
<key>NSMicrophoneUsageDescription</key>
<string>Nexy –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</string>

<key>NSScreenCaptureUsageDescription</key>
<string>Nexy –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø–æ–º–æ—â–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</string>

<key>NSInputMonitoringUsageDescription</key>
<string>Nexy –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø—Ä–æ–±–µ–ª)</string>
```

**–û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï:**
```xml
<key>NSAppleEventsUsageDescription</key>
<string>Nexy –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Apple Events –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VoiceOver</string>

<key>NSCameraUsageDescription</key>
<string>Nexy –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–º–µ—Ä—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</string>
```

**–°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï:**
```xml
<key>LSUIElement</key>
<true/>  <!-- –°–∫—Ä—ã—Ç—å –∏–∑ Dock, —Ç–æ–ª—å–∫–æ menu bar -->

<key>CFBundleShortVersionString</key>
<string>1.71.0</string>

<key>CFBundleVersion</key>
<string>1.71.0</string>

<key>CFBundleIdentifier</key>
<string>com.nexy.assistant</string>
```

#### 4.3 Entitlements (–¥–ª—è Code Signing)

**–§–∞–π–ª:** `packaging/entitlements.plist`

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï entitlements:**
```xml
<!-- –ú–∏–∫—Ä–æ—Ñ–æ–Ω -->
<key>com.apple.security.device.microphone</key>
<true/>

<key>com.apple.security.device.audio-input</key>
<true/>

<!-- Network –¥–ª—è gRPC -->
<key>com.apple.security.network.client</key>
<true/>

<!-- PyInstaller —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è -->
<key>com.apple.security.cs.disable-library-validation</key>
<true/>

<key>com.apple.security.cs.allow-jit</key>
<true/>

<key>com.apple.security.cs.allow-unsigned-executable-memory</key>
<true/>

<key>com.apple.security.cs.allow-dyld-environment-variables</key>
<true/>

<!-- Sandbox –í–´–ö–õ–Æ–ß–ï–ù (–≤–Ω–µ App Store) -->
<key>com.apple.security.app-sandbox</key>
<false/>
```

**–û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï entitlements:**
```xml
<!-- Apple Events (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) -->
<key>com.apple.security.automation.apple-events</key>
<true/>

<!-- –ö–∞–º–µ—Ä–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) -->
<key>com.apple.security.device.camera</key>
<true/>

<!-- –§–∞–π–ª–æ–≤—ã–π –¥–æ—Å—Ç—É–ø -->
<key>com.apple.security.files.user-selected.read-write</key>
<true/>
```

---

### 5. –°–ü–ï–¶–ò–§–ò–ö–ê macOS

#### 5.1 PyObjC Fix (NSMakeRect)

**–ü—Ä–æ–±–ª–µ–º–∞:** PyInstaller + rumps –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π `dlsym cannot find symbol NSMakeRect`

**–†–µ—à–µ–Ω–∏–µ:** –í `main.py` –î–û –∏–º–ø–æ—Ä—Ç–∞ rumps:
```python
try:
    import AppKit
    import Foundation
    # –ö–æ–ø–∏—Ä—É–µ–º NSMakeRect –∏–∑ AppKit –≤ Foundation
    if not hasattr(Foundation, "NSMakeRect"):
        Foundation.NSMakeRect = getattr(AppKit, "NSMakeRect", None)
    if not hasattr(Foundation, "NSMakePoint"):
        Foundation.NSMakePoint = getattr(AppKit, "NSMakePoint", None)
    if not hasattr(Foundation, "NSMakeSize"):
        Foundation.NSMakeSize = getattr(AppKit, "NSMakeSize", None)
    if not hasattr(Foundation, "NSMakeRange"):
        Foundation.NSMakeRange = getattr(AppKit, "NSMakeRange", None)
except Exception:
    pass
```

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `main.py:69-83`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python3 -c "import sys; sys.path.insert(0, '.'); import main; import rumps; print('OK')"
```

---

## üßæ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö-–õ–ò–°–¢ –ü–ï–†–ï–î –†–ï–õ–ò–ó–û–ú

1. `python3 scripts/check_dependencies.py` ‚Äî —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ª–æ–≥.
2. `lipo -info dist/Nexy.app/Contents/MacOS/Nexy` –∏ `lipo -info dist/Nexy.app/Contents/Resources/resources/ffmpeg/ffmpeg` ‚Üí `arm64 x86_64`.
3. Smoke-—Ç–µ—Å—Ç—ã –Ω–∞ Apple Silicon –∏ Intel/Rosetta —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –≤ release-–Ω–æ—Ç–∞—Ö.
4. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è `.app/.dmg/.pkg` –∏–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏ (–Ω–µ `.ipa`).
5. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—É–Ω–∫—Ç–æ–≤ 1‚Äì4 –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ ‚úÖ.

---

#### 5.2 FFmpeg Initialization

**–ü—Ä–æ–±–ª–µ–º–∞:** pydub –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç FFmpeg –≤ —É–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

**–†–µ—à–µ–Ω–∏–µ:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ `main.py` –î–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è pydub:
```python
def init_ffmpeg_for_pydub():
    # –ü–æ–∏—Å–∫ –≤ PyInstaller –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö:
    # 1. sys._MEIPASS (onefile)
    # 2. Contents/Resources (bundle)
    # 3. Dev-—Ä–µ–∂–∏–º (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—É—Ç–∏
    os.environ["FFMPEG_BINARY"] = str(ffmpeg_path)
    AudioSegment.converter = str(ffmpeg_path)
```

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `main.py:19-64`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python3 -c "
from pathlib import Path
import os, sys
sys.path.insert(0, '.')
import main
from pydub import AudioSegment
print('FFmpeg:', AudioSegment.converter)
"
```

---

#### 5.3 LSUIElement (Menu Bar —Ä–µ–∂–∏–º)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ menu bar –ë–ï–ó –∏–∫–æ–Ω–∫–∏ –≤ Dock

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** –í `Nexy.spec` ‚Üí `BUNDLE` ‚Üí `info_plist`:
```python
'LSUIElement': True
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- ‚úÖ –ò–∫–æ–Ω–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ menu bar
- ‚úÖ –ù–ï–¢ –∏–∫–æ–Ω–∫–∏ –≤ Dock
- ‚úÖ –ù–ï–¢ –≤ Command+Tab –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É–ø–∞–∫–æ–≤–∫–∏:**
```bash
defaults read dist/Nexy.app/Contents/Info.plist LSUIElement
# –û–∂–∏ÔøΩÔøΩ–∞–µ—Ç—Å—è: 1
```

---

#### 5.4 Hardened Runtime

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –î–ª—è –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ Apple –Ω–µ–æ–±—Ö–æ–¥–∏–º Hardened Runtime

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** –ü—Ä–∏ code signing:
```bash
codesign --options=runtime ...
```

**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å PyInstaller:**
- –¢—Ä–µ–±—É–µ—Ç entitlement: `com.apple.security.cs.disable-library-validation`
- –¢—Ä–µ–±—É–µ—Ç entitlement: `com.apple.security.cs.allow-jit`
- –¢—Ä–µ–±—É–µ—Ç entitlement: `com.apple.security.cs.allow-unsigned-executable-memory`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
codesign -d -vvv --entitlements - dist/Nexy.app
```

---

### 6. CODE SIGNING –ò NOTARIZATION

#### 6.1 –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

**–¢–†–ï–ë–£–Æ–¢–°–Ø:**
- ‚úÖ **Developer ID Application:** `Developer ID Application: Sergiy Zasorin (5NKLL2CLB9)`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü–æ–¥–ø–∏—Å—å .app bundle

- ‚úÖ **Developer ID Installer:** `Developer ID Installer: Sergiy Zasorin (5NKLL2CLB9)`
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü–æ–¥–ø–∏—Å—å .pkg installer

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è:**
```bash
security find-identity -v -p codesigning | grep "Developer ID Application"
security find-identity -v -p basic | grep "Developer ID Installer"
```

**–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–µ –∏—Å—Ç–µ–∫–ª–∏

---

#### 6.2 –ü–æ—Ä—è–¥–æ–∫ –ø–æ–¥–ø–∏—Å–∏

**–í–ê–ñ–ù–û:** –ü–æ–¥–ø–∏—Å—å –°–¢–†–û–ì–û –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

1. **–í–ª–æ–∂–µ–Ω–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏** (–ë–ï–ó entitlements):
   ```bash
   codesign --force --timestamp --options=runtime \
     --sign "Developer ID Application: Sergiy Zasorin" \
     dist/Nexy.app/Contents/Resources/resources/ffmpeg/ffmpeg

   codesign --force --timestamp --options=runtime \
     --sign "Developer ID Application: Sergiy Zasorin" \
     dist/Nexy.app/Contents/Resources/resources/audio/SwitchAudioSource
   ```

2. **–ì–ª–∞–≤–Ω—ã–π executable** (–° entitlements):
   ```bash
   codesign --force --timestamp --options=runtime \
     --entitlements packaging/entitlements.plist \
     --sign "Developer ID Application: Sergiy Zasorin" \
     dist/Nexy.app/Contents/MacOS/Nexy
   ```

3. **–í–µ—Å—å bundle** (–° entitlements):
   ```bash
   codesign --force --timestamp --options=runtime \
     --entitlements packaging/entitlements.plist \
     --sign "Developer ID Application: Sergiy Zasorin" \
     dist/Nexy.app
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
codesign --verify --deep --strict --verbose=2 dist/Nexy.app
spctl --assess --type execute --verbose dist/Nexy.app
```

---

#### 6.3 Notarization

**–¢–†–ï–ë–£–ï–¢–°–Ø:**
- ‚úÖ Apple ID: `seregawpn@gmail.com`
- ‚úÖ App-specific password (—Å–æ–∑–¥–∞—Ç—å –Ω–∞ appleid.apple.com)
- ‚úÖ Keychain profile: `nexy-notary`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ keychain profile:**
```bash
xcrun notarytool store-credentials "nexy-notary" \
  --apple-id "seregawpn@gmail.com" \
  --team-id "5NKLL2CLB9" \
  --password "<app-specific-password>"
```

**–ü—Ä–æ—Ü–µ—Å—Å –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏:**
```bash
# 1. –°–æ–∑–¥–∞—Ç—å ZIP
ditto -c -k --noextattr --noqtn dist/Nexy.app Nexy.zip

# 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏—é
xcrun notarytool submit Nexy.zip \
  --keychain-profile "nexy-notary" \
  --wait

# 3. –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –ø–µ—á–∞—Ç—å
xcrun stapler staple dist/Nexy.app

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
xcrun stapler validate dist/Nexy.app
```

**–í—Ä–µ–º—è:** 5-30 –º–∏–Ω—É—Ç (–æ–∂–∏–¥–∞–Ω–∏–µ Apple)

---

### 7. –°–¢–†–£–ö–¢–£–†–ê BUNDLE

#### 7.1 –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ .app

```
Nexy.app/
‚îú‚îÄ‚îÄ Contents/
‚îÇ   ‚îú‚îÄ‚îÄ Info.plist                    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ MacOS/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Nexy                      # –ì–ª–∞–≤–Ω—ã–π executable
‚îÇ   ‚îú‚îÄ‚îÄ Resources/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ unified_config.yaml   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icons/                # –ò–∫–æ–Ω–∫–∏ menu bar
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logo.icns             # –ò–∫–æ–Ω–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ffmpeg/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ffmpeg            # FFmpeg –±–∏–Ω–∞—Ä–Ω–∏–∫
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audio/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ SwitchAudioSource # Audio switcher
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ welcome_en.mp3    # Welcome —Å–æ–æ–±—â–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ grpc_client/proto/    # gRPC proto –º–æ–¥—É–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [PyInstaller –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏]
‚îÇ   ‚îî‚îÄ‚îÄ Frameworks/                   # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
```

#### 7.2 –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ bundle

**Info.plist:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è PyInstaller –∏–∑ `BUNDLE` —Å–µ–∫—Ü–∏–∏ –≤ `Nexy.spec`
- –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ Usage Descriptions
- –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `LSUIElement = True`

**Executable:**
- `Contents/MacOS/Nexy` - –≥–ª–∞–≤–Ω—ã–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω —Å entitlements
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: arm64

**–†–µ—Å—É—Ä—Å—ã:**
- –í—Å–µ —Ñ–∞–π–ª—ã –∏–∑ `datas` –≤ spec
- –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ PyInstaller resource path –ª–æ–≥–∏–∫—É

---

### 8. PyInstaller SPEC –¢–†–ï–ë–û–í–ê–ù–ò–Ø

#### 8.1 –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**Analysis:**
```python
a = Analysis(
    ['main.py'],                      # Entry point
    pathex=[str(client_dir)],         # –ü—É—Ç—å –∫ –º–æ–¥—É–ª—è–º
    binaries=[...],                   # –ë–∏–Ω–∞—Ä–Ω–∏–∫–∏ (FFmpeg, etc)
    datas=[...],                      # –†–µ—Å—É—Ä—Å—ã (config, assets, etc)
    hiddenimports=[...],              # –ù–µ–æ—á–µ–≤–∏–¥–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
    hookspath=[],                     # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ hooks
    runtime_hooks=[],                 # Runtime hooks
    excludes=[],                      # –ò—Å–∫–ª—é—á–∏—Ç—å –Ω–µ–Ω—É–∂–Ω–æ–µ
    noarchive=False,
)
```

**EXE:**
```python
exe = EXE(
    pyz,
    a.scripts,
    [],
    exclude_binaries=True,            # onedir mode (–ù–ï onefile!)
    name='Nexy',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,                      # –ù–µ strip –¥–ª—è arm64
    upx=False,                        # –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UPX
    console=False,                    # GUI app (–Ω–µ –∫–æ–Ω—Å–æ–ª—å)
    disable_windowed_traceback=False,
    argv_emulation=False,
    target_arch='arm64',              # Apple Silicon
    codesign_identity=None,           # –ü–æ–¥–ø–∏—Å—å –æ—Ç–¥–µ–ª—å–Ω–æ
)
```

**BUNDLE:**
```python
app = BUNDLE(
    coll,
    name='Nexy.app',
    icon='assets/logo.icns',          # –ò–∫–æ–Ω–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    bundle_identifier='com.nexy.assistant',
    version='1.71.0',
    info_plist={
        'LSUIElement': True,
        'NSMicrophoneUsageDescription': '...',
        'NSScreenCaptureUsageDescription': '...',
        'NSInputMonitoringUsageDescription': '...',
        'CFBundleShortVersionString': '1.71.0',
        'CFBundleVersion': '1.71.0',
    },
)
```

#### 8.2 –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ datas

```python
datas = [
    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ('config/unified_config.yaml', 'config'),

    # –†–µ—Å—É—Ä—Å—ã
    ('resources/ffmpeg', 'resources/ffmpeg'),
    ('resources/audio', 'resources/audio'),

    # Assets
    ('assets/icons', 'assets/icons'),
    ('assets/logo.icns', 'assets'),

    # gRPC Proto
    ('modules/grpc_client/proto/streaming_pb2.py', 'modules/grpc_client/proto'),
    ('modules/grpc_client/proto/streaming_pb2_grpc.py', 'modules/grpc_client/proto'),
]
```

#### 8.3 –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ binaries

```python
binaries = [
    ('resources/ffmpeg/ffmpeg', 'resources/ffmpeg'),
    ('resources/audio/SwitchAudioSource', 'resources/audio'),
]
```

#### 8.4 –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ hiddenimports

```python
hiddenimports = [
    # PyObjC (–¥–ª—è rumps –∏ macOS API)
    'AppKit',
    'Foundation',
    'Cocoa',
    'Quartz',
    'PyObjCTools',
    'objc',
    'PyObjCTools.AppHelper',

    # rumps
    'rumps',

    # gRPC
    'grpc',
    'grpc._cython.cygrpc',
    'google.protobuf',
    'google.protobuf.descriptor',
    'google.protobuf.descriptor_pb2',

    # Audio
    'pyaudio',
    'sounddevice',
    'pydub',
    'audioop',

    # SpeechRecognition
    'speech_recognition',

    # –î—Ä—É–≥–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ
    'mss',
    'PIL',
    'numpy',
    'aiohttp',
    'yaml',
]
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –¢–†–ï–ë–û–í–ê–ù–ò–Ø–ú

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —É–ø–∞–∫–æ–≤–∫–∏:

#### –ë–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ FFmpeg - arm64, –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π, —Ä–∞–±–æ—Ç–∞–µ—Ç (39MB)
- ‚úÖ SwitchAudioSource - arm64, –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π, —Ä–∞–±–æ—Ç–∞–µ—Ç (55KB)
- ‚úÖ FLAC encoder - –æ–±–Ω–æ–≤–ª—ë–Ω –¥–æ arm64 1.5.0 (452KB)

#### Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- ‚úÖ –í—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ .venv
- ‚úÖ –í—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å arm64
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤–µ—Ä—Å–∏–π
- ‚úÖ requirements.txt –∞–∫—Ç—É–∞–ª–µ–Ω

#### –†–µ—Å—É—Ä—Å—ã:
- ‚úÖ unified_config.yaml –≤–∞–ª–∏–¥–µ–Ω
- ‚úÖ –í—Å–µ –∏–∫–æ–Ω–∫–∏ –Ω–∞ –º–µ—Å—Ç–µ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- ‚úÖ Audio —Ñ–∞–π–ª—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è
- ‚úÖ gRPC proto –º–æ–¥—É–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è

#### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è:
- ‚úÖ entitlements.plist –ø–æ–ª–Ω—ã–π –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- ‚úÖ –í—Å–µ Usage Descriptions –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- ‚úÖ LSUIElement —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —É—á—Ç–µ–Ω–æ

#### –ö–æ–¥:
- ‚úÖ PyObjC fix –≤ main.py
- ‚úÖ FFmpeg init –≤ main.py
- ‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ù–µ—Ç circular dependencies
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –ü—É—Ç–∏ –¥–ª—è installed app (resource_path.py)

#### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
- ‚úÖ Developer ID Application –∞–∫—Ç—É–∞–ª–µ–Ω (5NKLL2CLB9)
- ‚úÖ Developer ID Installer –∞–∫—Ç—É–∞–ª–µ–Ω (5NKLL2CLB9)
- ‚úÖ Keychain profile –Ω–∞—Å—Ç—Ä–æ–µ–Ω (nexy-notary)

### –ü–æ—Å–ª–µ —É–ø–∞–∫–æ–≤–∫–∏:

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- ‚úÖ Nexy.app —Å–æ–∑–¥–∞–Ω (~200MB)
- ‚úÖ –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ Info.plist –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- ‚úÖ –†–∞–∑–º–µ—Ä —Ä–∞–∑—É–º–Ω—ã–π (<300MB)

#### Code Signing:
- ‚úÖ –í—Å–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã
- ‚úÖ Bundle –ø–æ–¥–ø–∏—Å–∞–Ω
- ‚úÖ –ü–æ–¥–ø–∏—Å—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ (`codesign --verify`)

#### Notarization:
- ‚úÖ –ù–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ (Accepted)
- ‚úÖ –ü–µ—á–∞—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∞ (stapled)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞ (`xcrun stapler validate`)

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ò–∫–æ–Ω–∫–∞ –≤ menu bar
- ‚úÖ –ù–ï–¢ –≤ Dock (LSUIElement —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ –ú–∏–∫—Ä–æ—Ñ–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Keyboard —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Screenshots —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Audio playback —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ gRPC –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîÑ –¢–ò–ü–û–í–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 1: NSMakeRect –Ω–µ –Ω–∞–π–¥–µ–Ω
**–°–∏–º–ø—Ç–æ–º:** –ü–∞–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å –æ—à–∏–±–∫–æ–π `dlsym cannot find symbol NSMakeRect`
**–†–µ—à–µ–Ω–∏–µ:** PyObjC fix –≤ main.py –î–û –∏–º–ø–æ—Ä—Ç–∞ rumps (—Å—Ç—Ä–æ–∫–∏ 69-83)
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 2: FFmpeg –Ω–µ –Ω–∞–π–¥–µ–Ω
**–°–∏–º–ø—Ç–æ–º:** pydub –æ—à–∏–±–∫–∞ `FileNotFoundError: [Errno 2] No such file or directory: 'ffmpeg'`
**–†–µ—à–µ–Ω–∏–µ:** init_ffmpeg_for_pydub() –≤ main.py (—Å—Ç—Ä–æ–∫–∏ 19-64)
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 3: gRPC proto –Ω–µ –Ω–∞–π–¥–µ–Ω
**–°–∏–º–ø—Ç–æ–º:** `ImportError: cannot import name 'streaming_pb2'`
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å proto —Ñ–∞–π–ª—ã –≤ `datas` –≤ spec, –¥–æ–±–∞–≤–∏—Ç—å –≤ `hiddenimports`
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ packaging/Nexy.spec

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 4: –ü—É—Ç–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–ù–û–í–ê–Ø!)
**–°–∏–º–ø—Ç–æ–º:** `FileNotFoundError` –¥–ª—è config/unified_config.yaml –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ /Applications/
**–ü—Ä–∏—á–∏–Ω–∞:** CWD –º–µ–Ω—è–µ—Ç—Å—è —Å dev-—Ä–µ–∂–∏–º–∞ –Ω–∞ /Applications/Nexy.app/Contents/MacOS/
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω integration/utils/resource_path.py, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 7 —Ñ–∞–π–ª–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–†–ò–¢–ò–ß–ù–û - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 5: –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è
**–°–∏–º–ø—Ç–æ–º:** –ù–µ—Ç –¥–∏–∞–ª–æ–≥–æ–≤ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Usage Descriptions –≤ Info.plist, –ø–æ–¥–ø–∏—Å–∞—Ç—å —Å entitlements
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ spec, –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 6: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Dock
**–°–∏–º–ø—Ç–æ–º:** –ò–∫–æ–Ω–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ Dock
**–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `LSUIElement = True` –≤ Info.plist (—á–µ—Ä–µ–∑ spec)
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ menu bar

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 7: –ù–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç
**–°–∏–º–ø—Ç–æ–º:** Rejection –æ—Ç Apple
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Hardened Runtime, –≤—Å–µ entitlements, –ø–æ–¥–ø–∏—Å—å –≤—Å–µ—Ö –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –ø–æ–¥–ø–∏—Å–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏—è Accepted

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 8: FLAC —É—Å—Ç–∞—Ä–µ–≤—à–∏–π (–ù–û–í–ê–Ø!)
**–°–∏–º–ø—Ç–æ–º:** `WARNING: Found binaries with invalid macOS SDK: flac-mac (10, 6, 0)`
**–ü—Ä–∏—á–∏–Ω–∞:** SpeechRecognition –≤–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞—Ä—ã–π x86_64 FLAC
**–†–µ—à–µ–Ω–∏–µ:** –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω FLAC 1.5.0 arm64, –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä –≤ spec
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, WARNING –∏—Å—á–µ–∑

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 9: numpy –æ—à–∏–±–∫–∞ (–ù–û–í–ê–Ø!)
**–°–∏–º–ø—Ç–æ–º:** `ModuleNotFoundError: No module named 'numpy'` –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–µ
**–ü—Ä–∏—á–∏–Ω–∞:** numpy –±—ã–ª –≤ excludes, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 11 —Ñ–∞–π–ª–∞—Ö
**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª—ë–Ω numpy –∏–∑ excludes –≤ spec
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, numpy –≤–∫–ª—é—á—ë–Ω –≤ bundle

---

## üìö –°–ü–†–ê–í–û–ß–ù–´–ï –°–°–´–õ–ö–ò

### Apple –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [Notarizing macOS Software Before Distribution](https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution)
- [Hardened Runtime](https://developer.apple.com/documentation/security/hardened_runtime)
- [App Sandbox](https://developer.apple.com/documentation/security/app_sandbox)
- [Entitlements](https://developer.apple.com/documentation/bundleresources/entitlements)

### PyInstaller –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [PyInstaller Manual](https://pyinstaller.org/en/stable/)
- [macOS-specific options](https://pyinstaller.org/en/stable/usage.html#macos-specific-options)
- [Runtime Information](https://pyinstaller.org/en/stable/runtime-information.html)

### PyObjC –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [PyObjC Documentation](https://pyobjc.readthedocs.io/)
- [rumps Documentation](https://rumps.readthedocs.io/)

---

## üéì –í–´–í–û–î–´ –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —É—Å–ø–µ—Ö–∞:

1. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∫ —Ä–µ—Å—É—Ä—Å–∞–º**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å resource_path.py –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –ò–∑–±–µ–≥–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π —Ç–∏–ø–∞ `config/file.yaml`
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ /Applications/

2. **–ü–æ–ª–Ω—ã–π spec —Ñ–∞–π–ª**
   - –í–∫–ª—é—á–∏—Ç—å –≤—Å–µ hiddenimports (50+)
   - –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ binaries —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
   - –ù–µ –∑–∞–±—ã—Ç—å data files –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤

3. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ**
   - –í—Å–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å arm64
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —á–µ—Ä–µ–∑ `file` –∏ `otool -L`
   - –û–±–Ω–æ–≤–ª—è—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

4. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å—å**
   - –ü–æ—Ä—è–¥–æ–∫: –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ ‚Üí executable ‚Üí bundle
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å entitlements –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ executable
   - Hardened Runtime –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏

### –î–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ä–µ–ª–∏–∑–æ–≤:

1. –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –≤ [config/unified_config.yaml](config/unified_config.yaml)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å spec –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å (–Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏ ‚Üí hiddenimports)
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å `./packaging/build_final.sh`
4. –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ `dist/` –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.0 (VERIFIED)
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-09
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-10-10
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´ –ò –ü–†–û–í–ï–†–ï–ù–´
