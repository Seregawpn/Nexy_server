# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: Preflight-—Ç–µ—Å—Ç First-Run Flow

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞: `python3 main.py`

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (3 —à–∞–≥–∞)

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
./scripts/preflight_first_run_test.sh
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç:
- ‚úÖ –°–±—Ä–æ—Å TCC —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (—Ç—Ä–µ–±—É–µ—Ç—Å—è sudo)
- ‚úÖ –û—á–∏—Å—Ç–∫—É —Ñ–ª–∞–≥–æ–≤ first-run
- ‚úÖ –í—ã–≤–µ–¥–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### 2. –ó–∞–ø—É—Å–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
python3 main.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
tail -f log.md | grep -E "permissions\.|restart"
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ Console.app:**
- –û—Ç–∫—Ä–æ–π—Ç–µ Console.app (Applications ‚Üí Utilities)
- –§–∏–ª—å—Ç—Ä: `Nexy` –∏–ª–∏ `com.nexy.assistant`

### 3. –í—ã–¥–∞—á–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

–í—ã–¥–∞–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É:

1. **Microphone** ‚Üí "Allow" (—Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏–∞–ª–æ–≥)
2. **Accessibility** ‚Üí "Open System Settings" ‚Üí –≤–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è Nexy
3. **Input Monitoring** ‚Üí "Open System Settings" ‚Üí –≤–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è Nexy
4. **Screen Capture** ‚Üí "Open System Settings" ‚Üí –≤–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è Nexy

## üìã –û–∂–∏–¥–∞–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π

```
1. permissions.first_run_started
2. permissions.status_checked (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è)
3. permissions.changed (–ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞)
4. permissions.first_run_restart_pending (–ø–æ—Å–ª–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π)
5. permission_restart.scheduled
6. [–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è]
7. permissions.first_run_completed (–ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞)
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ –ª–æ–≥–∞—Ö
./scripts/check_first_run_events.sh log.md

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–æ–≤
ls -la ~/Library/Application\ Support/Nexy/*.flag
```

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ –í—Å–µ —Å–æ–±—ã—Ç–∏—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç)
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∞ –∑–∞–Ω–æ–≤–æ

## üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `Docs/PREFLIGHT_TEST_GUIDE.md` –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
