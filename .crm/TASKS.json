{
  "workspace": "server",
  "id_prefix": "SRV",
  "next_id": 18,
  "tasks": [
    {
      "id": "SRV-001",
      "epicId": "EPIC-MVP",
      "title": "Validate session_id on gRPC server boundary",
      "status": "plan",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T11:33:30-05:00",
      "description": "## Цель\n\nОтклонять невалидный session_id на входе StreamAudio с корректным логом.\n\n## Definition of Done\n\n- сервер валидирует uuid4 session_id\n- невалидный session_id возвращает INVALID_ARGUMENT\n",
      "file_path": "server/modules/grpc_service/core/grpc_server.py"
    },
    {
      "id": "SRV-002",
      "epicId": "EPIC-MVP",
      "title": "Устранить серверное озвучивание при установке браузера",
      "status": "plan",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-01-18T00:00:00-05:00",
      "description": "## Цель\n\nУбрать локальные голосовые уведомления `say` на сервере и централизовать озвучивание в клиентском TTS.\n\n## Definition of Done\n\n- на сервере нет прямых вызовов `say` при установке браузера\n- прогресс установки не приводит к локальному аудио на сервере\n",
      "file_path": "server/server/modules/browser_use/module.py"
    },
    {
      "id": "SRV-003",
      "epicId": "EPIC-MVP",
      "title": "Stream browser_use as MCP command and allow in validator",
      "status": "plan",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T11:33:30-05:00",
      "description": "## Цель\n\nНе завершать поток раньше времени из-за валидации browser_use и маршрутизировать команду как MCP payload.\n\n## Definition of Done\n\n- ActionResponse принимает browser_use/close_browser\n- streaming_workflow не исполняет browser_use на сервере\n- MCP command_payload передается на клиент\n",
      "file_path": "server/server/integrations/core/response_models.py"
    },
    {
      "id": "SRV-004",
      "epicId": "EPIC-MVP",
      "title": "Уточнить правила browser_use vs websearch в system prompt",
      "status": "plan",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-01-19T12:30:08-05:00",
      "description": "## Цель\n\nУстранить конфликт правил между WebSearch и Browser Automation и уточнить условия использования browser_use.\n\n## Definition of Done\n\n- system prompt задает четкий выбор: websearch для фактов, browser_use для интерактивных задач\n- устранены конфликтующие инструкции про \"search\" в prompt\n- поведение валидатора/клиента остается совместимым\n",
      "file_path": "server/server/config/unified_config.py"
    },
    {
      "id": "SRV-005",
      "epicId": "EPIC-MVP",
      "title": "Диагностика ActionMessage command=unknown в gRPC pipeline",
      "status": "plan",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T11:33:30-05:00",
      "description": "## Цель\n\nЛокализовать место, где команда теряется и отправляется в ActionMessage как unknown.\n\n## Definition of Done\n\n- есть воспроизводимый тест на localhost\n- в логах видно место потери command\n- определен участок кода для фикса\n",
      "file_path": "server/server/modules/grpc_service/core/grpc_server.py"
    },
    {
      "id": "SRV-006",
      "epicId": "EPIC-MVP",
      "title": "Align EdgeTTS output format with unified audio format",
      "status": "plan",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-01T11:05:08",
      "description": "## Цель\n\nИспользовать единый формат аудио (sample_rate/channels/bits) из unified_config для EdgeTTS/GenerateWelcomeAudio.\n\n## Definition of Done\n\n- EdgeTTSProvider использует unified_config sample_rate/channels/bits\n- GenerateWelcomeAudio metadata соответствует реальному PCM формату\n",
      "file_path": "server/modules/audio_generation/providers/edge_tts_provider.py"
    },
    {
      "id": "SRV-007",
      "epicId": "EPIC-MVP",
      "title": "Deduplicate server main startup/shutdown checks",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T11:47:36-05:00",
      "description": "## Цель\n\nУбрать дубли проверки портов и двойную отмену задач в server/main.py; исключить утечку shutdown wait task.\n\n## Definition of Done\n\n- единая точка обработки занятых портов\n- metrics_task отменяется один раз\n- shutdown wait task не остается pending\n",
      "file_path": "server/main.py"
    },
    {
      "id": "SRV-008",
      "epicId": "EPIC-MVP",
      "title": "Fix async generator mock handling in gRPC integration",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T11:55:22-05:00",
      "description": "## Цель\n\nУстранить RuntimeWarning в тесте gRPC, корректно обрабатывая awaitable, возвращаемый моками process_request_streaming.\n\n## Definition of Done\n\n- async for работает и с awaitable, и с async iterable\n- warning в test_grpc_mcp_integration исчезает\n",
      "file_path": "server/integrations/service_integrations/grpc_service_integration.py"
    },
    {
      "id": "SRV-009",
      "epicId": "EPIC-MVP",
      "title": "Contract conflict hardening (session_id override, masking, gRPC priority)",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T12:13:22-05:00",
      "description": "## Цель\n\nПодтвердить контракт gRPC приоритетов, логировать/метрить session_id override, сузить маскирование ключей и добавить тесты.\n\n## Definition of Done\n\n- override session_id логируется и метрика фиксируется\n- маскирование не затрагивает keyboard/monkey\n- тесты на оба невалидных id и на non-secret key проходят\n",
      "file_path": "server/integrations/core/assistant_response_parser.py"
    },
    {
      "id": "SRV-010",
      "epicId": "EPIC-MVP",
      "title": "Sync feature flags docs and config",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T12:21:07-05:00",
      "description": "## Цель\n\nСинхронизировать Docs/FEATURE_FLAGS.md с фактическими флагами и прописать дефолты в config.env.\n\n## Definition of Done\n\n- Docs содержит WEB_SEARCH_ENABLED, PAYMENT_USE_ENABLED, SUBSCRIPTION_KILL_SWITCH, FORWARD_ASSISTANT_ACTIONS\n- Удален неработающий BROWSER_ENABLED\n- config.env содержит явные значения новых флагов\n",
      "file_path": "Docs/FEATURE_FLAGS.md"
    },
    {
      "id": "SRV-011",
      "epicId": "EPIC-MVP",
      "title": "Resolve audit conflicts in audio format and command validation",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T12:34:08-05:00",
      "description": "## Цель\n\nРазвести аудио dtype/codec и синхронизировать allowed_commands в fallback парсере.\n\n## Definition of Done\n\n- AUDIO_CODEC введен и используется для audio_format\n- fallback валидирует команды через get_allowed_commands\n",
      "file_path": "server/config/unified_config.py"
    },
    {
      "id": "SRV-012",
      "epicId": "EPIC-MVP",
      "title": "MCP order + audio dtype validation",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T12:41:13-05:00",
      "description": "## Цель\n\nЗакрепить порядок ActionMessage относительно text/audio и добавить валидацию dtype для AUDIO_FORMAT.\n\n## Definition of Done\n\n- ActionMessage отправляется после text/audio в рамках одного item\n- предупреждение при неверном dtype (pcm/mp3)\n",
      "file_path": "server/modules/grpc_service/core/grpc_server.py"
    },
    {
      "id": "SRV-013",
      "epicId": "EPIC-MVP",
      "title": "Finalize cleanup docs/tests for MCP order and audio contract",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T12:52:03-05:00",
      "description": "## Цель\n\nЗакрепить контракт MCP‑порядка и аудио dtype/codec в документации и добавить тест порядка ActionMessage.\n\n## Definition of Done\n\n- Документация MCP‑порядка и audio contract обновлена\n- Добавлен тест порядка ActionMessage\n",
      "file_path": "Docs/ARCHITECTURE_OVERVIEW.md"
    },
    {
      "id": "SRV-014",
      "epicId": "EPIC-MVP",
      "title": "Sync payment commands in system prompt",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T13:04:30-05:00",
      "description": "## Цель\n\nСинхронизировать allowed_commands в prompt с фактическими payment‑командами (buy_subscription + manage_subscription).\n\n## Definition of Done\n\n- build_system_prompt добавляет buy_subscription при payment_enabled\n- конфликт prompt/validator устранён\n",
      "file_path": "server/config/prompts.py"
    },
    {
      "id": "SRV-015",
      "epicId": "EPIC-MVP",
      "title": "Add quick_check script for fast fixes",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T13:31:43-05:00",
      "description": "## Цель\n\nДобавить быстрый скрипт проверок для ускорения фиксов.\n\n## Definition of Done\n\n- scripts/quick_check.sh существует\n- выполняет pytest server/tests -q и базовые проверки\n",
      "file_path": "server/scripts/quick_check.sh"
    },
    {
      "id": "SRV-016",
      "epicId": "EPIC-MVP",
      "title": "Expand quick_check script",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T13:45:27-05:00",
      "description": "## Цель\n\nРасширить quick_check.sh дополнительными sanity‑проверками (prompt vs allowed_commands, dtype/codec).\n\n## Definition of Done\n\n- quick_check.sh выполняет доп. проверки без падений\n",
      "file_path": "server/scripts/quick_check.sh"
    },
    {
      "id": "SRV-017",
      "epicId": "EPIC-MVP",
      "title": "Добавить intent-роутинг для web_search",
      "status": "released",
      "priority": "P1",
      "owner": "server",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T15:19:47-05:00",
      "description": "## Проблема\n\nWeb search не вызывается для явных запросов (\"последние новости\") из-за отсутствия серверного intent-роутинга.\n\n## Текущий прогресс\n\n- [x] Добавлен детектор intent для web search\n- [x] Форсирование use_search при триггерах\n- [x] Усилена директива для вызова google_search\n- [x] Проверка поведения на запросах\n\n## Следующие шаги\n\n1. Прогнать тестовый запрос \"найди последние новости\"\n2. Подтвердить лог intent=web_search\n",
      "file_path": "server/modules/text_processing/core/text_processor.py",
      "responsible_docs": [
        {
          "path": "Docs/ARCHITECTURE_OVERVIEW.md",
          "type": "reference",
          "description": "Архитектура и правила централизации"
        },
        {
          "path": "Docs/PROJECT_REQUIREMENTS.md",
          "type": "control",
          "description": "Общие требования проекта"
        }
      ]
    },
    {
      "id": "SRV-018",
      "epicId": "EPIC-MVP",
      "title": "Intent-based prompt section routing",
      "status": "in_progress",
      "priority": "P2",
      "created_by": "Codex",
      "modified_by": "Codex",
      "updated_at": "2026-02-03T15:52:14",
      "workspace": "server",
      "description": "Route prompt sections by request keywords; keep header/footer always; override system prompt per request.",
      "file_path": "server/config/prompts.py"
    }
  ]
}