# DefaultAudioManager

–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã macOS.

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–í–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞—É–¥–∏–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —ç—Ç–æ—Ç –º–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã macOS. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ù–µ—Ç —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –°–ª–µ–¥—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º macOS
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º–∏ macOS
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Å–∏—Å—Ç–µ–º–µ

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
DefaultAudioManager
‚îú‚îÄ‚îÄ DefaultAudioManager (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å)
‚îú‚îÄ‚îÄ HealthChecker (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞)
‚îú‚îÄ‚îÄ DefaultAudioConfig (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
‚îî‚îÄ‚îÄ Types (—Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö)
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### DefaultAudioManager

–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–∞–º–∏:

- –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–æ–≤ —Å `device=None`
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Callback —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏–π

### HealthChecker

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ RMS –∞–Ω–∞–ª–∏–∑:

- –ê–Ω–∞–ª–∏–∑ RMS –∑–Ω–∞—á–µ–Ω–∏–π
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (HEALTHY/SILENT/ERROR)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–æ—Ä–æ–≥–∏
- Callback —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### DefaultAudioConfig

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è:

- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—É–¥–∏–æ (sample rate, channels, dtype)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ health check
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from modules.default_audio_manager import DefaultAudioManager, DefaultAudioConfig

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
config = DefaultAudioConfig()

# –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
manager = DefaultAudioManager(config)

# –ó–∞–ø—É—Å–∫
await manager.start()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
is_healthy = manager.is_healthy()

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
await manager.stop()
```

### –° –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

```python
from modules.default_audio_manager import DefaultAudioManager, DefaultAudioConfig

# –ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
config = DefaultAudioConfig(
    input_sample_rate=24000,
    health_check_interval=2.0,
    auto_reopen_on_error=True
)

manager = DefaultAudioManager(config)
```

### Async context manager

```python
async with DefaultAudioManager(config) as manager:
    # –†–∞–±–æ—Ç–∞ —Å –∞—É–¥–∏–æ
    audio_data = manager.get_audio_data()
    is_healthy = manager.is_healthy()
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### unified_config.yaml

```yaml
default_audio:
  input_sample_rate: 16000
  output_sample_rate: 48000
  input_channels: 1
  output_channels: 1
  dtype: "int16"
  chunk_size: 1024
  
  health_check_interval: 1.0
  health_check_duration: 0.3
  rms_threshold: 1e-4
  silent_threshold: 1e-6
  
  auto_reopen_on_error: true
  max_retry_attempts: 3
  retry_delay: 0.5
  error_cooldown: 2.0
  
  enable_debug_logging: false
  log_health_checks: true
  log_stream_events: true
```

## –°–æ–±—ã—Ç–∏—è

### StreamStateCallback

```python
def on_state_change(state: AudioStreamState):
    print(f"–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ç–æ–∫–∞: {state.value}")

config.on_stream_state_change = on_state_change
```

### HealthStatusCallback

```python
def on_health_change(status: HealthStatus):
    print(f"–°—Ç–∞—Ç—É—Å –∑–¥–æ—Ä–æ–≤—å—è: {status.value}")

config.on_health_status_change = on_health_change
```

### ErrorCallback

```python
def on_error(error: StreamError):
    print(f"–û—à–∏–±–∫–∞: {error.error_message}")

config.on_error = on_error
```

### MetricsCallback

```python
def on_metrics(metrics: AudioMetrics):
    print(f"RMS: {metrics.rms_value:.6f}")

config.on_metrics_update = on_metrics
```

## –°–æ—Å—Ç–æ—è–Ω–∏—è

### AudioStreamState

- `STOPPED` - –ü–æ—Ç–æ–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- `STARTING` - –ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–æ–≤
- `RUNNING` - –ü–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- `STOPPING` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–æ–≤
- `ERROR` - –û—à–∏–±–∫–∞ –≤ –ø–æ—Ç–æ–∫–∞—Ö

### HealthStatus

- `UNKNOWN` - –°—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω
- `HEALTHY` - –ú–∏–∫—Ä–æ—Ñ–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- `SILENT` - –ú–∏–∫—Ä–æ—Ñ–æ–Ω —Ç–∏—Ö–∏–π
- `ERROR` - –û—à–∏–±–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

## –ú–µ—Ç—Ä–∏–∫–∏

### AudioMetrics

- `rms_value` - RMS –∑–Ω–∞—á–µ–Ω–∏–µ
- `peak_value` - –ü–∏–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `sample_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ç–º–ø–ª–æ–≤
- `error_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- `last_health_check` - –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- `stream_uptime` - –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø–æ—Ç–æ–∫–∞

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç–∏–µ

–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º `auto_reopen_on_error` –º–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ç–æ–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

### Retry –ª–æ–≥–∏–∫–∞

- `max_retry_attempts` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
- `retry_delay` - –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- `error_cooldown` - –ü–∞—É–∑–∞ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- `enable_debug_logging` - –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏
- `log_health_checks` - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
- `log_stream_events` - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –ø–æ—Ç–æ–∫–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤

```
‚úÖ [AUDIO] –ê—É–¥–∏–æ –ø–æ—Ç–æ–∫–∏ –∑–∞–ø—É—â–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
üè• [HEALTH] –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è: healthy
üìä [METRICS] RMS: 0.004503, Peak: 0.012345
üîÑ [STATE] –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å: running
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –° EventBus

```python
from integration.integrations.default_audio_integration import DefaultAudioIntegration

integration = DefaultAudioIntegration(event_bus, state_manager, error_handler)
await integration.start()
```

### –° SpeechRecognizer

```python
# SpeechRecognizer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç device=None
stream = sd.InputStream(
    device=None,  # –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç
    samplerate=16000,
    channels=1,
    dtype="int16"
)
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

```bash
python3 quick_default_test.py
```

### –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
python3 test_default_audio_scenarios.py
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

```bash
python3 test_default_audio_integration.py
```

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å AudioDeviceManager

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å

1. –ó–∞–º–µ–Ω–∏—Ç—å `AudioDeviceIntegration` –Ω–∞ `DefaultAudioIntegration`
2. –£–±—Ä–∞—Ç—å `device_index` –∏–∑ `SpeechRecognizer`
3. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `unified_config.yaml`
4. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –º–æ–¥—É–ª—å `audio_device_manager`

### –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å

1. EventBus —Å–∏—Å—Ç–µ–º—É
2. ApplicationStateManager
3. ErrorHandler
4. –û—Å–Ω–æ–≤–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## Troubleshooting

### –ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ System Settings ‚Üí Privacy & Security ‚Üí Microphone
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ System Settings ‚Üí Sound ‚Üí Input
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### AirPods –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ AirPods –≤—ã–±—Ä–∞–Ω—ã –∏ –≤–æ Input, –∏ –≤ Output
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 0.5-1 —Å–µ–∫—É–Ω–¥—É –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ HFP
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Bluetooth –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –û—à–∏–±–∫–∏ –ø–æ—Ç–æ–∫–æ–≤

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –º–∏–∫—Ä–æ—Ñ–æ–Ω
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- –£–≤–µ–ª–∏—á–∏—Ç—å `health_check_interval` –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- –£–º–µ–Ω—å—à–∏—Ç—å `health_check_duration` –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- –û—Ç–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ production

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –°–ª–µ–¥–∏—Ç—å –∑–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏ `AudioMetrics`
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø–æ—Ç–æ–∫–æ–≤
